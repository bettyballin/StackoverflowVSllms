class Product < ApplicationRecord\n  # Paperclip attachment\n  has_attached_file :image\n  validates_attachment_content_type :image, content_type: ["image/jpeg", "image/png", "image/gif"]\n\n  # Virtual attribute to track the current action\n  attr_accessor :current_step\n\n  # Validations\n  validates :name, presence: true, format: { with: /^([a-zA-Z0-9\ \-]{3,128})$/i }, if: -> { current_step != 'image_upload' }\n  validates_attachment_presence :image, if: -> { current_step == 'image_upload' }\n\n  # Custom validation method to check for both name and image presence\n  validate :name_and_image_presence, unless: -> { current_step == 'image_upload' || current_step == 'data_update' }\n\n  private\n\n  def name_and_image_presence\n    errors.add(:name, "can't be blank") if name.blank?\n    errors.add(:image, "can't be blank") if image.blank?\n  end\nend