class WaitChannel < ApplicationCable::Channel\n       def subscribed\n         stream_from "wait_channel"\n         $redis.sadd("waiting_users", current_user.id)\n         check_for_pair\n       end\n\n       def unsubscribed\n         $redis.srem("waiting_users", current_user.id)\n       end\n\n       private\n\n       def check_for_pair\n         if $redis.scard("waiting_users") >= 2\n           user_ids = $redis.spop("waiting_users", 2)\n           ActionCable.server.broadcast("wait_channel", { pair: user_ids })\n         end\n       end\n     end