def wrap_long_string(txt, col = 20)\n  txt.split(/(<a[^>]*>.*?<\/a>)/).map do |part|\n    if part =~ /<a[^>]*>.*?<\/a>/\n      part\n    else\n      part.gsub(/(.{1,#{col}})( +|$\n?)|(.{1,#{col}})/, "\\1\\3\n")\n    end\n  end.join\nend\n\ndef process_text(text, col = 20)\n  auto_link(h(text)).then do |linked_text|\n    wrap_long_string(linked_text, col).gsub(/\n/, "<br />").html_safe\n  end\nend\n\n# Example usage\npost_text = "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa http://www.google.com/search?hl=en&client=firefox-a&rls=org.mozilla%3Aen-US%3Aofficial&hs=ZGF&q=example&btnG=Search"\nprocessed_text = process_text(post_text, 50)