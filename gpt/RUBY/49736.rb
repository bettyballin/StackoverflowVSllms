class ApplicationController < ActionController::Base\n  protect_from_forgery with: :exception\n\n  before_action :find_user\n\n  private\n\n  def find_user\n    if session[:user_id]\n      @current_user = User.find_by(id: session[:user_id])\n      unless @current_user\n        reset_session\n        @current_user = create_new_anonymous_user\n      end\n    else\n      @current_user = create_new_anonymous_user\n    end\n  end\n\n  def create_new_anonymous_user\n    user = User.create(is_anonymous: true)\n    session[:user_id] = user.id\n    user\n  end\n\n  def reset_session\n    session[:user_id] = nil\n  end\nend