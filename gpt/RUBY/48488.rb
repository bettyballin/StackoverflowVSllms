require 'rubygems'\nrequire 'nokogiri'\n\nvalue = Nokogiri::HTML.parse(<<-HTML_END)\n  "<html>\n    <body>\n      <p id='para-1'>A</p>\n      <p id='para-22'>B</p>\n      <h1>Bla</h1>\n      <p id='para-3'>C</p>\n      <p id='para-4'>D</p>\n      <div class="foo" id="eq-1_bl-1">\n        <p id='para-5'>3</p>\n      </div>\n    </body>\n  </html>"\nHTML_END\n\n# my_block is given\nmy_bl = "1"\n# my_eq corresponds to this regex\nmy_eq = "[0-9]+"\n\n# The following line is changed to an XPath search.\nxpath_query = "//div[@class='foo' and contains(@id, 'eq-') and contains(@id, '_bl-#{my_bl}') and @id =~ /eq-#{my_eq}_bl-#{my_bl}/]"\n\n# Find the div element using XPath\nif my_div = value.at_xpath(xpath_query)\n  # doing some stuff with the <p> inside the div\n  puts my_div.to_html\nend