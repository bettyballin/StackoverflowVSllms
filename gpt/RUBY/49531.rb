module SslRequirement\n  extend ActiveSupport::Concern\n\n  included do\n    before_action :ensure_proper_protocol\n  end\n\n  protected\n\n  def ensure_proper_protocol\n    return unless enforce_ssl?\n\n    if !request.ssl? && ssl_required?\n      redirect_to protocol: "https://", status: :moved_permanently\n    elsif request.ssl? && !ssl_required?\n      redirect_to protocol: "http://", status: :moved_permanently\n    end\n  end\n\n  def enforce_ssl?\n    Rails.env.production?\n  end\n\n  module ClassMethods\n    def ssl_required(*actions)\n      write_inheritable_array(:ssl_required_actions, actions)\n    end\n\n    def ssl_allowed(*actions)\n      write_inheritable_array(:ssl_allowed_actions, actions)\n    end\n  end\nend