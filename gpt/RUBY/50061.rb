class Product < ApplicationRecord\n  before_validation :generate_permalink\n\n  validate :permalink_must_not_overlap_with_reserved_routes\n\n  private\n\n  def generate_permalink\n    # Your permalink generation logic here\n  end\n\n  def permalink_must_not_overlap_with_reserved_routes\n    reserved_paths = fetch_reserved_paths\n    if reserved_paths.include?(permalink)\n      errors.add(:permalink, 'is reserved and cannot be used')\n    end\n  end\n\n  def fetch_reserved_paths\n    routes = Rails.application.routes.routes\n    routes.collect do |route|\n      path = route.path.spec.to_s.split(':').first\n      path.gsub(/[^a-z0-9_\-]/i, '').gsub(/^\//, '')\n    end.uniq\n  end\nend