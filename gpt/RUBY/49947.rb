require 'rexml/document'\ninclude REXML\n\n# Sample XHTML content\nxhtml_content = <<-XML\n<root>\n  <p>hello <span>world</span> a </p>\n  <p>Hi there </p>\n  <p>The End </p>\n</root>\nXML\n\n# Parse the XHTML content\ndoc = Document.new(xhtml_content)\n\n# Find and trim the last text node of each paragraph\nXPath.each(doc, '//root/p/text()[last()]') do |text_node|\n  text_node.value = text_node.value.rstrip\nend\n\n# Output the modified XHTML content\nformatter = REXML::Formatters::Pretty.new\nformatter.compact = true\nformatter.write(doc, $stdout)