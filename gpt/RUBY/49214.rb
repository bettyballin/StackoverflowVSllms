class RegistrationWizardController < ApplicationController\n  include Wicked::Wizard\n\n  steps :step1, :step2, :step3, :step4\n\n  def show\n    @user = User.find(session[:user_id])\n    render_wizard\n  end\n\n  def update\n    @user = User.find(session[:user_id])\n    @user.attributes = user_params(step)\n    if @user.valid?(step)\n      @user.save if step == steps.last\n      render_wizard @user\n    else\n      render_wizard @user, status: :unprocessable_entity\n    end\n  end\n\n  private\n\n  def user_params(step)\n    permitted_attributes = case step\n    when :step1\n      [:name, :email]\n    when :step2\n      [:phone, :address]\n    when :step3\n      [:profile_picture]\n    when :step4\n      [:terms_of_service]\n    else\n      []\n    end\n    params.require(:user).permit(permitted_attributes).merge(form_step: step.to_s)\n  end\nend