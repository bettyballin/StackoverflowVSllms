class Entry < ActiveRecord::Base\n  has_many :entry_tags\n  has_many :tags, through: :entry_tags\n\n  attr_writer :tag_names\n\n  validate :validate_tag_names\n\n  after_save :update_tags\n\n  def tag_names\n    @tag_names || tags.map(&:name).join(", ")\n  end\n\n  private\n\n  def update_tags\n    if @tag_names\n      self.tags = @tag_names.split(",").map do |name|\n        Tag.find_or_create_by(name: name.strip)\n      end\n    end\n  end\n\n  def validate_tag_names\n    if @tag_names\n      @tag_names.split(",").each do |name|\n        tag = Tag.new(name: name.strip)\n        unless tag.valid?\n          tag.errors.full_messages.each do |message|\n            errors.add(:tag_names, message)\n          end\n        end\n      end\n    end\n  end\nend