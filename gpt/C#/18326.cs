using System;\nusing System.Drawing;\nusing System.Drawing.Imaging;\n\npublic class JpegRotator\n{\n    public void RotateJpeg(string sourcePath, string targetPath, RotateFlipType rotateFlipType)\n    {\n        using (Image image = Image.FromFile(sourcePath))\n        {\n            ImageFormat sourceFormat = image.RawFormat;\n            EncoderParameters encoderParams = null;\n\n            try\n            {\n                if (sourceFormat.Guid == ImageFormat.Jpeg.Guid)\n                {\n                    encoderParams = new EncoderParameters(1);\n                    encoderParams.Param[0] = new EncoderParameter(Encoder.Transformation, GetEncoderValueForRotation(rotateFlipType));\n                }\n                else\n                {\n                    image.RotateFlip(rotateFlipType);\n                    encoderParams = new EncoderParameters(1);\n                    encoderParams.Param[0] = new EncoderParameter(Encoder.Quality, 100L);\n                }\n\n                image.Save(targetPath, GetEncoder(sourceFormat), encoderParams);\n            }\n            finally\n            {\n                if (encoderParams != null)\n                    encoderParams.Dispose();\n            }\n        }\n    }\n\n    private EncoderValue GetEncoderValueForRotation(RotateFlipType rotateFlipType)\n    {\n        switch (rotateFlipType)\n        {\n            case RotateFlipType.Rotate90FlipNone:\n                return EncoderValue.TransformRotate90;\n            case RotateFlipType.Rotate180FlipNone:\n                return EncoderValue.TransformRotate180;\n            case RotateFlipType.Rotate270FlipNone:\n                return EncoderValue.TransformRotate270;\n            default:\n                throw new NotSupportedException("Unsupported rotation type for lossless JPEG transformation.");\n        }\n    }\n\n    private ImageCodecInfo GetEncoder(ImageFormat format)\n    {\n        foreach (var info in ImageCodecInfo.GetImageEncoders())\n            if (info.FormatID == format.Guid)\n                return info;\n        return null;\n    }\n}