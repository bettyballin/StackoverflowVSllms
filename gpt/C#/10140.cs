connection.Open();\nvar cmd = new SqlCommand(@"GetNextSms", connection) { CommandType = CommandType.StoredProcedure };\nSqlParameter param = cmd.Parameters.Add("@SmsId", SqlDbType.UniqueIdentifier);\nparam.Direction = ParameterDirection.Output;\nparam = cmd.Parameters.Add("@ToNumber", SqlDbType.VarChar, 50);\nparam.Direction = ParameterDirection.Output;\nparam = cmd.Parameters.Add("@SmsContent", SqlDbType.NVarChar, 1024);\nparam.Direction = ParameterDirection.Output;\nparam = cmd.Parameters.Add("@TimeAccepted", SqlDbType.DateTime);\nparam.Direction = ParameterDirection.Output;\n\nif (cmd.ExecuteNonQuery() > 0)\n{\n    sms = new Sms\n    {\n        SmsId = ((Guid)cmd.Parameters["@SmsId"].Value),\n        Content = (string)cmd.Parameters["@SmsContent"].Value,\n        ToNumber = (string)cmd.Parameters["@ToNumber"].Value,\n        TimeAccepted = ((DateTime)cmd.Parameters["@TimeAccepted"].Value)\n    };\n}