protected void Application_Error(object sender, EventArgs e)\n{\n    Exception exception = Server.GetLastError();\n    \n    if (exception is HttpRequestValidationException)\n    {\n        Server.ClearError();\n        \n        if (IsAjaxRequest())\n        {\n            Response.ContentType = "application/json";\n            Response.StatusCode = 400;\n            Response.Write("{\"error\":\"Invalid input detected.\"}");\n            Response.End();\n        }\n        else\n        {\n            Response.Redirect("~/ErrorPages/ValidationError.aspx");\n        }\n    }\n}\n\nprivate bool IsAjaxRequest()\n{\n    return (Request.Headers["X-Requested-With"] == "XMLHttpRequest");\n}