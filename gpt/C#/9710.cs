private void button1_Click(object sender, EventArgs e)\n{\n    Layer1();\n    MessageBox.Show("OK");\n}\n\nprivate void Layer1()\n{\n    try\n    {\n        Layer2(); // This will cause a SecurityException\n    }\n    catch (SecurityException)\n    {\n        MessageBox.Show("Caught"); // This will be displayed\n    }\n    Layer2b(); // This call will succeed\n}\n\nprivate void Layer2()\n{\n    new System.Security.Permissions.FileIOPermission(PermissionState.Unrestricted).Deny();\n    GC.Collect(); // Garbage collection does not affect the denial\n    Layer3(); // This will throw a SecurityException\n}\n\nprivate void Layer2b()\n{\n    Layer3(); // This call will succeed because no Deny is in effect\n}\n\n[FileIOPermission(SecurityAction.LinkDemand, Write=@"C:\temp")]\nprivate void Layer3()\n{\n    using (FileStream stream = new FileStream(@"C:\temp\test.txt", FileMode.Create))\n    {\n        // File operation code\n    }\n}