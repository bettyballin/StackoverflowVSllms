using System;\nusing System.Collections.Generic;\nusing System.Data.SqlClient;\n\npublic class EmailScheduler\n{\n    private static Dictionary<int, string> GetUserTimeZones()\n    {\n        var userTimeZones = new Dictionary<int, string>();\n\n        // Replace with your actual connection string\n        string connectionString = "your_connection_string";\n        string query = "SELECT UserID, TimeZoneId FROM Users";\n\n        using (SqlConnection conn = new SqlConnection(connectionString))\n        {\n            SqlCommand cmd = new SqlCommand(query, conn);\n            conn.Open();\n            \n            using (SqlDataReader reader = cmd.ExecuteReader())\n            {\n                while (reader.Read())\n                {\n                    int userId = reader.GetInt32(0);\n                    string timeZoneId = reader.GetString(1);\n                    userTimeZones[userId] = timeZoneId;\n                }\n            }\n        }\n\n        return userTimeZones;\n    }\n\n    public static void ScheduleEmails()\n    {\n        var userTimeZones = GetUserTimeZones();\n        DateTime serverTime = DateTime.UtcNow;\n\n        foreach (var userTimeZone in userTimeZones)\n        {\n            int userId = userTimeZone.Key;\n            string timeZoneId = userTimeZone.Value;\n            \n            TimeZoneInfo userTimeZoneInfo = TimeZoneInfo.FindSystemTimeZoneById(timeZoneId);\n            DateTime userLocalTime = TimeZoneInfo.ConvertTimeFromUtc(serverTime, userTimeZoneInfo);\n\n            // Calculate next hourly interval\n            DateTime nextHour = new DateTime(userLocalTime.Year, userLocalTime.Month, userLocalTime.Day, userLocalTime.Hour, 0, 0).AddHours(1);\n\n            // Convert back to server time (UTC)\n            DateTime nextEmailTime = TimeZoneInfo.ConvertTimeToUtc(nextHour, userTimeZoneInfo);\n\n            // Schedule email to be sent at nextEmailTime (server time)\n            // Implement your email scheduling logic here\n            Console.WriteLine($"Schedule email for User {userId} at {nextEmailTime} (server time)");\n        }\n    }\n}