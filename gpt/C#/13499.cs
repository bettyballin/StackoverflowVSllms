using (var transaction = session.BeginTransaction())\n   {\n       try\n       {\n           var customer = new Customer { Name = "John Doe" };\n           session.Save(customer);\n\n           var order = new Order { Customer = customer, OrderDate = DateTime.Now };\n           session.Save(order);\n\n           transaction.Commit();\n       }\n       catch (Exception)\n       {\n           transaction.Rollback();\n           throw;\n       }\n   }