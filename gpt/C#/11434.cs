using System;\nusing System.Xml;\nusing System.Xml.XPath;\n\nclass Program\n{\n    static void Main()\n    {\n        string sourceXml = @"\n<a>\n  <x>\n  <b>\n    <c/>\n    <z/>\n  </b>\n  <c/>\n</a>\n<c/>\n<d><e/></d>";\n\n        XmlDocument doc = new XmlDocument();\n        doc.LoadXml(sourceXml);\n\n        XPathNavigator nav = doc.CreateNavigator();\n        XPathExpression expr = nav.Compile("//c");\n\n        XmlDocument resultDoc = new XmlDocument();\n        XmlElement root = resultDoc.CreateElement("root");\n        resultDoc.AppendChild(root);\n\n        XPathNodeIterator iterator = nav.Select(expr);\n        while (iterator.MoveNext())\n        {\n            XPathNavigator currentNode = iterator.Current;\n            XmlNode importedNode = ImportNodeWithAncestors(resultDoc, currentNode);\n            if (importedNode != null)\n            {\n                root.AppendChild(importedNode);\n            }\n        }\n\n        resultDoc.Save("filtered.xml");\n    }\n\n    static XmlNode ImportNodeWithAncestors(XmlDocument resultDoc, XPathNavigator node)\n    {\n        XmlNode importedNode = null;\n        XmlNode lastImportedNode = null;\n\n        while (node != null)\n        {\n            XmlNode currentNode = resultDoc.ImportNode(((IHasXmlNode)node).GetNode(), false);\n            if (importedNode == null)\n            {\n                importedNode = currentNode;\n            }\n            else\n            {\n                lastImportedNode.PrependChild(currentNode);\n            }\n\n            lastImportedNode = currentNode;\n            node = node.SelectSingleNode("..");\n        }\n\n        return importedNode;\n    }\n}