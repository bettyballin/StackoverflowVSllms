using System;\nusing System.Diagnostics;\nusing System.Security.Principal;\nusing System.Runtime.InteropServices;\n\npublic class ImpersonationHelper\n{\n    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Auto)]\n    public static extern bool LogonUser(\n        string lpszUsername, string lpszDomain, string lpszPassword,\n        int dwLogonType, int dwLogonProvider, out IntPtr phToken);\n\n    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]\n    public extern static bool CloseHandle(IntPtr handle);\n\n    public static void DeletePerformanceCounterCategory(string categoryName, string username, string domain, string password)\n    {\n        IntPtr tokenHandle = IntPtr.Zero;\n        try\n        {\n            const int LOGON32_PROVIDER_DEFAULT = 0;\n            const int LOGON32_LOGON_INTERACTIVE = 2;\n\n            tokenHandle = IntPtr.Zero;\n\n            bool returnValue = LogonUser(username, domain, password, LOGON32_LOGON_INTERACTIVE, LOGON32_PROVIDER_DEFAULT, out tokenHandle);\n\n            if (!returnValue)\n            {\n                int ret = Marshal.GetLastWin32Error();\n                throw new System.ComponentModel.Win32Exception(ret);\n            }\n\n            using (WindowsIdentity newId = new WindowsIdentity(tokenHandle))\n            {\n                using (WindowsImpersonationContext impersonatedUser = newId.Impersonate())\n                {\n                    if (PerformanceCounterCategory.Exists(categoryName))\n                    {\n                        PerformanceCounterCategory.Delete(categoryName);\n                    }\n                }\n            }\n        }\n        catch (Exception ex)\n        {\n            throw new InvalidOperationException("Failed to delete performance counter category due to: " + ex.Message, ex);\n        }\n        finally\n        {\n            if (tokenHandle != IntPtr.Zero)\n            {\n                CloseHandle(tokenHandle);\n            }\n        }\n    }\n}