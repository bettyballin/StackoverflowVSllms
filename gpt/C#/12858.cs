using System;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic class DatabaseManager : IDisposable\n{\n    private readonly string _connectionString;\n    private SqlConnection _connection;\n    private SqlTransaction _transaction;\n\n    public DatabaseManager(string connectionString)\n    {\n        _connectionString = connectionString;\n        _connection = new SqlConnection(_connectionString);\n        _connection.Open();\n    }\n\n    public void BeginTransaction()\n    {\n        _transaction = _connection.BeginTransaction();\n    }\n\n    public void CommitTransaction()\n    {\n        _transaction?.Commit();\n    }\n\n    public void RollbackTransaction()\n    {\n        _transaction?.Rollback();\n    }\n\n    public void ExecuteCommand(Action<SqlCommand> commandAction)\n    {\n        using (SqlCommand command = _connection.CreateCommand())\n        {\n            command.Transaction = _transaction;\n            commandAction(command);\n        }\n    }\n\n    public void Dispose()\n    {\n        _transaction?.Dispose();\n        if (_connection != null)\n        {\n            _connection.Close();\n            _connection.Dispose();\n        }\n    }\n}\n\n// Example usage\npublic class DataInserter\n{\n    private readonly DatabaseManager _dbManager;\n\n    public DataInserter(DatabaseManager dbManager)\n    {\n        _dbManager = dbManager;\n    }\n\n    public void InsertData()\n    {\n        try\n        {\n            _dbManager.BeginTransaction();\n\n            _dbManager.ExecuteCommand(command =>\n            {\n                command.CommandText = "INSERT INTO Table1 (Column1) VALUES (@Value1); SELECT SCOPE_IDENTITY();";\n                command.Parameters.AddWithValue("@Value1", "SomeValue");\n                int id = Convert.ToInt32(command.ExecuteScalar());\n\n                command.CommandText = "INSERT INTO Table2 (Table1Id, Column2) VALUES (@Table1Id, @Value2)";\n                command.Parameters.AddWithValue("@Table1Id", id);\n                command.Parameters.AddWithValue("@Value2", "SomeOtherValue");\n                command.ExecuteNonQuery();\n            });\n\n            _dbManager.CommitTransaction();\n        }\n        catch (Exception)\n        {\n            _dbManager.RollbackTransaction();\n            throw;\n        }\n    }\n}\n\n// Usage example\nclass Program\n{\n    static void Main()\n    {\n        string connectionString = "YourConnectionStringHere";\n\n        using (var dbManager = new DatabaseManager(connectionString))\n        {\n            var inserter = new DataInserter(dbManager);\n            inserter.InsertData();\n        }\n    }\n}