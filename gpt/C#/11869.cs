<%@ WebHandler Language="C#" Class="StreamAudio" %>\n\nusing System;\nusing System.Web;\n\npublic class StreamAudio : IHttpHandler\n{\n    public void ProcessRequest(HttpContext context)\n    {\n        string filePath = context.Server.MapPath("~/protected_mp3/" + context.Request.QueryString["file"]);\n        \n        if (System.IO.File.Exists(filePath))\n        {\n            context.Response.Clear();\n            context.Response.ContentType = "audio/mpeg";\n            context.Response.AddHeader("Content-Disposition", "inline; filename=" + System.IO.Path.GetFileName(filePath));\n            context.Response.Cache.SetCacheability(HttpCacheability.NoCache);\n            context.Response.Cache.SetNoStore();\n            context.Response.Cache.SetExpires(DateTime.MinValue);\n\n            System.IO.FileStream fs = System.IO.File.OpenRead(filePath);\n            byte[] buffer = new byte[1024];\n            int bytesRead;\n            while ((bytesRead = fs.Read(buffer, 0, buffer.Length)) > 0)\n            {\n                context.Response.OutputStream.Write(buffer, 0, bytesRead);\n            }\n            fs.Close();\n            context.Response.End();\n        }\n        else\n        {\n            context.Response.StatusCode = 404;\n            context.Response.StatusDescription = "File not found";\n        }\n    }\n\n    public bool IsReusable\n    {\n        get { return false; }\n    }\n}