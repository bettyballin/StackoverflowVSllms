using NHibernate.Criterion;\nusing NHibernate.Linq;\nusing System.Linq;\n\n// Your test code\nvar dei1 = BuildDeriveModule();\n\nvar sessionSource = Injector.Resolve();\n\nusing (var session = sessionSource.CreateSession())\n{\n    using (var transaction = session.BeginTransaction())\n    {\n        session.Save(dei1);\n        transaction.Commit();\n    }\n}\n\nModule item = null;\nusing (var session = sessionSource.CreateSession())\n{\n    item = session\n        .Query<Module>()\n        .Where(m => m.ModuleId == dei1.ModuleId)\n        .Fetch(m => m.Variables) // Eagerly fetch Variables collection\n        .Fetch(m => m.OptionalStrata) // Eagerly fetch OptionalStrata collection\n        .SingleOrDefault();\n\n    Assert.Equal(dei1, item);\n    Assert.Equal(4, item.Variables.Count);\n}