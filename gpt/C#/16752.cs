using System;\nusing System.Data;\nusing System.Linq;\n\npublic void CopyData(DataSet sourceDataSet, DataSet targetDataSet, string filter)\n{\n    // Assuming sourceDataSet has "Master" and "Details" DataTables\n    DataTable masterTable = sourceDataSet.Tables["Master"];\n    DataTable detailsTable = sourceDataSet.Tables["Details"];\n\n    // Create new tables for the target DataSet\n    DataTable targetMasterTable = masterTable.Clone();\n    DataTable targetDetailsTable = detailsTable.Clone();\n\n    // Copy filtered master rows\n    var filteredMasterRows = masterTable.AsEnumerable()\n                                        .Where(row => row.Field<string>("ColumnA") == filter);\n    foreach (DataRow masterRow in filteredMasterRows)\n    {\n        targetMasterTable.ImportRow(masterRow);\n\n        // Copy corresponding details rows\n        var detailRows = masterRow.GetChildRows("MasterDetailsRelation");\n        foreach (DataRow detailRow in detailRows)\n        {\n            targetDetailsTable.ImportRow(detailRow);\n        }\n    }\n\n    // Add the new tables to the target DataSet\n    targetDataSet.Tables.Add(targetMasterTable);\n    targetDataSet.Tables.Add(targetDetailsTable);\n\n    // Create the same relation in target DataSet\n    targetDataSet.Relations.Add("MasterDetailsRelation", targetMasterTable.Columns["MasterId"], targetDetailsTable.Columns["MasterId"]);\n}