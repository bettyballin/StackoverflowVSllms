protected void AddPhotoToDatabase()\n{\n    byte[] OriginalPhoto = GetImage();\n    byte[] Thumbnail = GenerateThumbnail();\n    string Title = FileUpload1.FileName.ToString();\n    string sql = "INSERT INTO [ProfileGallery] ([UserId], [Title], [OriginalImage], [ThumbImage]) VALUES (@UserId, @Title, @OriginalImage, @ThumbImage)";\n    string strCon = System.Web.Configuration.WebConfigurationManager.ConnectionStrings["SocialSiteConnectionString"].ConnectionString;\n\n    using (SqlConnection conn = new SqlConnection(strCon))\n    {\n        using (SqlCommand comm = new SqlCommand(sql, conn))\n        {\n            comm.Parameters.AddWithValue("@UserId", User.Identity.Name);\n            comm.Parameters.AddWithValue("@Title", Title);\n            comm.Parameters.AddWithValue("@OriginalImage", OriginalPhoto);\n            comm.Parameters.AddWithValue("@ThumbImage", Thumbnail);\n\n            conn.Open();\n            comm.ExecuteNonQuery();\n        }\n    }\n}\n\nprotected byte[] GetImage()\n{\n    byte[] photo = new byte[FileUpload1.PostedFile.ContentLength];\n    FileUpload1.PostedFile.InputStream.Read(photo, 0, photo.Length);\n    return photo;\n}\n\nprotected byte[] GenerateThumbnail()\n{\n    System.Drawing.Image image = System.Drawing.Image.FromStream(FileUpload1.PostedFile.InputStream);\n    double thumbwidth = 0;\n    double thumbheight = 0;\n    double imgsz = 150.0;\n\n    if (imgsz / image.Width < imgsz / image.Height)\n    {\n        thumbwidth = image.Width * (imgsz / image.Width);\n        thumbheight = image.Height * (imgsz / image.Width);\n    }\n    else\n    {\n        thumbwidth = image.Width * (imgsz / image.Height);\n        thumbheight = image.Height * (imgsz / image.Height);\n    }\n\n    System.Drawing.Image thumb = image.GetThumbnailImage((int)thumbwidth, (int)thumbheight, delegate() { return false; }, IntPtr.Zero);\n    MemoryStream ms = new MemoryStream();\n    thumb.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);\n    return ms.ToArray();\n}