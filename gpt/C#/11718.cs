public void ReadWholeArray(string fileName, byte[] data)\n{\n    int offset = 0;\n    int remaining = data.Length;\n\n    log.Debug("ReadWholeArray");\n\n    try\n    {\n        using (FileStream fileStream = new FileStream(fileName, FileMode.Open, FileAccess.Read, FileShare.Read, bufferSize: 4096, useAsync: true))\n        using (BufferedStream bufferedStream = new BufferedStream(fileStream, bufferSize: 81920)) // 80KB buffer\n        {\n            while (remaining > 0)\n            {\n                int read = bufferedStream.Read(data, offset, remaining);\n                if (read <= 0)\n                    throw new EndOfStreamException($"End of stream reached with {remaining} bytes left to read");\n                remaining -= read;\n                offset += read;\n            }\n        }\n    }\n    catch (IOException ex)\n    {\n        log.Error("IOException occurred while reading the file", ex);\n        throw;\n    }\n}