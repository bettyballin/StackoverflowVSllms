public TestQueryResponseMessage TestQuery(TestQueryRequestMessage message)\n{\n    var xml = ParamsToXml(message.Body.Params);\n    var result = Repository.ExecuteQuery("TestQuery", xml);\n\n    return new TestQueryResponseMessage\n    {\n        Body = new TestQueryResponse\n        {\n            TopicItems = result\n        }\n    };\n}\n\nprivate string ParamsToXml(Dictionary<string, string> nvc)\n{\n    var settings = new XmlWriterSettings\n    {\n        OmitXmlDeclaration = true,\n        Indent = false,\n        ConformanceLevel = ConformanceLevel.Fragment\n    };\n\n    using (var sw = new StringWriter())\n    using (var xw = XmlWriter.Create(sw, settings))\n    {\n        xw.WriteStartElement("params");\n        foreach (var param in nvc)\n        {\n            xw.WriteStartElement("param");\n            xw.WriteElementString(param.Key, SecurityElement.Escape(param.Value));\n            xw.WriteEndElement();\n        }\n        xw.WriteEndElement();\n        xw.Flush();\n        return sw.ToString();\n    }\n}