using System;\nusing System.Collections;\nusing System.ComponentModel;\nusing System.Configuration.Install;\nusing System.Diagnostics;\nusing System.DirectoryServices;\n\nnamespace CustomAction\n{\n    [RunInstaller(true)]\n    public partial class Installer1 : Installer\n    {\n        public Installer1()\n        {\n            InitializeComponent();\n        }\n\n        public override void Install(IDictionary stateSaver)\n        {\n            base.Install(stateSaver);\n            CreateAppPool();\n        }\n\n        private void CreateAppPool()\n        {\n            string appPoolName = "MyNewAppPool";\n            string userName = "domain\\username";\n            string password = "password";\n\n            try\n            {\n                DirectoryEntry appPools = new DirectoryEntry("IIS://localhost/W3SVC/AppPools");\n                DirectoryEntry newPool = appPools.Children.Add(appPoolName, "IIsApplicationPool");\n                newPool.CommitChanges();\n\n                DirectoryEntry pool = new DirectoryEntry($"IIS://localhost/W3SVC/AppPools/{appPoolName}");\n                pool.Properties["AppPoolIdentityType"].Value = 3; // 3 means configurable identity\n                pool.Properties["WAMUserName"].Value = userName;\n                pool.Properties["WAMUserPass"].Value = password;\n                pool.CommitChanges();\n            }\n            catch (Exception ex)\n            {\n                EventLog.WriteEntry("Application", "Error creating app pool: " + ex.Message);\n                throw;\n            }\n        }\n    }\n}