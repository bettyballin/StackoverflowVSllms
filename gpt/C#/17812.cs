using System.IO.Compression;\nusing System.Web;\n\npublic class CompressionModule : IHttpModule\n{\n    public void Init(HttpApplication context)\n    {\n        context.PreRequestHandlerExecute += (sender, e) =>\n        {\n            var app = (HttpApplication)sender;\n            var acceptEncoding = app.Request.Headers["Accept-Encoding"];\n            if (!string.IsNullOrEmpty(acceptEncoding) && acceptEncoding.Contains("gzip"))\n            {\n                app.Response.Filter = new GZipStream(app.Response.Filter, CompressionMode.Compress);\n                app.Response.AppendHeader("Content-Encoding", "gzip");\n            }\n        };\n    }\n\n    public void Dispose() { }\n}