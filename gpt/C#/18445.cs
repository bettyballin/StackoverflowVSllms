using System.ServiceModel.Description;\nusing System.ServiceModel.Dispatcher;\n\npublic class IPFilterBehavior : IServiceBehavior\n{\n    private readonly string[] allowedIPs;\n\n    public IPFilterBehavior(string[] allowedIPs)\n    {\n        this.allowedIPs = allowedIPs;\n    }\n\n    public void AddBindingParameters(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase, Collection<ServiceEndpoint> endpoints, BindingParameterCollection bindingParameters) { }\n\n    public void ApplyDispatchBehavior(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase)\n    {\n        foreach (ChannelDispatcher channelDispatcher in serviceHostBase.ChannelDispatchers)\n        {\n            foreach (var endpointDispatcher in channelDispatcher.Endpoints)\n            {\n                endpointDispatcher.DispatchRuntime.MessageInspectors.Add(new IPFilterMessageInspector(allowedIPs));\n            }\n        }\n    }\n\n    public void Validate(ServiceDescription serviceDescription, ServiceHostBase serviceHostBase) { }\n}