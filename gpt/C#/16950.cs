using System;\nusing System.Diagnostics;\nusing System.Threading;\n\npublic class CpuLimiter\n{\n    private readonly int _maxCpuPercentage;\n    private readonly Stopwatch _stopwatch;\n    \n    public CpuLimiter(int maxCpuPercentage)\n    {\n        if (maxCpuPercentage <= 0 || maxCpuPercentage > 100)\n        {\n            throw new ArgumentOutOfRangeException(nameof(maxCpuPercentage), "CPU percentage should be between 1 and 100.");\n        }\n\n        _maxCpuPercentage = maxCpuPercentage;\n        _stopwatch = new Stopwatch();\n    }\n\n    public void ExecuteWithCpuLimit(Action action)\n    {\n        // Calculate the amount of sleep time needed to achieve the desired CPU usage\n        double targetExecutionTime = _maxCpuPercentage / 100.0;\n        double targetSleepTime = 1.0 - targetExecutionTime;\n\n        while (true)\n        {\n            _stopwatch.Restart();\n            action.Invoke();\n            _stopwatch.Stop();\n\n            double elapsedTime = _stopwatch.Elapsed.TotalMilliseconds;\n\n            // Calculate sleep time to control CPU usage\n            int sleepTime = (int)(elapsedTime * targetSleepTime / targetExecutionTime);\n            if (sleepTime > 0)\n            {\n                Thread.Sleep(sleepTime);\n            }\n        }\n    }\n}