SPSecurity.RunWithElevatedPrivileges(\n    delegate\n    {\n        using (SPSite elevatedSite = new SPSite(SPContext.Current.Site.Url))\n        using (SPWeb targetWeb = elevatedSite.OpenWeb(webUrl))\n        {\n            targetWeb.AllowUnsafeUpdates = true;\n            SPUser currentUser = SPContext.Current.Web.CurrentUser;\n            SPFile newFile = files.Add(filename, file);\n            SPListItem item = newFile.Item;\n\n            // Set the Modified By field to the current user\n            item["Editor"] = currentUser;\n            item["Modified By"] = currentUser;\n\n            item.SystemUpdate();\n\n            // Reset AllowUnsafeUpdates\n            targetWeb.AllowUnsafeUpdates = false;\n        }\n    }\n);