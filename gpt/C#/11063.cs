using System;\nusing System.DirectoryServices;\nusing System.DirectoryServices.ActiveDirectory;\n\nstatic void Main(string[] args) {\n    string spn = "K2Server/jonathand-vpc:5252";\n    try {\n        ValidateSPN(spn);\n        Console.WriteLine("SPN is valid and not duplicated.");\n    } catch (Exception ex) {\n        Console.WriteLine(ex.Message);\n    }\n}\n\nstatic void ValidateSPN(string spn) {\n    const string queryFormat = "(servicePrincipalName={0})";\n    using (Domain localDomain = Domain.GetCurrentDomain()) {\n        using (DirectoryEntry entry = localDomain.GetDirectoryEntry()) {\n            using (DirectorySearcher search = new DirectorySearcher(entry)) {\n                search.Filter = string.Format(queryFormat, spn);\n                search.SearchScope = SearchScope.Subtree;\n                SearchResultCollection collection = search.FindAll();\n                if (collection.Count > 1)\n                    throw new Exception("Duplicate SPNs found.");\n                else if (collection.Count == 0)\n                    throw new Exception("No such SPN");\n            }\n        }\n    }\n}