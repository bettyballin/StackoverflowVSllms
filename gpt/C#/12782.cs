using System;\nusing System.Net;\nusing System.Threading.Tasks;\n\npublic class WebServer\n{\n    private readonly HttpListener _listener = new HttpListener();\n\n    public WebServer(string[] prefixes)\n    {\n        if (prefixes == null || prefixes.Length == 0)\n            throw new ArgumentException("prefixes");\n\n        foreach (string prefix in prefixes)\n            _listener.Prefixes.Add(prefix);\n    }\n\n    public async Task StartAsync()\n    {\n        _listener.Start();\n        while (true)\n        {\n            var context = await _listener.GetContextAsync();\n            var request = context.Request;\n\n            if (request.HttpMethod == "POST")\n            {\n                using (var reader = new System.IO.StreamReader(request.InputStream, request.ContentEncoding))\n                {\n                    string key = await reader.ReadToEndAsync();\n                    var device = new PhonyOposDevice();\n                    device.SendKeyPress(key);\n                }\n            }\n\n            var response = context.Response;\n            string responseString = "OK";\n            byte[] buffer = System.Text.Encoding.UTF8.GetBytes(responseString);\n            response.ContentLength64 = buffer.Length;\n            using (var output = response.OutputStream)\n            {\n                await output.WriteAsync(buffer, 0, buffer.Length);\n            }\n        }\n    }\n\n    public void Stop()\n    {\n        _listener.Stop();\n        _listener.Close();\n    }\n}