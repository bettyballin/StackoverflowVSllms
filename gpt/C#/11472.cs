using System;\nusing System.Data;\nusing System.IO;\nusing System.Text;\nusing System.Xml;\n\n// Your existing code to create and fill the DataSet\nDataSet dSet = new DataSet();\n// Load schema, fill data in\ndSet.WriteXml("testFile.xml");\n\n// Create a MemoryStream\nusing (MemoryStream stream = new MemoryStream())\n{\n    // Create an XmlWriterSettings object with the desired settings.\n    XmlWriterSettings settings = new XmlWriterSettings\n    {\n        Encoding = new UTF8Encoding(false), // No BOM\n        Indent = true,\n        OmitXmlDeclaration = false\n    };\n\n    // Create an XmlWriter with the settings.\n    using (XmlWriter writer = XmlWriter.Create(stream, settings))\n    {\n        // Write the DataSet to the XmlWriter.\n        dSet.WriteXml(writer);\n    }\n\n    // Reset the stream position to the beginning.\n    stream.Seek(0, SeekOrigin.Begin);\n\n    // Read the stream as a string for demonstration purposes.\n    using (StreamReader reader = new StreamReader(stream))\n    {\n        string result = reader.ReadToEnd();\n        Console.WriteLine(result); // This will include the XML declaration\n    }\n}