using System;\nusing System.Runtime.InteropServices;\nusing System.ServiceProcess;\n\npublic class ServiceAccountChanger\n{\n    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Auto)]\n    private static extern bool ChangeServiceConfig(\n        IntPtr hService,\n        uint nServiceType,\n        uint nStartType,\n        uint nErrorControl,\n        string lpBinaryPathName,\n        string lpLoadOrderGroup,\n        IntPtr lpdwTagId,\n        [In] char[] lpDependencies,\n        string lpServiceStartName,\n        string lpPassword,\n        string lpDisplayName);\n\n    [DllImport("advapi32.dll", SetLastError = true)]\n    private static extern IntPtr OpenService(\n        IntPtr hSCManager,\n        string lpServiceName,\n        uint dwDesiredAccess);\n\n    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Auto)]\n    private static extern IntPtr OpenSCManager(\n        string lpMachineName,\n        string lpDatabaseName,\n        uint dwDesiredAccess);\n\n    [DllImport("advapi32.dll", SetLastError = true)]\n    private static extern bool CloseServiceHandle(IntPtr hSCObject);\n\n    private const uint SERVICE_NO_CHANGE = 0xFFFFFFFF;\n    private const uint SC_MANAGER_ALL_ACCESS = 0xF003F;\n    private const uint SERVICE_CHANGE_CONFIG = 0x0002;\n\n    public static void ChangeServiceLogon(string serviceName, string username, string password)\n    {\n        IntPtr scm = OpenSCManager(null, null, SC_MANAGER_ALL_ACCESS);\n        if (scm == IntPtr.Zero)\n        {\n            throw new Exception("Could not open service control manager.");\n        }\n\n        IntPtr service = OpenService(scm, serviceName, SERVICE_CHANGE_CONFIG);\n        if (service == IntPtr.Zero)\n        {\n            CloseServiceHandle(scm);\n            throw new Exception("Could not open service.");\n        }\n\n        bool result = ChangeServiceConfig(\n            service,\n            SERVICE_NO_CHANGE,\n            SERVICE_NO_CHANGE,\n            SERVICE_NO_CHANGE,\n            null,\n            null,\n            IntPtr.Zero,\n            null,\n            username,\n            password,\n            null);\n\n        if (!result)\n        {\n            throw new Exception("Could not change service configuration.");\n        }\n\n        CloseServiceHandle(service);\n        CloseServiceHandle(scm);\n    }\n}