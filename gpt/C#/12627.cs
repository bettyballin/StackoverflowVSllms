public class CustomAuthorizeAttribute : AuthorizeAttribute\n{\n    protected override void HandleUnauthorizedRequest(AuthorizationContext filterContext)\n    {\n        if (filterContext.HttpContext.Request.IsAjaxRequest())\n        {\n            // Return 401 for AJAX requests\n            filterContext.HttpContext.Response.StatusCode = 401;\n            filterContext.Result = new JsonResult\n            {\n                Data = new { message = "Unauthorized" },\n                JsonRequestBehavior = JsonRequestBehavior.AllowGet\n            };\n        }\n        else\n        {\n            // Redirect to login page for regular requests\n            filterContext.Result = new RedirectResult("~/Account/Login?ReturnUrl=" + filterContext.HttpContext.Server.UrlEncode(filterContext.HttpContext.Request.RawUrl));\n        }\n    }\n}