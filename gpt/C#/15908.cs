try\n{\n    string domainUser = filterContext.HttpContext.User.Identity.Name;\n\n    // Log the domain user for debugging\n    System.Diagnostics.Debug.WriteLine("Domain User: " + domainUser);\n\n    WindowsIdentity windowsIdentity = filterContext.HttpContext.User.Identity as WindowsIdentity;\n\n    if (windowsIdentity != null)\n    {\n        using (WindowsImpersonationContext impersonationContext = windowsIdentity.Impersonate())\n        {\n            try\n            {\n                DirectoryEntry userEntry = new DirectoryEntry("WinNT://" + domainUser.Replace('\\', '/') + ",User");\n                filterContext.Controller.ViewData["User"] = (string)userEntry.Properties["fullname"].Value;\n            }\n            catch (Exception ex)\n            {\n                // Log the exception for debugging\n                System.Diagnostics.Debug.WriteLine("Exception: " + ex.Message);\n                filterContext.Controller.ViewData["User"] = domainUser;\n            }\n        }\n    }\n    else\n    {\n        // Log that the WindowsIdentity was null\n        System.Diagnostics.Debug.WriteLine("WindowsIdentity was null.");\n        filterContext.Controller.ViewData["User"] = domainUser;\n    }\n}\ncatch (Exception ex)\n{\n    // Log the exception for debugging\n    System.Diagnostics.Debug.WriteLine("Exception: " + ex.Message);\n    filterContext.Controller.ViewData["User"] = "Unknown User";\n}