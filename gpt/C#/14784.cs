using System;\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        string input = "arg1 arg2 \"arg 3 with spaces\" arg4";\n        string[] splitArgs = SplitCommandLine(input);\n\n        foreach (var arg in splitArgs)\n        {\n            Console.WriteLine(arg);\n        }\n    }\n\n    static string[] SplitCommandLine(string commandLine)\n    {\n        var args = new System.Collections.Generic.List<string>();\n        var currentArg = new System.Text.StringBuilder();\n        bool inQuotes = false;\n\n        for (int i = 0; i < commandLine.Length; i++)\n        {\n            char c = commandLine[i];\n\n            if (c == '\"')\n            {\n                inQuotes = !inQuotes;\n            }\n            else if (c == ' ' && !inQuotes)\n            {\n                if (currentArg.Length > 0)\n                {\n                    args.Add(currentArg.ToString());\n                    currentArg.Clear();\n                }\n            }\n            else\n            {\n                currentArg.Append(c);\n            }\n        }\n\n        if (currentArg.Length > 0)\n        {\n            args.Add(currentArg.ToString());\n        }\n\n        return args.ToArray();\n    }\n}