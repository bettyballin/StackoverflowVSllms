using System;\nusing System.Data.SqlClient;\nusing System.Runtime.InteropServices;\nusing System.Security.Principal;\n\npublic class SqlImpersonation\n{\n    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Auto)]\n    public static extern bool LogonUser(string lpszUsername, string lpszDomain, string lpszPassword,\n        int dwLogonType, int dwLogonProvider, out IntPtr phToken);\n\n    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]\n    public extern static bool CloseHandle(IntPtr handle);\n\n    public static void ConnectToSqlServer(string username, string domain, string password)\n    {\n        IntPtr userToken = IntPtr.Zero;\n        \n        try\n        {\n            // Log in as the specified user\n            bool isSuccess = LogonUser(username, domain, password, 2, 0, out userToken);\n            if (!isSuccess)\n            {\n                throw new UnauthorizedAccessException("Failed to logon user");\n            }\n\n            using (WindowsImpersonationContext impersonatedUser = WindowsIdentity.Impersonate(userToken))\n            {\n                // Now, under the context of the impersonated user, connect to SQL Server\n                using (SqlConnection connection = new SqlConnection("your_connection_string"))\n                {\n                    connection.Open();\n                    // Your database operations go here\n                }\n            }\n        }\n        finally\n        {\n            if (userToken != IntPtr.Zero)\n            {\n                CloseHandle(userToken);\n            }\n        }\n    }\n}