using System;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic class BookAdder\n{\n    private string connectionString = "your_connection_string_here";\n\n    public bool UserHasWritePermission(string username)\n    {\n        using (SqlConnection conn = new SqlConnection(connectionString))\n        {\n            conn.Open();\n            SqlCommand cmd = new SqlCommand("SELECT HAS_PERMS_BY_NAME(DB_NAME(), 'DATABASE', 'INSERT')", conn);\n            bool hasPermission = (bool)cmd.ExecuteScalar();\n            return hasPermission;\n        }\n    }\n\n    public bool UserHasPublisherPermission(string username, string publisher)\n    {\n        using (SqlConnection conn = new SqlConnection(connectionString))\n        {\n            conn.Open();\n            SqlCommand cmd = new SqlCommand("SELECT COUNT(*) FROM UserPermissions WHERE Username = @Username AND Publisher = @Publisher", conn);\n            cmd.Parameters.AddWithValue("@Username", username);\n            cmd.Parameters.AddWithValue("@Publisher", publisher);\n            int count = (int)cmd.ExecuteScalar();\n            return count > 0;\n        }\n    }\n\n    public void AddBook(string username, string bookTitle, string publisher)\n    {\n        if (!UserHasWritePermission(username))\n        {\n            throw new UnauthorizedAccessException("User does not have write permission to the database.");\n        }\n\n        if (!UserHasPublisherPermission(username, publisher))\n        {\n            throw new UnauthorizedAccessException("User does not have permission to add books for this publisher.");\n        }\n\n        using (SqlConnection conn = new SqlConnection(connectionString))\n        {\n            conn.Open();\n            SqlCommand cmd = new SqlCommand("INSERT INTO Books (Title, Publisher) VALUES (@Title, @Publisher)", conn);\n            cmd.Parameters.AddWithValue("@Title", bookTitle);\n            cmd.Parameters.AddWithValue("@Publisher", publisher);\n            cmd.ExecuteNonQuery();\n        }\n    }\n}\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        BookAdder bookAdder = new BookAdder();\n        string username = "Jim"; // Retrieved from the authenticated context\n        string bookTitle = "C# 3.0 in a Nutshell";\n        string publisher = "O'Reilly";\n\n        try\n        {\n            bookAdder.AddBook(username, bookTitle, publisher);\n            Console.WriteLine("Book added successfully.");\n        }\n        catch (UnauthorizedAccessException ex)\n        {\n            Console.WriteLine(ex.Message);\n        }\n        catch (Exception ex)\n        {\n            Console.WriteLine("An error occurred: " + ex.Message);\n        }\n    }\n}