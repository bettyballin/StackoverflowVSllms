using System;\nusing System.Security.Principal;\nusing System.DirectoryServices;\n\nnamespace nanttest\n{\n    class Program\n    {\n        public static void Main(string[] args)\n        {\n            if (!IsUserAdministrator())\n            {\n                Console.WriteLine("You must run this application as an administrator.");\n                return;\n            }\n            \n            using (DirectoryEntry entry = new DirectoryEntry("IIS://localhost/W3SVC"))\n            {\n                object absobject = entry.NativeObject;\n                Console.WriteLine("Name: {0}", entry.Name);\n            }\n\n            Console.Write("Press any key to continue . . . ");\n            Console.ReadKey(true);\n        }\n\n        private static bool IsUserAdministrator()\n        {\n            bool isAdmin;\n            try\n            {\n                WindowsIdentity user = WindowsIdentity.GetCurrent();\n                WindowsPrincipal principal = new WindowsPrincipal(user);\n                isAdmin = principal.IsInRole(WindowsBuiltInRole.Administrator);\n            }\n            catch (UnauthorizedAccessException)\n            {\n                isAdmin = false;\n            }\n            catch (Exception)\n            {\n                isAdmin = false;\n            }\n            return isAdmin;\n        }\n    }\n}