using System;\nusing System.Runtime.InteropServices;\nusing System.Security.Principal;\nusing System.IO;\n\npublic class ImpersonationHelper\n{\n    [DllImport("advapi32.dll", SetLastError = true)]\n    public static extern bool RevertToSelf();\n\n    public static void WriteFileAsAppPoolIdentity(string filePath, string content)\n    {\n        WindowsImpersonationContext impersonationContext = null;\n\n        try\n        {\n            // Revert to the application pool identity\n            if (RevertToSelf())\n            {\n                // Application pool identity is now used for this block\n                File.WriteAllText(filePath, content);\n            }\n            else\n            {\n                throw new InvalidOperationException("Failed to revert to application pool identity.");\n            }\n        }\n        finally\n        {\n            // Revert back to the original impersonated user\n            if (impersonationContext != null)\n            {\n                impersonationContext.Undo();\n            }\n        }\n    }\n}