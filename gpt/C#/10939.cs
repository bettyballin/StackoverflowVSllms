private void TextBox_PreviewLostKeyboardFocus(object sender, KeyboardFocusChangedEventArgs e)\n{\n    var box = sender as TextBox;\n    var binding = box.GetBindingExpression(TextBox.TextProperty);\n    if (binding.HasError)\n    {\n        e.Handled = true; // Cancel the focus change\n    }\n}