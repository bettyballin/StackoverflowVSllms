using System;\nusing System.DirectoryServices;\nusing System.Linq;\n\nprivate enum IISVersion\n{\n    IIS5,\n    IIS6\n}\n\nprivate void ReadVirtualDirectory(string server, string directory, IISVersion version)\n{\n    string siteID = string.Empty;\n    string path = string.Empty;\n\n    switch(version)\n    {\n        case IISVersion.IIS5:\n            path = string.Format("IIS://{0}/W3SVC/1/Root", server);\n\n            if(!string.IsNullOrEmpty(directory))\n            {\n                path = string.Concat(path, "/", directory);\n            }\n\n            break;\n\n        case IISVersion.IIS6:\n            path = string.Format("IIS://{0}/W3SVC", server);\n\n            if(!string.IsNullOrEmpty(directory))\n            {\n                DirectoryEntry de = new DirectoryEntry(path);\n\n                foreach(DirectoryEntry child in de.Children)\n                {\n                    if(child.Properties["ServerComment"].Value.ToString().ToLower() == directory.ToLower())\n                    {\n                        siteID = child.Name;\n                        break;\n                    }\n                }\n\n                path = string.Concat(path, "/", siteID, "/Root");\n\n                de.Close();\n                de = null;\n            }\n\n            break;\n    }\n\n    DirectoryEntry iis = new DirectoryEntry(path);\n\n    // Retrieve the script maps to determine the ASP.NET version\n    PropertyValueCollection scriptMaps = iis.Properties["ScriptMaps"];\n    string aspNetVersion = scriptMaps\n        .Cast<string>()\n        .FirstOrDefault(s => s.Contains("aspnet_isapi.dll"));\n\n    if (aspNetVersion != null)\n    {\n        if (aspNetVersion.Contains("v1.1"))\n        {\n            Console.WriteLine("ASP.NET Version: 1.1");\n        }\n        else if (aspNetVersion.Contains("v2.0"))\n        {\n            Console.WriteLine("ASP.NET Version: 2.0");\n        }\n        else\n        {\n            Console.WriteLine("ASP.NET Version: Unknown");\n        }\n    }\n    else\n    {\n        Console.WriteLine("ASP.NET is not configured for this virtual directory.");\n    }\n\n    iis.Close();\n    iis = null;\n}