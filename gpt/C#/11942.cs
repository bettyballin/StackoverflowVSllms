public class UnitOfWork : IUnitOfWork\n{\n    private readonly IConfiguration _configuration;\n    private SqlConnection _connection;\n    private SqlTransaction _transaction;\n    private IProductRepository _productRepository;\n\n    public UnitOfWork(IConfiguration configuration)\n    {\n        _configuration = configuration;\n        _connection = new SqlConnection(_configuration.GetConnectionString("DefaultConnection"));\n        _connection.Open();\n        _transaction = _connection.BeginTransaction();\n    }\n\n    public IProductRepository Products => _productRepository ??= new ProductRepository(_configuration);\n\n    public void Commit()\n    {\n        try\n        {\n            _transaction.Commit();\n        }\n        catch\n        {\n            _transaction.Rollback();\n            throw;\n        }\n        finally\n        {\n            _transaction.Dispose();\n            _connection.Close();\n        }\n    }\n\n    public void Dispose()\n    {\n        _transaction?.Dispose();\n        _connection?.Close();\n        _connection?.Dispose();\n    }\n}