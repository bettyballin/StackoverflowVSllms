using System;\nusing System.IO;\nusing System.IO.Ports;\n\npublic class LoadCell\n{\n    private static string configFile = Directory.GetCurrentDirectory() + "/LoadCell.config";\n    private static string errorLog = Directory.GetCurrentDirectory() + "/LoadCell.log";\n    private static string puerto = "/dev/ttyS0";\n\n    public static void Main (string[] args)\n    {\n        if(File.Exists(configFile))\n        {\n            TextReader tr = new StreamReader(configFile);\n            puerto = tr.ReadToEnd();\n            tr.Close();\n        }\n\n        if(args.Length > 0)\n        {\n            switch(args[0])\n            {\n                case "-ayuda":\n                    Console.WriteLine("\nEste programa esta diseñado para capturar el peso medido actualmente por la báscula a través de un puerto (por defecto es el /dev/ttyS0). Recuerde que el indicador debe estar configurado para:");\n                    Console.WriteLine("\npuerto: " + puerto);\n                    Console.WriteLine("baud rate: 4800");\n                    Console.WriteLine("parity: none");\n                    Console.WriteLine("data bits: 8");\n                    Console.WriteLine("stop bit: one");\n                    Console.WriteLine("\nEn caso de ocurrir un error recuerde revisar el log de errores (" + errorLog + ").");\n                    Console.WriteLine("\nLos posibles argumentos son:");\n                    Console.WriteLine("\n-ayuda: este ya lo sabes usar...");\n                    Console.WriteLine("\n-puerto <nombre>: cambia el puerto al nuevo valor creando un archivo de configuración (" + configFile + ")");\n                    Console.WriteLine("\n-default: elimina el archivo de configuración para retomar la configuración inicial");\n                    break;\n\n                case "-default":\n                    File.Delete(configFile);\n                    Console.WriteLine("\narchivo de configuración eliminado");\n                    break;\n\n                case "-puerto":\n                    if(args.Length > 1)\n                    {\n                        puerto = args[1];\n                        TextWriter tw = new StreamWriter(configFile);\n                        tw.Write(puerto);\n                        tw.Close();\n                        Console.WriteLine("\npuerto cambiado a " + puerto);\n                    }\n                    else\n                    {\n                        Console.WriteLine("\nse esperaba un nombre de puerto");\n                    }\n                    break;\n            }\n        }\n        else\n        {\n            new LoadCell();\n        }\n    }\n\n    private static void log(string text)\n    {\n        Console.Write("ha ocurrido un error...");\n        TextWriter sw = File.AppendText(errorLog);\n        sw.WriteLine("[" + DateTime.Now.ToString() + "] " + text);\n        sw.Close();\n    }\n\n    public LoadCell()\n    {\n        try\n        {\n            SerialPort port = new SerialPort(puerto, 4800, Parity.None, 8,  StopBits.One);\n            port.NewLine = "\r";\n            port.ReadTimeout = 10000;\n            port.Open();\n            port.WriteLine("RA:");\n            port.DiscardInBuffer();\n            Console.Write(port.ReadLine());\n        }\n        catch(Exception e)\n        {\n            log("Error: " + e.ToString());\n        }\n    }\n}