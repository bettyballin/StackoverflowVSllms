using System;\nusing System.Data;\nusing System.IO;\nusing System.Text;\nusing System.Web;\n\npublic class CsvStreamHandler : IHttpHandler\n{\n    public void ProcessRequest(HttpContext context)\n    {\n        // Assuming you have your DataTable 'dt' ready\n        DataTable dt = GetDataTable(); // Replace with your method to get the DataTable\n\n        // Create a StringWriter to hold the CSV data\n        using (StringWriter writer = new StringWriter())\n        {\n            // Write the column headers\n            for (int i = 0; i < dt.Columns.Count; i++)\n            {\n                writer.Write(dt.Columns[i]);\n                if (i < dt.Columns.Count - 1)\n                {\n                    writer.Write(",");\n                }\n            }\n            writer.WriteLine();\n\n            // Write the rows\n            foreach (DataRow row in dt.Rows)\n            {\n                for (int i = 0; i < dt.Columns.Count; i++)\n                {\n                    writer.Write(row[i].ToString().Replace(",", " ")); // Replace commas in data to avoid CSV format issues\n                    if (i < dt.Columns.Count - 1)\n                    {\n                        writer.Write(",");\n                    }\n                }\n                writer.WriteLine();\n            }\n\n            // Write the CSV data to the response stream\n            context.Response.ContentType = "text/csv";\n            context.Response.AddHeader("Content-Disposition", "attachment;filename=data.csv");\n            context.Response.Write(writer.ToString());\n            context.Response.End();\n        }\n    }\n\n    public bool IsReusable\n    {\n        get { return false; }\n    }\n\n    private DataTable GetDataTable()\n    {\n        // Generate your DataTable here\n        DataTable dt = new DataTable();\n        dt.Columns.Add("FirstName", typeof(string));\n        dt.Columns.Add("LastName", typeof(string));\n\n        // Add rows to the DataTable\n        dt.Rows.Add("John", "Doe");\n        dt.Rows.Add("Jane", "Smith");\n\n        return dt;\n    }\n}