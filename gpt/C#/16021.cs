using System;\nusing System.Runtime.InteropServices;\nusing Microsoft.Office.Interop.Excel;\n\npublic class ExcelFileProcessor\n{\n    public void UpdateSpreadsheet(string fileName)\n    {\n        Microsoft.Office.Interop.Excel.Workbook wb = null;\n        Microsoft.Office.Interop.Excel.Worksheet ws = null;\n\n        try\n        {\n            wb = ef.GetWorkbook(fileName, false, true);\n            ws = wb.Sheets[Foo.WorksheetName] as Microsoft.Office.Interop.Excel.Worksheet;\n\n            if (ws != null && ef.CopyWorksheet(ws, Foo.WorksheetName))\n            {\n                // Update the sheet as appropriate\n                ef.SaveWorkbook(wb, fileName);\n                // Update Foo object to reflect copied worksheet\n            }\n        }\n        catch (Exception ex)\n        {\n            logger.Error("Error in UpdateSpreadsheet", ex);\n        }\n        finally\n        {\n            if (ws != null)\n            {\n                Marshal.ReleaseComObject(ws);\n                ws = null;\n            }\n            if (wb != null)\n            {\n                ef.DestroyWorkbook(wb, fileName);\n                Marshal.ReleaseComObject(wb);\n                wb = null;\n            }\n            GC.Collect();\n            GC.WaitForPendingFinalizers();\n        }\n    }\n\n    public bool CopyWorksheet(Worksheet ws, string sourceSheet)\n    {\n        try\n        {\n            Worksheet sheet = GetWorksheet(sourceSheet + " (2)");\n            Marshal.ReleaseComObject(sheet);\n            sheet = null;\n            return false;\n        }\n        catch (Exception)\n        {\n            ws.Copy(Missing.Value, ws);\n            return true;\n        }\n        finally\n        {\n            ws.Activate();\n        }\n    }\n\n    public void SaveWorkbook(Workbook wb, string fileName)\n    {\n        if (wb != null)\n        {\n            try\n            {\n                wb.Save();\n            }\n            catch (Exception ex)\n            {\n                logger.Error("Unable to SaveWorkbook()", ex);\n                throw;\n            }\n        }\n    }\n\n    private void DestroyWorkbook(Workbook wb, string fileName)\n    {\n        if (wb != null)\n        {\n            wb.Close(false);\n            Marshal.ReleaseComObject(wb);\n            wb = null;\n        }\n    }\n}