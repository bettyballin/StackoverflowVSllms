public class MyDataContractSurrogate : IDataContractSurrogate\n{\n    public object GetDeserializedObject(object obj, Type targetType)\n    {\n        // Retrieve the header value from the context\n        var headerContext = OperationContext.Current.Extensions.Find<HeaderContextExtension>();\n        if (headerContext != null)\n        {\n            string factoryIdFromHeader = headerContext.FactoryIdFromHeader;\n\n            // Use the header value in your surrogate logic\n            return SingletonFactoryPool.Factories[factoryIdFromHeader].CreateTargetType(obj);\n        }\n\n        throw new InvalidOperationException("Header value not found in context.");\n    }\n\n    // Other IDataContractSurrogate methods implementation...\n}