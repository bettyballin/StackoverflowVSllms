using System;\n   using System.IO;\n   using System.Security.AccessControl;\n   using System.Security.Principal;\n\n   class Program\n   {\n       static void Main()\n       {\n           string directoryPath = @"S:\";\n\n           try\n           {\n               DirectoryInfo directoryInfo = new DirectoryInfo(directoryPath);\n               DirectorySecurity directorySecurity = directoryInfo.GetAccessControl();\n\n               // Add the current user with full control\n               string user = Environment.UserDomainName + "\\" + Environment.UserName;\n               FileSystemAccessRule accessRule = new FileSystemAccessRule(\n                   user,\n                   FileSystemRights.FullControl,\n                   InheritanceFlags.ContainerInherit | InheritanceFlags.ObjectInherit,\n                   PropagationFlags.None,\n                   AccessControlType.Allow);\n\n               directorySecurity.AddAccessRule(accessRule);\n               directoryInfo.SetAccessControl(directorySecurity);\n\n               // Now try to list files\n               string[] files = Directory.GetFiles(directoryPath);\n               foreach (string file in files)\n               {\n                   Console.WriteLine(file);\n               }\n           }\n           catch (UnauthorizedAccessException ex)\n           {\n               Console.WriteLine("Access denied: " + ex.Message);\n           }\n           catch (Exception ex)\n           {\n               Console.WriteLine("An error occurred: " + ex.Message);\n           }\n       }\n   }