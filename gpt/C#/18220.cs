public static class HtmlHelperExtensions\n{\n    public static MvcForm BeginSecureForm(this HtmlHelper htmlHelper, string actionName, string controllerName, FormMethod method)\n    {\n        string token = AntiXsrfToken.GenerateToken();\n        htmlHelper.ViewContext.HttpContext.Response.Cookies.Set(new HttpCookie("XSRF-TOKEN", token));\n\n        TagBuilder tagBuilder = new TagBuilder("input");\n        tagBuilder.Attributes["type"] = "hidden";\n        tagBuilder.Attributes["name"] = "XSRF-TOKEN";\n        tagBuilder.Attributes["value"] = token;\n\n        MvcForm form = htmlHelper.BeginForm(actionName, controllerName, method);\n        htmlHelper.ViewContext.Writer.Write(tagBuilder.ToString(TagRenderMode.SelfClosing));\n\n        return form;\n    }\n}