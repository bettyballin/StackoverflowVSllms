void CalcNewDimensions(ref int w, ref int h, int MaxWidth, int MaxHeight)\n{\n    // Calculate the aspect ratio\n    float aspectRatio = (float)w / h;\n\n    // Calculate the new dimensions\n    if (w > MaxWidth || h > MaxHeight)\n    {\n        if (w > h)\n        {\n            w = MaxWidth;\n            h = (int)(MaxWidth / aspectRatio);\n        }\n        else\n        {\n            h = MaxHeight;\n            w = (int)(MaxHeight * aspectRatio);\n        }\n\n        // Adjust in case one dimension is still too big\n        if (w > MaxWidth)\n        {\n            w = MaxWidth;\n            h = (int)(MaxWidth / aspectRatio);\n        }\n        if (h > MaxHeight)\n        {\n            h = MaxHeight;\n            w = (int)(MaxHeight * aspectRatio);\n        }\n    }\n}