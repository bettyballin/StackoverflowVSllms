using (var session = sessionFactory.OpenSession())\n{\n    using (var transaction = session.BeginTransaction())\n    {\n        try\n        {\n            // Perform operations\n            session.SaveOrUpdate(entity1);\n            session.SaveOrUpdate(entity2);\n\n            // Explicit flush if needed\n            session.Flush();\n\n            // Commit transaction\n            transaction.Commit();\n        }\n        catch (Exception ex)\n        {\n            transaction.Rollback();\n            throw;\n        }\n    }\n    // Session will automatically flush at the end of transaction if not manually flushed\n}