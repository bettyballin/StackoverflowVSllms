using System;\nusing System.ServiceProcess;\nusing System.Threading;\n\npublic class MyService : ServiceBase\n{\n    private const string MsmqServiceName = "MSMQ";\n\n    protected override void OnStart(string[] args)\n    {\n        // Wait for the MSMQ service to start\n        WaitForServiceToStart(MsmqServiceName, TimeSpan.FromMinutes(5));\n\n        // Your service initialization code here\n    }\n\n    private void WaitForServiceToStart(string serviceName, TimeSpan timeout)\n    {\n        ServiceController serviceController = new ServiceController(serviceName);\n        DateTime timeoutTime = DateTime.Now.Add(timeout);\n\n        while (serviceController.Status != ServiceControllerStatus.Running)\n        {\n            if (DateTime.Now > timeoutTime)\n            {\n                throw new TimeoutException($"The service '{serviceName}' did not start within the given timeout.");\n            }\n\n            Thread.Sleep(1000); // Wait for 1 second before checking the status again\n            serviceController.Refresh(); // Refresh the service status\n        }\n    }\n\n    protected override void OnStop()\n    {\n        // Your service cleanup code here\n    }\n\n    public static void Main()\n    {\n        ServiceBase.Run(new MyService());\n    }\n}