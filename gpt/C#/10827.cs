using System;\nusing System.IO;\nusing System.IO.Compression;\nusing System.Net;\nusing System.Text;\n\nprivate static void demo()\n{\n    Stream myRequestStream = null;\n    Stream myResponseStream = null;\n\n    HttpWebRequest myWebRequest = (HttpWebRequest)WebRequest.Create("http://example.com");\n    byte[] bytMessage = Encoding.UTF8.GetBytes("data=[a several MB XML document]");\n\n    // Compress the data using GZipStream\n    using (MemoryStream compressedStream = new MemoryStream())\n    {\n        using (GZipStream gzipStream = new GZipStream(compressedStream, CompressionMode.Compress, true))\n        {\n            gzipStream.Write(bytMessage, 0, bytMessage.Length);\n        }\n\n        byte[] compressedData = compressedStream.ToArray();\n        myWebRequest.ContentLength = compressedData.Length;\n        myWebRequest.Method = "POST";\n\n        // Set the content type as form and encoding to gzip\n        myWebRequest.ContentType = "application/x-www-form-urlencoded";\n        myWebRequest.Headers.Add(HttpRequestHeader.ContentEncoding, "gzip");\n\n        // Get Stream object\n        myRequestStream = myWebRequest.GetRequestStream();\n\n        // Writes the compressed sequence of bytes to the current stream\n        myRequestStream.Write(compressedData, 0, compressedData.Length);\n\n        // Close stream\n        myRequestStream.Close();\n    }\n\n    WebResponse myWebResponse = myWebRequest.GetResponse();\n    myResponseStream = myWebResponse.GetResponseStream();\n}