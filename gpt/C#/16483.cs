using System;\nusing System.Drawing;\nusing System.Drawing.Imaging;\nusing System.IO;\n\npublic class ImageResizer\n{\n    public static void SaveImageWithTargetSize(string inputPath, string outputPath, long targetSize, ImageFormat format)\n    {\n        using (Bitmap originalImage = new Bitmap(inputPath))\n        {\n            long quality = 100;\n            long increment = 10;\n            long currentSize;\n\n            do\n            {\n                using (MemoryStream ms = new MemoryStream())\n                {\n                    ImageCodecInfo codec = GetEncoder(format);\n                    EncoderParameters parameters = new EncoderParameters(1);\n                    parameters.Param[0] = new EncoderParameter(Encoder.Quality, quality);\n\n                    originalImage.Save(ms, codec, parameters);\n                    currentSize = ms.Length;\n\n                    if (currentSize > targetSize && quality > 0)\n                    {\n                        quality -= increment;\n                        if (quality < 0)\n                        {\n                            quality = 0;\n                        }\n                    }\n                }\n            } while (currentSize > targetSize && quality > 0);\n\n            ImageCodecInfo finalCodec = GetEncoder(format);\n            EncoderParameters finalParameters = new EncoderParameters(1);\n            finalParameters.Param[0] = new EncoderParameter(Encoder.Quality, quality);\n\n            originalImage.Save(outputPath, finalCodec, finalParameters);\n        }\n    }\n\n    private static ImageCodecInfo GetEncoder(ImageFormat format)\n    {\n        ImageCodecInfo[] codecs = ImageCodecInfo.GetImageDecoders();\n        foreach (ImageCodecInfo codec in codecs)\n        {\n            if (codec.FormatID == format.Guid)\n            {\n                return codec;\n            }\n        }\n        return null;\n    }\n\n    public static void Main(string[] args)\n    {\n        string inputPath = "input.jpg";\n        string outputPath = "output.jpg";\n        long targetSize = 100 * 1024; // 100KB\n\n        SaveImageWithTargetSize(inputPath, outputPath, targetSize, ImageFormat.Jpeg);\n    }\n}