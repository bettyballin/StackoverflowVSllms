public IQueryable<AppointmentItem> GetAppointments(DateTime date)\n{\n    var dayFlag = (OlDaysOfWeek)(int)Math.Pow(2, (int)date.DayOfWeek);\n    return OlDefaultFolders.olFolderCalendar.GetItems()\n        .Select(a => new\n        {\n            Appointment = a,\n            RecurrencePattern = a.IsRecurring ? a.GetRecurrencePattern() : null\n        })\n        .Where(a =>\n            a.Appointment.Start.Date <= date &&\n            (\n                (a.RecurrencePattern == null && a.Appointment.End.Date >= date) ||\n                (\n                    a.RecurrencePattern != null &&\n                    (\n                        (a.RecurrencePattern.DayOfMonth == 0 || a.RecurrencePattern.DayOfMonth == date.Day) &&\n                        (a.RecurrencePattern.DayOfWeekMask == 0 || (a.RecurrencePattern.DayOfWeekMask & dayFlag) != 0) &&\n                        (a.RecurrencePattern.MonthOfYear == 0 || a.RecurrencePattern.MonthOfYear == date.Month)\n                    )\n                )\n            )\n        )\n        .Select(a => a.Appointment);\n}