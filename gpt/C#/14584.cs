using System;\nusing System.Collections.Generic;\nusing System.Data.Entity;\nusing System.Data.SqlServerCe;\nusing System.Linq;\n\npublic void UpsertData(List<MyEntity> entities)\n{\n    using (var context = new MyDbContext())\n    {\n        using (var transaction = context.Database.BeginTransaction())\n        {\n            try\n            {\n                foreach (var entity in entities)\n                {\n                    var existingEntity = context.MyEntities\n                        .Where(e => e.Id == entity.Id)\n                        .FirstOrDefault();\n\n                    if (existingEntity != null)\n                    {\n                        // Update existing entity\n                        existingEntity.Property1 = entity.Property1;\n                        existingEntity.Property2 = entity.Property2;\n                        // ... update other properties as needed\n                    }\n                    else\n                    {\n                        // Insert new entity\n                        context.MyEntities.Add(entity);\n                    }\n                }\n\n                context.SaveChanges();\n                transaction.Commit();\n            }\n            catch (Exception ex)\n            {\n                transaction.Rollback();\n                throw;\n            }\n        }\n    }\n}