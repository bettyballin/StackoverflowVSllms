public partial class MainForm : Form\n{\n    private dynamic shellWindows;\n\n    public MainForm()\n    {\n        InitializeComponent();\n        this.FormClosed += MainForm_FormClosed;\n    }\n\n    private void MainForm_FormClosed(object sender, FormClosedEventArgs e)\n    {\n        // Ensure all COM objects are released\n        if (shellWindows != null)\n        {\n            while (Marshal.ReleaseComObject(shellWindows) > 0) ;\n            shellWindows = null;\n        }\n\n        // Terminate background threads if any\n        // Example: Ensure all threads are stopped\n        foreach (var thread in threadList)\n        {\n            if (thread.IsAlive)\n            {\n                thread.Abort();\n                thread.Join();\n            }\n        }\n\n        // Dispose other resources if any\n    }\n\n    private void OnShutdown()\n    {\n        // Ensure the application exits properly\n        Application.Exit();\n    }\n}