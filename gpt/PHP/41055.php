<?php\nsession_start();\ninclude("connect.php");\n\n$timeout = 60 * 30;\n$fingerprint = md5($_SERVER['REMOTE_ADDR'] . $_SERVER['HTTP_USER_AGENT']);\n\nif(isset($_POST['userName'])) {\n    $user = $_POST['userName'];\n    $password = $_POST['password'];\n\n    $stmt = $mysqli->prepare("SELECT * FROM users WHERE username=? LIMIT 1");\n    if ($stmt) {\n        $stmt->bind_param('s', $user);\n        $stmt->execute();\n        $result = $stmt->get_result();\n        \n        if ($result->num_rows === 1) {\n            $matchingUser = $result->fetch_assoc();\n            if (password_verify($password, $matchingUser['password'])) {\n                if ($matchingUser['inactive'] == 1) {\n                    $error = "Your e-mail Id has not been verified. Check your mail to verify your e-mail Id. However you'll be logged in to site with less privileges.";\n                    $_SESSION['inactive'] = true;\n                }\n                session_regenerate_id(true);\n                $_SESSION['user'] = $user;\n                $_SESSION['lastActive'] = time();\n                $_SESSION['fingerprint'] = $fingerprint;\n            } else {\n                $error = "Invalid password";\n            }\n        } else {\n            $error = "Invalid username";\n        }\n        $stmt->close();\n    }\n}\n\nif ((isset($_SESSION['lastActive']) && $_SESSION['lastActive'] < (time() - $timeout)) || \n    (isset($_SESSION['fingerprint']) && $_SESSION['fingerprint'] != $fingerprint) || \n    isset($_GET['logout'])) {\n    setcookie(session_name(), '', time() - 3600, '/');\n    session_destroy();\n    header("Location: " . $_SERVER['PHP_SELF']);\n    exit();\n} else {\n    session_regenerate_id(true);\n    $_SESSION['lastActive'] = time();\n    $_SESSION['fingerprint'] = $fingerprint;\n}\n?>