<?php\n\nrequire_once('/usr/local/lib/php/Doctrine/lib/Doctrine.php');\n\nspl_autoload_register(array('Doctrine', 'autoload'));\n\n$manager = Doctrine_Manager::getInstance();\n$manager->setAttribute('model_loading', 'conservative');\nDoctrine::loadModels('lib/model/master');\n\nwhile (1) {\n    print "You are using " . intval(memory_get_usage() / 1024) . " KB\n";\n    $manager->connection('********************************************', 'master');\n    \n    $query = Doctrine_Query::create()\n        ->from('SubmissionQueue s')\n        ->where('s.time_acted_on IS NULL')\n        ->orderby('s.time_queued')\n        ->limit(1)\n        ->execute();\n    \n    print "[" . $query[0]->time_queued . "]\n";\n    \n    // Free the query result\n    $query->free();\n    unset($query);\n    $query = null;\n    \n    // Clear the Doctrine cache\n    Doctrine_Manager::getInstance()->getCurrentConnection()->clear();\n    \n    // Close the connection\n    $manager->closeConnection(Doctrine_Manager::getInstance()->getConnection('master'));\n    \n    // Trigger garbage collection\n    gc_collect_cycles();\n    \n    sleep(5);\n}