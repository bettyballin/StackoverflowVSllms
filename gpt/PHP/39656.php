public function save(PropelPDO $con = null) {\n    $con = Propel::getConnection();\n    try {\n        $con->beginTransaction();\n\n        // Lock the table\n        $con->exec('LOCK TABLES foo WRITE');\n        \n        sleep(3); // ignore this, used for testing only\n        \n        parent::save($con);\n        $foo = $this->getFoo(); // Propel object, triggers a SELECT\n\n        // stuff is happening here...\n\n        $foo->save($con);\n\n        // Commit the transaction\n        $con->commit();\n        \n        // Unlock the table\n        $con->exec('UNLOCK TABLES');\n    } catch (Exception $e) {\n        $con->rollBack();\n        \n        // Ensure the tables are unlocked in case of an error\n        $con->exec('UNLOCK TABLES');\n        \n        throw $e;\n    }\n}