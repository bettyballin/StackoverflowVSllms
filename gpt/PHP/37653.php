<?php \nsession_start();\n\n// Below variable contains full path to external site where file resides\n$filename = $_SESSION['$serverURL'].'audio/'.$_SESSION['fileName'].'.mp3';\n// Below variable contains a chosen filename of the file to be downloaded\n$properFilename = $_GET['properFilename'].'.mp3';\n\n// Required for IE, otherwise Content-disposition is ignored\nif(ini_get('zlib.output_compression')) {\n    ini_set('zlib.output_compression', 'Off');\n}\n\n// Get file extension\n$file_extension = strtolower(pathinfo($filename, PATHINFO_EXTENSION));\n\n// Validate filename\nif ($filename == "") {\n    exit;\n}\n\n// Use cURL to check if the file exists and get its size\n$ch = curl_init($filename);\ncurl_setopt($ch, CURLOPT_NOBODY, true);\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($ch, CURLOPT_HEADER, true);\ncurl_setopt($ch, CURLOPT_FOLLOWLOCATION, true); // Follow redirects\ncurl_exec($ch);\n$file_exists = curl_getinfo($ch, CURLINFO_HTTP_CODE) == 200;\n$file_size = curl_getinfo($ch, CURLINFO_CONTENT_LENGTH_DOWNLOAD);\ncurl_close($ch);\n\nif (!$file_exists) {\n    exit;\n}\n\n// Determine content type\n$ctype = 'application/force-download'; // Default\nswitch($file_extension) {\n    case "pdf": $ctype="application/pdf"; break;\n    case "exe": $ctype="application/octet-stream"; break;\n    case "zip": $ctype="application/zip"; break;\n    case "doc": $ctype="application/msword"; break;\n    case "xls": $ctype="application/vnd.ms-excel"; break;\n    case "ppt": $ctype="application/vnd.ms-powerpoint"; break;\n    case "gif": $ctype="image/gif"; break;\n    case "png": $ctype="image/png"; break;\n    case "jpeg":\n    case "jpg": $ctype="image/jpg"; break;\n}\n\n// Set headers\nheader("Pragma: public"); // Required\nheader("Expires: 0");\nheader("Cache-Control: must-revalidate, post-check=0, pre-check=0");\nheader("Cache-Control: private", false); // Required for certain browsers\nheader("Content-Type: $ctype");\n// Change, added quotes to allow spaces in filenames\nheader("Content-Disposition: attachment; filename=\"".basename($properFilename)."\";" );\nheader("Content-Transfer-Encoding: binary");\nheader("Content-Length: $file_size");\n\n// Read file from external server\nreadfile($filename);\nexit();\n?>