$query = mysql_query("SELECT * FROM eventcal WHERE eventDate = '$date' ORDER BY region");\n\n$doc = new DomDocument("1.0");\n\n$root = $doc->createElement('root');\n$root = $doc->appendChild($root);\n\n$regions = [];\n\nif (@mysql_num_rows($query)) {\n    while ($row = @mysql_fetch_assoc($query)) {\n        $regionId = $row['region'];\n\n        // Check if the region node already exists\n        if (!isset($regions[$regionId])) {\n            $regionNode = $doc->createElement('region');\n            $regionNode->setAttribute('ID', $regionId);\n            $regions[$regionId] = $regionNode;\n            $root->appendChild($regionNode);\n        } else {\n            $regionNode = $regions[$regionId];\n        }\n\n        // Create the primary node\n        $primaryNode = $doc->createElement('primary', $row['primary']);\n        $regionNode->appendChild($primaryNode);\n    }\n}\n\n// Save the XML to a string or file as needed\n$xmlString = $doc->saveXML();\necho $xmlString;