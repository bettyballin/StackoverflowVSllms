<?php\n// Spaghetti Code Example\nfunction processOrder($orderId) {\n    global $db;\n    $order = $db->query("SELECT * FROM orders WHERE id = $orderId")->fetch();\n    if ($order) {\n        if ($order['status'] == 'pending') {\n            $db->query("UPDATE orders SET status = 'processing' WHERE id = $orderId");\n            $items = $db->query("SELECT * FROM order_items WHERE order_id = $orderId");\n            while ($item = $items->fetch()) {\n                $product = $db->query("SELECT * FROM products WHERE id = " . $item['product_id'])->fetch();\n                if ($product['stock'] > 0) {\n                    $db->query("UPDATE products SET stock = stock - " . $item['quantity'] . " WHERE id = " . $item['product_id']);\n                } else {\n                    echo "Out of stock: " . $product['name'];\n                }\n            }\n            echo "Order processed.";\n        } else {\n            echo "Order not in pending state.";\n        }\n    } else {\n        echo "Order not found.";\n    }\n}\nprocessOrder(123);\n?>