$this->loadModel('Tips');\n\n$userId = 2;\n\n$tips = $this->Tips->find()\n    ->contain(['Users']) // Assuming Tips belongsTo Users\n    ->matching('Users.Friends', function ($q) use ($userId) {\n        return $q->where(['FriendsUsers.user_id' => $userId]);\n    })\n    ->orWhere(['Tips.user_id' => $userId])\n    ->limit(30)\n    ->all();\n\nforeach ($tips as $tip) {\n    // Process each tip as needed\n}