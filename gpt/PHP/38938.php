<?php\nfunction custom_json_escape($string) {\n    $replacements = array(\n        "\\" => "\\\\",\n        "\"" => "\\\"",\n        "\n" => "\\n",\n        "\r" => "\\r",\n        "\t" => "\\t",\n        "\b" => "\\b",\n        "\f" => "\\f",\n    );\n\n    return str_replace(array_keys($replacements), array_values($replacements, $string));\n}\n\n$s = <<<END\nFirst row.\nSecond row w/ "double quotes" and backslash: \.\nEND;\n\n$s = custom_json_escape($s);\n$s = json_encode($s);\necho $s;\n// Will output: "First row.\nSecond row w\/ \"double quotes\" and backslash: \\."\n\n?>\n\n<script type="text/javascript">\n    JSON.parse(<?php echo $s; ?>);  // This will now work correctly\n</script>