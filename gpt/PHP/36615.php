<?php\nrequire_once __DIR__ . '/vendor/autoload.php'; // Change path as needed\n\nuse Facebook\Facebook;\n\nsession_start();\n\n$fb = new Facebook([\n  'app_id' => 'YOUR_APP_ID', // Replace with your app id\n  'app_secret' => 'YOUR_APP_SECRET', // Replace with your app secret\n  'default_graph_version' => 'v12.0',\n]);\n\n$helper = $fb->getRedirectLoginHelper();\n\ntry {\n  $accessToken = $helper->getAccessToken();\n} catch(Facebook\Exceptions\FacebookResponseException $e) {\n  // When Graph returns an error\n  echo 'Graph returned an error: ' . $e->getMessage();\n  exit;\n} catch(Facebook\Exceptions\FacebookSDKException $e) {\n  // When validation fails or other local issues\n  echo 'Facebook SDK returned an error: ' . $e->getMessage();\n  exit;\n}\n\nif (!isset($accessToken)) {\n  $permissions = ['email', 'user_friends']; // Optional permissions\n  $loginUrl = $helper->getLoginUrl('https://your-callback-url.com/', $permissions);\n\n  echo '<a href="' . htmlspecialchars($loginUrl) . '">Log in with Facebook!</a>';\n  exit;\n}\n\n// Logged in\n$oAuth2Client = $fb->getOAuth2Client();\n$tokenMetadata = $oAuth2Client->debugToken($accessToken);\n$tokenMetadata->validateAppId('YOUR_APP_ID'); // Replace with your app id\n$tokenMetadata->validateExpiration();\n\nif (!$accessToken->isLongLived()) {\n  try {\n    $accessToken = $oAuth2Client->getLongLivedAccessToken($accessToken);\n  } catch (Facebook\Exceptions\FacebookSDKException $e) {\n    echo '<p>Error getting long-lived access token: ' . $e->getMessage() . "</p>";\n    exit;\n  }\n}\n\n$_SESSION['fb_access_token'] = (string) $accessToken;\n\ntry {\n  // Get the Facebook\GraphNodes\GraphUser object for the current user.\n  $response = $fb->get('/me?fields=id,name,picture', $accessToken);\n  $me = $response->getGraphUser();\n  echo 'Logged in as ' . $me->getName();\n  echo '<img src="' . $me->getPicture()->getUrl() . '">';\n\n  // Get the list of friends who use the app\n  $friends_response = $fb->get('/me/friends', $accessToken);\n  $friends = $friends_response->getGraphEdge();\n\n  echo '<h3>Friends who use this app:</h3>';\n  foreach ($friends as $friend) {\n    echo $friend['name'] . '<br>';\n  }\n} catch(Facebook\Exceptions\FacebookResponseException $e) {\n  echo 'Graph returned an error: ' . $e->getMessage();\n  exit;\n} catch(Facebook\Exceptions\FacebookSDKException $e) {\n  echo 'Facebook SDK returned an error: ' . $e->getMessage();\n  exit;\n}\n?>