<?php\n// redirect.php\n\n// Get URL from query parameters\n$url = isset($_GET['url']) ? $_GET['url'] : 'http://example.com';\n\n// Send the redirect header\nheader("Location: $url");\nheader("Connection: close");\n\n// Close the connection to the user's browser\nignore_user_abort(true);\nob_start();\nheader('Content-Length: 0');\nob_end_flush();\nflush();\n\n// Proceed to log the visit\n$mysqli = new mysqli("localhost", "username", "password", "database");\nif ($mysqli->connect_error) {\n    die("Connection failed: " . $mysqli->connect_error);\n}\n\n$escaped_url = $mysqli->real_escape_string($url);\n\n// Insert or update the log in the database\n$sql = "INSERT INTO url_log (url, hits) VALUES ('$escaped_url', 1) ON DUPLICATE KEY UPDATE hits = hits + 1";\n$mysqli->query($sql);\n\n$mysqli->close();\n?>\n\n<!-- Include JavaScript to log the click asynchronously -->\n<script>\n    (function() {\n        var img = new Image();\n        img.src = 'log_visit.php?url=' + encodeURIComponent(window.location.href);\n    })();\n</script>