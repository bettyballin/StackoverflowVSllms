function encodeOutsidePre($text) {\n    // Match all content inside <pre> tags\n    $prePattern = '/<pre>(.*?)<\/pre>/is';\n    preg_match_all($prePattern, $text, $preMatches);\n    \n    // Replace all content inside <pre> tags with placeholders\n    $placeholders = array();\n    foreach ($preMatches[0] as $i => $match) {\n        $placeholder = "###PRE$i###";\n        $placeholders[$placeholder] = $match;\n        $text = str_replace($match, $placeholder, $text);\n    }\n\n    // Encode the remaining content\n    $text = htmlentities($text);\n\n    // Replace placeholders with original <pre> content\n    foreach ($placeholders as $placeholder => $originalContent) {\n        $text = str_replace($placeholder, $originalContent, $text);\n    }\n\n    return $text;\n}\n\n// Example usage\n$input = '<p>Some text with <b>HTML</b> entities.</p><pre><b>Hello world</b></pre><p>More text.</p><pre>"This must not be converted to HTML entities"</pre>';\n$output = encodeOutsidePre($input);\necho $output;