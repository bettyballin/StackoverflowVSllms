<?php\nsession_start();\n\n// Regenerate session ID upon login\nif (!isset($_SESSION['initiated'])) {\n    session_regenerate_id(true);\n    $_SESSION['initiated'] = true;\n}\n\n// Check if the user is authenticated\nfunction isAuthenticated() {\n    return isset($_SESSION['user_id']) && isset($_SESSION['token']);\n}\n\n// Login function\nfunction login($username, $password) {\n    // Validate user credentials\n    // Assume validateUser is a function that checks the username and password against the database\n    $user = validateUser($username, $password);\n    if ($user) {\n        $_SESSION['user_id'] = $user['id'];\n        $_SESSION['token'] = bin2hex(random_bytes(32)); // Generate a secure token\n        return true;\n    }\n    return false;\n}\n\n// Logout function\nfunction logout() {\n    session_unset();\n    session_destroy();\n}\n\n// Protect a page\nif (!isAuthenticated()) {\n    header("Location: login.php");\n    exit;\n}\n?>