$allCategories = [];\n$batchSize = 1000; // Adjust batch size based on available memory\n$records = getRecordsFromFile(); // Function to read records from the file\n\nforeach ($records as $index => $record) {\n    $category = $record['category'];\n    $procId = $record['procId'];\n\n    if (array_key_exists($category, $allCategories)) {\n        $id = $allCategories[$category];\n    } else {\n        $query = "SELECT id FROM categories WHERE procId='$procId' AND category='$category'";\n        $result = mysql_query($query);\n\n        if ($row = mysql_fetch_assoc($result)) {\n            $id = $row['id'];\n        } else {\n            mysql_query("INSERT INTO categories (procId, category) VALUES ('$procId', '$category')");\n            $id = mysql_insert_id();\n        }\n        $allCategories[$category] = $id;\n    }\n\n    // Process the record with $id...\n\n    // Clear cache periodically to manage memory usage\n    if (($index + 1) % $batchSize == 0) {\n        $allCategories = [];\n    }\n}