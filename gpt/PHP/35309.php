<?php\nrequire_once "../config/functions.inc.php";\n\nset_time_limit(0);\n\n// Set batch size\n$batchSize = 1000;\n$offset = 0;\n\ndo {\n    // get users in batches\n    $sql = "SELECT * FROM friend_login LIMIT $batchSize OFFSET $offset";\n    $result = executequery($sql);\n    $numRows = mysql_num_rows($result);\n\n    while ($row = mysql_fetch_assoc($result)) {\n        // get states\n        $sql = 'SELECT * FROM usstates ORDER BY rand() LIMIT 1';\n        $state = getSingleResult($sql);\n        // convert to lat and long\n        $geo = get_geo($state);\n        $lat = $geo['Latitude'];\n        $long = $geo['Longitude'];\n\n        // insert lat/long into locations table\n        $insert = "INSERT INTO friend_location (user_id, lat, `long`) VALUES ('{$row['auto_id']}', '$lat', '$long')";\n        executeQuery($insert);\n\n        echo 'user updated with ' . $state . ' <BR> userID=' . $row['auto_id'] . ' <BR><BR><BR>';\n    }\n\n    $offset += $batchSize;\n} while ($numRows > 0);\n?>