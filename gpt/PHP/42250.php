function splitByCommasOutsideBrackets($input) {\n    $result = [];\n    $length = strlen($input);\n    $bracketDepth = 0;\n    $start = 0;\n\n    for ($i = 0; $i < $length; $i++) {\n        if ($input[$i] == '(') {\n            $bracketDepth++;\n        } elseif ($input[$i] == ')') {\n            $bracketDepth--;\n        } elseif ($input[$i] == ',' && $bracketDepth == 0) {\n            $result[] = trim(substr($input, $start, $i - $start));\n            $start = $i + 1;\n        }\n    }\n\n    // Add the last segment\n    $result[] = trim(substr($input, $start));\n\n    return $result;\n}\n\n$input = "one, two, three, (four, (five, six), (ten)), seven";\n$result = splitByCommasOutsideBrackets($input);\nprint_r($result);