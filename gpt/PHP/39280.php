function forum_extract($text) {\n    return str_replace("\n", '<br />', limit_text(preg_replace('/\[[^\]]+\]/', '', $text), 30));\n}\n\nfunction limit_text($text, $limit) {\n    if (strlen($text) <= $limit) {\n        return $text;\n    }\n\n    $words = str_word_count($text, 2);\n    $pos = array_keys($words);\n\n    if (count($pos) < $limit) {\n        return $text;\n    }\n\n    return substr($text, 0, $pos[$limit]) . '...';\n}