<?php\n    use Ratchet\MessageComponentInterface;\n    use Ratchet\ConnectionInterface;\n\n    require __DIR__ . '/vendor/autoload.php';\n\n    class Chat implements MessageComponentInterface {\n        protected $clients;\n\n        public function __construct() {\n            $this->clients = new \SplObjectStorage;\n        }\n\n        public function onOpen(ConnectionInterface $conn) {\n            // Store the new connection in $clients\n            $this->clients->attach($conn);\n        }\n\n        public function onMessage(ConnectionInterface $from, $msg) {\n            foreach ($this->clients as $client) {\n                if ($from !== $client) {\n                    // Send the message to all connected clients except the sender\n                    $client->send($msg);\n                }\n            }\n        }\n\n        public function onClose(ConnectionInterface $conn) {\n            // Remove the connection from $clients\n            $this->clients->detach($conn);\n        }\n\n        public function onError(ConnectionInterface $conn, \Exception $e) {\n            $conn->close();\n        }\n    }\n\n    $server = IoServer::factory(\n        new HttpServer(\n            new WsServer(\n                new Chat()\n            )\n        ),\n        8080\n    );\n\n    $server->run();