<?php\n$results = array(\n    array('user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'),\n    array('user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'),\n    array('user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'),\n    array('user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar')\n);\n\n$formatted = array();\n\nforeach ($results as $row) {\n    $userName = $row['user_name'];\n    $tag = array('id' => $row['tag_id'], 'name' => $row['tag_name']);\n\n    if (!isset($formatted[$userName])) {\n        $formatted[$userName] = array('name' => $userName, 'tags' => array());\n    }\n\n    $formatted[$userName]['tags'][] = $tag;\n}\n\n$finalResult = array_values($formatted);\nprint_r($finalResult);\n?>