<?php\nif ($DEBUG == true) {\n    error_reporting(E_ALL);\n}\n\nrequire "header.php";\nrequire_once "dbinterface.php";\nrequire_once "user.class.php";\nrequire_once "config.inc.php";\n\n// Start the session\nif (session_status() == PHP_SESSION_NONE) {\n    session_start();\n}\n\n$db = new db($DB['host'], $DB['user'], $DB['pass'], $DB['database']);\n\n$u_result = $db->run("SELECT user_id FROM users WHERE user_name = '" . $db->escape($_POST['user_name']) . "'");\n\nif ($u_result == false || count($u_result) < 1) {\n    header('Location: error.php?id=' . ($u_result == false ? 8 : 3));\n    exit();\n}\n\n$user = new user($u_result[0]['user_id']);\n\nif ($user->match_password($_POST['pass'])) {\n    $_SESSION['authenticated'] = true;\n    $_SESSION['user_id'] = $u_result[0]['user_id'];\n    $_SESSION['user'] = $user;\n    session_write_close();\n    header('Location: index.php');\n    exit();\n} else {\n    header('Location: error.php?id=4');\n    exit();\n}\n?>