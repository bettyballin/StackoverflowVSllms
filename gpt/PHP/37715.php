<?php\n\n// Function to display the upload form\nfunction display_upload_form() {\n    echo <<<DISPLAY_UPLOAD_FORM\n    <html>\n    <body>\n        <form action="" method="post" enctype="multipart/form-data">\n            <input type="file" name="myfile">\n            <input type="submit" name="execute" value="Upload">\n        </form>\n    </body>\n    </html>\nDISPLAY_UPLOAD_FORM;\n}\n\n// Function to handle the file upload\nfunction execute_upload() {\n    $path = $_SERVER['DOCUMENT_ROOT'];\n    $dirname = '/uploads';\n    $chmod = 0755;\n\n    $filename = $_FILES['myfile']['name'];\n    $filesize = $_FILES['myfile']['size'];\n    $filetype = $_FILES['myfile']['type'];\n    $file_tmp = $_FILES['myfile']['tmp_name'];\n    $file_err = $_FILES['myfile']['error'];\n    $file_ext = strrchr($filename, '.');\n\n    if (($file_err == 0) && ($filesize != 0)) {\n        if (!$file_ext) {\n            unlink($file_tmp);\n            die('File must have an extension.');\n        }\n\n        if (is_uploaded_file($file_tmp)) {\n            $dir = $path . $dirname;\n\n            if (!is_dir($dir)) {\n                $dir = explode('/', $dirname);\n                foreach ($dir as $sub_dir) {\n                    $path .= '/' . $sub_dir;\n                    if (!is_dir($path)) {\n                        if (!mkdir($path, $chmod)) {\n                            unlink($file_tmp);\n                            die('Error: Directory does not exist and was unable to be created.');\n                        }\n                    }\n                }\n            }\n\n            $file_path = $dir . '/' . $filename;\n            if (@move_uploaded_file($file_tmp, $file_path)) {\n                // Create a counter file\n                $counter_file = $file_path . '.count';\n                file_put_contents($counter_file, 0);\n                \n                echo "\n Success!\n View File: <a href='view_file.php?file=$filename'>$filename</a>\n";\n            } else {\n                unlink($file_tmp);\n                echo 'Error: Unable to move file to designated directory.';\n            }\n        } else {\n            unlink($file_tmp);\n            echo 'Error: File does not appear to be a valid upload. Could be a file attack.';\n        }\n    } else {\n        if ($file_tmp != '') {\n            unlink($file_tmp);\n        }\n\n        switch ($file_err) {\n            case '0':\n                echo 'That is not a valid file. 0 byte length.';\n                break;\n            case '1':\n                echo 'This file, at ' . $filesize . ' bytes, exceeds the maximum allowed file size as set in php.ini. Please contact your system admin.';\n                break;\n            case '2':\n                echo 'This file exceeds the maximum file size specified in your HTML form.';\n                break;\n            case '3':\n                echo 'File was only partially uploaded. This could be the result of your connection being dropped in the middle of the upload.';\n                break;\n            case '4':\n                echo 'You did not upload anything... Please go back and select a file to upload.';\n                break;\n        }\n    }\n}\n\n// Logic Code\nif (isset($_POST['execute'])) {\n    execute_upload();\n} else {\n    display_upload_form();\n}\n\n?>