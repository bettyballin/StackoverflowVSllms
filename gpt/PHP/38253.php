<?php\nrequire_once 'Mail/mimeDecode.php';\n\nfunction clean($text) {\n    // Your custom cleaning logic here\n    return htmlspecialchars($text);\n}\n\n$raw_email = <<<EOT\n> This message is in MIME format. Since your mail reader does not understand\nthis format, some or all of this message may not be legible.\n\n--B_3331365494_4098727\nContent-type: text/plain;\ncharset="US-ASCII"\nContent-transfer-encoding: 7bit\n\ntest\n\n--B_3331365494_4098727\nContent-type: text/html;\ncharset="US-ASCII"\nContent-transfer-encoding: quoted-printable\n\n<HTML>\n<HEAD>\n<TITLE>Test</TITLE>\n</HEAD>\n<BODY>\n<FONT FACE="Calibri, Verdana, Helvetica, Arial"><SPAN STYLE='font-size:11pt'>test</SPAN></FONT>\n</BODY>\n</HTML>\n\n--B_3331365494_4098727--\nEOT;\n\n$params['include_bodies'] = true;\n$params['decode_bodies']  = true;\n$params['decode_headers'] = true;\n\n$decoder = new Mail_mimeDecode($raw_email);\n$structure = $decoder->decode($params);\n\nforeach ($structure->parts as $part) {\n    if ($part->ctype_primary == 'text' && $part->ctype_secondary == 'plain') {\n        echo "Plain text part: " . clean($part->body) . "\n";\n    } elseif ($part->ctype_primary == 'text' && $part->ctype_secondary == 'html') {\n        echo "HTML part: " . clean($part->body) . "\n";\n    }\n}\n?>