amespace Drupal\custom_module\Controller;\n\nuse Drupal\Core\Controller\ControllerBase;\nuse Symfony\Component\HttpFoundation\BinaryFileResponse;\nuse Symfony\Component\HttpFoundation\ResponseHeaderBag;\n\nclass FileDownloadController extends ControllerBase {\n  public function download($token) {\n    $store = \Drupal::service('tempstore.private')->get('file_download_tokens');\n    $file_path = $store->get($token);\n\n    if ($file_path) {\n      // Invalidate the token\n      $store->delete($token);\n\n      // Serve the file\n      $response = new BinaryFileResponse($file_path);\n      $response->setContentDisposition(ResponseHeaderBag::DISPOSITION_ATTACHMENT);\n\n      return $response;\n    }\n\n    throw new \Symfony\Component\HttpKernel\Exception\NotFoundHttpException();\n  }\n}