<?php\n// Start session properly\nsession_start();\ninclude "../../functions.php";\ninclude "../../inc/photo.php";\n\n// Check if the session is valid and user is logged in\nif (!isset($_SESSION['user_id']) || !is_logged_in()) {\n    echo "0";\n    exit;\n}\n\n// Ensure the upload directory has the right permissions\n$uploadDir = '/path/to/upload/dir';\nif (!is_writable($uploadDir)) {\n    echo "Upload directory is not writable";\n    exit;\n}\n\n$fail = false;\nforeach ($_FILES as $file) {\n    if (add_to_album($file['tmp_name'], $_REQUEST['album']) == false) {\n        $fail = true;\n    }\n}\necho "upload has finished";\nif ($fail == true) {\n    echo "0";\n} else {\n    echo "1";\n}\n\n// Add error logging\nerror_log(print_r($_FILES, true));\nerror_log(print_r($_REQUEST, true));\n?>