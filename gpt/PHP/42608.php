$data = '';\n$iptc = array(\n    '2#120' => 'Caption text',\n    '2#055' => 'DateCreated',\n    '2#105' => 'Headline'\n);\n\nforeach ($iptc as $tag => $string) {\n    $tag = substr($tag, 2);\n    $data .= iptc_make_tag(2, $tag, $string);\n}\n\nfunction iptc_make_tag($rec, $dat, $val) {\n    $len = strlen($val);\n    if ($len < 0x8000) {\n        return chr(0x1C) . chr($rec) . chr($dat) . \n               chr($len >> 8) . chr($len & 0xFF) . $val;\n    } else {\n        return chr(0x1C) . chr($rec) . chr($dat) . \n               chr(0x80) . chr(0x04) . \n               chr(($len >> 24) & 0xFF) . chr(($len >> 16) & 0xFF) . \n               chr(($len >> 8 ) & 0xFF) . chr(($len) & 0xFF) . $val;\n    }\n}