function prepareString($str) {\n    // Normalize the string and convert to lowercase\n    $str = mb_strtolower(trim($str));\n\n    // Replace non-alphanumeric characters with a space\n    $str = preg_replace('#[^\p{L}\p{Nd}]+#u', ' ', $str);\n\n    // Split into individual characters, preserving Latin words and ideographic characters\n    $parts = preg_split('#([^\p{L}\p{Nd}]+|\p{Han})#u', $str, -1, PREG_SPLIT_DELIM_CAPTURE | PREG_SPLIT_NO_EMPTY);\n\n    // Rebuild the string with spaces between ideographic characters\n    $result = [];\n    foreach ($parts as $part) {\n        if (preg_match('#\p{Han}#u', $part)) {\n            $result[] = preg_replace('#(\p{Han})#u', ' $1 ', $part);\n        } else {\n            $result[] = $part;\n        }\n    }\n\n    // Join the parts and trim extra spaces\n    return trim(preg_replace('#\s+#u', ' ', implode(' ', $result)));\n}\n\n// Example usage\n$input = "hello 1234567890 蓄積した abc123def";\n$output = prepareString($input);\necho $output; // Should output: "hello 1234567890 蓄 積 し た abc123def"