<?php\nclass Reputation_model extends CI_Model {\n\n    public function get_user_reputation($user_id, $start_date, $end_date) {\n        $this->db->select_sum('points');\n        $this->db->from('reputation');\n        $this->db->where('user_id', $user_id);\n        $this->db->where('date >=', $start_date);\n        $this->db->where('date <=', $end_date);\n        $query = $this->db->get();\n        return $query->row()->points;\n    }\n\n    public function get_all_users_reputation($start_date, $end_date) {\n        $this->db->select('user_id, SUM(points) as total_points');\n        $this->db->from('reputation');\n        $this->db->where('date >=', $start_date);\n        $this->db->where('date <=', $end_date);\n        $this->db->group_by('user_id');\n        $query = $this->db->get();\n        return $query->result_array();\n    }\n\n    public function calculate_percentile_rank($user_id, $start_date, $end_date) {\n        // Get the user's reputation for the given time span\n        $user_reputation = $this->get_user_reputation($user_id, $start_date, $end_date);\n        \n        // Get all users' reputation for the given time span\n        $all_users_reputation = $this->get_all_users_reputation($start_date, $end_date);\n\n        // Count users with less reputation\n        $count_less = 0;\n        foreach ($all_users_reputation as $user) {\n            if ($user['total_points'] < $user_reputation) {\n                $count_less++;\n            }\n        }\n\n        // Total users\n        $total_users = count($all_users_reputation);\n\n        // Calculate percentile rank\n        if ($total_users == 0) {\n            return 0; // Handle division by zero if no users are found\n        }\n        $percentile_rank = ($count_less / $total_users) * 100;\n\n        return $percentile_rank;\n    }\n}\n?>