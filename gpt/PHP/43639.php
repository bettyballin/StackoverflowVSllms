<?php\n/*\nTemplate Name: Custom Archive\n*/\n\nget_header(); ?>\n\n<div id="content" class="narrowcolumn" role="main">\n  <?php\n    global $wpdb;\n    $months = $wpdb->get_results("SELECT DISTINCT MONTH(post_date) AS month, YEAR(post_date) AS year, COUNT(ID) as post_count FROM $wpdb->posts WHERE post_status = 'publish' AND post_type = 'post' GROUP BY month, year ORDER BY post_date DESC");\n\n    if ($months) :\n      foreach ($months as $month) :\n        $month_name = date("F", mktime(0, 0, 0, $month->month, 1, $month->year));\n  ?>\n        <h2><?php echo $month_name . ' ' . $month->year; ?></h2>\n        <ul>\n          <?php\n            $posts = $wpdb->get_results("SELECT ID, post_title FROM $wpdb->posts WHERE post_status = 'publish' AND post_type = 'post' AND MONTH(post_date) = $month->month AND YEAR(post_date) = $month->year ORDER BY post_date DESC");\n            if ($posts) :\n              foreach ($posts as $post) :\n          ?>\n                <li><a href="<?php echo get_permalink($post->ID); ?>"><?php echo $post->post_title; ?></a></li>\n          <?php\n              endforeach;\n            endif;\n          ?>\n        </ul>\n  <?php\n      endforeach;\n    else :\n  ?>\n      <p><?php _e('No posts found.', 'textdomain'); ?></p>\n  <?php endif; ?>\n</div>\n\n<?php get_sidebar(); ?>\n<?php get_footer(); ?>