<?php\nfunction generateUsername($firstName, $lastName, $conn) {\n    // Generate the base username\n    $baseUsername = strtolower(substr($firstName, 0, 1) . $lastName);\n    $username = $baseUsername;\n    $counter = 1;\n    \n    // Prepare the SQL statement\n    $stmt = $conn->prepare("SELECT COUNT(*) FROM users WHERE username = ?");\n    \n    // Check if the username exists and increment the counter if it does\n    while (true) {\n        // Bind the username parameter and execute the query\n        $stmt->bind_param("s", $username);\n        $stmt->execute();\n        $stmt->bind_result($count);\n        $stmt->fetch();\n        \n        // If no user exists with this username, break the loop\n        if ($count == 0) {\n            break;\n        }\n        \n        // If the username is taken, increment the counter and try again\n        $username = $baseUsername . $counter;\n        $counter++;\n    }\n    \n    // Close the statement\n    $stmt->close();\n    \n    return $username;\n}\n\n// Usage example:\n// Assuming you have a MySQLi connection $conn\n$firstName = "John";\n$lastName = "Smith";\n$conn = new mysqli("localhost", "username", "password", "database");\n\n// Make sure to handle connection errors\nif ($conn->connect_error) {\n    die("Connection failed: " . $conn->connect_error);\n}\n\n$newUsername = generateUsername($firstName, $lastName, $conn);\necho "Generated username: " . $newUsername;\n\n$conn->close();\n?>