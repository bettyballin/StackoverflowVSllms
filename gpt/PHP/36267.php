<?php\n$secretKey = 'your_secret_key'; // Use the same secret key\n\nif (isset($_GET['file']) && isset($_GET['expires']) && isset($_GET['token'])) {\n    $filePath = urldecode($_GET['file']);\n    $expirationTime = intval($_GET['expires']);\n    $token = $_GET['token'];\n    \n    // Validate the token and expiration time\n    if (time() < $expirationTime) {\n        $expectedToken = hash_hmac('sha256', $filePath . $expirationTime, $secretKey);\n        \n        if (hash_equals($expectedToken, $token)) {\n            // Token is valid, serve the file\n            $fullPath = '/path/to/secure/directory/' . $filePath; // Adjust the path as needed\n            \n            if (file_exists($fullPath)) {\n                header('Content-Description: File Transfer');\n                header('Content-Type: application/octet-stream');\n                header('Content-Disposition: attachment; filename="' . basename($fullPath) . '"');\n                header('Expires: 0');\n                header('Cache-Control: must-revalidate');\n                header('Pragma: public');\n                header('Content-Length: ' . filesize($fullPath));\n                readfile($fullPath);\n                exit;\n            } else {\n                http_response_code(404);\n                echo 'File not found.';\n                exit;\n            }\n        } else {\n            http_response_code(403);\n            echo 'Invalid token.';\n            exit;\n        }\n    } else {\n        http_response_code(403);\n        echo 'Link has expired.';\n        exit;\n    }\n} else {\n    http_response_code(400);\n    echo 'Invalid request.';\n    exit;\n}