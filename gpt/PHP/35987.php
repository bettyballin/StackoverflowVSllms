<?php\n$rules = "Rule 1: Do [XXX] when [PN] greater than [N]";\n$translate = array(\n    'XXX' => 'gen-string-input', \n    'PN' => 'gen-positivenumber-input',\n    'N' => 'gen-number-input'\n);\n\n$md5Hash = md5($rules); // Generate a static MD5 hash for the rule\n\nfunction replace_callback($matches) {\n    global $translate, $md5Hash;\n    static $offset = 0;\n\n    $code = $matches[1];\n    $classname = isset($translate[$code]) ? $translate[$code] : 'unknown-class';\n    $output = sprintf(\n        '<span class="%s" unique="%s" offset="%d">[%s]</span>',\n        $classname,\n        $md5Hash,\n        $offset,\n        $code\n    );\n    $offset++;\n    return $output;\n}\n\n// Use regular expression to find and replace all [CODE] instances\n$result = preg_replace_callback('/\[(\w+)\]/', 'replace_callback', $rules);\n\n// Output the result\necho "<p>$result</p>";\n?>