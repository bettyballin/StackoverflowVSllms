// Prepare the data\n$user_agent = $this->user_agent;\n$ip = $this->ip;\n$userid = $this->id;\n$timestamp = time();\n\n// SQL query using ON DUPLICATE KEY UPDATE\n$sql = "INSERT INTO `user_ips` (`userid`, `ip`, `first_time`, `last_time`, `user_agent`)\n        VALUES ($userid, $ip, $timestamp, $timestamp, '$user_agent')\n        ON DUPLICATE KEY UPDATE\n        `last_time` = VALUES(`last_time`), \n        `user_agent` = VALUES(`user_agent`)";\n\n// Execute the query\n$site->query($sql);