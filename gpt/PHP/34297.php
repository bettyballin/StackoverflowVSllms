<?php\nsession_start();\nrequire_once($_SERVER['DOCUMENT_ROOT'].'/config.php');\nrequire_once(SITE_ROOT.'includes/exceptions.php');\nrequire_once(SITE_ROOT.'data/model.php');\n\nclass Auth extends Model\n{\n    function isUserLoggedIn()\n    {\n        if (isset($_SESSION['user'])) {\n            return true;\n        } else {\n            return false;\n        }\n    }\n\n    static function redirectToLogin()\n    {\n        header("location: http://". DOMAIN .APP_DIR . "index.php?action=login");\n        exit();\n    }\n\n    static function redirectToMain()\n    {\n        header("location: http://". DOMAIN . APP_DIR . "index.php?action=main");\n        exit();\n    }\n\n    static function login($user)\n    {\n        try\n        {\n            $db = parent::getConnection();\n            $username = $user->getUsername();\n            $password = $user->getPassword();\n            \n            $stmt = $db->prepare("SELECT username, password FROM users WHERE username = ?");\n            $stmt->bind_param('s', $username);\n            $stmt->execute();\n            $stmt->store_result();\n            \n            if ($stmt->num_rows === 0) {\n                throw new Exception('Invalid login credentials', EX_LOGIN_ERROR);\n            }\n            \n            $stmt->bind_result($dbUsername, $dbPassword);\n            $stmt->fetch();\n            \n            if (password_verify($password, $dbPassword)) {\n                $_SESSION['user'] = $dbUsername;\n            } else {\n                throw new Exception('Invalid login credentials', EX_LOGIN_ERROR);\n            }\n            \n            $stmt->close();\n        }\n        catch(Exception $e)\n        {\n            throw $e;\n        }\n    }\n\n    static function logout()\n    {\n        unset($_SESSION['user']);\n        session_destroy();\n    }\n}\n?>