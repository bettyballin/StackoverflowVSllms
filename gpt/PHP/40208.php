foreach($eventfiles as $eventfile) {\n    if($eventfile['filename']) { \n        $file = $eventfile['filepath'];\n        \n        // Ensure the file path is valid\n        if (!file_exists($file) || !is_readable($file)) {\n            echo '<br>CAN NOT READ FILE.';\n            exit;\n        }\n\n        // Open File\n        if( !($fp = fopen($file, "r"))) {\n            echo '<br>CAN NOT READ FILE.';\n            exit;\n        }\n\n        // Read data from the file into $data\n        $data = "";\n        while (!feof($fp)) {\n            $data .= fread($fp, 1024);\n        }\n        fclose($fp);\n\n        // Update the database\n        query("update event_rtab set html = '".escape($data)."' where id = {$eventfile['id']}");\n    }\n    if($eventfile['eventType'] == 'email') {\n        query("INSERT INTO event_email_rtab (event_id, subject) values ({$eventfile['id']}, '".escape($eventfile['email_subject'])."')");\n    }\n}