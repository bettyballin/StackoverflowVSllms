public function login() {\n    if ($this->request->is('post')) {\n        $user = $this->Auth->identify();\n        if ($user) {\n            $this->Auth->setUser($user);\n\n            // Check for a redirect URL provided in the request data\n            $redirectUrl = $this->Auth->redirectUrl();\n\n            // Optionally, you can set a default redirect URL to override the previous one\n            if (empty($redirectUrl) || $redirectUrl == '/') {\n                $redirectUrl = $this->Auth->config('loginRedirect');\n            }\n\n            return $this->redirect($redirectUrl);\n        }\n\n        $this->Flash->error(__('Invalid username or password, try again'));\n    }\n\n    // If the user is already logged in, redirect them to the loginRedirect URL\n    if ($this->Auth->user()) {\n        return $this->redirect($this->Auth->config('loginRedirect'));\n    }\n}