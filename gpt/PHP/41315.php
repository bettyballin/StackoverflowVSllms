<?php\nsession_start();\n\n// Check if token is present and valid\nif (!isset($_GET['token']) || !isset($_SESSION['download_token']) || $_GET['token'] !== $_SESSION['download_token']) {\n    die("Unauthorized access.");\n}\n\n// Remove the token after it's used\nunset($_SESSION['download_token']);\n\n// Process the download\n$file = $_GET['file'];\n// Add further security checks for the file reference to ensure it's valid and safe\n$filepath = "/path/to/your/files/" . basename($file);\n\nif (file_exists($filepath)) {\n    header('Content-Description: File Transfer');\n    header('Content-Type: application/octet-stream');\n    header('Content-Disposition: attachment; filename="' . basename($filepath) . '"');\n    header('Expires: 0');\n    header('Cache-Control: must-revalidate');\n    header('Pragma: public');\n    header('Content-Length: ' . filesize($filepath));\n    readfile($filepath);\n    exit;\n} else {\n    die("File not found.");\n}\n?>