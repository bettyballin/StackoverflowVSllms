function encrypt($plaintext, $key) {\n    $ivlen = openssl_cipher_iv_length($cipher = "AES-128-CBC");\n    $iv = openssl_random_pseudo_bytes($ivlen);\n    $ciphertext_raw = openssl_encrypt($plaintext, $cipher, $key, $options = OPENSSL_RAW_DATA, $iv);\n    $hmac = hash_hmac('sha256', $ciphertext_raw, $key, $as_binary = true);\n    return base64_encode($iv . $hmac . $ciphertext_raw);\n}\n\nfunction decrypt($ciphertext, $key) {\n    $c = base64_decode($ciphertext);\n    $ivlen = openssl_cipher_iv_length($cipher = "AES-128-CBC");\n    $iv = substr($c, 0, $ivlen);\n    $hmac = substr($c, $ivlen, $sha2len = 32);\n    $ciphertext_raw = substr($c, $ivlen + $sha2len);\n    $original_plaintext = openssl_decrypt($ciphertext_raw, $cipher, $key, $options = OPENSSL_RAW_DATA, $iv);\n    $calcmac = hash_hmac('sha256', $ciphertext_raw, $key, $as_binary = true);\n    if (hash_equals($hmac, $calcmac)) {\n        return $original_plaintext;\n    }\n    return false; // HMAC verification failed\n}\n\n// Usage examples\n$key = 'your-encryption-key';\n$plaintext = 'This is a secret message';\n\n$encrypted = encrypt($plaintext, $key);\necho "Encrypted: " . $encrypted . "\n";\n\n$decrypted = decrypt($encrypted, $key);\necho "Decrypted: " . $decrypted . "\n";