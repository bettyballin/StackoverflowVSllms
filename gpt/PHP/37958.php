// Assuming $menu is built as described\n$menu = array();\n$sql = "SELECT menu_id, menu_name, parent_id FROM menu";\n$dbc->setFetchMode(DB_FETCHMODE_ASSOC);\n$res = $dbc->query($sql);\nwhile ($row = $res->fetchRow()) {\n    $menu[$row['parent_id']][$row['menu_id']] = $row['menu_name'];\n}\n\n$P['menu_bilder_data'] = $menu[0]; // Root level menus\n$smarty->assign('P', $P);\n\n// Register the recursive function\n$smarty->registerPlugin('function', 'make_menu', 'make_menu');\n\n// Display the template\n$smarty->display('your_template.tpl');