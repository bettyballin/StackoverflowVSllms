<?php\nrequire 'vendor/autoload.php';\n\nuse PhpAmqpLib\Connection\AMQPStreamConnection;\nuse PHPMailer\PHPMailer\PHPMailer;\nuse PHPMailer\PHPMailer\Exception;\n\nfunction sendEmail($recipient, $subject, $body)\n{\n    $mail = new PHPMailer(true);\n\n    try {\n        //Server settings\n        $mail->isSMTP();\n        $mail->Host = 'smtp.example.com';\n        $mail->SMTPAuth = true;\n        $mail->Username = 'your_email@example.com';\n        $mail->Password = 'your_password';\n        $mail->SMTPSecure = PHPMailer::ENCRYPTION_STARTTLS;\n        $mail->Port = 587;\n\n        //Recipients\n        $mail->setFrom('your_email@example.com', 'Mailer');\n        $mail->addAddress($recipient);\n\n        //Content\n        $mail->isHTML(true);\n        $mail->Subject = $subject;\n        $mail->Body    = $body;\n\n        $mail->send();\n        echo 'Message has been sent' . PHP_EOL;\n    } catch (Exception $e) {\n        echo "Message could not be sent. Mailer Error: {$mail->ErrorInfo}" . PHP_EOL;\n    }\n}\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection->channel();\n$channel->queue_declare('email_queue', false, true, false, false);\n\necho ' [*] Waiting for messages. To exit press CTRL+C', "\n";\n\n$callback = function ($msg) {\n    $data = json_decode($msg->body, true);\n    sendEmail($data['recipient'], $data['subject'], $data['body']);\n};\n\n$channel->basic_consume('email_queue', '', false, true, false, false, $callback);\n\nwhile ($channel->is_consuming()) {\n    $channel->wait();\n}\n\n$channel->close();\n$connection->close();