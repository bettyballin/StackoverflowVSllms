<?php\ndefined('_JEXEC') or die;\n\nuse Joomla\CMS\Plugin\CMSPlugin;\nuse Joomla\CMS\Factory;\n\nclass PlgContentImageoptimizer extends CMSPlugin {\n    public function onContentBeforeSave($context, &$article, $isNew) {\n        $images = $this->extractImages($article->introtext);\n\n        foreach ($images as $image) {\n            $sourcePath = JPATH_ROOT . '/' . $image;\n            $targetPath = JPATH_ROOT . '/cache/resized/' . basename($image);\n\n            if (!file_exists($targetPath)) {\n                $this->resizeImage($sourcePath, $targetPath, 800, 600); // Adjust max dimensions as needed\n            }\n\n            $article->introtext = str_replace($image, 'cache/resized/' . basename($image), $article->introtext);\n        }\n\n        return true;\n    }\n    \n    private function extractImages($content) {\n        preg_match_all('/<img[^>]+src="([^">]+)"/', $content, $matches);\n        return $matches[1];\n    }\n\n    private function resizeImage($sourcePath, $targetPath, $maxWidth, $maxHeight) {\n        list($origWidth, $origHeight) = getimagesize($sourcePath);\n\n        $ratio = $origWidth / $origHeight;\n        if ($maxWidth / $maxHeight > $ratio) {\n            $maxWidth = $maxHeight * $ratio;\n        } else {\n            $maxHeight = $maxWidth / $ratio;\n        }\n\n        $image_p = imagecreatetruecolor($maxWidth, $maxHeight);\n        $image = imagecreatefromjpeg($sourcePath);\n        imagecopyresampled($image_p, $image, 0, 0, 0, 0, $maxWidth, $maxHeight, $origWidth, $origHeight);\n        \n        imagejpeg($image_p, $targetPath, 75); // Adjust quality as needed\n\n        imagedestroy($image_p);\n        imagedestroy($image);\n    }\n}