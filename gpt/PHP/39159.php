// Select 15 random galleries\n$this->db->select('galleries.id, galleries.name, users.username');\n$this->db->from('galleries');\n$this->db->join('users', 'users.id = galleries.user_id', 'left');\n$this->db->where('galleries.active', 1);\n$this->db->order_by('RAND()');\n$this->db->limit(15);\n$galleries = $this->db->get_compiled_select();\n\n// Create the main query with the subquery for random picture\n$this->db->select('g.id AS gallery_id, g.name AS gallery_name, u.username, p.url AS picture_url');\n$this->db->from("($galleries) AS g");\n$this->db->join('users AS u', 'u.id = g.user_id', 'left');\n$this->db->join('(SELECT gallery_id, url FROM pictures ORDER BY RAND()) AS p', 'p.gallery_id = g.id', 'left');\n$this->db->group_by('g.id');\n$query = $this->db->get();\n\n$result = $query->result();