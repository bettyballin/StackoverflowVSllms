private function run_lengthy_job($command, $message) {\n    $handle = popen($command, 'r');\n    if (!$handle) {\n        throw new \RuntimeException("Unable to open process for command: $command");\n    }\n\n    // Set the stream to non-blocking mode\n    stream_set_blocking($handle, false);\n\n    while (!feof($handle)) {\n        $read = [$handle];\n        $write = $except = null;\n\n        // Wait for the stream to become readable\n        if (stream_select($read, $write, $except, 2)) {\n            $output = fread($handle, 1024);\n            if ($output !== false && strlen($output) > 0) {\n                printf("[%s]\t%s\n", time(), $message);\n\n                // log the operation\n                exec(sprintf('logger "%s"', escapeshellarg($output)));\n            }\n        }\n\n        // Sleep briefly to avoid busy-waiting\n        usleep(200000); // 200 milliseconds\n    }\n\n    pclose($handle);\n}