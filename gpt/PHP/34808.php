$mysqli = new mysqli("localhost", "username", "password", "database");\n\n$userhash = $mysqli->real_escape_string($userhash);\n\n$query = $mysqli->query("\n  SELECT \n    s.*,\n    UNIX_TIMESTAMP(s.`date`) AS `date`,\n    MAX(f.userid) as favoritehash\n  FROM\n    songs s\n  LEFT JOIN\n    favorites f\n  ON \n    f.favorite = s.id\n    AND f.userid = '$userhash'\n  GROUP BY \n    s.id\n");\n\nwhile ($row = $query->fetch_assoc()) {\n    // Process each row\n}