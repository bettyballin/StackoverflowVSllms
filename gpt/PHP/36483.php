<?php\nrequire 'vendor/autoload.php';\n\nsession_start();\n\nif (isset($_SESSION['access_token']) && $_SESSION['access_token']) {\n    $client = new Google_Client();\n    $client->setAuthConfig('path/to/client_credentials.json');\n    $client->setAccessToken($_SESSION['access_token']);\n\n    $service = new Google_Service_Gmail($client);\n\n    $message = new Google_Service_Gmail_Message();\n    $rawMessageString = "Subject: Test Mail\r\n";\n    $rawMessageString .= "From: your-email@gmail.com\r\n";\n    $rawMessageString .= "To: recipient-email@gmail.com\r\n\r\n";\n    $rawMessageString .= "This is a test email.";\n\n    $rawMessage = base64_encode($rawMessageString);\n    $rawMessage = str_replace(array('+', '/', '='), array('-', '_', ''), $rawMessage);\n    $message->setRaw($rawMessage);\n\n    try {\n        $message = $service->users_messages->send('me', $message);\n        print('Message sent with ID: ' . $message->getId());\n    } catch (Exception $e) {\n        print('An error occurred: ' . $e->getMessage());\n    }\n} else {\n    header('Location: oauth2callback.php');\n}\n?>