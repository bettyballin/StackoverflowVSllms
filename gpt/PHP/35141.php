<?php\nfunction connect_to_server($host, $port, $timeout = 30) {\n    $socket = @fsockopen($host, $port, $errno, $errstr, $timeout);\n    if (!$socket) {\n        die("Could not connect to $host on port $port: $errstr ($errno)");\n    }\n    stream_set_timeout($socket, $timeout);\n    return $socket;\n}\n\n$username = $_POST["username"];\n$socket = connect_to_server("messenger.hotmail.com", 1863);\necho 'Connected to 1st server.';\n\n// Send MSNP version\nfputs($socket, "VER 0 MSNP10 CVR0\r\n");\necho fread($socket, 5000);\n\n// Send user-agent\nfputs($socket, "CVR 1 0x0409 php " . phpversion() . " i386 MSNMSGR 7.0.0000 MSMSGS $username\r\n");\necho fread($socket, 5000);\n\n// Send username\nfputs($socket, "USR 2 TWN I $username\r\n");\n\n// Read XFR\n$xfr = fread($socket, 5000);\necho $xfr;\n$xfr = explode(" ", $xfr);\n\n// Connect to second server\n$server2 = explode(":", $xfr[3]);\n$socket = connect_to_server($server2[0], (int)$server2[1]);\necho 'Connected to 2nd server.';\n\n// Send MSNP version\nfputs($socket, "VER 0 MSNP10 CVR0\r\n");\necho fread($socket, 5000);\n\n// Send user-agent\nfputs($socket, "CVR 1 0x0409 php " . phpversion() . " i386 MSNMSGR 7.0.0000 MSMSGS $username\r\n");\necho fread($socket, 5000);\n\n// Send username\nfputs($socket, "USR 2 TWN I $username\r\n");\n\n// Read USR\n$usr = fread($socket, 5000);\necho $usr;\n$usr = explode(" ", $usr);\n\n// Connect to Nexus\n$nexus = connect_to_server("nexus.passport.com", 443);\n$request_nexus = "GET /rdr/pprdr.asp HTTP/1.1\r\n";\n$request_nexus .= "Host: nexus.passport.com\r\n";\n$request_nexus .= "User-Agent: MSNphp/1.0 (PHP; U; PHP 5; en-US)\r\n";\n$request_nexus .= "Accept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\r\n";\n$request_nexus .= "Accept-Language: en-us,en;q=0.5\r\n";\n$request_nexus .= "Connection: keep-alive\r\n";\n$request_nexus .= "Cache-Control: max-age=0\r\n\r\n";\n\nfputs($nexus, $request_nexus);\n$response = fread($nexus, 5000);\necho $response;\n\nfclose($nexus);\nfclose($socket);\n?>