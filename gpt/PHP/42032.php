try {\n    $database = new PDO("mysql:host=host;dbname=mysql_db", "username", "password");\n    $database->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n    // Start the transaction\n    $database->beginTransaction();\n\n    while (notDone()) {\n        $add_row = $database->prepare("INSERT INTO table (columns) VALUES (?)");\n        $add_row->execute(array('values'));\n\n        // PROCESSING STUFF THAT TAKES A LONG TIME GOES HERE\n        // Ensure you handle the possibility of this section failing.\n    }\n\n    // Commit the transaction if everything was successful\n    $database->commit();\n} catch (Exception $e) {\n    // Rollback the transaction on any error\n    $database->rollBack();\n    echo "Failed: " . $e->getMessage();\n} finally {\n    // Close the database connection\n    $database = null;\n}