<?php\n// Check if the form was submitted\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    // File upload path\n    $targetDir = "uploads/";\n    $username = $_POST['username']; // Assume the username is posted from a form\n    $targetFile = $targetDir . basename($_FILES["fileToUpload"]["name"]);\n    $imageFileType = strtolower(pathinfo($targetFile, PATHINFO_EXTENSION));\n    $newFileName = $targetDir . $username . '.' . $imageFileType;\n    \n    // Check if image file is a actual image or fake image\n    $check = getimagesize($_FILES["fileToUpload"]["tmp_name"]);\n    if ($check !== false) {\n        // Check file size (5MB max)\n        if ($_FILES["fileToUpload"]["size"] <= 5000000) {\n            // Allow certain file formats\n            if($imageFileType == "jpg" || $imageFileType == "png" || $imageFileType == "jpeg" || $imageFileType == "gif" ) {\n                // Resize the image if necessary (example using GD library)\n                $image = imagecreatefromstring(file_get_contents($_FILES["fileToUpload"]["tmp_name"]));\n                $resizedImage = imagescale($image, 100, 100); // Example: scale to 100x100\n                \n                // Save the resized image\n                if ($imageFileType == "jpg" || $imageFileType == "jpeg") {\n                    imagejpeg($resizedImage, $newFileName);\n                } elseif ($imageFileType == "png") {\n                    imagepng($resizedImage, $newFileName);\n                } elseif ($imageFileType == "gif") {\n                    imagegif($resizedImage, $newFileName);\n                }\n\n                // Save the file path in the database\n                $conn = new mysqli("localhost", "username", "password", "database");\n                if ($conn->connect_error) {\n                    die("Connection failed: " . $conn->connect_error);\n                }\n                $sql = "UPDATE users SET profile_image_path='$newFileName' WHERE username='$username'";\n                if ($conn->query($sql) === TRUE) {\n                    echo "Profile image updated successfully.";\n                } else {\n                    echo "Error updating record: " . $conn->error;\n                }\n                $conn->close();\n\n                // Free resources\n                imagedestroy($image);\n                imagedestroy($resizedImage);\n            } else {\n                echo "Sorry, only JPG, JPEG, PNG & GIF files are allowed.";\n            }\n        } else {\n            echo "Sorry, your file is too large.";\n        }\n    } else {\n        echo "File is not an image.";\n    }\n}\n?>