<?php\n$servername = "localhost";\n$username = "username";\n$password = "password";\n$dbname = "database";\n\n// Create connection\n$conn = new mysqli($servername, $username, $password, $dbname);\n\n// Check connection\nif ($conn->connect_error) {\n    die("Connection failed: " . $conn->connect_error);\n}\n\nsession_start();\n$user_id = $_SESSION['user_id']; // Assuming user_id is stored in session after login\n$item_id = intval($_POST['item_id']);\n$vote = intval($_POST['vote']); // 1 for upvote, -1 for downvote\n\nif ($vote !== 1 && $vote !== -1) {\n    die("Invalid vote value");\n}\n\n// Check if the user has already voted on this item\n$sql = "SELECT * FROM votes WHERE item_id = ? AND user_id = ?";\n$stmt = $conn->prepare($sql);\n$stmt->bind_param("ii", $item_id, $user_id);\n$stmt->execute();\n$result = $stmt->get_result();\n\nif ($result->num_rows > 0) {\n    // Update the existing vote\n    $sql = "UPDATE votes SET vote = ?, created_at = NOW() WHERE item_id = ? AND user_id = ?";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param("iii", $vote, $item_id, $user_id);\n} else {\n    // Insert a new vote\n    $sql = "INSERT INTO votes (item_id, user_id, vote) VALUES (?, ?, ?)";\n    $stmt = $conn->prepare($sql);\n    $stmt->bind_param("iii", $item_id, $user_id, $vote);\n}\n\nif ($stmt->execute()) {\n    echo "Vote recorded successfully";\n} else {\n    echo "Error: " . $stmt->error;\n}\n\n$stmt->close();\n$conn->close();\n?>