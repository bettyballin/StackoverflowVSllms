<?php\nrequire 'vendor/autoload.php';\n\nuse Google\Client;\nuse Google\Service\Gmail;\n\nfunction getClient() {\n    $client = new Client();\n    $client->setApplicationName('Gmail API PHP Quickstart');\n    $client->setScopes(Gmail::MAIL_GOOGLE_COM);\n    $client->setAuthConfig('path/to/credentials.json');\n    $client->setAccessType('offline');\n    $client->setPrompt('select_account consent');\n\n    $tokenPath = 'token.json';\n    if (file_exists($tokenPath)) {\n        $accessToken = json_decode(file_get_contents($tokenPath), true);\n        $client->setAccessToken($accessToken);\n    }\n\n    if ($client->isAccessTokenExpired()) {\n        if ($client->getRefreshToken()) {\n            $client->fetchAccessTokenWithRefreshToken($client->getRefreshToken());\n        } else {\n            $authUrl = $client->createAuthUrl();\n            printf("Open the following link in your browser:\n%s\n", $authUrl);\n            print 'Enter verification code: ';\n            $authCode = trim(fgets(STDIN));\n            $accessToken = $client->fetchAccessTokenWithAuthCode($authCode);\n            $client->setAccessToken($accessToken);\n\n            if (!file_exists(dirname($tokenPath))) {\n                mkdir(dirname($tokenPath), 0700, true);\n            }\n            file_put_contents($tokenPath, json_encode($client->getAccessToken()));\n        }\n    }\n    return $client;\n}\n\n$client = getClient();\n$service = new Gmail($client);\n\n$user = 'me';\n$results = $service->users_messages->listUsersMessages($user);\n\nif (count($results->getMessages()) == 0) {\n    print "No messages found.\n";\n} else {\n    print "Messages:\n";\n    foreach ($results->getMessages() as $message) {\n        print $message->getId() . "\n";\n    }\n}\n?>