$temp_image_file = imagecreatefromjpeg("http://www.example.com/image.jpg");\n\nlist($width, $height) = getimagesize("http://www.example.com/image.jpg");\n\n$target_width = 166;\n$target_height = 103;\n\n// Calculate aspect ratios\n$source_aspect_ratio = $width / $height;\n$target_aspect_ratio = $target_width / $target_height;\n\nif ($source_aspect_ratio > $target_aspect_ratio) {\n    // Landscape image\n    $new_width = $target_width;\n    $new_height = (int)($target_width / $source_aspect_ratio);\n    $dst_x = 0;\n    $dst_y = (int)(($target_height - $new_height) / 2);\n} else {\n    // Portrait image or square\n    $new_width = (int)($target_height * $source_aspect_ratio);\n    $new_height = $target_height;\n    $dst_x = (int)(($target_width - $new_width) / 2);\n    $dst_y = 0;\n}\n\n$image_file = imagecreatetruecolor($target_width, $target_height);\n\n// Fill the background with black color\n$black = imagecolorallocate($image_file, 0, 0, 0);\nimagefill($image_file, 0, 0, $black);\n\n// Copy and resize the image\nimagecopyresampled($image_file, $temp_image_file, $dst_x, $dst_y, 0, 0, $new_width, $new_height, $width, $height);\n\n// Save the thumbnail\nimagejpeg($image_file, "thumbnails/thumbnail.jpg", 50);\n\n// Free memory\nimagedestroy($temp_image_file);\nimagedestroy($image_file);