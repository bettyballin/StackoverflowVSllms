<?php\n// Establish database connection (use mysqli or PDO instead of deprecated mysql_* functions)\n$mysqli = new mysqli("host", "user", "password", "database");\n\n// Prepare statements for insert and update\n$updateStmt = $mysqli->prepare("UPDATE it_raw SET \n    eventtime = ?, eventname = ?, venuename = ?, venueregion = ?, venuepostcode = ?, \n    country = ?, minprice = ?, available = ?, link = ?, eventtype = ?, \n    seaOnSaleDate = ?, perOnSaleDate = ?, soldOut = ?, eventImageURL = ? \n    WHERE perfID = ?");\n$insertStmt = $mysqli->prepare("INSERT INTO it_raw (\n    eventtime, eventname, venuename, venueregion, venuepostcode, country, \n    minprice, available, link, eventtype, seaOnSaleDate, perOnSaleDate, \n    soldOut, eventImageURL, perfID) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)");\n\n$counter = 0;\n$events = sizeof($feed_array['1']) - 1;\n\n// Fetch all existing perfIDs in one query\n$existingPerfIDs = [];\n$result = $mysqli->query("SELECT perfID FROM it_raw");\nwhile ($row = $result->fetch_assoc()) {\n    $existingPerfIDs[$row['perfID']] = true;\n}\n\nwhile ($counter <= $events) {\n    $perfID = $feed_array['16'][$counter];\n    $eventDate = explode("/", $feed_array['1'][$counter]);\n    $eventTime = explode(":", $feed_array['2'][$counter]);\n    $eventUnixTime = mktime($eventTime[0], $eventTime[1], 0, $eventDate[1], $eventDate[0], $eventDate[2]);\n\n    $params = [\n        $eventUnixTime,\n        addslashes($feed_array['3'][$counter]),\n        addslashes($feed_array['4'][$counter]),\n        addslashes($feed_array['5'][$counter]),\n        addslashes($feed_array['6'][$counter]),\n        addslashes($feed_array['7'][$counter]),\n        addslashes($feed_array['8'][$counter]),\n        addslashes($feed_array['9'][$counter]),\n        addslashes($feed_array['10'][$counter]),\n        addslashes($feed_array['11'][$counter]),\n        addslashes($feed_array['12'][$counter]),\n        addslashes($feed_array['13'][$counter]),\n        addslashes($feed_array['14'][$counter]),\n        addslashes($feed_array['15'][$counter]),\n        $perfID\n    ];\n\n    if (isset($existingPerfIDs[$perfID])) {\n        // Perform update\n        $updateStmt->bind_param('isssssssssssssi', ...$params);\n        $updateStmt->execute();\n        echo "UPDATE $perfID: " . addslashes($feed_array['3'][$counter]) . "\n";\n    } else {\n        // Perform insert\n        $insertStmt->bind_param('isssssssssssssi', ...$params);\n        $insertStmt->execute();\n        echo "INSERT $perfID: " . addslashes($feed_array['3'][$counter]) . "\n";\n    }\n\n    $counter++;\n}\n\n$updateStmt->close();\n$insertStmt->close();\n$mysqli->close();\n?>