ini_set("memory_limit", "128M");\n\nif (isset($_POST['submit'])) {\n    if (isset($_FILES['new_image'])) {\n        $imagename = $_FILES['new_image']['name'];\n        $source = $_FILES['new_image']['tmp_name'];\n        $target = "images/" . $imagename;\n        \n        if (move_uploaded_file($source, $target)) {\n            $save = "thumbs/uploads/" . $imagename;\n            $file = "images/" . $imagename;\n            $imagesize = getimagesize($file);\n\n            list($width, $height) = $imagesize;\n            $modwidth = $modheight = 150;\n\n            if ($width > $height) {\n                $diff = $width / $modwidth;\n                $modheight = $height / $diff;\n            } else {\n                $diff = $height / $modheight;\n                $modwidth = $width / $diff;\n            }\n\n            $tn = imagecreatetruecolor($modwidth, $modheight);\n            $image = imagecreatefromjpeg($file);\n\n            if ($image && $tn) {\n                imagecopyresampled($tn, $image, 0, 0, 0, 0, $modwidth, $modheight, $width, $height);\n                imagejpeg($tn, $save, 100);\n\n                imagedestroy($image);\n                imagedestroy($tn);\n            } else {\n                echo "Failed to create image resources.";\n            }\n        } else {\n            echo "Failed to upload image.";\n        }\n    }\n}