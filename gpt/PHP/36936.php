// Fetch and lock a batch of messages\n$fetchQuery = "SELECT * FROM messages WHERE status = 'pending' ORDER BY scheduled_time LIMIT 10 FOR UPDATE";\n$messages = $db->query($fetchQuery)->fetchAll();\n\n// Process each message\nforeach ($messages as $message) {\n    // Mark the message as 'processing'\n    $updateQuery = "UPDATE messages SET status = 'processing' WHERE id = :id";\n    $stmt = $db->prepare($updateQuery);\n    $stmt->execute([':id' => $message['id']]);\n\n    // Process the message\n    // ...\n\n    // After processing, mark the message as 'completed'\n    $completeQuery = "UPDATE messages SET status = 'completed' WHERE id = :id";\n    $stmt = $db->prepare($completeQuery);\n    $stmt->execute([':id' => $message['id']]);\n}