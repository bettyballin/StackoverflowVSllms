$MimeType = new MimeType();\n$mimetype = $MimeType->getType($filename);\n$basename = basename($filename);\n\nheader("Content-Type: $mimetype");\nheader("Content-Disposition: attachment; filename=\"$basename\"");\nheader("Content-Length: " . filesize($filename));\n\n// These headers can help IE to properly handle the download\nheader("Pragma: public");\nheader("Expires: 0");\nheader("Cache-Control: must-revalidate, post-check=0, pre-check=0");\nheader("Cache-Control: private", false);\n\nif (@readfile($filename) === false) {\n    header("HTTP/1.0 500 Internal Server Error");\n    loadErrorPage('500');\n}