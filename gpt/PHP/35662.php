/**\n * Send Authentication, SASL\n * @return Bool\n * @param $username String\n * @param $password String\n */\nfunction authenticate($username, $password) {\n    $this->username = $username;\n    $this->password = $password;\n\n    // Start the XML stream\n    $this->_sendStream();\n\n    // Encode the credentials in base64\n    $auth = base64_encode("\u0000" . $username . "\u0000" . $password);\n    $xml = '<auth mechanism="PLAIN" xmlns="urn:ietf:params:xml:ns:xmpp-sasl">' . $auth . '</auth>';\n\n    if ($this->write($xml)) {\n        if ($xml = $this->listen(1, true)) {\n            if (preg_match("/<success/i", $xml)) {\n                $this->authenticated = true;\n            } elseif (preg_match("/<failure/i", $xml)) {\n                $this->authenticated = false;\n            }\n        }\n    }\n\n    $this->events->trigger('authenticate', $this->authenticated);\n    return $this->authenticated;\n}\n\n/**\n * Start the XML stream\n */\nprivate function _sendStream() {\n    $xml = '<?xml version="1.0"?>' .\n           '<stream:stream to="' . $this->domain . '" ' .\n           'xmlns="jabber:client" ' .\n           'xmlns:stream="http://etherx.jabber.org/streams" ' .\n           'version="1.0">';\n    return $this->write($xml);\n}