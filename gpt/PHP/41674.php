<?php\n\nfunction memstat() {\n  print "current memory usage: ". memory_get_usage() . "\n";\n}\n\nfunction waste_lots_of_memory($iters) {\n  $i = 0;\n  $object = new StdClass;\n  for (;$i < $iters; $i++) {\n    $object->{"member_" . $i} = array("blah blah blha" => 12345);\n    $object->{"membersonly_" . $i} = new StdClass;\n    $object->{"onlymember"} = array("blah blah blha" => 12345);\n  }\n  unset($object);\n  // Force garbage collection\n  gc_collect_cycles();\n}\n\nfunction waste_a_little_less_memory($iters) {\n  $i = 0;\n  $object = new StdClass;\n  for (;$i < $iters; $i++) {\n\n    $object->{"member_" . $i} = array("blah blah blha" => 12345);\n    $object->{"membersonly_" . $i} = new StdClass;\n    $object->{"onlymember"} = array("blah blah blha" => 12345);\n\n    unset($object->{"membersonly_". $i});\n    unset($object->{"member_" . $i});\n    unset($object->{"onlymember"});\n\n    // Periodically force garbage collection\n    if ($i % 1000 == 0) {\n      gc_collect_cycles();\n    }\n  }\n  unset($object);\n  // Ensure garbage collection at the end\n  gc_collect_cycles();\n}\n\nmemstat();\n\nwaste_a_little_less_memory(1000000);\n\nmemstat();\n\nwaste_lots_of_memory(10000);\n\nmemstat();\n?>