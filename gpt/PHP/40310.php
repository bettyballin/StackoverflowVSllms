<?php\n\nfunction projectListToTree($projects) {\n    $stack = array();\n    $tree = array();\n    \n    for ($x = 0; $x < count($projects); $x++) {\n        $project = $projects[$x];\n        $project['Children'] = array();\n\n        // Adjust the stack\n        while (count($stack) > 0 && $stack[count($stack) - 1]['Right'] < $project['Right']) {\n            array_pop($stack);\n        }\n\n        if (count($stack) > 0) {\n            // Add to the children array of the last item in the stack\n            $stack[count($stack) - 1]['Children'][] = $project;\n        } else {\n            // No parent, this is a top-level item\n            $tree[] = $project;\n        }\n\n        // Add the current project to the stack\n        $stack[] = $project;\n    }\n\n    // Since we are modifying the stack items directly, we need to reference the original tree\n    return $tree;\n}\n\n/*\nThis is basically what comes from the DB.\nShould be:\n Parent\n First Child\n Second Child\n Grand Child\n*/\n$projects = array(\n    array(\n        "ID" => "2",\n        "Left" => "2",\n        "Right" => "9",\n        "ParentID" => "1",\n        "Name" => "Parent"\n    ),\n    array(\n        "ID" => "3",\n        "Left" => "3",\n        "Right" => "4",\n        "ParentID" => "2",\n        "Name" => "First Child"\n    ),\n    array(\n        "ID" => "4",\n        "Left" => "5",\n        "Right" => "8",\n        "ParentID" => "2",\n        "Name" => "Second Child"\n    ),\n    array(\n        "ID" => "5",\n        "Left" => "6",\n        "Right" => "7",\n        "ParentID" => "4",\n        "Name" => "Grand Child"\n    )\n);\n\n$tree = projectListToTree($projects);\necho json_encode($tree, JSON_PRETTY_PRINT);\n\n?>