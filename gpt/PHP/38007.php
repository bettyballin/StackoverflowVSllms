<?php\nsession_start();\n\n// Function to check the HTTP_REFERER\nfunction is_valid_referer() {\n    $referer = $_SERVER['HTTP_REFERER'] ?? '';\n    $host = $_SERVER['HTTP_HOST'];\n    return strpos($referer, $host) !== false;\n}\n\n// Function to verify the CSRF token\nfunction is_valid_csrf_token($token) {\n    return isset($_SESSION['csrf_token']) && hash_equals($_SESSION['csrf_token'], $token);\n}\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST') {\n    $csrf_token = $_POST['csrf_token'] ?? '';\n\n    if (!is_valid_referer() || !is_valid_csrf_token($csrf_token)) {\n        // Invalid request\n        die("Invalid request.");\n    }\n\n    // Process the form data\n    // Your existing conditional statements and form processing logic go here\n}\n?>