<?php\n$target_dir = realpath(__DIR__ . '/../uploads/') . '/';\n$target_file = $target_dir . basename($_FILES['uploaded']['name']);\n$uploadOk = 1;\n\n// Check if file already exists\n$result = mysql_query("SELECT * FROM media WHERE path = '" . mysql_real_escape_string($target_file) . "'");\nif (mysql_num_rows($result) == 1) {\n    echo "<br />Sorry, there is already a file with that name on the server.<br />Please press back on your browser and save the file under a different name.";\n    $uploadOk = 0;\n}\n\n// Check if $uploadOk is set to 0 by an error\nif ($uploadOk == 1) {\n    if (move_uploaded_file($_FILES['uploaded']['tmp_name'], $target_file)) {\n        echo "The file " . basename($_FILES['uploaded']['name']) . " has been uploaded.";\n        $cat = mysql_real_escape_string($cat);\n        $type = mysql_real_escape_string($type);\n        $name = mysql_real_escape_string($name);\n        $position = mysql_real_escape_string($position);\n        $id = mysql_real_escape_string($id);\n        $today = mysql_real_escape_string($today);\n\n        mysql_query("INSERT INTO media (id, related_page_id, type, title, copy, path, position, assets, time) VALUES ('', '$cat', '$type', '$name', '', '$target_file', '$position', '$id', '$today')");\n        header("Location: edit.php?category=$cat");\n        exit();\n    } else {\n        echo "Sorry, there was a problem uploading your file. Please press back on your browser and try again.";\n    }\n}\n?>