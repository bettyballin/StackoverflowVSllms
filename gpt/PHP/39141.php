<?php\n\nfunction page_content_vc($content) {\n    global $_DBH, $_TPL, $_SET;\n\n    $_SET['ignoreTimezone'] = true;\n\n    lu_CheckUpdateLogin();\n\n    if (shouldRedirectToVc($content)) {\n        redirectToVc();\n    }\n\n    if (isset($_GET['l'])) {\n        processLocation($_GET['l']);\n    }\n\n    if (isset($_SESSION['dash']['VC']['loc_ID'])) {\n        loadLocationData($_SESSION['dash']['VC']['loc_ID']);\n    }\n}\n\nfunction shouldRedirectToVc($content) {\n    return $_SESSION['dash']['VC']['switch'] == 'unmanned' || \n           $_SESSION['dash']['VC']['switch'] == 'touchscreen' && \n           $content['page_name'] != 'vc';\n}\n\nfunction redirectToVc() {\n    header('Location: /vc/');\n    die();\n}\n\nfunction processLocation($location) {\n    unset($_SESSION['dash']['VC']);\n    if ($loc_id = lu_GetFieldValue('ID', 'Location', $location)) {\n        if (lu_CheckPermissions('vc', $loc_id)) {\n            setTimezoneForLocation($loc_id);\n            $_SESSION['dash']['VC']['loc_ID'] = $loc_id;\n            redirectToVc();\n        }\n    }\n}\n\nfunction setTimezoneForLocation($loc_id) {\n    $timezone = lu_GetFieldValue('Time Zone', 'Location', $loc_id, 'ID');\n    if (strlen($timezone) > 0) {\n        $_SESSION['time_zone'] = $timezone;\n    }\n}\n\nfunction loadLocationData($loc_id) {\n    global $_TPL;\n\n    setTimezoneForLocation($loc_id);\n    $org_id = lu_GetFieldValue('record_ID', 'Location', $loc_id);\n\n    $_TPL->assign('loc_id', $loc_id);\n    $_TPL->assign('LocationName', lu_GetFieldValue('Location Name', 'Location', $loc_id));\n    $_TPL->assign('CustomerName', lu_GetFieldValue('Customer Name', 'Organisation', $org_id));\n    $_TPL->assign('EnableVisitorSnap', lu_GetFieldValue('VisitorSnap', 'Location', $loc_id));\n\n    $lacps = explode("\n", lu_GetFieldValue('Location Access Control Point', 'Location', $loc_id));\n    array_walk($lacps, 'trim_value');\n\n    handleLacps($lacps);\n}\n\nfunction handleLacps($lacps) {\n    if (count($lacps) > 0) {\n        if (count($lacps) == 1) {\n            $_SESSION['dash']['VC']['lacp'] = $lacps[0];\n        } else {\n            if (isset($_GET['changeLACP']) && in_array($_GET['changeLACP'], $lacps)) {\n                $_SESSION['dash']['VC']['lacp'] = $_GET['changeLACP'];\n            }\n        }\n    }\n}