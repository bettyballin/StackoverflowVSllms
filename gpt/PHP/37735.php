echo '<ul>';\n$prev_depth = 0;\nforeach($table->fetchTree() as $row) {\n    if ($row->tree_depth > $prev_depth) {\n        echo str_repeat('<ul>', $row->tree_depth - $prev_depth);\n    } else if ($row->tree_depth < $prev_depth) {\n        echo str_repeat('</li></ul>', $prev_depth - $row->tree_depth) . '</li>';\n    } else {\n        echo '</li>';\n    }\n    echo '<li>' . htmlspecialchars($row->name, ENT_QUOTES, 'UTF-8');\n    $prev_depth = $row->tree_depth;\n}\necho str_repeat('</li></ul>', $prev_depth) . '</li></ul>';