class YourController extends CI_Controller {\n    private $data = array();\n\n    public function __construct() {\n        parent::__construct();\n        $this->load->library('upload');\n        $this->load->model('categories_m');\n        $this->load->model('products_m');\n        $this->load->model('pages_m');\n        $this->load->model('backoffice/backofficecategories_m');\n    }\n\n    public function categories() {\n        $this->data['body'] = $this->load->view('backoffice/categories/navigation_v', '', TRUE);\n        $this->data['cat_tree'] = $this->categories_m->getCategoryTree();\n        $this->data['page_list'] = $this->pages_m->getPageList();\n        $this->data['category_dropdown'] = $this->load->view('backoffice/categories/category_dropdown_v', $this->data, TRUE);\n\n        switch ($this->uri->segment(3)) {\n            case 'delete':\n                $this->_handleDelete();\n                break;\n            case 'preview':\n                $this->_handlePreview();\n                break;\n            default:\n                $this->_handleDefault();\n                break;\n        }\n\n        $this->load->view('backoffice/template_v', $this->data);\n    }\n\n    private function _handleDelete() {\n        $categoryTreeID = $this->sitewide_m->checkURLParam($this->uri->segment(4), 'CategoryTree');\n        if (isset($_POST['delete'])) {\n            $this->backofficecategories_m->deleteCategory($categoryTreeID);\n            $this->data['body'] .= 'Category Deleted.';\n        } else {\n            $this->data['cat_details'] = $this->categories_m->getCategoryDetails('', $categoryTreeID);\n            $this->data['parent_category'] = $this->categories_m->getParentCategory($categoryTreeID);\n            $this->data['products_to_reassign'] = $this->products_m->getProductsInCategory('', $categoryTreeID);\n            $this->data['body'] .= $this->load->view('backoffice/categories/delete_v', $this->data, TRUE);\n        }\n    }\n\n    private function _handlePreview() {\n        if ($this->uri->segment(4)) {\n            $this->data['categoryTreeID'] = $this->sitewide_m->checkURLParam($this->uri->segment(4), 'CategoryTree');\n        }\n        $this->data['cat_details'] = $this->categories_m->getCategoryDetails(NULL, $this->data['categoryTreeID']);\n        foreach ($this->data['cat_details']->result() as $detail) {\n            $this->data['categoryName'] = $detail->Name;\n            $this->data['categoryID'] = $detail->ID;\n        }\n        $this->data['body'] .= $this->load->view('backoffice/categories/preview_v', $this->data, TRUE);\n    }\n\n    private function _handleDefault() {\n        $this->load->library('table');\n        $this->data['body'] .= $this->load->view('backoffice/categories/categories_v', $this->data, TRUE);\n    }\n}