$sqlq = "SELECT id, name FROM productcategories JOIN products ON productcategories.productid = products.id WHERE categoryid=?";\nif ($allsubcats) {\n    foreach ($allsubcats as $key => $data) {\n        $sqlq .= " OR categoryid=?";\n    }\n}\n\nif ($query = $this->mysqli->connection->prepare($sqlq)) {\n    // Prepare the types string (all integers, so 'i' repeated)\n    $types = str_repeat('i', count($allsubcats) + 1);\n\n    // Collect the parameters into an array\n    $params = array_merge([$cat], array_column($allsubcats, 0));\n\n    // Use call_user_func_array to bind the parameters\n    $bind_names[] = $types;\n    for ($i = 0; $i < count($params); $i++) {\n        $bind_name = 'bind' . $i;\n        $$bind_name = $params[$i];\n        $bind_names[] = &$$bind_name;\n    }\n\n    call_user_func_array([$query, 'bind_param'], $bind_names);\n\n    $query->execute();\n    $query->bind_result($id, $name);\n    $query->store_result();\n\n    if ($query->num_rows > 0) {\n        while ($query->fetch()) {\n            $allprods[] = ["id" => $id, "name" => $name];\n        }\n    }\n    $query->close();\n} else {\n    // Handle error\n    echo "Prepare failed: (" . $this->mysqli->connection->errno . ") " . $this->mysqli->connection->error;\n}