<?php\n\nfunction extractUrls($string) {\n    // Regular expression to match URLs\n    $regex = '/\b(https?|ftp|file):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|]/i';\n    \n    // Find all matches\n    preg_match_all($regex, $string, $matches, PREG_PATTERN_ORDER);\n    \n    return $matches[0];\n}\n\nfunction getRealUrl($url) {\n    // cURL options to follow redirects\n    $options = array(\n        CURLOPT_RETURNTRANSFER => true,\n        CURLOPT_HEADER         => true,\n        CURLOPT_FOLLOWLOCATION => true,\n        CURLOPT_ENCODING       => "",\n        CURLOPT_USERAGENT      => "spider",\n        CURLOPT_AUTOREFERER    => true,\n        CURLOPT_CONNECTTIMEOUT => 120,\n        CURLOPT_TIMEOUT        => 120,\n        CURLOPT_MAXREDIRS      => 10,\n    );\n    \n    $ch = curl_init($url);\n    curl_setopt_array($ch, $options);\n    curl_exec($ch);\n    \n    // Get the final URL after redirects\n    $finalUrl = curl_getinfo($ch, CURLINFO_EFFECTIVE_URL);\n    curl_close($ch);\n    \n    return $finalUrl;\n}\n\n// Example usage\n$test = "I am testing this application for http://test.com YAY!";\n$urls = extractUrls($test);\n\nforeach ($urls as $url) {\n    $realUrl = getRealUrl($url);\n    echo "Original URL: $url\n";\n    echo "Final URL: $realUrl\n";\n}\n?>