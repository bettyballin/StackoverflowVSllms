<?php\n$img_addr = $_GET['image_address'];\n$img = imagecreatefromjpeg($img_addr);\n\nif ($img) {\n    // Convert to grayscale manually\n    imagefilter_manual_grayscale($img);\n\n    header('Content-type: image/jpeg');\n    imagejpeg($img);\n}\n\nfunction imagefilter_manual_grayscale($img) {\n    $width = imagesx($img);\n    $height = imagesy($img);\n    \n    for ($x = 0; $x < $width; $x++) {\n        for ($y = 0; $y < $height; $y++) {\n            $rgb = imagecolorat($img, $x, $y);\n            $r = ($rgb >> 16) & 0xFF;\n            $g = ($rgb >> 8) & 0xFF;\n            $b = $rgb & 0xFF;\n            \n            // Calculate the grayscale value\n            $gray = round(($r + $g + $b) / 3);\n\n            // Create a grayscale color\n            $grayColor = imagecolorallocate($img, $gray, $gray, $gray);\n            \n            // Set the pixel color\n            imagesetpixel($img, $x, $y, $grayColor);\n        }\n    }\n}\n?>