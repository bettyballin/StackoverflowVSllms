// pic.php\n<?php\n    // open the file in a binary mode\n    $user = $_GET['u'];\n    $id = $_GET['i'];\n    $s = $_GET['s'];\n\n    if (!isset($user) && !isset($s) && isset($id))\n    {\n        // display a lock!\n        exit(0);\n    }\n\n    require_once("bootstrap_minimal.php"); //setup db connection, etc\n\n    // does this image_id belong to the user?\n    $stmt = $db->query('SELECT image_id, user_id, file_name, private FROM images WHERE image_id = ?', $id);\n    $obj = $stmt->fetchObject();\n\n    if (is_object($obj))\n    {\n        // is the picture is the users?\n        if ($obj->user_id != $_SESSION['user_id'])\n        {\n            // is this a private picture?\n            if ($obj->private == 1)\n            {\n                // check permissions...\n                // display a lock in needed!\n            }\n        }\n    }\n    else\n    {\n        // display a error pic?!\n        exit(0);\n    }\n\n    if ($s == 0)\n    {\n        $picture = $common->getImagePathThumb($obj->file_name);\n    }\n    else\n    {\n        $picture = $common->getImagePath($obj->file_name);\n    }\n\n    // send the right headers\n    header("Content-Type: image/png");\n    header("Content-Length: " . filesize($picture));\n\n    // Cache control headers\n    header("Cache-Control: public, max-age=31536000"); // Cache for 1 year\n    header("Pragma: cache");\n    header("Expires: " . gmdate("D, d M Y H:i:s", time() + 31536000) . " GMT"); // Set expiration time\n\n    $fp = fopen($picture, 'rb');\n\n    // dump the picture and stop the script\n    fpassthru($fp);\n    exit;\n?>