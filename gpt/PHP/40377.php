<?php\nclass OrderProcessor {\n    private $db;\n\n    public function __construct($db) {\n        $this->db = $db;\n    }\n\n    public function processOrder($orderId) {\n        $order = $this->getOrder($orderId);\n        if ($order && $order['status'] === 'pending') {\n            $this->updateOrderStatus($orderId, 'processing');\n            $this->processOrderItems($orderId);\n            echo "Order processed.";\n        } else {\n            echo $order ? "Order not in pending state." : "Order not found.";\n        }\n    }\n\n    private function getOrder($orderId) {\n        return $this->db->query("SELECT * FROM orders WHERE id = ?", [$orderId])->fetch();\n    }\n\n    private function updateOrderStatus($orderId, $status) {\n        $this->db->query("UPDATE orders SET status = ? WHERE id = ?", [$status, $orderId]);\n    }\n\n    private function processOrderItems($orderId) {\n        $items = $this->db->query("SELECT * FROM order_items WHERE order_id = ?", [$orderId]);\n        foreach ($items as $item) {\n            $product = $this->getProduct($item['product_id']);\n            if ($product['stock'] > 0) {\n                $this->updateProductStock($item['product_id'], $item['quantity']);\n            } else {\n                echo "Out of stock: " . $product['name'];\n            }\n        }\n    }\n\n    private function getProduct($productId) {\n        return $this->db->query("SELECT * FROM products WHERE id = ?", [$productId])->fetch();\n    }\n\n    private function updateProductStock($productId, $quantity) {\n        $this->db->query("UPDATE products SET stock = stock - ? WHERE id = ?", [$quantity, $productId]);\n    }\n}\n\n$db = new PDO('mysql:host=localhost;dbname=test', 'root', '');\n$orderProcessor = new OrderProcessor($db);\n$orderProcessor->processOrder(123);\n?>