$lock_id = sem_get(ftok('tmp/this.lock', 'r'));\n\nif ($lock_id === false) {\n    die("Failed to get semaphore");\n}\n\nwhile (true) {\n    if (sem_acquire($lock_id)) {\n        // do something\n        sem_release($lock_id);\n        break;\n    } else {\n        if (pcntl_get_last_error() != EINTR) {\n            die("Failed to acquire semaphore: " . pcntl_strerror(pcntl_get_last_error()));\n        }\n        // Retry if interrupted by signal\n    }\n}