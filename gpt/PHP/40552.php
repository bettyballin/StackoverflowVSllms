<?php\n$mysqli = new mysqli("hostname", "username", "password", "database");\n\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_FILES['file'])) {\n    $fileName = $_FILES['file']['name'];\n    $fileSize = $_FILES['file']['size'];\n    $fileTmp = $_FILES['file']['tmp_name'];\n\n    // Get the server with the most free space\n    $result = $mysqli->query("SELECT * FROM media_servers ORDER BY free_space DESC LIMIT 1");\n    $server = $result->fetch_assoc();\n\n    if ($server) {\n        $serverUrl = $server['server_url'];\n        $serverId = $server['id'];\n\n        // Upload file to the selected server\n        $uploadPath = $serverUrl . '/' . basename($fileName);\n        if (move_uploaded_file($fileTmp, $uploadPath)) {\n            // Update database with new file information\n            $mysqli->query("INSERT INTO media_files (file_name, server_id) VALUES ('$fileName', $serverId)");\n            // Update free space on the selected server\n            $newFreeSpace = $server['free_space'] - $fileSize;\n            $mysqli->query("UPDATE media_servers SET free_space = $newFreeSpace WHERE id = $serverId");\n\n            echo "File uploaded successfully.";\n        } else {\n            echo "Failed to upload file.";\n        }\n    } else {\n        echo "No available servers.";\n    }\n}\n?>