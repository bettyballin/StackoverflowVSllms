// Assuming a search request is made\n$searchCriteria = $_POST['search_criteria'];\n$userId = $_SESSION['user_id'];\n\n// Step 1: Store the search criteria in a session or cookie\n$_SESSION['search_criteria'] = serialize($searchCriteria);\n\n// Step 2: Insert a new search entry\n$searchId = insertSearch($userId);\n\n// Step 3: Fetch, randomize, and store the search results\n$results = fetchSearchResults($searchCriteria);\n$randomizedResults = shuffle($results);\nstoreSearchResults($searchId, $randomizedResults);\n\n// Step 4: Redirect to search results page\nheader("Location: /search_results.php?search_id=$searchId");\nexit();\n\n// Function definitions\nfunction insertSearch($userId) {\n    // Insert into searches table and return the search_id\n    global $db;\n    $stmt = $db->prepare("INSERT INTO searches (user_id) VALUES (?) RETURNING id");\n    $stmt->execute([$userId]);\n    return $stmt->fetchColumn();\n}\n\nfunction fetchSearchResults($criteria) {\n    // Fetch results based on search criteria\n    global $db;\n    // Implement the search logic here\n}\n\nfunction storeSearchResults($searchId, $results) {\n    global $db;\n    $stmt = $db->prepare("INSERT INTO search_results (search_id, result_order, user_id) VALUES (?, ?, ?)");\n    foreach ($results as $order => $result) {\n        $stmt->execute([$searchId, $order, $result['user_id']]);\n    }\n}