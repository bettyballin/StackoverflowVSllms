<?php\n\n$link = "host=localhost dbname=company user=pgsql password=password";\n$connect = pg_connect($link);\n\n$query = "SELECT * FROM customer";\n$result = pg_query($connect, $query);\n\n$doc = new DomDocument("1.0");\n\n$root = $doc->createElement('data');\n$root = $doc->appendChild($root);\n\nfunction addNode($doc, $parent, $row, $table, $connect) {\n    $node = $doc->createElement($table);\n    $node = $parent->appendChild($node);\n\n    foreach ($row as $fieldname => $fieldvalue) {\n        if ($fieldname != 'id') { // Assuming 'id' is the primary key\n            $node->appendChild($doc->createElement($fieldname, htmlspecialchars($fieldvalue)));\n        }\n    }\n\n    if ($table == 'customer') {\n        $query = "SELECT * FROM address WHERE customer_id = " . intval($row['id']);\n        $sub_result = pg_query($connect, $query);\n\n        while ($sub_row = pg_fetch_assoc($sub_result)) {\n            addNode($doc, $node, $sub_row, 'address', $connect);\n        }\n    }\n}\n\nwhile ($row = pg_fetch_assoc($result)) {\n    addNode($doc, $root, $row, 'customer', $connect);\n}\n\n$doc->save("cust.xml");\n\n?>