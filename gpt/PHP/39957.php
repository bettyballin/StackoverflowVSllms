function processUserData(array $params) {\n    // Define required keys and their defaults\n    $requiredParams = [\n        'username' => '',\n        'email' => '',\n        'age' => null\n    ];\n    \n    // Merge provided params with defaults\n    $params = array_merge($requiredParams, $params);\n\n    // Validate required parameters\n    if (empty($params['username']) || empty($params['email'])) {\n        throw new InvalidArgumentException('Username and email are required.');\n    }\n\n    if (!filter_var($params['email'], FILTER_VALIDATE_EMAIL)) {\n        throw new InvalidArgumentException('Invalid email format.');\n    }\n\n    // Process the data\n    echo "Processing user: " . htmlspecialchars($params['username']) . "\n";\n    echo "Email: " . htmlspecialchars($params['email']) . "\n";\n    echo "Age: " . ($params['age'] !== null ? (int)$params['age'] : 'N/A') . "\n";\n}\n\n// Example usage\ntry {\n    processUserData([\n        'username' => 'john_doe',\n        'email' => 'john@example.com',\n        'age' => 30\n    ]);\n} catch (InvalidArgumentException $e) {\n    echo "Error: " . $e->getMessage();\n}