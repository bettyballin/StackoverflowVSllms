<?php\nif ($_SERVER['REQUEST_METHOD'] == 'POST' && isset($_FILES['image'])) {\n    // Directory where the images will be saved\n    $uploadDir = 'uploads/';\n    // Allowed file types\n    $allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];\n    // Maximum file size in bytes (2MB)\n    $maxSize = 2 * 1024 * 1024;\n\n    // Check if the file is of a valid type and size\n    if (in_array($_FILES['image']['type'], $allowedTypes) && $_FILES['image']['size'] <= $maxSize) {\n        // Generate a unique name for the file\n        $extension = pathinfo($_FILES['image']['name'], PATHINFO_EXTENSION);\n        $newFileName = uniqid('image_', true) . '.' . $extension;\n        $uploadPath = $uploadDir . $newFileName;\n\n        // Move the uploaded file to the target directory\n        if (move_uploaded_file($_FILES['image']['tmp_name'], $uploadPath)) {\n            // Create a thumbnail of the uploaded image\n            createThumbnail($uploadPath, $uploadDir . 'thumb_' . $newFileName, 150, 150);\n            echo 'File uploaded and thumbnail created successfully.';\n        } else {\n            echo 'Failed to move uploaded file.';\n        }\n    } else {\n        echo 'Invalid file type or size.';\n    }\n}\n\nfunction createThumbnail($sourcePath, $thumbPath, $thumbWidth, $thumbHeight) {\n    list($width, $height, $type) = getimagesize($sourcePath);\n\n    // Create the image resource from the uploaded file\n    switch ($type) {\n        case IMAGETYPE_JPEG:\n            $sourceImage = imagecreatefromjpeg($sourcePath);\n            break;\n        case IMAGETYPE_PNG:\n            $sourceImage = imagecreatefrompng($sourcePath);\n            break;\n        case IMAGETYPE_GIF:\n            $sourceImage = imagecreatefromgif($sourcePath);\n            break;\n        default:\n            return false;\n    }\n\n    // Create a new blank image with the thumbnail dimensions\n    $thumbImage = imagecreatetruecolor($thumbWidth, $thumbHeight);\n\n    // Resize the source image and copy it to the thumbnail image\n    imagecopyresampled($thumbImage, $sourceImage, 0, 0, 0, 0, $thumbWidth, $thumbHeight, $width, $height);\n\n    // Save the thumbnail to the specified path\n    switch ($type) {\n        case IMAGETYPE_JPEG:\n            imagejpeg($thumbImage, $thumbPath);\n            break;\n        case IMAGETYPE_PNG:\n            imagepng($thumbImage, $thumbPath);\n            break;\n        case IMAGETYPE_GIF:\n            imagegif($thumbImage, $thumbPath);\n            break;\n    }\n\n    // Free up memory\n    imagedestroy($sourceImage);\n    imagedestroy($thumbImage);\n}\n\n?>\n\n<form method="post" enctype="multipart/form-data">\n    <input type="file" name="image" accept="image/*" required>\n    <button type="submit">Upload Image</button>\n</form>