<?php\nnamespace Vendor\Module\Block\Category;\n\nuse Magento\Catalog\Model\ResourceModel\Category\CollectionFactory;\nuse Magento\Framework\View\Element\Template\Context;\nuse Magento\Catalog\Block\Category\View as CategoryView;\n\nclass CustomCategory extends CategoryView\n{\n    protected $categoryCollectionFactory;\n\n    public function __construct(\n        Context $context,\n        CollectionFactory $categoryCollectionFactory,\n        array $data = []\n    ) {\n        $this->categoryCollectionFactory = $categoryCollectionFactory;\n        parent::__construct($context, $data);\n    }\n\n    public function getCategoryCollection()\n    {\n        $storeId = $this->_storeManager->getStore()->getId();\n        $categoryCollection = $this->categoryCollectionFactory->create();\n        $categoryCollection->addAttributeToSelect('*');\n        $categoryCollection->addIsActiveFilter();\n        $categoryCollection->addStoreFilter($storeId);\n\n        $categoryCollection->getSelect()->joinLeft(\n            ['products' => $categoryCollection->getTable('catalog_category_product')],\n            'e.entity_id = products.category_id',\n            []\n        )->where('products.product_id IS NOT NULL');\n\n        $categoryCollection->getSelect()->group('e.entity_id');\n\n        return $categoryCollection;\n    }\n}