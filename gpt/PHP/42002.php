$text = '<p>I would like to replace "&gt" with ">" and "&lt" with "<" but only when they occur outside "<pre>" and "</pre>". Is this possible?</p>\n<pre><code>$newText = preg_replace(\'&gt\', \'>\', $text);\n</code></pre>';\n\n$result = preg_replace_callback(\n    '/(<pre.*?>.*?<\/pre.*?>)|(.+?)(?=<pre.*?>|$)/si',\n    function ($matches) {\n        if (isset($matches[2])) {\n            // This is the text outside <pre> tags\n            return str_replace(['&gt', '&lt'], ['>', '<'], $matches[2]);\n        }\n        // Return the <pre> content unmodified\n        return $matches[1];\n    },\n    $text\n);\n\necho $result;