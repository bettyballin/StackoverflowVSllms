<?php\nclass TreeGenerator {\n    private $mysqli;\n    private $parent_id_field;\n    private $name_field;\n    public $nodes = [];\n    public $select = [];\n\n    public function __construct($mysqli, $parent_id_field, $name_field) {\n        $this->mysqli = $mysqli;\n        $this->parent_id_field = $parent_id_field;\n        $this->name_field = $name_field;\n    }\n\n    public function init($table, $parent_id = 0) {\n        $sql = "SELECT id, {$this->parent_id_field}, {$this->name_field} FROM $table WHERE {$this->parent_id_field}=? ORDER BY display_order";\n        $stmt = $this->mysqli->prepare($sql);\n        $stmt->bind_param('i', $parent_id);\n        $stmt->execute();\n        $result = $stmt->get_result();\n\n        $this->get_tree($result, 0);\n\n        print_r($this->nodes);\n        print_r($this->select);\n        exit;\n    }\n\n    private function get_tree($result, $depth = 0, $parent_obj = null) {\n        while($row = $result->fetch_object()) {\n            /* Get node */\n            $this->nodes[$row->{$this->parent_id_field}][$row->id] = $row;\n\n            /* Get select item */\n            $text = str_repeat("    ", $depth) . $row->{$this->name_field};\n            $this->select[$row->id] = $text;\n\n            echo "$depth $text\n";\n\n            $sql = "SELECT id, {$this->parent_id_field}, {$this->name_field} FROM product_categories WHERE {$this->parent_id_field}=? ORDER BY display_order";\n            $stmt = $this->mysqli->prepare($sql);\n            $stmt->bind_param('i', $row->id);\n            $stmt->execute();\n            $nextResult = $stmt->get_result();\n\n            if($nextResult->num_rows > 0) {\n                $this->get_tree($nextResult, $depth + 1, $row);\n            }\n        }\n    }\n}\n\n// Usage Example:\n$mysqli = new mysqli('hostname', 'username', 'password', 'database');\n$treeGenerator = new TreeGenerator($mysqli, 'parent_category_id', 'name');\n$treeGenerator->init('product_categories');\n?>