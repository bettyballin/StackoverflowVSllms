try {\n    // Establish a database connection\n    $pdo = new PDO('mysql:host=localhost;dbname=your_database', 'username', 'password');\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n    // Start a transaction\n    $pdo->beginTransaction();\n\n    // Lock the table to prevent race conditions\n    $stmt = $pdo->prepare("SELECT id FROM albums WHERE date = :date FOR UPDATE");\n    $stmt->execute([':date' => date('Y-m-d')]);\n\n    if ($stmt->rowCount() === 0) {\n        // Album does not exist, create it\n        $insertStmt = $pdo->prepare("INSERT INTO albums (date, name) VALUES (:date, :name)");\n        $insertStmt->execute([':date' => date('Y-m-d'), ':name' => 'Album ' . date('Y-m-d')]);\n        $albumId = $pdo->lastInsertId();\n    } else {\n        // Album exists, get its ID\n        $album = $stmt->fetch(PDO::FETCH_ASSOC);\n        $albumId = $album['id'];\n    }\n\n    // Commit the transaction\n    $pdo->commit();\n\n    // Now you can proceed to associate the uploaded photo with the album\n    // $albumId contains the album ID\n\n} catch (Exception $e) {\n    // Rollback the transaction in case of error\n    $pdo->rollBack();\n    throw $e;\n}