<configuration>\n  <system.webServer>\n    <rewrite>\n      <rules>\n        <rule name="ReverseProxyToSubfolder" stopProcessing="true">\n          <match url="^directory/(.*)" />\n          <action type="Rewrite" url="http://subdomain.test.com/{R:1}" />\n        </rule>\n      </rules>\n      <outboundRules>\n        <rule name="AddProxyHeader" preCondition="ResponseIsHtml1">\n          <match filterByTags="A" pattern="^http://subdomain.test.com/(.*)" />\n          <action type="Rewrite" value="/directory/{R:1}" />\n        </rule>\n        <preConditions>\n          <preCondition name="ResponseIsHtml1">\n            <add input="{RESPONSE_CONTENT_TYPE}" pattern="^text/html" />\n          </preCondition>\n        </preConditions>\n      </outboundRules>\n    </rewrite>\n  </system.webServer>\n</configuration>