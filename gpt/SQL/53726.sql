WITH RecursiveCTE AS (\n    -- Base case: get all root nodes that are visible\n    SELECT Id, ParentId, Visible\n    FROM MyTree\n    WHERE ParentId IS NULL AND Visible = 1\n    \n    UNION ALL\n    \n    -- Recursive case: get all children of the nodes from the previous result set that are visible\n    SELECT m.Id, m.ParentId, m.Visible\n    FROM MyTree m\n    INNER JOIN RecursiveCTE r ON m.ParentId = r.Id\n    WHERE m.Visible = 1\n)\nSELECT *\nFROM RecursiveCTE\nORDER BY Id;