-- Replace 'YYYYMMDD' with the desired report date\nDECLARE @ReportDate DATE = 'YYYYMMDD';\n\nWITH JerkinessHistory AS (\n    SELECT\n        name,\n        processing_date,\n        is_jerk,\n        ROW_NUMBER() OVER (PARTITION BY name ORDER BY processing_date) - \n        ROW_NUMBER() OVER (PARTITION BY name, is_jerk ORDER BY processing_date) AS grp\n    FROM history_of_jerkiness\n    WHERE processing_date <= @ReportDate\n),\nFilteredHistory AS (\n    SELECT\n        name,\n        processing_date,\n        is_jerk,\n        grp\n    FROM JerkinessHistory\n    WHERE is_jerk = 'true'\n)\nSELECT\n    name,\n    COUNT(*) AS days_jerky\nFROM FilteredHistory\nGROUP BY name, grp\nORDER BY name;