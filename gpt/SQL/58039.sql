-- Step 1: Insert or update the item\nINSERT INTO items (itemId, itemName) VALUES (1, 'ItemName')\nON DUPLICATE KEY UPDATE itemName = VALUES(itemName);\n\n-- Step 2: Insert categories if they do not exist\nINSERT IGNORE INTO categories (catName) VALUES ('each'), ('category'), ('name');\n\n-- Step 3: Retrieve category IDs\nSELECT catId, catName INTO @catId_each, @catId_category, @catId_name\nFROM categories WHERE catName IN ('each', 'category', 'name');\n\n-- Step 4: Insert or update the map\nINSERT IGNORE INTO map (mapId, itemId, catId)\nVALUES \n  (CONCAT(1, '|', @catId_each), 1, @catId_each),\n  (CONCAT(1, '|', @catId_category), 1, @catId_category),\n  (CONCAT(1, '|', @catId_name), 1, @catId_name);\n\n-- Step 5: Delete old associations not in the new list\nDELETE FROM map WHERE itemId = 1 AND catId NOT IN (@catId_each, @catId_category, @catId_name);\n\n-- Step 6: Delete orphaned categories\nDELETE c\nFROM categories c\nLEFT JOIN map m ON c.catId = m.catId\nWHERE m.catId IS NULL;