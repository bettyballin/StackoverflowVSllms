CREATE TABLE entity (\n    entity_id  VARCHAR(10) NOT NULL,\n    group_id   VARCHAR(10) NOT NULL,\n    first_seen DATE        NOT NULL,\n    last_seen  DATE        NOT NULL,\n    PRIMARY KEY (entity_id, group_id)\n);\n\n-- Insert new records or update existing ones\nINSERT INTO entity (entity_id, group_id, first_seen, last_seen)\nSELECT entity_id, group_id, record_date, record_date\nFROM entity_raw\nWHERE record_date = DATE(DATE_SUB(NOW(), INTERVAL 1 DAY))\nON DUPLICATE KEY UPDATE \n    last_seen = VALUES(last_seen);