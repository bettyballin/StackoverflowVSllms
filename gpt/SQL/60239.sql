-- Add a 'version' column to the table\nALTER TABLE credits ADD COLUMN version INT DEFAULT 1;\n\n-- Update query with version check\nBEGIN;\n\n-- Retrieve the current credits and version\nSELECT creds, version FROM credits WHERE user_id = 1 FOR UPDATE;\n\n-- Application logic to calculate new value\n-- Assume new_credits is the calculated value and current_version is the retrieved version\n\n-- Update if the version has not changed\nUPDATE credits \nSET creds = new_credits, version = version + 1 \nWHERE user_id = 1 AND version = current_version;\n\n-- Check if the update was successful\nIF ROW_COUNT() = 0 THEN\n    -- Handle the concurrency conflict, e.g., by retrying the transaction\nEND IF;\n\nCOMMIT;