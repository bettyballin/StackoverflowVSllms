WITH RankedArticles AS (\n  SELECT \n    a.article_id,\n    a.category_id,\n    a.title,\n    a.is_sticky,\n    a.published_at,\n    ROW_NUMBER() OVER (\n      PARTITION BY a.category_id \n      ORDER BY a.is_sticky DESC, a.published_at\n    ) as row_num\n  FROM \n    articles a\n)\nSELECT \n  article_id,\n  category_id,\n  title,\n  is_sticky,\n  published_at\nFROM \n  RankedArticles\nWHERE \n  row_num <= 3\nORDER BY \n  category_id, is_sticky DESC, published_at;