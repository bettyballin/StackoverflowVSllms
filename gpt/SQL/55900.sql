SELECT \n    p.name AS ProcedureName,\n    SCHEMA_NAME(p.schema_id) AS SchemaName,\n    m.definition AS ProcedureDefinition\nFROM \n    sys.procedures AS p\nJOIN \n    sys.sql_modules AS m\n    ON p.object_id = m.object_id\nWHERE \n    m.definition LIKE '%WITH RECOMPILE%'\n    AND m.definition NOT LIKE '%--%WITH RECOMPILE%'  -- Exclude commented occurrences\nORDER BY \n    SchemaName, ProcedureName;