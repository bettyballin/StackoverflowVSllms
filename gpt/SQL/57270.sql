DELIMITER //\n\nCREATE TRIGGER before_update_item\nBEFORE UPDATE ON item\nFOR EACH ROW\nBEGIN\n    IF OLD.rank <> NEW.rank THEN\n        IF NEW.rank < 1 THEN\n            SET NEW.rank = 1;\n        ELSEIF NEW.rank > (SELECT COUNT(*) FROM item) THEN\n            SET NEW.rank = (SELECT COUNT(*) FROM item);\n        END IF;\n\n        IF NEW.rank < OLD.rank THEN\n            UPDATE item SET rank = rank + 1 WHERE rank >= NEW.rank AND rank < OLD.rank;\n        ELSE\n            UPDATE item SET rank = rank - 1 WHERE rank <= NEW.rank AND rank > OLD.rank;\n        END IF;\n    END IF;\nEND;\n//\n\nDELIMITER ;