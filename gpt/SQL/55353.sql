SELECT *\nFROM (\n    SELECT NEWID() AS guid, UserID, RoleId, ClubId, 0 AS GroupRole\n    FROM dbo.Portal_UserRoles\n\n    UNION\n\n    SELECT NEWID() AS guid, dbo.Portal_UserGroups.UserId, \n           dbo.Portal_GroupRoles.RoleId, dbo.Portal_UserGroups.ClubId, \n           dbo.Portal_GroupRoles.GroupId AS GroupRole\n    FROM dbo.Portal_GroupRoles\n    INNER JOIN dbo.Portal_UserGroups \n        ON dbo.Portal_GroupRoles.GroupId = dbo.Portal_UserGroups.GroupId\n) AS derivedtbl_1\nWHERE EXISTS (\n    SELECT 1\n    FROM Portal_GroupRoles\n    INNER JOIN Portal_ClubGroups\n        ON Portal_GroupRoles.GroupId = Portal_ClubGroups.GroupId\n    WHERE derivedtbl_1.RoleId = Portal_GroupRoles.RoleId\n      AND derivedtbl_1.ClubId = Portal_ClubGroups.ClubId\n)