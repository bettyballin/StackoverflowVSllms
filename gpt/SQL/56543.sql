CREATE PROCEDURE [dbo].[TestTable_Search]\n    @Col1 int,\n    @Col2 uniqueidentifier,\n    @Col3 datetime,\n    @Col4 datetime,\n    @ID1 varchar(10)\nAS\nBEGIN\n    SET TRANSACTION ISOLATION LEVEL READ COMMITTED\n    \n    IF @ID1 IS NOT NULL\n    BEGIN\n        SELECT *\n        FROM [dbo].[TestTable]\n        WHERE\n            [Col1] = COALESCE(@Col1, Col1) AND\n            [Col2] = COALESCE(@Col2, Col2) AND\n            [Col3] >= COALESCE(@Col3, Col3) AND\n            [Col4] <= COALESCE(@Col4, Col4) AND\n            [Col5] IN (SELECT [ID2] FROM [dbo].[TestTable2] WHERE [ID1] = @ID1)\n    END\n    ELSE\n    BEGIN\n        SELECT *\n        FROM [dbo].[TestTable]\n        WHERE\n            [Col1] = COALESCE(@Col1, Col1) AND\n            [Col2] = COALESCE(@Col2, Col2) AND\n            [Col3] >= COALESCE(@Col3, Col3) AND\n            [Col4] <= COALESCE(@Col4, Col4)\n    END\nEND