-- Check for currently running queries that are consuming high CPU\nSELECT TOP 10\n    r.session_id,\n    r.cpu_time,\n    r.total_elapsed_time,\n    r.logical_reads,\n    r.reads,\n    r.writes,\n    r.blocking_session_id,\n    r.[status],\n    r.command,\n    r.wait_type,\n    r.wait_time,\n    r.last_wait_type,\n    r.start_time,\n    s.[text]\nFROM sys.dm_exec_requests r\nCROSS APPLY sys.dm_exec_sql_text(r.sql_handle) s\nORDER BY r.cpu_time DESC;\n\n-- Check for overall CPU utilization\nSELECT \n    record_id, \n    event_time, \n    SQLProcessUtilization, \n    SystemIdle, \n    100 - SystemIdle - SQLProcessUtilization AS OtherProcessUtilization\nFROM \n    sys.dm_os_ring_buffers\nWHERE \n    ring_buffer_type = N'RING_BUFFER_SCHEDULER_MONITOR'\n    AND record_id % 256 = 0\nORDER BY \n    record_id DESC;