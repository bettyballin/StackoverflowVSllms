DECLARE @cols AS NVARCHAR(MAX),\n        @query AS NVARCHAR(MAX);\n\n-- Get the list of unique questions\nSELECT @cols = STRING_AGG(QUOTENAME(QuestionText), ', ') \n               FROM Question;\n\n-- Construct the dynamic SQL query\nSET @query = '\nSELECT ' + @cols + ' \nFROM \n(\n    SELECT \n        q.QuestionText,\n        r.ResponseText,\n        ROW_NUMBER() OVER (PARTITION BY r.QuestionID ORDER BY r.ResponseID) AS RowNum\n    FROM Response r\n    JOIN Question q ON r.QuestionID = q.QuestionID\n) AS SourceTable\nPIVOT\n(\n    MAX(ResponseText)\n    FOR QuestionText IN (' + @cols + ')\n) AS PivotTable\nORDER BY RowNum;';\n\n-- Execute the dynamic SQL query\nEXEC sp_executesql @query;