CREATE TRIGGER trg_UniqueActiveSurveyAnswer\nON SurveyAnswer\nAFTER INSERT, UPDATE\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @surveyId INT, @answer NVARCHAR(255), @surveyDomainId INT;\n\n    -- Retrieve the values from the inserted or updated row\n    SELECT @surveyId = i.SurveyID, @answer = i.Answer\n    FROM inserted i;\n\n    -- Retrieve the SurveyDomainId for the given SurveyID\n    SELECT @surveyDomainId = s.SurveyDomainID\n    FROM Survey s\n    WHERE s.SurveyID = @surveyId;\n\n    -- Check for duplicate active answers within the same SurveyDomain\n    IF EXISTS (\n        SELECT 1\n        FROM Survey s\n        INNER JOIN SurveyAnswer sa ON s.SurveyID = sa.SurveyID\n        WHERE s.Active = 1\n          AND s.SurveyDomainID = @surveyDomainId\n          AND sa.Answer = @answer\n          AND sa.SurveyID <> @surveyId\n    )\n    BEGIN\n        -- Rollback the transaction and raise an error\n        ROLLBACK TRANSACTION;\n        RAISERROR ('Duplicate active SurveyAnswer for the given SurveyDomain is not allowed.', 16, 1);\n    END\nEND;\nGO