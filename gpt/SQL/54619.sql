-- Step 3: Add a timestamp column to track processing start time\nALTER TABLE YourTable ADD ProcessingStartTime DATETIME;\n\n-- Step 4: Update the select and lock query to include the timestamp\nBEGIN TRANSACTION;\n\n-- Mark rows as 'InProcess' and set the processing start time\nWITH RowsToProcess AS (\n    SELECT TOP (10) * \n    FROM YourTable\n    WHERE ProcessingStatus = 'Pending'\n    ORDER BY SomeColumn\n)\nUPDATE RowsToProcess\nSET ProcessingStatus = 'InProcess', ProcessingStartTime = GETDATE()\nOUTPUT inserted.*;\n\n-- Commit the transaction\nCOMMIT TRANSACTION;\n\n-- Step 5: Periodically reset rows that have been 'InProcess' for too long\nUPDATE YourTable\nSET ProcessingStatus = 'Pending', ProcessingStartTime = NULL\nWHERE ProcessingStatus = 'InProcess' AND ProcessingStartTime < DATEADD(MINUTE, -30, GETDATE());