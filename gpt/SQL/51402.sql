CREATE PROCEDURE GetDocumentWithAccessCheck\n    @UserId INT,\n    @DocumentId INT\nAS\nBEGIN\n    -- Check if the user has access to the document\n    IF EXISTS (SELECT 1 FROM UserDocumentPermissions WHERE UserId = @UserId AND DocumentId = @DocumentId)\n    BEGIN\n        -- Retrieve the document\n        SELECT * FROM Documents WHERE DocumentId = @DocumentId;\n    END\n    ELSE\n    BEGIN\n        -- Return an error if the user does not have access\n        RAISERROR('Access Denied', 16, 1);\n    END\nEND