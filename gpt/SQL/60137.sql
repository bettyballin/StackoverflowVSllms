CREATE PROCEDURE dbo.YourProcedureName\n    AS\n    BEGIN\n        BEGIN TRY\n            -- Open the symmetric key\n            OPEN SYMMETRIC KEY YourSymmetricKeyName\n            DECRYPTION BY CERTIFICATE YourCertificateName;\n\n            -- Your T-SQL statements go here\n            -- Example: SELECT, INSERT, UPDATE, DELETE on encrypted data\n\n            -- Close the symmetric key\n            CLOSE SYMMETRIC KEY YourSymmetricKeyName;\n        END TRY\n        BEGIN CATCH\n            -- Handle the error\n            DECLARE @ErrorMessage NVARCHAR(4000);\n            SET @ErrorMessage = ERROR_MESSAGE();\n            \n            -- Close the symmetric key in case of error\n            IF EXISTS (SELECT * FROM sys.symmetric_keys WHERE name = 'YourSymmetricKeyName' AND key_guid IS NOT NULL)\n            BEGIN\n                CLOSE SYMMETRIC KEY YourSymmetricKeyName;\n            END\n\n            -- Optionally re-throw the error\n            RAISERROR (@ErrorMessage, 16, 1);\n        END CATCH\n    END