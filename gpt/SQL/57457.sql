DECLARE @listCol VARCHAR(2000)\nDECLARE @query VARCHAR(4000)\n\n-- Generate the list of columns based on BucketNum order\nSELECT @listCol = STUFF(\n    (SELECT DISTINCT '], [' + [Size]\n     FROM #t\n     ORDER BY MIN(BucketNum) -- Order by BucketNum\n     FOR XML PATH('')), 1, 2, '') + ']'\n\n-- Construct the dynamic pivot query\nSET @query = '\nSELECT * FROM\n(\n    SELECT OID, [Size], [quantity]\n    FROM #t\n) src\nPIVOT \n(\n    SUM(quantity) FOR [Size] IN (' + @listCol + ')\n) AS pvt'\n\n-- Execute the dynamic query\nEXECUTE(@query)