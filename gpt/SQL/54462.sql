SELECT \n    m.id, \n    m.groupNum,\n    t.priceEach,\n    (t.priceEach - (t.priceEach * m.margin)) AS estCost,\n    ((t.priceEach - (t.priceEach * m.margin)) * t.quantity) AS salesSub,\n    (( (t.priceEach - (t.priceEach * m.margin)) * t.quantity) / \n        (SELECT SUM((t2.priceEach - (t2.priceEach * m.margin)) * t2.quantity)\n         FROM temp AS t2\n         INNER JOIN financeMasters AS m2\n         ON t2.mod = m2.mod\n         WHERE m2.groupNum = m.groupNum)\n    ) AS salesPercent\nINTO output\nFROM financeMasters AS m\nINNER JOIN temp AS t\nON t.mod = m.mod;