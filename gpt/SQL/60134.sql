SELECT \n    sp.name AS LoginName,\n    dp.name AS DatabaseName,\n    dp2.name AS UserName,\n    dr.name AS DatabaseRole\nFROM \n    sys.server_principals sp\nJOIN \n    sys.database_principals dp2 \n    ON sp.sid = dp2.sid\nJOIN \n    sys.databases d \n    ON d.owner_sid = sp.sid\nJOIN \n    sys.database_principals dp \n    ON dp.principal_id = d.principal_id\nLEFT JOIN \n    sys.database_role_members drm \n    ON dp2.principal_id = drm.member_principal_id\nLEFT JOIN \n    sys.database_principals dr \n    ON drm.role_principal_id = dr.principal_id\nORDER BY \n    sp.name, dp.name, dr.name;