SELECT \n    t.id, \n    g.home_team_id AS Home, \n    g.away_team_id AS Away, \n    home_team_wins.wins AS home_team_wins\nFROM \n    ticket t\nJOIN \n    game g ON g.id = t.game_id\nLEFT JOIN (\n    SELECT \n        game.home_team_id AS team_id, \n        COUNT(game.id) AS wins\n    FROM \n        game\n    WHERE \n        game.home_score > game.away_score\n    GROUP BY \n        game.home_team_id\n    UNION ALL\n    SELECT \n        game.away_team_id AS team_id, \n        COUNT(game.id) AS wins\n    FROM \n        game\n    WHERE \n        game.away_score > game.home_score\n    GROUP BY \n        game.away_team_id\n) AS home_team_wins ON home_team_wins.team_id = g.home_team_id\nWHERE \n    g.date < DATE_SUB(t.time_sold, INTERVAL 1 DAY);