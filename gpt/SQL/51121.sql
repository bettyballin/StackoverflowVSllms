WITH RankedPatientStatus AS (\n    SELECT \n        p.pkPatientId,\n        p.FirstName,\n        p.Surname,\n        ps.pkPatientStatusId,\n        ps.StatusCode,\n        ps.StartDate,\n        ps.EndDate,\n        ROW_NUMBER() OVER (PARTITION BY ps.fkPatientId ORDER BY ps.StartDate) AS rn\n    FROM \n        Patient p\n    INNER JOIN \n        PatientStatus ps ON p.pkPatientId = ps.fkPatientId\n)\nSELECT \n    pkPatientId,\n    FirstName,\n    Surname,\n    pkPatientStatusId,\n    StatusCode,\n    StartDate,\n    EndDate\nFROM \n    RankedPatientStatus\nWHERE \n    rn <= 2\nORDER BY \n    pkPatientId, StartDate;