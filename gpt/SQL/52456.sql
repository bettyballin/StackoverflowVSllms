-- Step 1: Create a temporary mapping table\nCREATE TABLE #ParentIdMapping (\n    OldParentId INT,\n    NewParentId INT\n);\n\n-- Step 2: Insert data into the new parent table and capture new primary keys\nINSERT INTO NewTable1 (Name)\nOUTPUT INSERTED.ParentId, INSERTED.ParentId INTO #ParentIdMapping (OldParentId, NewParentId)\nSELECT Name\nFROM OldTable1;\n\n-- Step 3: Insert data into the new child table using the mapping table\nINSERT INTO NewTable2 (ChildId, ParentId, Foo)\nSELECT \n    ChildId,\n    m.NewParentId, -- Map old ParentId to new ParentId\n    Foo\nFROM \n    OldTable2 o\nJOIN \n    #ParentIdMapping m ON o.ParentId = m.OldParentId;\n\n-- Cleanup: Drop the temporary mapping table\nDROP TABLE #ParentIdMapping;