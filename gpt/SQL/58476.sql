DELIMITER //\n\nCREATE PROCEDURE GetAncestors(IN nodeId INT)\nBEGIN\n    DECLARE done INT DEFAULT FALSE;\n    DECLARE currentId INT;\n    DECLARE parentId INT;\n    DECLARE ancestorCursor CURSOR FOR \n        SELECT parent_node_id FROM hierarchy WHERE child_node_id = currentId;\n    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n\n    SET currentId = nodeId;\n    CREATE TEMPORARY TABLE IF NOT EXISTS ancestors (ancestor_id INT);\n\n    REPEAT\n        OPEN ancestorCursor;\n        read_loop: LOOP\n            FETCH ancestorCursor INTO parentId;\n            IF done THEN\n                LEAVE read_loop;\n            END IF;\n            INSERT INTO ancestors (ancestor_id) VALUES (parentId);\n            SET currentId = parentId;\n        END LOOP;\n        CLOSE ancestorCursor;\n    UNTIL done END REPEAT;\n\n    SELECT * FROM ancestors;\n    DROP TEMPORARY TABLE ancestors;\nEND //\n\nDELIMITER ;