WITH CTE AS (\n    SELECT\n        ID,\n        USERID,\n        [VALUE],\n        ROW_NUMBER() OVER (PARTITION BY USERID ORDER BY ID) - \n        ROW_NUMBER() OVER (PARTITION BY USERID, [VALUE] ORDER BY ID) AS grp\n    FROM\n        your_table\n),\nGroupedValues AS (\n    SELECT\n        USERID,\n        [VALUE],\n        COUNT(*) AS cnt\n    FROM\n        CTE\n    GROUP BY\n        USERID,\n        [VALUE],\n        grp\n)\nSELECT\n    USERID,\n    [VALUE],\n    MAX(cnt) AS [COUNT]\nFROM\n    GroupedValues\nGROUP BY\n    USERID,\n    [VALUE]\nORDER BY\n    USERID,\n    [COUNT] DESC;