CREATE FUNCTION [dbo].[udf_GetDateInBusinessDays]\n(\n  @StartDate datetime,  -- Start Date\n  @NumberDays int       -- Good days ahead\n)\nRETURNS datetime\nAS\nBEGIN\n    DECLARE @ReturnDate datetime\n\n    ;WITH Tally AS\n    (\n        SELECT TOP (@NumberDays * 2) -- Assuming enough buffer\n            ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) - 1 AS N\n        FROM master.dbo.spt_values\n    )\n    , BusinessDays AS\n    (\n        SELECT DATEADD(d, N, @StartDate) AS BusinessDay\n        FROM Tally\n        WHERE NOT EXISTS (SELECT 1 FROM dbo.[BadDates] WHERE [StartDate] = DATEADD(d, N, @StartDate))\n    )\n    SELECT @ReturnDate = BusinessDay\n    FROM BusinessDays\n    ORDER BY BusinessDay\n    OFFSET @NumberDays - 1 ROWS FETCH NEXT 1 ROWS ONLY\n\n    RETURN @ReturnDate\nEND