MERGE INTO target_dim_table AS target\nUSING source_table AS source\nON target.business_key = source.business_key\nAND target.end_date IS NULL\nWHEN MATCHED AND (\n    source.attribute1 <> target.attribute1 OR\n    source.attribute2 <> target.attribute2 -- Add more attributes as needed\n) THEN\n    -- 1. Update the existing record's EndDate\n    UPDATE SET target.end_date = source.effective_date\nWHEN NOT MATCHED BY TARGET THEN\n    -- 2. Insert a new record\n    INSERT (business_key, attribute1, attribute2, effective_date, end_date)\n    VALUES (source.business_key, source.attribute1, source.attribute2, source.effective_date, NULL);