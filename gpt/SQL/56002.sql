WITH CTE AS (\n    SELECT \n        StudentID, \n        StartDate, \n        EndDate, \n        Field1, \n        Field2, \n        ROW_NUMBER() OVER (PARTITION BY StudentID, Field1, Field2 ORDER BY StartDate) AS rn\n    FROM \n        YourTable\n),\nCombined AS (\n    SELECT \n        c1.StudentID, \n        c1.StartDate, \n        COALESCE(MAX(c2.EndDate), c1.EndDate) AS EndDate, \n        c1.Field1, \n        c1.Field2\n    FROM \n        CTE c1\n    LEFT JOIN \n        CTE c2\n    ON \n        c1.StudentID = c2.StudentID \n        AND c1.Field1 = c2.Field1 \n        AND c1.Field2 = c2.Field2 \n        AND c1.rn + 1 = c2.rn \n        AND DATEADD(day, 1, c1.EndDate) = c2.StartDate\n    GROUP BY \n        c1.StudentID, \n        c1.StartDate, \n        c1.Field1, \n        c1.Field2\n)\nSELECT \n    StudentID, \n    MIN(StartDate) AS StartDate, \n    MAX(EndDate) AS EndDate, \n    Field1, \n    Field2\nFROM \n    Combined\nGROUP BY \n    StudentID, \n    Field1, \n    Field2\nORDER BY \n    StudentID, \n    StartDate;