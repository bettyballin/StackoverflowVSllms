BEGIN TRY\n    -- Backup current procedure\n    IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'X')\n    BEGIN\n        EXEC sp_rename 'X', 'X_backup';\n    END\n\n    -- Drop and create the new procedure\n    IF EXISTS (SELECT * FROM sys.objects WHERE type = 'P' AND name = 'X')\n    BEGIN\n        DROP PROCEDURE X;\n    END\n\n    CREATE PROCEDURE X\n    AS\n    BEGIN\n        -- Your procedure code here\n    END\nEND TRY\nBEGIN CATCH\n    -- Rollback if there is an error\n    IF OBJECT_ID('X_backup', 'P') IS NOT NULL\n    BEGIN\n        IF OBJECT_ID('X', 'P') IS NOT NULL\n        BEGIN\n            DROP PROCEDURE X;\n        END\n        EXEC sp_rename 'X_backup', 'X';\n    END\n    THROW;\nEND CATCH;