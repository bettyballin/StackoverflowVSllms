BEGIN;\n\n-- Update the master node if its lastTimestamp is older than 2*X or there is no current master\nUPDATE cluster_nodes\nSET isMaster = CASE \n                 WHEN nodeID = :newMasterID THEN 1 \n                 ELSE 0 \n               END,\n    lastTimestamp = CASE \n                      WHEN nodeID = :newMasterID THEN CURRENT_TIMESTAMP \n                      ELSE lastTimestamp \n                    END\nWHERE isMaster = 1 \n   OR (SELECT COUNT(*) FROM cluster_nodes WHERE isMaster = 1) = 0 \n   OR lastTimestamp < (CURRENT_TIMESTAMP - INTERVAL '2*X seconds');\n\nCOMMIT;