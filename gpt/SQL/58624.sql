set serveroutput on size 2000;\n--PL/SQL block to link ISSN in serial base on a company's ISSN text file\n\ndeclare\n    cursor ItemCursor is\n        select issn is2 from web.obfuscated1 where issn is not null\n            union\n        select eissn is2 from web.obfuscated1 where eissn is not null;\n\n    cursor ItemCursor1(aIS varchar2) is\n        select obfuscated1_uid from web.obfuscated1 where group_num is null and issn in (\n            select distinct issn from web.obfuscated1 where issn = aIS or eissn = aIS\n                union\n            select distinct eissn from web.obfuscated1 where issn = aIS or eissn = aIS\n        )\n            union\n        select obfuscated1_uid from web.obfuscated1 where eissn in (\n            select distinct issn from web.obfuscated1 where issn = aIS or eissn = aIS\n                union\n            select distinct eissn from web.obfuscated1 where issn = aIS or eissn = aIS\n        );\n\n    cursor ItemCursor2(aIS9 varchar2) is\n        select obfuscated1_uid from web.obfuscated1 where issn in (\n            select distinct issn from web.obfuscated1 where issn = aIS9 or eissn = aIS9\n                union\n            select distinct eissn from web.obfuscated1 where issn = aIS9 or eissn = aIS9\n        ) and group_num is null;\n\n    agroup      number(8);\n    processCount    number(8);\n\n    ------------------------------------------------------\n    -- MAIN BLOCK -----------------------------------\n    -------------------------------------------------\nbegin\n    processCount := 0;\n\n    agroup := null;\n    for itemRec in ItemCursor loop\n        agroup := null;\n        begin\n            select group_num into agroup from web.obfuscated1 where issn in (\n                select distinct issn from web.obfuscated1 where issn = itemRec.is2 or eissn = itemRec.is2\n                    union\n                select distinct eissn from web.obfuscated1 where issn = itemRec.is2 or eissn = itemRec.is2\n            ) and group_num is not null and issn is not null and eissn is not null and rownum <= 1;\n\n        exception\n            when no_data_found then\n                agroup := null;\n            when others then\n                agroup := null;\n        end;\n\n        if agroup is not null then\n            for itemRec2 in ItemCursor2(itemRec.is2) loop\n                update web.obfuscated1 set group_num = agroup where obfuscated1_uid = itemRec2.obfuscated1_uid;\n                commit;\n            end loop;\n        else\n            processCount := processCount + 1;\n            for itemRec1 in ItemCursor1(itemRec.is2) loop\n                update web.obfuscated1 set group_num = processCount where obfuscated1_uid = itemRec1.obfuscated1_uid;\n                commit;\n            end loop;\n            commit;\n        end if;\n    end loop;\n\n    dbms_output.put_line('Total record read: ' || processCount);\nexception\n    when others then\n        dbms_output.put_line('ORA' || sqlcode);\n        dbms_output.put_line(substr(sqlerrm, 1, 255));\n        dbms_output.put_line('ORA- Error during processing ' );\nend;\n/\nexit;