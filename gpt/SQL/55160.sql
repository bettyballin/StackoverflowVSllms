SELECT \n    Company.companyID,\n    Company.companyName,\n    SUM(Orders.orderValue) AS TotalOrderValue,\n    CASE \n        WHEN Orders.orderDate <= DATEADD(DAY, -1, DATEFROMPARTS(YEAR(Orders.orderDate), MONTH(Company.YearEndingDate), DAY(Company.YearEndingDate)))\n        THEN YEAR(Orders.orderDate)\n        ELSE YEAR(Orders.orderDate) + 1\n    END AS CustomYear\nFROM \n    Orders\nINNER JOIN \n    Company ON Company.companyID = Orders.companyID\nGROUP BY \n    Company.companyID,\n    Company.companyName,\n    CASE \n        WHEN Orders.orderDate <= DATEADD(DAY, -1, DATEFROMPARTS(YEAR(Orders.orderDate), MONTH(Company.YearEndingDate), DAY(Company.YearEndingDate)))\n        THEN YEAR(Orders.orderDate)\n        ELSE YEAR(Orders.orderDate) + 1\n    END\nORDER BY \n    Company.companyID,\n    CustomYear;