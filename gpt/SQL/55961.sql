-- Script to generate user creation scripts\nDECLARE @sql NVARCHAR(MAX) = N'';\nSELECT @sql += 'USE [' + DB_NAME() + ']; \n    CREATE USER [' + dp.name + '] \n    FOR LOGIN [' + sp.name + ']; \n    ALTER ROLE [' + dr.name + '] ADD MEMBER [' + dp.name + '];'\nFROM sys.database_principals dp\nJOIN sys.server_principals sp ON dp.sid = sp.sid\nJOIN sys.database_role_members drm ON dp.principal_id = drm.member_principal_id\nJOIN sys.database_principals dr ON drm.role_principal_id = dr.principal_id\nWHERE dp.type = 'S' AND sp.name NOT IN ('sa');\n\n-- Print or execute the generated script\nPRINT @sql;\n-- EXEC sp_executesql @sql;