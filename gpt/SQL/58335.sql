CREATE TABLE check_minus\n(\n    name_id NUMBER(4),\n    trans NUMBER(4),\n    val NUMBER(2)\n);\n\nINSERT INTO check_minus VALUES (1, 1, 5);\nINSERT INTO check_minus VALUES (1, 2, 5);\nINSERT INTO check_minus VALUES (1, 3, -5);\nINSERT INTO check_minus VALUES (1, 4, 10);\nINSERT INTO check_minus VALUES (1, 5, -10);\nINSERT INTO check_minus VALUES (1, 6, 15);\nINSERT INTO check_minus VALUES (1, 7, 15);\nINSERT INTO check_minus VALUES (1, 8, 15);\nINSERT INTO check_minus VALUES (1, 9, -15);\nINSERT INTO check_minus VALUES (1, 10, 20);\nCOMMIT;\n\n-- Using GROUP BY and HAVING to count non-reversed transactions\nWITH transaction_counts AS (\n    SELECT \n        val, \n        COUNT(*) AS cnt\n    FROM \n        check_minus\n    GROUP BY \n        val\n),\nnon_reversed_transactions AS (\n    SELECT \n        val,\n        CASE\n            WHEN val > 0 THEN val\n            ELSE -val\n        END AS abs_val,\n        cnt\n    FROM \n        transaction_counts\n)\nSELECT \n    abs_val AS val\nFROM \n    non_reversed_transactions\nWHERE \n    abs_val > 0\n    AND cnt > COALESCE((SELECT cnt FROM non_reversed_transactions WHERE abs_val = -val), 0)\nORDER BY \n    val;