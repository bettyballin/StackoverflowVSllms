SELECT d.ID, d.NAME, h.USER_ID AS LAST_USER_ID\nFROM DOCUMENTS d\nLEFT JOIN (\n    SELECT h1.DOC_ID, h1.USER_ID\n    FROM HISTORY h1\n    INNER JOIN (\n        SELECT DOC_ID, MAX(TIMESTAMP) AS MAX_TIMESTAMP\n        FROM HISTORY\n        GROUP BY DOC_ID\n    ) h2 ON h1.DOC_ID = h2.DOC_ID AND h1.TIMESTAMP = h2.MAX_TIMESTAMP\n) h ON d.ID = h.DOC_ID;