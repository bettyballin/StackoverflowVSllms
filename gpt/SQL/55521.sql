-- Temporary table to store the mapping of old and new master IDs\nCREATE TABLE #MasterMapping (OldID INT, NewID INT);\n\n-- Insert into master table and capture the new IDs\nINSERT INTO master (name)\nOUTPUT inserted.id INTO #MasterMapping (NewID)\nSELECT 'master a' UNION ALL\nSELECT 'master b';\n\n-- Select the old and new IDs for further use\nSELECT * INTO #TempMaster FROM (\n    SELECT 1 AS OldID, id AS NewID FROM master WHERE name = 'master a'\n    UNION ALL\n    SELECT 2, id FROM master WHERE name = 'master b'\n) AS Temp;\n\n-- Temporary table to store the new slave records with updated master IDs\nCREATE TABLE #NewSlaves (id INT IDENTITY, master_id INT, name CHAR);\n\n-- Insert the slave records using the new master IDs\nINSERT INTO #NewSlaves (master_id, name)\nSELECT NewID, 'slave aa' FROM #TempMaster WHERE OldID = 1\nUNION ALL\nSELECT NewID, 'slave bb' FROM #TempMaster WHERE OldID = 1\nUNION ALL\nSELECT NewID, 'slave cc' FROM #TempMaster WHERE OldID = 2\nUNION ALL\nSELECT NewID, 'slave dd' FROM #TempMaster WHERE OldID = 2;\n\n-- Insert the new slave records into the actual slave table\nINSERT INTO slave (master_id, name)\nSELECT master_id, name FROM #NewSlaves;\n\n-- Clean up temporary tables\nDROP TABLE #MasterMapping;\nDROP TABLE #TempMaster;\nDROP TABLE #NewSlaves;