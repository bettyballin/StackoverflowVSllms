SELECT \n    u.id AS owner,\n    ISNULL([1], 0) AS currency1,\n    ISNULL([2], 0) AS currency2,\n    ISNULL([3], 0) AS currency3\nFROM \n    (SELECT \n        a.user_id, \n        c.id AS currency_id, \n        a.amount \n     FROM \n        accounts a\n     JOIN \n        currency c ON a.currency_id = c.id) AS SourceTable\nPIVOT\n(\n    SUM(amount)\n    FOR currency_id IN ([1], [2], [3])\n) AS PivotTable\nRIGHT JOIN users u ON u.id = PivotTable.user_id\nORDER BY u.id;