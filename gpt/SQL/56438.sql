WITH CTE1 AS (\n    SELECT\n        col1,\n        col2,\n        col3,\n        CASE\n            WHEN condition1 THEN\n                CASE \n                    WHEN condition2 THEN calculation1\n                    ELSE calculation2\n                END\n            ELSE\n                CASE \n                    WHEN condition2 THEN calculation3\n                    ELSE calculation4\n                END\n        END AS intermediate_result1,\n        col4,\n        col5\n    FROM table\n),\nCTE2 AS (\n    SELECT\n        col1,\n        col2,\n        col3,\n        intermediate_result1,\n        CASE\n            WHEN condition THEN\n                intermediate_result1\n            ELSE\n                CASE \n                    WHEN condition1 THEN \n                        CASE \n                            WHEN condition2 THEN calculation5\n                            ELSE calculation6\n                        END\n                    ELSE\n                        CASE \n                            WHEN condition2 THEN calculation7\n                            ELSE calculation8\n                        END\n                END\n        END AS calculatedcol1,\n        col4,\n        col5 \n    FROM CTE1\n)\nSELECT\n    col1,\n    col2,\n    col3,\n    calculatedcol1,\n    col4,\n    col5\nFROM CTE2;