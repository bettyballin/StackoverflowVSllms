DECLARE @Date DATE = '2023-10-25'; -- Replace with the desired date\n\n-- Check for invalid data\nIF EXISTS (\n    SELECT 1\n    FROM YourTable\n    WHERE CAST([Timestamp] AS DATE) = @Date\n    GROUP BY CAST([Timestamp] AS DATE), Message\n    HAVING COUNT(CASE WHEN Message = 'Started' THEN 1 END) > 1\n    OR COUNT(CASE WHEN Message = 'Finished' THEN 1 END) > 1\n)\nBEGIN\n    RAISERROR ('Invalid data: multiple "Started" or "Finished" messages found for the date.', 16, 1);\n    RETURN;\nEND\n\n-- Determine the status\nSELECT\n    CASE \n        WHEN NOT EXISTS (\n            SELECT 1\n            FROM YourTable\n            WHERE CAST([Timestamp] AS DATE) = @Date\n            AND Message = 'Started'\n        ) THEN 0\n        WHEN EXISTS (\n            SELECT 1\n            FROM YourTable\n            WHERE CAST([Timestamp] AS DATE) = @Date\n            AND Message = 'Started'\n        )\n        AND NOT EXISTS (\n            SELECT 1\n            FROM YourTable\n            WHERE CAST([Timestamp] AS DATE) = @Date\n            AND Message = 'Finished'\n        ) THEN 1\n        WHEN EXISTS (\n            SELECT 1\n            FROM YourTable\n            WHERE CAST([Timestamp] AS DATE) = @Date\n            AND Message = 'Started'\n        )\n        AND EXISTS (\n            SELECT 1\n            FROM YourTable\n            WHERE CAST([Timestamp] AS DATE) = @Date\n            AND Message = 'Finished'\n        ) THEN 2\n    END AS ProcessStatus