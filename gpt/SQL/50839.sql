DELIMITER //\n\nCREATE TRIGGER before_employee_insert\nBEFORE INSERT ON employees\nFOR EACH ROW\nBEGIN\n    DECLARE new_internal_id INT;\n\n    -- Get the last internal_id for the company\n    SELECT last_internal_id INTO new_internal_id\n    FROM company_employee_counter\n    WHERE company_id = NEW.company_id\n    FOR UPDATE;\n\n    -- Increment the internal_id\n    SET new_internal_id = new_internal_id + 1;\n\n    -- Update the last internal_id for the company\n    UPDATE company_employee_counter\n    SET last_internal_id = new_internal_id\n    WHERE company_id = NEW.company_id;\n\n    -- Assign the new internal_id to the employee\n    SET NEW.internal_id = new_internal_id;\n\n    -- If the company does not exist in the counter table, add it\n    IF ROW_COUNT() = 0 THEN\n        INSERT INTO company_employee_counter (company_id, last_internal_id)\n        VALUES (NEW.company_id, 1);\n\n        -- Set the internal_id to 1 for the new insertion\n        SET NEW.internal_id = 1;\n    END IF;\nEND;\n//\n\nDELIMITER ;