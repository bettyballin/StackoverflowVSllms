WITH LatestService AS (\n    SELECT \n        Table1ID, \n        Location, \n        MAX(ServiceDate) AS LatestServiceDate\n    FROM Table2\n    GROUP BY Table1ID, Location\n)\nSELECT \n    t1.PersonCode, \n    t1.Name, \n    t2.Location, \n    t2.ServiceDate\nFROM Table1 t1\nJOIN Table2 t2 \n    ON t1.ID = t2.Table1ID\nJOIN LatestService ls \n    ON t2.Table1ID = ls.Table1ID \n    AND t2.Location = ls.Location \n    AND t2.ServiceDate = ls.LatestServiceDate\nWHERE t1.PersonCode = 'XYZ';