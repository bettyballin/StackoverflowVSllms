CREATE PROCEDURE CopyFolder\n    @SourceFolderID INT,\n    @DestinationFolderID INT\nAS\nBEGIN\n    SET NOCOUNT ON;\n    BEGIN TRANSACTION;\n\n    BEGIN TRY\n        -- Temporary table to hold mapping of old IDs to new IDs\n        CREATE TABLE #FolderMapping (\n            OldFolderID INT,\n            NewFolderID INT\n        );\n\n        -- Recursive CTE to get all folders and items under the source folder\n        WITH RecursiveCTE AS (\n            SELECT FolderID, ParentFolderID, FolderName\n            FROM Folders\n            WHERE FolderID = @SourceFolderID\n            UNION ALL\n            SELECT f.FolderID, f.ParentFolderID, f.FolderName\n            FROM Folders f\n            INNER JOIN RecursiveCTE r ON f.ParentFolderID = r.FolderID\n        )\n\n        -- Insert the folders into the destination\n        INSERT INTO Folders (ParentFolderID, FolderName)\n        OUTPUT inserted.FolderID, r.FolderID INTO #FolderMapping (NewFolderID, OldFolderID)\n        SELECT @DestinationFolderID, FolderName\n        FROM RecursiveCTE r;\n\n        -- Insert the items\n        INSERT INTO Items (FolderID, ItemName)\n        SELECT fm.NewFolderID, i.ItemName\n        FROM Items i\n        INNER JOIN #FolderMapping fm ON i.FolderID = fm.OldFolderID;\n\n        COMMIT TRANSACTION;\n    END TRY\n    BEGIN CATCH\n        ROLLBACK TRANSACTION;\n        THROW;\n    END CATCH\nEND;