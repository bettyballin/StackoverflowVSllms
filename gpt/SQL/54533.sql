CREATE TABLE #Temp (\n    VisitingCount int,\n    [Time] int,\n    [Date] nvarchar(50)\n);\n\nDECLARE @DateNow DATETIME, @i int, @Time int, @Date nvarchar(50);\nset @DateNow = '00:00';\nset @i = 1;\n\nwhile(@i <= 60)  \nbegin  \n    set @DateNow = DATEADD(minute, 30, @DateNow);\n    set @Time = (DATEPART(hour, @DateNow) * 60 + DATEPART(minute, @DateNow)) / 30;\n    set @Date = CONVERT(VARCHAR(5), @DateNow, 108);\n    insert into #Temp (VisitingCount, [Time], [Date]) values (0, @Time, @Date);\n    set @i = @i + 1;\nend;\n\nselect Sum(VisitingCount) as VisitingCount, [Time], [Date]\nfrom (\n    select Sum(VisitingCount) as VisitingCount, [Time], [Date]\n    from #Temp\n    group by [Time], [Date]\n    UNION ALL\n    select count(page) as VisitingCount,\n           (DATEPART(hour, Date) * 60 + DATEPART(minute, Date)) / 30 as [Time],\n           CONVERT(VARCHAR(5), Date, 108) as [Date]\n    from scr_SecuristLog\n    where Date between '2009-05-12' and '2009-05-13'\n    GROUP BY (DATEPART(hour, Date) * 60 + DATEPART(minute, Date)) / 30, CONVERT(VARCHAR(5), Date, 108)\n) X\ngroup by [Time], [Date]\norder by [Time] asc;