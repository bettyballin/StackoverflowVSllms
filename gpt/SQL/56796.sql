CREATE PROCEDURE SP_GET_DEPENDENCIES\n(\n  @obj_name SYSNAME\n)\nAS\nBEGIN\n    WITH ProcHierarchy AS\n    (\n        -- Anchor member: Start with the given procedure\n        SELECT \n            1 AS Level,\n            b.name AS ParentProc,\n            c.name AS ChildProc\n        FROM \n            dbo.sysdepends a\n            INNER JOIN dbo.sysobjects b ON a.id = b.id\n            INNER JOIN dbo.sysobjects c ON a.depid = c.id\n        WHERE \n            b.name = @obj_name\n\n        UNION ALL\n\n        -- Recursive member: Find dependencies of the child procedures\n        SELECT \n            ph.Level + 1 AS Level,\n            ph.ChildProc AS ParentProc,\n            c.name AS ChildProc\n        FROM \n            ProcHierarchy ph\n            INNER JOIN dbo.sysdepends a ON ph.ChildProc = b.name\n            INNER JOIN dbo.sysobjects b ON a.id = b.id\n            INNER JOIN dbo.sysobjects c ON a.depid = c.id\n        WHERE \n            ph.Level < 10\n    )\n    SELECT \n        REPLICATE('--', Level - 1) + ' ' + ChildProc AS Hierarchy\n    FROM \n        ProcHierarchy\n    ORDER BY \n        Level, ParentProc, ChildProc\nEND