-- Subquery to compute the 'some_product' column\nWITH computed AS (\n  SELECT\n    CASE\n      WHEN col1 > col2 THEN SUM(col3 * col4)\n      ELSE 0\n    END AS some_product,\n    other_columns -- Include other columns you want to group by\n  FROM your_table\n  GROUP BY other_columns -- Group by necessary columns excluding the aggregated one\n)\n\n-- Outer query to group by the computed 'some_product' column\nSELECT\n  some_product,\n  COUNT(*) AS count_of_products -- Example of another aggregate function\nFROM computed\nGROUP BY some_product;