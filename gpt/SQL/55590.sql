CREATE PROCEDURE web.getRandomCharities (\n    @tmp_ID bigint --members ID\n) \nAS \nBEGIN\n    -- Get the favorite charity of the member\n    DECLARE @favorite_cha_Key bigint;\n    SELECT @favorite_cha_Key = members_Favourite \n    FROM TBL_MEMBERS \n    WHERE members_Id = @tmp_ID;\n\n    -- Common Table Expression to get 5 random charities excluding the favorite and cha_Key = '1'\n    WITH RandomCharities AS (\n        SELECT TOP 5 * \n        FROM TBL_CHARITIES \n        WHERE cha_Active = 'TRUE' \n        AND cha_Key != @favorite_cha_Key \n        ORDER BY NEWID()\n    )\n\n    -- Select the 5 random charities\n    SELECT * \n    FROM RandomCharities\n\n    UNION ALL\n\n    -- Select the favorite charity if it is not in the top 5 random charities\n    SELECT * \n    FROM TBL_CHARITIES \n    WHERE cha_Key = @favorite_cha_Key \n    AND @favorite_cha_Key NOT IN (SELECT cha_Key FROM RandomCharities)\n\n    UNION ALL\n\n    -- Select the charity with cha_Key = '1' if it is not the favorite and not in the top 5 random\n    SELECT * \n    FROM TBL_CHARITIES \n    WHERE cha_Key = '1' \n    AND cha_Key != @favorite_cha_Key \n    AND cha_Key NOT IN (SELECT cha_Key FROM RandomCharities)\nEND