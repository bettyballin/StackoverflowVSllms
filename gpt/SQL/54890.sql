WITH HourlyPaymentCounts AS (\n    SELECT \n        DATEPART(hour, [CreateDate]) AS [Hour],\n        COUNT(*) AS [Count]\n    FROM \n        [dbo].[PaymentLog]\n    WHERE \n        [CreateDate] >= DATEADD(day, -10, GETDATE())\n    GROUP BY \n        DATEPART(hour, [CreateDate])\n)\nSELECT\n    H.[Hour],\n    AVG(CAST(ISNULL(P.[Count], 0) AS DECIMAL)) AS [Average]\nFROM \n    (SELECT DISTINCT DATEPART(hour, [CreateDate]) AS [Hour] FROM [dbo].[PaymentLog]) H\nLEFT JOIN \n    HourlyPaymentCounts P\nON \n    H.[Hour] = P.[Hour]\nGROUP BY \n    H.[Hour]\nORDER BY \n    H.[Hour];