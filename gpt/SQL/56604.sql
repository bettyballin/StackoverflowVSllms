CREATE OR REPLACE FUNCTION check_event_timespan_overlap() RETURNS TRIGGER AS $$\nBEGIN\n    IF EXISTS (\n        SELECT 1\n        FROM timespan t\n        WHERE t.event_id = NEW.event_id\n        AND t.id <> NEW.id\n        AND t.day = NEW.day\n        AND (t.start_time, t.end_time) OVERLAPS (NEW.start_time, NEW.end_time)\n    ) THEN\n        RAISE EXCEPTION 'Timespan overlap within the same event';\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER trg_check_event_timespan_overlap\nBEFORE INSERT OR UPDATE ON timespan\nFOR EACH ROW EXECUTE FUNCTION check_event_timespan_overlap();