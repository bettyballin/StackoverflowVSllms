SELECT \n       t.NAME AS TableName,\n       s.Name AS SchemaName,\n       p.rows AS RowCounts,\n       SUM(a.total_pages) * 8 AS TotalSpaceKB, \n       SUM(a.used_pages) * 8 AS UsedSpaceKB, \n       (SUM(a.total_pages) - SUM(a.used_pages)) * 8 AS UnusedSpaceKB\n   FROM \n       sys.tables t\n   INNER JOIN      \n       sys.indexes i ON t.OBJECT_ID = i.object_id\n   INNER JOIN \n       sys.partitions p ON i.object_id = p.OBJECT_ID AND i.index_id = p.index_id\n   INNER JOIN \n       sys.allocation_units a ON p.partition_id = a.container_id\n   INNER JOIN \n       sys.schemas s ON t.schema_id = s.schema_id\n   WHERE \n       t.is_ms_shipped = 0\n   GROUP BY \n       t.Name, s.Name, p.Rows\n   ORDER BY \n       TotalSpaceKB DESC;