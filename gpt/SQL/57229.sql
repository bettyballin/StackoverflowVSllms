begin a transaction on Connection1\n\nprepare a query in TableA on Connection1\n\nbegin loop over some_data\n   (1) insert into key_id on TableA\nend loop\n\ncommit on Connection1\n\nbegin a transaction on Connection2\n\nprepare a query on TableB on Connection2\n\nbegin loop over some_data\n   begin loop over some_other_data\n      (2) insert into TableB using same key_id as in TableA\n   end loop\nend loop\n\ncommit on Connection2