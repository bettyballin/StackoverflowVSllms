-- Step 1: Create temporary tables or CTEs to handle intermediate results\nWITH attribute_values_cte AS (\n    SELECT attribute_definition_id, prodtree_element_id, value\n    FROM attribute_values\n    WHERE attribute_definition_id = 22\n)\n\n-- Step 2: Use the CTE in your main query\nSELECT pe.prodtree_element_id AS prodID, \n       pe.prodtree_element_name_s, \n       li.line_name, \n       av2.value\nFROM prodtree_element pe\nLEFT JOIN prodtree_link pl\n    ON pe.prodtree_element_id = pl.to_prodtree_node_id\nLEFT JOIN line li\n    ON pe.line_code = li.line_code\nLEFT JOIN attribute_values_cte av2\n    ON pe.prodtree_element_id = av2.prodtree_element_id\nWHERE pe.prodtree_element_func_type <> 'WIZARD'\n  AND pe.prodtree_element_topo_type = 'NODE';