WITH Transactions AS (\n    SELECT \n        [Transaction Date],\n        [Transaction Qty],\n        [Transaction Value],\n        [Reversal]\n    FROM \n        YourTransactionTable\n),\nFilteredTransactions AS (\n    SELECT \n        [Transaction Date],\n        [Transaction Qty],\n        [Transaction Value]\n    FROM \n        Transactions t1\n    WHERE \n        [Reversal] = 'N'\n        AND NOT EXISTS (\n            SELECT 1 \n            FROM Transactions t2\n            WHERE \n                t2.[Transaction Date] = t1.[Transaction Date]\n                AND t2.[Transaction Qty] = -t1.[Transaction Qty]\n                AND t2.[Transaction Value] = -t1.[Transaction Value]\n                AND t2.[Reversal] = 'Y'\n        )\n)\nSELECT \n    [Transaction Date],\n    [Transaction Qty],\n    [Transaction Value],\n    COUNT(*) AS [Count]\nFROM \n    FilteredTransactions\nGROUP BY \n    [Transaction Date],\n    [Transaction Qty],\n    [Transaction Value]\nHAVING \n    COUNT(*) > 1\nORDER BY \n    [Transaction Date];