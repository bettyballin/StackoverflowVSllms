-- Step 1: Create a temporary table to store the mappings\nCREATE TABLE #TempMapping (\n    OldID INT,\n    NewIdentity INT\n);\n\n-- Step 2: Insert aggregated data from TableA into TableB and capture the mappings\nINSERT INTO TableB (ColumnX)\nOUTPUT inserted.Identity, src.ID INTO #TempMapping (NewIdentity, OldID)\nSELECT ColumnA + ', ' + ColumnB + ', ' + ColumnC\nFROM TableA src;\n\n-- Step 3: Update TableC with the mappings from the temporary table\nINSERT INTO TableC (OldID, NewIdentity)\nSELECT OldID, NewIdentity\nFROM #TempMapping;\n\n-- Step 4: Drop the temporary table\nDROP TABLE #TempMapping;