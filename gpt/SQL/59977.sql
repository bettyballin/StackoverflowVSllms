WITH base_t AS (\n    SELECT \n        city,\n        temperature,\n        ROW_NUMBER() OVER (PARTITION BY city ORDER BY temperature) AS rownum,\n        COUNT(*) OVER (PARTITION BY city) AS total_count\n    FROM weather_history\n),\nmedian_t AS (\n    SELECT \n        city,\n        temperature\n    FROM base_t\n    WHERE rownum = FLOOR((total_count + 1) / 2.0)\n       OR rownum = CEILING((total_count + 1) / 2.0)\n)\nSELECT \n    city,\n    AVG(temperature) AS mean_temp,\n    DECIMAL(AVG(temperature), 10, 2) AS median_temp\nFROM (\n    SELECT city, temperature FROM weather_history\n    UNION ALL\n    SELECT city, temperature FROM median_t\n) t\nGROUP BY city\nORDER BY city;