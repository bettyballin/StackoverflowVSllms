USE [AxDWH_Central_Reporting]\nGO\n\nDECLARE \n    @dbname sysname,\n    @dbsize bigint,\n    @logsize bigint,\n    @reservedpages  bigint\n\nSELECT\n    @reservedpages = SUM(a.total_pages)\nFROM\n    sys.partitions p \n    JOIN sys.allocation_units a ON p.partition_id = a.container_id \n    LEFT JOIN sys.internal_tables it ON p.object_id = it.object_id\n\nSELECT\n    @dbsize = SUM(CONVERT(bigint, CASE WHEN status & 64 = 0 THEN size ELSE 0 END)),\n    @logsize = SUM(CONVERT(bigint, CASE WHEN status & 64 <> 0 THEN size ELSE 0 END))\nFROM \n    dbo.sysfiles\n\nSELECT \n    'database name' = db_name(),\n    'database size' = FORMAT((CONVERT (DEC (15,2),@dbsize) + CONVERT (DEC (15,2),@logsize)) * 8192 / 1048576, 'N2') + ' MB',\n    'unallocated space' = FORMAT((CASE WHEN @dbsize >= @reservedpages THEN\n        (CONVERT (DEC (15,2),@dbsize) - CONVERT (DEC (15,2),@reservedpages)) * 8192 / 1048576 ELSE 0 END), 'N2') + ' MB'