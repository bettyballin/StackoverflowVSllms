DECLARE @date1 DATETIME, @date2 DATETIME, @COUNT INT, @countgap INT;\nSET @date1 = '2009-05-11';\nSET @date2 = '2009-05-12';\nSET @countgap = 30;\nSET @COUNT = 0;\n\n-- Create a temporary table to store the results of Query1\nSELECT @date1 AS TARIH, @COUNT AS SIRA \nINTO #TMP;\n\nWHILE @date1 < @date2\nBEGIN\n    SELECT @date1 = DATEADD(MINUTE, @countgap, @date1), @COUNT = @COUNT + 1;\n    INSERT INTO #TMP\n    SELECT @date1 AS TARIH, @COUNT AS SIRA;\nEND;\n\n-- Select data from Query1 with an additional VISITINGCOUNT column set to 0\nSELECT TARIH, SIRA, 0 AS VISITINGCOUNT\nINTO #TMP_FINAL\nFROM #TMP\nORDER BY SIRA;\n\n-- Execute Query2 and store the results in another temporary table\nSELECT COUNT(page) AS VISITINGCOUNT, \n       (DATEPART(hour, Date) * 60 + DATEPART(minute, Date)) / @countgap AS SIRA\nINTO #TMP2\nFROM scr_SecuristLog\nWHERE Date BETWEEN @date1 AND @date2\nGROUP BY (DATEPART(hour, Date) * 60 + DATEPART(minute, Date)) / @countgap;\n\n-- Join the two temporary tables on the SIRA column\nSELECT T1.TARIH, T1.SIRA, ISNULL(T2.VISITINGCOUNT, 0) AS VISITINGCOUNT\nFROM #TMP_FINAL T1\nLEFT JOIN #TMP2 T2 ON T1.SIRA = T2.SIRA\nORDER BY T1.SIRA;\n\n-- Clean up temporary tables\nDROP TABLE #TMP;\nDROP TABLE #TMP_FINAL;\nDROP TABLE #TMP2;