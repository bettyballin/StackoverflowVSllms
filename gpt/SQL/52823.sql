WITH Hierarchy AS (\n    SELECT \n        ItemID,\n        Name,\n        ParentID,\n        CAST('<ReportFolder>' + Name + '</ReportFolder>' AS NVARCHAR(MAX)) AS XMLData\n    FROM \n        Catalog\n    WHERE \n        ParentID IS NULL\n\n    UNION ALL\n\n    SELECT \n        c.ItemID,\n        c.Name,\n        c.ParentID,\n        CAST(p.XMLData + '<ReportFolder>' + c.Name + '</ReportFolder>' AS NVARCHAR(MAX))\n    FROM \n        Catalog c\n        INNER JOIN Hierarchy p ON c.ParentID = p.ItemID\n)\nSELECT \n    (SELECT \n        XMLData\n     FROM \n        Hierarchy\n     FOR XML PATH(''), TYPE\n    ) AS Server\nFOR XML PATH(''), ROOT('Server')