WITH RankedReplies AS (\n    SELECT\n        r.id AS reply_id,\n        r.post_id,\n        r.content AS reply_content,\n        ROW_NUMBER() OVER (PARTITION BY r.post_id ORDER BY r.created_at DESC) AS reply_rank\n    FROM\n        Replies r\n)\nSELECT\n    p.id AS post_id,\n    p.content AS post_content,\n    rr.reply_id,\n    rr.reply_content\nFROM\n    Posts p\nLEFT JOIN\n    RankedReplies rr ON p.id = rr.post_id AND rr.reply_rank <= 3\nORDER BY\n    p.id, rr.reply_rank;