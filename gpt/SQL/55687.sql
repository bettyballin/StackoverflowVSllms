WITH SkillsAboveTwo AS (\n    SELECT id_app\n    FROM SKILL\n    WHERE lvl >= 2\n    GROUP BY id_app, id_profile\n    HAVING COUNT(*) >= 1\n),\nAppsCovered AS (\n    SELECT id_app\n    FROM SkillsAboveTwo\n    GROUP BY id_app\n    HAVING COUNT(*) >= 2\n)\nSELECT \n    (COUNT(DISTINCT ac.id_app) * 100.0 / COUNT(DISTINCT a.id)) AS coverage_percentage\nFROM \n    APP a\nLEFT JOIN \n    AppsCovered ac ON a.id = ac.id_app;