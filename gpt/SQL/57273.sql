DELIMITER //\n\nCREATE TRIGGER before_insert_item\nBEFORE INSERT ON item\nFOR EACH ROW\nBEGIN\n    DECLARE max_rank INT;\n    \n    SET max_rank = (SELECT COUNT(*) FROM item);\n    \n    IF NEW.rank < 1 THEN\n        SET NEW.rank = 1;\n    ELSEIF NEW.rank > max_rank + 1 THEN\n        SET NEW.rank = max_rank + 1;\n    END IF;\n    \n    UPDATE item SET rank = rank + 1 WHERE rank >= NEW.rank;\nEND;\n//\n\nDELIMITER ;