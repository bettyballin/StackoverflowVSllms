BEGIN\n    DECLARE @startRowIndex INT;\n    DECLARE @PageIndex INT;\n    DECLARE @RowsPerPage INT;\n    DECLARE @Username NVARCHAR(50);\n    \n    SET @PageIndex = 0;\n    SET @RowsPerPage = 15;\n    SET @startRowIndex = (@PageIndex * @RowsPerPage) + 1;\n    SET @Username = 'myUsername';\n\n    WITH messageentries AS (\n        SELECT \n            Row_number() OVER(ORDER BY score DESC) AS row,\n            COUNT(DISTINCT town.townid) AS towns,\n            user_details.username,\n            user_score.score,\n            allience.alliencename,\n            allience.allienceid,\n            allience.alliencetagname,\n            COUNT(*) OVER() AS numberofrows,\n            ROW_NUMBER() OVER(ORDER BY score DESC) FILTER (WHERE user_details.username = @Username) AS myself_row\n        FROM user_details\n        INNER JOIN user_score ON user_details.username = user_score.username\n        INNER JOIN town ON user_details.username = town.townownername\n        LEFT OUTER JOIN allience_roles ON user_details.useralliencerole = allience_roles.roleid\n        LEFT OUTER JOIN allience ON allience_roles.allienceid = allience.allienceid\n        GROUP BY user_details.username, user_score.score, allience.alliencename, allience.allienceid, allience.alliencetagname\n    )\n    SELECT *, \n           (SELECT myself_row FROM messageentries WHERE username = @Username) AS myself\n    FROM messageentries\n    WHERE row BETWEEN @startRowIndex AND (@startRowIndex + @RowsPerPage - 1);\nEND