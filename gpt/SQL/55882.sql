WITH GroupHierarchy AS (\n    SELECT \n        g.GruppeID,\n        g.ParentGruppeID,\n        g.GruppeName,\n        0 AS Level\n    FROM \n        Gruppen AS g\n    WHERE \n        g.ParentGruppeID IS NULL\n\n    UNION ALL\n\n    SELECT \n        g.GruppeID,\n        g.ParentGruppeID,\n        g.GruppeName,\n        gh.Level + 1\n    FROM \n        Gruppen AS g\n    INNER JOIN \n        GroupHierarchy AS gh ON g.ParentGruppeID = gh.GruppeID\n)\nSELECT \n    k.KundeID,\n    REPLICATE('   ', gh.Level) + gh.GruppeName AS GroupHierarchy\nFROM \n    Kunden AS k\nINNER JOIN \n    KundenGruppen AS kg ON k.KundeID = kg.KundeID\nINNER JOIN \n    GroupHierarchy AS gh ON kg.GruppeID = gh.GruppeID\nORDER BY \n    k.KundeID, gh.Level