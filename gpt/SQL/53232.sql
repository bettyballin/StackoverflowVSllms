ALTER Trigger [dbo].[Set_Asignado_State] ON [dbo].[Tables] \nFOR INSERT AS \nBEGIN           \n    IF (SELECT COUNT(*) FROM inserted WHERE IsProcessed = 1) = 0\n    BEGIN\n        UPDATE Tables SET IsProcessed = 1 WHERE Table_Area_Id IN (SELECT Table_Area_Id FROM inserted)\n        \n        DECLARE @area varchar(1)\n        SELECT @area = Table_Area_ID FROM inserted\n\n        IF (@area = 'L')\n        BEGIN\n            INSERT INTO Table_History\n            SELECT (SELECT TOP 1 Table_Area_Id AS Table_Area_Id FROM inserted) AS Table_Area_Id,\n                   (SELECT SUBSTRING(CAST(YEAR(GETDATE()) AS VARCHAR), 3, 2)) AS Table_Year, \n                   (SELECT TOP 1 Table_Seq AS Table_Seq FROM inserted) AS Table_Seq, \n                   (SELECT TOP 1 ID FROM Table_Status WHERE Description = 'Asignado') AS Status, \n                   '' AS Responsible, \n                   (SELECT TOP 1 OrigDept FROM inserted) AS User_Responsible, \n                   GETDATE() AS [DateTime],\n                   'None' AS Comments\n            FROM Tables\n            WHERE Tables.Table_Area_Id = (SELECT TOP 1 Table_Area_Id AS Table_Area_Id FROM inserted) AND\n                  Tables.Table_Year = (SELECT SUBSTRING(CAST(YEAR(GETDATE()) AS VARCHAR), 3, 2))\n\n            IF @@ERROR <> 0\n            BEGIN\n                DECLARE @errorMsg NVARCHAR(256)\n                SET @errorMsg = @@ERROR; \n                PRINT 'Error Inserting in Table_History'\n            END\n        END\n    END\nEND