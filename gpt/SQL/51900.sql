-- Step 1: Insert data into the new contract table\nINSERT INTO contract (name, contract_parent_id)\nSELECT tbl_contract.contract_name, tbl_contract.contract_parent_id\nFROM dbo.tbl_contract;\n\n-- Step 2: Use a CTE to update the contract_parent_id in the new contract table\nWITH CTE AS (\n    SELECT c1.ID AS new_id, c2.ID AS new_parent_id, c1.contract_pk\n    FROM contract c1\n    LEFT JOIN contract c2 ON c1.contract_parent_id = c2.contract_pk\n)\nUPDATE contract\nSET contract_parent_id = CTE.new_parent_id\nFROM contract\nINNER JOIN CTE ON contract.ID = CTE.new_id;\n\n-- Note: Ensure that `contract_parent_id` in the new contract table is nullable or has a default value