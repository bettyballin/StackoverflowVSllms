WITH RECURSIVE time_intervals AS (\n    SELECT \n        MIN(strftime('%Y-%m-%d %H:%M', start_ts)) AS time_interval\n    FROM \n        sessions\n    UNION ALL\n    SELECT \n        strftime('%Y-%m-%d %H:%M', datetime(time_interval, '+1 minute'))\n    FROM \n        time_intervals\n    WHERE \n        time_interval < (SELECT MAX(strftime('%Y-%m-%d %H:%M', end_ts)) FROM sessions)\n)\nSELECT \n    time_intervals.time_interval AS TIME_INTERVAL,\n    COUNT(sessions.session_id) AS ACTIVE_SESSIONS\nFROM \n    time_intervals\nLEFT JOIN \n    sessions\nON \n    sessions.start_ts <= datetime(time_intervals.time_interval, '+1 minute')\n    AND sessions.end_ts >= time_intervals.time_interval\nGROUP BY \n    time_intervals.time_interval\nORDER BY \n    time_intervals.time_interval;