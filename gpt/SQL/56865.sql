WITH CTE1 AS (\n        SELECT ...\n        FROM ...\n        WHERE ...\n    ),\n    CTE2 AS (\n        SELECT ...\n        FROM CTE1\n        JOIN ...\n        WHERE ...\n    )\n    SELECT ...\n    FROM CTE2\n    JOIN ...\n    WHERE ...