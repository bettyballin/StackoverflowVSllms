WITH LatestCar AS (\n    SELECT \n        CarId, \n        CarVer, \n        VersionTime, \n        Colour\n    FROM Cars\n    WHERE CarId = 1 AND VersionTime <= '12 Jun 2009 09:50'\n    ORDER BY VersionTime DESC\n    LIMIT 1\n),\nLatestWheels AS (\n    SELECT \n        WheelId, \n        WheelVer, \n        VersionTime, \n        CarId\n    FROM Wheels\n    WHERE CarId = 1 AND VersionTime <= '12 Jun 2009 09:50'\n    QUALIFY ROW_NUMBER() OVER (PARTITION BY WheelId ORDER BY VersionTime DESC) = 1\n)\nSELECT\n    w.WheelId,\n    w.WheelVer,\n    w.VersionTime AS WheelVerTime,\n    c.CarId,\n    c.CarVer,\n    c.VersionTime AS CarVerTime,\n    c.Colour AS CarColour\nFROM LatestCar c\nJOIN LatestWheels w ON c.CarId = w.CarId;