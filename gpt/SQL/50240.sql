CREATE PROCEDURE [dbo].[ExecView]\n(\n    @publisherId bigint,\n    @advertId bigint,\n    @localeId int,\n    @ip varchar(15),\n    @ipIsUnique bit,\n    @success bit OUTPUT,\n    @campaignId bigint OUTPUT,\n    @advert varchar(500) OUTPUT,\n    @advertWidth int OUTPUT,\n    @advertHeight int OUTPUT\n)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @unique bit\n    DECLARE @approved bit\n    DECLARE @publisherEarning money\n    DECLARE @advertiserCost money\n    DECLARE @originalStatus smallint\n    DECLARE @advertUrl varchar(500)\n\n    -- Check if the publisher is an actual customer under the given locale\n    IF EXISTS (\n        SELECT 1\n        FROM Customer\n        WHERE PublisherId = @publisherId AND LocaleId = @localeId\n    )\n    BEGIN\n        -- Fetch advert details\n        SELECT\n            @advertUrl = AdvertUrl,\n            @advertWidth = AdvertWidth,\n            @advertHeight = AdvertHeight\n        FROM Advert\n        WHERE AdvertId = @advertId\n\n        -- Check if the advert is allowed to be shown\n        EXEC [dbo].[CheckAdvertPermission]\n            @advertId,\n            @publisherId,\n            @ip,\n            @ipIsUnique,\n            @unique OUTPUT,\n            @approved OUTPUT,\n            @campaignId OUTPUT,\n            @originalStatus OUTPUT\n\n        IF @approved = 1\n        BEGIN\n            -- Update success output and advert details\n            SET @success = 1\n            SET @advert = @advertUrl\n        END\n        ELSE\n        BEGIN\n            SET @success = 0\n        END\n    END\n    ELSE\n    BEGIN\n        SET @success = 0\n    END\nEND