WITH ScheduleWithDates AS (\n    SELECT\n        es.[Employee ID],\n        es.[Project ID],\n        dn.[Day],\n        LAG(dn.[Day]) OVER (PARTITION BY es.[Employee ID], es.[Project ID] ORDER BY dn.[Day]) AS PrevDay\n    FROM \n        [Employee Schedule] es\n    JOIN\n        [Day Numbers] dn\n    ON\n        es.[Day ID] = dn.[ID]\n),\nDayGroups AS (\n    SELECT\n        [Employee ID],\n        [Project ID],\n        [Day],\n        SUM(CASE WHEN DATEADD(day, -1, [Day]) = PrevDay THEN 0 ELSE 1 END) OVER (PARTITION BY [Employee ID], [Project ID] ORDER BY [Day]) AS GroupNumber\n    FROM\n        ScheduleWithDates\n)\nSELECT\n    [Employee ID],\n    [Project ID],\n    MIN([Day]) AS StartDate,\n    MAX([Day]) AS EndDate\nFROM\n    DayGroups\nGROUP BY\n    [Employee ID],\n    [Project ID],\n    GroupNumber\nORDER BY\n    [Employee ID],\n    [Project ID],\n    StartDate;