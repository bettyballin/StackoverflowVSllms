WITH RankedRows AS (\n    SELECT \n        T1.id as id1, \n        T1.type as type1, \n        T1.siteid as siteid1,\n        T2.id as id2,\n        T2.type as type2,\n        T2.siteid as siteid2,\n        ROW_NUMBER() OVER (PARTITION BY T1.siteid ORDER BY T1.id) as rn\n    FROM \n        test T1\n    LEFT JOIN \n        test T2 \n    ON \n        T1.siteid = T2.siteid \n        AND T1.id <> T2.id\n)\nSELECT \n    id1 as id, \n    type1 as type, \n    siteid1 as siteid, \n    id2 as id, \n    type2 as type, \n    siteid2 as siteid\nFROM \n    RankedRows\nWHERE \n    rn = 1;