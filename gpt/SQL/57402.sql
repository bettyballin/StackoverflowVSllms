CREATE TRIGGER [dbo].[BeforeUpdateUser]\nON [dbo].[Users]\nINSTEAD OF UPDATE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n    IF EXISTS (\n        SELECT 1 \n        FROM INSERTED i\n        JOIN Users u ON i.Email = u.Email AND i.UserId != u.UserId\n    )\n    BEGIN\n        RAISERROR ('Duplicate email addresses are not allowed.', 16, 1);\n        ROLLBACK TRANSACTION;\n        RETURN;\n    END\n\n    IF EXISTS (\n        SELECT 1 \n        FROM INSERTED i\n        JOIN Users u ON i.UserName = u.UserName AND i.UserId != u.UserId\n    )\n    BEGIN\n        RAISERROR ('Duplicate usernames are not allowed.', 16, 1);\n        ROLLBACK TRANSACTION;\n        RETURN;\n    END\n\n    -- If no duplicates found, proceed with the update\n    UPDATE Users\n    SET \n        FirstName = i.FirstName,\n        LastName = i.LastName,\n        Email = i.Email,\n        Password = i.Password,\n        UserName = i.UserName,\n        LanguageId = i.LanguageId,\n        Data = i.Data,\n        IsDeleted = i.IsDeleted\n    FROM INSERTED i\n    WHERE Users.UserId = i.UserId;\nEND