DECLARE @retry INT = 3;\nDECLARE @retryDelay INT = 1000; -- milliseconds\n\nWHILE @retry > 0\nBEGIN\n    BEGIN TRY\n        BEGIN TRANSACTION\n        \n        SELECT * FROM table1 WITH (UPDLOCK) WHERE condition;\n        INSERT INTO table2 (columns) VALUES (values);\n        UPDATE table1 SET pointer = value WHERE condition;\n        \n        COMMIT TRANSACTION\n        BREAK; -- Exit loop if successful\n    END TRY\n    BEGIN CATCH\n        IF ERROR_NUMBER() = 1205 -- Deadlock error number\n        BEGIN\n            ROLLBACK TRANSACTION;\n            SET @retry = @retry - 1;\n            WAITFOR DELAY '00:00:01'; -- Wait 1 second before retrying\n        END\n        ELSE\n        BEGIN\n            ROLLBACK TRANSACTION;\n            THROW; -- Re-throw the original exception\n        END\n    END CATCH\nEND