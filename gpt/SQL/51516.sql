SELECT \n    accepted.folio,\n    COALESCE(inprog.activityin, accepted.activityin) AS activityin,\n    inprog.participantin,\n    accepted.completiondate\nFROM performance accepted\nLEFT OUTER JOIN performance inprog \n    ON accepted.folio = inprog.folio \n    AND inprog.activityin IN (4, 435) -- both are ids for in-progress\n    AND inprog.participantin != 1 -- Ignore the "bot" participant\nLEFT OUTER JOIN performance closed\n    ON accepted.folio = closed.folio \n    AND closed.activityin IN (10, 436, 4, 430) -- all these are closed or cancelled\nWHERE accepted.activityin IN (3, 429) -- both are id for new\nAND accepted.folio IS NOT NULL\nAND closed.folio IS NULL;