SELECT \n    e.Id,\n    e.Name,\n    COALESCE(\n        (\n            SELECT h.NewValue \n            FROM History h \n            WHERE h.RowId = e.Id \n              AND h.Field = 'Department' \n              AND h.ChangeDate <= '2009-05-05'\n            ORDER BY h.ChangeDate DESC \n            LIMIT 1\n        ), \n        e.Department\n    ) AS Department\nFROM \n    Employee e;