WITH RankedItems AS (\n    SELECT \n        CartItems.cart_id, \n        ItemValues.item_id, \n        ItemValues.value,\n        ROW_NUMBER() OVER (PARTITION BY CartItems.cart_id ORDER BY ItemValues.value DESC) AS rn\n    FROM \n        CartItems \n    INNER JOIN \n        ItemValues \n    ON \n        CartItems.item_id = ItemValues.item_id\n)\nSELECT \n    cart_id,\n    item_id,\n    value\nFROM \n    RankedItems\nWHERE \n    rn = 1;