WITH LatestDates AS (\n    SELECT \n        Resource.Description, \n        arq.ResourceID, \n        MAX(arq.DateReferred) AS DateReferred\n    FROM \n        AssessmentXResource AS arq\n        INNER JOIN Resource ON arq.ResourceID = Resource.ResourceID\n        INNER JOIN Assessment AS aq ON arq.AssessmentID = aq.AssessmentID\n        INNER JOIN [Case] AS cq ON aq.CaseID = cq.CaseID\n        INNER JOIN [Plan] AS pq ON cq.CaseID = pq.CaseID\n    WHERE \n        pq.PlanID = 22\n    GROUP BY \n        Resource.Description, arq.ResourceID\n)\nSELECT \n    Resource.Description, \n    LatestDates.DateReferred, \n    arq.AssessmentResourceID\nFROM \n    LatestDates\n    INNER JOIN AssessmentXResource AS arq ON LatestDates.ResourceID = arq.ResourceID AND LatestDates.DateReferred = arq.DateReferred\n    INNER JOIN Resource ON arq.ResourceID = Resource.ResourceID\nORDER BY \n    Resource.Description;