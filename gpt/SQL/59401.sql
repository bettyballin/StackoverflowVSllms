SELECT \n    s_id, \n    s_title, \n    s_time, \n    (s_time - UNIX_TIMESTAMP()) AS s_timediff, \n    (\n        (SELECT COUNT(*) FROM s_ups WHERE stories.s_id = s_ups.s_id) - \n        (SELECT COUNT(*) FROM s_downs WHERE stories.s_id = s_downs.s_id)\n    ) AS votes,\n    (\n        LOG10(GREATEST(ABS(\n            (SELECT COUNT(*) FROM s_ups WHERE stories.s_id = s_ups.s_id) - \n            (SELECT COUNT(*) FROM s_downs WHERE stories.s_id = s_downs.s_id)\n        ), 1)) + \n        (UNIX_TIMESTAMP(stories.s_time) / 45000)\n    ) AS rank\nFROM \n    stories\nORDER BY \n    rank DESC;