-- Collect CPU usage data\nSELECT \n    record_id, \n    DATEADD(ms, -1 * (cpu_ticks / (cpu_ticks / ms_ticks)), GETDATE()) AS EventTime,\n    SQLProcessUtilization AS SQLServerCPU, \n    SystemIdle, \n    100 - SystemIdle - SQLProcessUtilization AS OtherCPU \nFROM \n    sys.dm_os_ring_buffers \nWHERE \n    ring_buffer_type = N'RING_BUFFER_SCHEDULER_MONITOR' \n    AND record_id = (SELECT MAX(record_id) FROM sys.dm_os_ring_buffers \n                      WHERE ring_buffer_type = N'RING_BUFFER_SCHEDULER_MONITOR');