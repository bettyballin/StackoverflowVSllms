CREATE OR REPLACE FUNCTION ht_encode(str IN VARCHAR2, mask IN VARCHAR2) RETURN VARCHAR2 AS\n  xor_mask VARCHAR2(2000);\n  result_s RAW(2000);\n  i INTEGER;\n  xx INTEGER;\n  ch1 CHAR(1);\n  ch2 CHAR(1);\n  chrx RAW(1);\nBEGIN\n  result_s := UTL_RAW.CAST_TO_RAW('');\n  xor_mask := mask;\n  WHILE LENGTH(xor_mask) < LENGTH(str) LOOP\n    xor_mask := xor_mask || mask;\n  END LOOP;\n  FOR i IN 1..LENGTH(str) LOOP\n    ch1 := SUBSTR(str, i, 1);\n    ch2 := SUBSTR(xor_mask, i, 1);\n    xx := BITXOR(ASCII(ch1), ASCII(ch2));\n    chrx := UTL_RAW.CAST_TO_RAW(CHR(xx));\n    result_s := result_s || chrx;\n  END LOOP;\n  RETURN UTL_RAW.CAST_TO_VARCHAR2(UTL_ENCODE.BASE64_ENCODE(result_s));\nEND;\n/