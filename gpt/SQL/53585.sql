CREATE PROCEDURE YourStoredProc\nAS\nBEGIN\n    BEGIN TRY\n        BEGIN TRANSACTION;\n\n        -- Log start\n        INSERT INTO log_table (message, log_time) VALUES ('SP Start', GETDATE());\n\n        DELETE table_y;\n\n        -- Log after delete\n        INSERT INTO log_table (message, log_time) VALUES ('After DELETE', GETDATE());\n\n        INSERT INTO table_y\n        SELECT * FROM (SELECT * FROM source_table_1 UNION ALL SELECT * FROM source_table_2 UNION ALL SELECT * FROM source_table_3) AS unioned;\n\n        -- Log after insert\n        INSERT INTO log_table (message, log_time) VALUES ('After INSERT', GETDATE());\n\n        UPDATE table_x;\n\n        COMMIT TRANSACTION;\n\n        -- Log commit\n        INSERT INTO log_table (message, log_time) VALUES ('After COMMIT', GETDATE());\n    END TRY\n    BEGIN CATCH\n        ROLLBACK TRANSACTION;\n        -- Log error\n        INSERT INTO log_table (message, log_time) VALUES ('Error: ' + ERROR_MESSAGE(), GETDATE());\n    END CATCH\nEND