USE [POBox]\nGO\n/****** Object:  StoredProcedure [dbo].[test]    Script Date: 07/06/2009 12:55:39 ******/\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\nALTER PROCEDURE [dbo].[test] --'DateTime','1','10'\n(\n    @p_SortExpression NVARCHAR(100),\n    @p_StartIndex INT,\n    @p_MaxRows INT,\n    @p_SearchTerm NVARCHAR(100)\n)\nAS\nSET NOCOUNT ON;\nIF LEN(@p_SortExpression)= 0 \nSET @p_SortExpression = 'DateTime DESC'\n\nDECLARE @Sql NVARCHAR(4000)\nSET @Sql ='\n    SELECT ID, DateTime, Subject, CreatedBy, ToReceipientID, ReceiverStatus\n    FROM\n    (\n        SELECT ID, DateTime, Subject, CreatedBy, ToReceipientID, ReceiverStatus,\n        ROW_NUMBER() OVER(ORDER BY ' + @p_SortExpression + ') AS Indexing\n        FROM ComposeMail\n        WHERE Subject LIKE @SearchPattern\n    ) AS NewDataTable\n    WHERE Indexing > ' + CONVERT(NVARCHAR(10), @p_StartIndex) + ' AND Indexing <= (' + CONVERT(NVARCHAR(10), @p_StartIndex) + ' + ' + CONVERT(NVARCHAR(10), @p_MaxRows) + ')'\n\nEXEC sp_executesql @Sql, N'@SearchPattern NVARCHAR(100)', @SearchPattern = '%' + @p_SearchTerm + '%'