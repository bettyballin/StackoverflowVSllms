CREATE VIEW TagSummary AS\nSELECT \n    t.id,\n    t.name,\n    t.sortorder,\n    t.parentid,\n    ISNULL(pt.ProductCount, 0) AS ProductCount,\n    ISNULL(ct.ChildTagCount, 0) AS ChildTagCount\nFROM \n    Tags t\nLEFT JOIN \n    (SELECT tagid, COUNT(productid) AS ProductCount\n     FROM ProductTags\n     GROUP BY tagid) pt ON t.id = pt.tagid\nLEFT JOIN \n    (SELECT parentid, COUNT(id) AS ChildTagCount\n     FROM Tags\n     WHERE parentid IS NOT NULL\n     GROUP BY parentid) ct ON t.id = ct.parentid;