WITH RankedPerformance AS (\n    SELECT \n        salespersonId,\n        performance_metric,\n        DATE(performance_time) AS performance_date,\n        ROW_NUMBER() OVER (PARTITION BY salespersonId, DATE(performance_time) ORDER BY performance_time DESC) AS rank\n    FROM \n        so_test.salesperson_hourly_performance\n)\nSELECT \n    salespersonId,\n    performance_metric,\n    performance_date\nFROM \n    RankedPerformance\nWHERE \n    rank = 1;