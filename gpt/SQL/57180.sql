ALTER FUNCTION [VEZNE].[fnMakbuzIslemGetir] \n(\n    @refNo AS INT\n)\nRETURNS @tablename TABLE (kontrol1 CHAR(1), key0 NUMERIC(18,0), tarih DATETIME, hizkod CHAR(12), hizad CHAR(75), ytlhizfiyat DECIMAL(18,2), hizmiktar NUMERIC(18,2), ytlhiztutar DECIMAL(18,2))\nAS \nBEGIN\n\n    DECLARE @durum     AS VARCHAR(50)\n    DECLARE @hastaTuru AS VARCHAR(50)\n    DECLARE @makTipi   AS VARCHAR(50)\n\n    SET @durum     = (SELECT durum FROM TH_RefKart WHERE RefNo = @refNo)\n    SET @hastaTuru = (SELECT HastaTuru FROM TH_Dosya WHERE DosyaNo IN (SELECT DosyaNo FROM TH_RefKart WHERE RefNo = @refNo))\n    SET @makTipi   = (SELECT TOP 1 maktipi FROM TH_Islem WHERE refNo = @refNo ORDER BY <some_column>)\n\n    IF ((@hastaTuru = 'Ãœcretli') AND (@durum = 'AYAKTA')) OR @makTipi = '0' \n    BEGIN \n        INSERT @tablename \n        SELECT kontrol1, key0, tarih, hizkod, hizad, ytlhizfiyat, hizmiktar, ytlhiztutar \n        FROM TH_Islem \n        WHERE refno = @refNo AND DekontNo = '0' AND anahtar <> -1 \n    END \n\n    RETURN\n\nEND