CREATE TABLE Branch (\n    branch_id INT NOT NULL PRIMARY KEY IDENTITY(1,1),\n    branch_name VARCHAR(80) NOT NULL,\n    street VARCHAR(80) NULL,\n    city VARCHAR(30) NULL,\n    state CHAR(2) NULL,\n    zip CHAR(5) NULL,\n    is_satellite_office BIT NOT NULL DEFAULT(0),\n    satellite_to_branch_id INT NULL,\n    CONSTRAINT CK_Branch CHECK (\n        (is_satellite_office = 0 AND satellite_to_branch_id IS NULL)\n        OR (is_satellite_office = 1 AND satellite_to_branch_id IS NOT NULL)\n    )\n);\n\n-- Ensure that satellite_to_branch_id references a branch_id where is_satellite_office is 0\nALTER TABLE Branch\nADD CONSTRAINT CK_SatelliteParent CHECK (\n    satellite_to_branch_id IS NULL OR \n    (satellite_to_branch_id IS NOT NULL AND \n     (SELECT is_satellite_office FROM Branch WHERE branch_id = satellite_to_branch_id) = 0)\n);\n\n-- Ensure that each branch can only be a parent once\nALTER TABLE Branch\nADD CONSTRAINT UQ_SatelliteToBranch UNIQUE (satellite_to_branch_id);