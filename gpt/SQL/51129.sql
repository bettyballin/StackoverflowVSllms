WITH TimeSlots AS (\n    SELECT \n        CASE \n            WHEN DATEPART(MINUTE, [Date]) < 30 THEN FORMAT([Date], 'HH:00') + '-' + FORMAT([Date], 'HH:30')\n            ELSE FORMAT(DATEADD(MINUTE, 30, [Date]), 'HH:00') + '-' + FORMAT(DATEADD(MINUTE, 30, [Date]), 'HH:30')\n        END AS TimeRange,\n        VisitingCount\n    FROM Table1\n),\nAggregatedSlots AS (\n    SELECT\n        TimeRange,\n        SUM(VisitingCount) AS TotalVisitingCount\n    FROM TimeSlots\n    GROUP BY TimeRange\n)\nSELECT\n    TotalVisitingCount AS VisitingCount,\n    TimeRange AS [Date]\nFROM AggregatedSlots\nORDER BY [Date];