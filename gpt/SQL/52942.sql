-- Step 1: Create a temporary table to identify duplicates\nCREATE TEMPORARY TABLE temp_duplicates AS\nSELECT \n    id, ref_id, type\nFROM (\n    SELECT \n        id,\n        ref_id,\n        type,\n        ROW_NUMBER() OVER(PARTITION BY ref_id, type ORDER BY id) as row_num\n    FROM my_table\n) subquery\nWHERE row_num > 1;\n\n-- Step 2: Delete rows that are identified as duplicates\nDELETE my_table\nFROM my_table\nINNER JOIN temp_duplicates\nON my_table.id = temp_duplicates.id;\n\n-- Step 3: Drop the temporary table as it is no longer needed\nDROP TEMPORARY TABLE temp_duplicates;\n\n-- Step 4: Add the UNIQUE constraint\nALTER TABLE my_table ADD UNIQUE (ref_id, type);