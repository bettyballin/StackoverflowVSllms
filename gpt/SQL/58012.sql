CREATE TABLE [dbo].[WeatherMeasurement](\n  MeasurementID [int] Identity(1,1) NOT NULL,\n  TownID [int] NOT NULL,\n  Temp [int] NOT NULL,\n  Date [datetime] NOT NULL\n);\n\nCREATE TABLE [dbo].[WeatherMeasurementHistory](\n  MeasurementID [int] Identity(1,1) NOT NULL,\n  TownID [int] NOT NULL,\n  Temp [int] NOT NULL,\n  Date [datetime] NOT NULL\n);\n\n-- Trigger to archive old data\nCREATE TRIGGER trg_ArchiveWeatherMeasurement\nON [dbo].[WeatherMeasurement]\nAFTER INSERT, UPDATE\nAS\nBEGIN\n  -- Archive old records\n  INSERT INTO [dbo].[WeatherMeasurementHistory] (TownID, Temp, Date)\n  SELECT TownID, Temp, Date\n  FROM inserted\n  WHERE Date < GETDATE() - 1;\n\n  -- Remove old records from current table\n  DELETE FROM [dbo].[WeatherMeasurement]\n  WHERE Date < GETDATE() - 1;\nEND;