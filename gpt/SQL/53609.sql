ALTER FUNCTION [Treasury].[ufnCheckDarkhastFaktorMablaghConstraint]\n(\n    @DarkhastFaktor INT\n)\nRETURNS BIT\nAS\nBEGIN\n    DECLARE @SumMablagh FLOAT\n    DECLARE @Mablagh FLOAT\n\n    SELECT @SumMablagh = ISNULL(SUM(Mablagh), 0)\n    FROM Treasury.DariaftPardakhtDarkhastFaktor WITH (UPDLOCK, HOLDLOCK)\n    WHERE DarkhastFaktor = @DarkhastFaktor\n\n    SELECT @Mablagh = ISNULL(MablaghKhalesFaktor, 0)\n    FROM Sales.DarkhastFaktor WITH (UPDLOCK, HOLDLOCK)\n    WHERE DarkhastFaktor = @DarkhastFaktor\n\n    IF @Mablagh - @SumMablagh < -1\n        RETURN 0\n\n    RETURN 1\nEND