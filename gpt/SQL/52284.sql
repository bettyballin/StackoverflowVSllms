IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[DictValue]') AND type in (N'FN', N'IF', N'TF', N'FS', N'FT'))\n    DROP FUNCTION [dbo].[DictValue]\nGO\n\nIF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N'[dbo].[TableWithXmlColumn]') AND type in (N'U'))\n    DROP TABLE [dbo].[TableWithXmlColumn]\nGO\n\nCREATE TABLE TableWithXmlColumn (\n    Id INT IDENTITY PRIMARY KEY,\n    Dict XML\n)\nGO\n\nCREATE FUNCTION DictValue(\n    @id INT,\n    @key NVARCHAR(MAX)\n) RETURNS NVARCHAR(MAX) AS \nBEGIN\n    DECLARE @value NVARCHAR(MAX)\n\n    SELECT @value = d.Pair.value('data(.)', 'nvarchar(max)')\n    FROM TableWithXmlColumn\n    CROSS APPLY Dict.nodes('/StringDictionary/Pair') AS d(Pair)\n    WHERE Id = @id AND d.Pair.value('./@Key', 'nvarchar(max)') = @key\n\n    RETURN @value\nEND\nGO\n\nDECLARE @xmlId INT\nINSERT TableWithXmlColumn (Dict) VALUES (\n    N'<?xml version="1.0" encoding="utf-16"?>\n    <StringDictionary>\n      <Pair Key="color">red</Pair>\n      <Pair Key="count">123</Pair>\n    </StringDictionary>'\n)\nSET @xmlId = SCOPE_IDENTITY()\n\nSELECT \n    dbo.DictValue(@xmlId, 'color') AS color,\n    dbo.DictValue(@xmlId, 'count') AS [count]