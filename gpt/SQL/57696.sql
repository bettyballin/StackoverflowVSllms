USE master;\nGO\n\nIF OBJECT_ID('sp_help_revlogin') IS NOT NULL\n    DROP PROCEDURE sp_help_revlogin;\nGO\n\nCREATE PROCEDURE sp_help_revlogin\nAS\nBEGIN\n    DECLARE @sql NVARCHAR(MAX);\n\n    SET @sql = '/* sp_help_revlogin script starts here */\n    DECLARE @name NVARCHAR(256),\n            @type NVARCHAR(256),\n            @hasaccess INT;\n\n    DECLARE logins CURSOR FOR\n    SELECT  name, type, hasaccess\n    FROM    master.dbo.syslogins\n    WHERE   name NOT LIKE ''##%'' AND name NOT IN (''sa'', ''guest'')\n    ORDER BY name;\n\n    OPEN logins;\n    FETCH NEXT FROM logins\n    INTO @name, @type, @hasaccess;\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        PRINT ''Creating login: '' + @name;\n\n        IF @type = ''U''\n        BEGIN\n            PRINT ''  Type: Windows user'';\n            EXEC sp_grantlogin @name;\n        END\n        ELSE IF @type = ''G''\n        BEGIN\n            PRINT ''  Type: Windows group'';\n            EXEC sp_grantlogin @name;\n        END\n        ELSE IF @type = ''S''\n        BEGIN\n            DECLARE @pwd NVARCHAR(256);\n            SELECT @pwd = password\n            FROM master.dbo.sysxlogins\n            WHERE sid = SUSER_SID(@name);\n\n            PRINT ''  Type: SQL Server login'';\n            SET @sql = ''CREATE LOGIN ['' + @name + ''] WITH PASSWORD = '''''' + @pwd + '''''' HASHED'';\n            EXEC sp_executesql @sql;\n        END\n\n        IF @hasaccess = 1\n        BEGIN\n            PRINT ''  Granting access'';\n            EXEC sp_grantdbaccess @name;\n        END\n\n        FETCH NEXT FROM logins\n        INTO @name, @type, @hasaccess;\n    END;\n\n    CLOSE logins;\n    DEALLOCATE logins;\n    /* sp_help_revlogin script ends here */\n    ';\n\n    EXEC sp_executesql @sql;\nEND;\nGO