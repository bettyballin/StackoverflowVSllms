BEGIN TRAN\n\n-- Select and lock the next 20 orders for the processor\nUPDATE OrderTable WITH (ROWLOCK, UPDLOCK, READPAST)\nSET ProcessorID = @PROCID\nOUTPUT inserted.OrderID\nWHERE OrderID IN (\n    SELECT TOP (20) OrderID\n    FROM OrderTable WITH (ROWLOCK, UPDLOCK, READPAST)\n    WHERE ProcessorID = 0\n    ORDER BY OrderID\n)\n\nCOMMIT TRAN\n\n-- Retrieve the orders assigned to the processor\nSELECT OrderID, ProcessorID, etc...\nFROM OrderTable\nWHERE ProcessorID = @PROCID