CREATE PROCEDURE dbo.spPivot\n    @EntityTypeID int\nAS\nBEGIN\n    DECLARE @SQL nvarchar(MAX);\n    DECLARE @COLS nvarchar(MAX);\n\n    SELECT @COLS = STRING_AGG('[' + Name + ']', ',')\n    FROM c_EntityAttribute \n    WHERE EntityTypeID = @EntityTypeID;\n\n    SET @SQL = '\n    SELECT * \n    FROM (\n        SELECT EntityInstanceID, AttributeName, Value \n        FROM v_EntityElementData \n        WHERE EntityTypeID = @EntityTypeID\n    ) AS SourceTable \n    PIVOT (\n        MIN(Value) \n        FOR AttributeName IN (' + @COLS + ')\n    ) AS PivotTable';\n\n    EXEC sp_executesql @SQL, N'@EntityTypeID int', @EntityTypeID;\nEND