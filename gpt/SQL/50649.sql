-- Update the ValTable with a join on StrTable\nUPDATE ValTable vt\nJOIN StrTable st ON vt.str_key = st.str_key\nSET vt.val = 2.124\nWHERE st.str_key = (SELECT str_key FROM StrTable WHERE str_key = 0 AND str = 'a')\nAND vt.other_key = 1;\n\n-- If no rows were updated, insert a new row\nIF @@ROWCOUNT = 0 \nBEGIN\n    INSERT INTO ValTable (str_key, other_key, val)\n    SELECT str_key, 1, 2.124\n    FROM StrTable\n    WHERE str_key = 0 AND str = 'a';\nEND