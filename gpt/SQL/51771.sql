WITH RECURSIVE ReportingHierarchy AS (\n    -- Anchor member: start with the given reporting unit\n    SELECT \n        Key, \n        ParentReportingUnitKey\n    FROM \n        ReportingUnit\n    WHERE \n        Key = 'R1'\n    \n    UNION ALL\n    \n    -- Recursive member: join the table to itself to find all children\n    SELECT \n        RU.Key, \n        RU.ParentReportingUnitKey\n    FROM \n        ReportingUnit RU\n    INNER JOIN \n        ReportingHierarchy RH\n    ON \n        RU.ParentReportingUnitKey = RH.Key\n)\nSELECT \n    F.Key AS FacilityKey\nFROM \n    Facility F\nINNER JOIN \n    ReportingHierarchy RH\nON \n    F.ParentReportingUnitKey = RH.Key;