WITH LastActions AS (\n    SELECT \n        intPK, \n        datCheckedOut AS datLastAction, \n        'CheckedOut' AS ActionType\n    FROM \n        dbo.tblAssetsInUse\n    WHERE \n        datCheckedOut IS NOT NULL\n    \n    UNION ALL\n    \n    SELECT \n        intPK, \n        datCheckedIn AS datLastAction, \n        'CheckedIn' AS ActionType\n    FROM \n        dbo.tblAssetsInUse\n    WHERE \n        datCheckedIn IS NOT NULL\n)\n\nSELECT TOP (1) \n    la.intPK, \n    MAX(la.datLastAction) AS datLastScan, \n    a.strFriendlyName, \n    taiu.intAssetID,\n    la.ActionType\nFROM \n    LastActions la\nINNER JOIN\n    dbo.tblAssetsInUse taiu ON la.intPK = taiu.intPK\nINNER JOIN\n    dbo.viwAssets a ON taiu.intAssetID = a.intPK\nGROUP BY \n    la.intPK, \n    a.strFriendlyName, \n    taiu.intAssetID, \n    la.ActionType\nORDER BY \n    datLastScan DESC;