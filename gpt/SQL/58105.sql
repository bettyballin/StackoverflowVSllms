WITH LatestGenerations AS (\n    SELECT \n        Id,\n        Value,\n        DeleteAction,\n        GenerationId,\n        ROW_NUMBER() OVER (PARTITION BY Id ORDER BY GenerationId DESC) AS rn\n    FROM \n        MyObjects\n    WHERE \n        GenerationId <= @GivenGenerationId\n)\nSELECT \n    Id, \n    Value, \n    GenerationId\nFROM \n    LatestGenerations\nWHERE \n    rn = 1\n    AND DeleteAction = 0;