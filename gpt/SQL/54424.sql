WITH latest_users AS (\n    SELECT DISTINCT userID\n    FROM table1\n    WHERE date > '2009-01-01'\n),\nlatest_answers AS (\n    SELECT \n        userID,\n        MAX(CASE WHEN question = 'Unit' THEN counter END) AS max_unit_counter,\n        MAX(CASE WHEN question = 'Demo' THEN counter END) AS max_demo_counter\n    FROM table2\n    GROUP BY userID\n),\nunit_answers AS (\n    SELECT userID, answer AS unit_answer\n    FROM table2\n    WHERE question = 'Unit'\n),\ndemo_answers AS (\n    SELECT userID, answer AS demo_answer\n    FROM table2\n    WHERE question = 'Demo'\n)\nSELECT \n    u.userID,\n    ua.unit_answer AS Unit,\n    da.demo_answer AS Demo\nFROM latest_users u\nJOIN latest_answers la ON u.userID = la.userID\nJOIN unit_answers ua ON la.userID = ua.userID AND la.max_unit_counter = ua.counter\nJOIN demo_answers da ON la.userID = da.userID AND la.max_demo_counter = da.counter\nORDER BY u.userID;