WITH RankedRecords AS (\n    SELECT \n        id, \n        Type, \n        Name,\n        ROW_NUMBER() OVER (PARTITION BY Type ORDER BY id) as rn\n    FROM Records\n    WHERE Name LIKE '%Foo%'\n),\nAtLeastOneRecordPerType AS (\n    SELECT id, Type, Name, rn\n    FROM RankedRecords\n    WHERE rn = 1\n),\nRemainingRecords AS (\n    SELECT id, Type, Name, rn\n    FROM RankedRecords\n    WHERE rn > 1\n)\nSELECT id, Type, Name\nFROM AtLeastOneRecordPerType\nUNION ALL\nSELECT id, Type, Name\nFROM RemainingRecords\nORDER BY Type, rn\nOFFSET 0 ROWS FETCH NEXT (100 - (SELECT COUNT(*) FROM AtLeastOneRecordPerType)) ROWS ONLY;