WITH LatestAudit AS (\n    SELECT\n        ID,\n        CustomerID,\n        Name,\n        Address,\n        AuditDateTime,\n        AuditCode,\n        ROW_NUMBER() OVER (PARTITION BY CustomerID ORDER BY AuditDateTime DESC) AS RowNum\n    FROM\n        AuditLog\n    WHERE\n        AuditDateTime BETWEEN '2009-07-17 00:00:00' AND '2009-07-17 23:59:59'\n)\nSELECT\n    ID,\n    CustomerID,\n    Name,\n    Address,\n    AuditDateTime,\n    AuditCode\nFROM\n    LatestAudit\nWHERE\n    RowNum = 1;