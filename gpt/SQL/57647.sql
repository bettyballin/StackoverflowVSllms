SELECT \n    customer_name,\n    MAX(IIF(pivot_id=1, order_date, NULL)) AS order_date1,\n    MAX(IIF(pivot_id=1, price, NULL)) AS price1,\n    MAX(IIF(pivot_id=2, order_date, NULL)) AS order_date2,\n    MAX(IIF(pivot_id=2, price, NULL)) AS price2,\n    MAX(IIF(pivot_id=3, order_date, NULL)) AS order_date3,\n    MAX(IIF(pivot_id=3, price, NULL)) AS price3,\n    MAX(IIF(pivot_id=4, order_date, NULL)) AS order_date4,\n    MAX(IIF(pivot_id=4, price, NULL)) AS price4,\n    MAX(IIF(pivot_id=5, order_date, NULL)) AS order_date5,\n    MAX(IIF(pivot_id=5, price, NULL)) AS price5\nFROM\n    (SELECT \n        (SELECT COUNT(*) \n         FROM Sales AS s2 \n         WHERE s2.customer_name = s1.customer_name \n           AND s2.order_date <= s1.order_date \n        ) AS pivot_id,\n        s1.customer_name,\n        s1.order_date,\n        s1.price\n     FROM Sales AS s1\n     ORDER BY s1.customer_name, s1.order_date) AS SubQuery\nGROUP BY customer_name;