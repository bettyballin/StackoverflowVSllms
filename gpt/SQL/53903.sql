SELECT \n    log1.productId, \n    DATEDIFF('d', log1.firstStatus01Date, log3.statusDate) AS leadtime\nFROM \n    (SELECT productId, MIN(statusDate) AS firstStatus01Date\n     FROM log\n     WHERE status = '01'\n     GROUP BY productId) AS log1\nINNER JOIN \n    (SELECT productId, statusDate\n     FROM log\n     WHERE status = '03') AS log3\nON log1.productId = log3.productId\nORDER BY log1.productId, log3.statusDate;