-- Using derived table to encapsulate common parts\nSELECT columnlist\nFROM (\n    SELECT columnlist, joincond2, joincond3, conditions1\n    FROM table1\n    JOIN table2 ON joincond2\n    JOIN table3 ON joincond3\n    WHERE conditions1\n) AS CommonPart\nWHERE (@param1 IS NULL AND cond3a)\nUNION ALL\nSELECT columnlist\nFROM (\n    SELECT columnlist, joincond2, joincond3, conditions1\n    FROM table1\n    JOIN table2 ON joincond2\n    JOIN table3 ON joincond3\n    WHERE conditions1\n) AS CommonPart\nWHERE cond3b;