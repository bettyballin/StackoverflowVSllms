WITH RankedComments AS (\n    SELECT\n        *,\n        ROW_NUMBER() OVER (PARTITION BY post_id ORDER BY comment_date DESC) as rn\n    FROM\n        replies\n)\nSELECT\n    *\nFROM\n    RankedComments\nWHERE\n    rn <= 3\nORDER BY\n    post_id, rn;