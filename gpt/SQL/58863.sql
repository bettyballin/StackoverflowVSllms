CREATE PROCEDURE GenerateDates\nAS\nBEGIN\n    WITH Dates AS\n    (\n        SELECT CAST('2008-01-01' AS datetime) AS Date\n        UNION ALL\n        SELECT Date + 1\n        FROM Dates  \n        WHERE Date + 1 < DATEADD(yy, 1, GETDATE())\n    )\n    SELECT d.Date, COALESCE(t2.available, t1.available) AS available\n    FROM Dates d\n    LEFT JOIN table2 t2 ON d.Date = t2.date\n    LEFT JOIN table1 t1 ON DATEPART(dw, d.Date) = t1.weekday\n    OPTION (MAXRECURSION 0);\nEND