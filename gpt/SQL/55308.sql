create table #tableA \n(\n    id int IDENTITY(1,1),\n    groupid int,\n    flag bit,\n    CONSTRAINT [PK_TableA] PRIMARY KEY CLUSTERED \n    (\n        [id] ASC\n    )\n)\n\ninsert into #tableA (groupid,flag) values (1,0),(1,0),(1,1),(2,0),(2,1)\n\nselect \n    groupid,\n    cast(sum(flag) over (partition by groupid) as float) / count(*) over (partition by groupid) as ratio\nfrom \n    #tableA\ngroup by \n    groupid, flag\n\ndrop table #tableA