DECLARE @LookupID int\n\n-- Our test value\nSET @LookupID = 1\n\nWITH cteLevelOne (ParentID, CustID, Level) AS\n(\n    SELECT a.ParentID, a.CustID, 1 AS Level\n    FROM tblCustomer AS a\n    WHERE a.CustID = @LookupID\n    UNION ALL\n    SELECT a.ParentID, a.CustID, c.Level + 1\n    FROM tblCustomer AS a\n    INNER JOIN cteLevelOne AS c ON a.CustID = c.ParentID\n    WHERE c.CustID <> a.CustID\n)\nSELECT TOP 1 ParentID, CustID\nFROM cteLevelOne\nORDER BY Level DESC