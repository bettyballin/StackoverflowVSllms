-- Define the timeframe for grouping updates (1 hour in seconds)\nSET @timeframe = 3600;\n\n-- Query to get the feed\nSELECT \n    u.userid,\n    MAX(u.update_time) AS latest_update_time,\n    CASE\n        WHEN u.update_type = 1 THEN 'updated their profile'\n        WHEN u.update_type = 2 THEN CONCAT('uploaded ', COUNT(u.pictureid), ' new photos')\n        WHEN u.update_type = 3 THEN CONCAT('updated their mood! (', m.description, ')')\n    END AS activity_description\nFROM \n    update_log u\nLEFT JOIN \n    mood_lookup m ON u.mood_a = m.mood_id\nWHERE \n    u.update_time >= UNIX_TIMESTAMP(NOW()) - @timeframe\nGROUP BY \n    u.userid,\n    u.update_type,\n    CASE \n        WHEN u.update_type = 3 THEN u.mood_a \n        ELSE NULL \n    END,\n    FLOOR(u.update_time / @timeframe)\nORDER BY \n    latest_update_time DESC;