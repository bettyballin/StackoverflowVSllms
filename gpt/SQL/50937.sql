WITH PresentationGrades AS (\n    SELECT \n        p.id, \n        p.title, \n        p.date, \n        p.visible,\n        (SELECT MAX(grade)\n         FROM tests\n         WHERE userid = 41\n         AND presid = p.id) AS grade\n    FROM presentations p\n)\nSELECT \n    id, \n    title, \n    date, \n    grade\nFROM \n    PresentationGrades\nWHERE \n    visible = 1\n    AND grade >= 5\nORDER BY \n    grade DESC;