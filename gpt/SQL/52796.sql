WITH RankedRecords AS (\n    SELECT \n        VISITORIP, \n        HTTPADDRESS, \n        DATEENTERED,\n        ROW_NUMBER() OVER (PARTITION BY VISITORIP ORDER BY DATEENTERED DESC) AS RowNum\n    FROM \n        STATS\n    WHERE \n        DATEENTERED BETWEEN 'OnlineTime' AND GETDATE()\n)\nSELECT \n    VISITORIP, \n    HTTPADDRESS, \n    DATEENTERED\nFROM \n    RankedRecords\nWHERE \n    RowNum = 1\nORDER BY \n    DATEENTERED DESC;