CREATE PROCEDURE CalculateAndUpdateDiscUsage()\nAS\nBEGIN\n    -- Temporary table to hold intermediate results\n    CREATE TABLE #CustomerUsage (\n        CustomerID INT,\n        NumberOfUsers INT,\n        TotalDiscUsage DECIMAL(18, 2),\n        CalculatedY DECIMAL(18, 2)\n    );\n\n    -- Insert the aggregated data into the temporary table\n    INSERT INTO #CustomerUsage (CustomerID, NumberOfUsers, TotalDiscUsage)\n    SELECT \n        CustomerID,\n        COUNT(UserID) AS NumberOfUsers,\n        SUM(DiscUsageMB) AS TotalDiscUsage\n    FROM \n        UserStorage\n    GROUP BY \n        CustomerID;\n\n    -- Perform the calculations and update the temporary table\n    UPDATE #CustomerUsage\n    SET \n        CalculatedY = (TotalDiscUsage - (NumberOfUsers * 200)) / 50;\n\n    -- Update the original table or another table with the calculated values\n    UPDATE TargetTable\n    SET \n        Y = cu.CalculatedY\n    FROM \n        TargetTable t\n    INNER JOIN \n        #CustomerUsage cu ON t.CustomerID = cu.CustomerID;\n\n    -- Drop the temporary table\n    DROP TABLE #CustomerUsage;\nEND;