SELECT\n    customer.id,\n    customer.name,\n    SUM(combined.num_orders) AS total_num_orders,\n    SUM(combined.total_money) AS total_money\nFROM\n    customer\n    LEFT JOIN (\n        SELECT\n            p_orders.id_customer AS id_customer,\n            COUNT(DISTINCT p_orders.id) AS num_orders,\n            SUM(p_items.price) AS total_money\n        FROM\n            p_orders\n            INNER JOIN p_items ON p_items.id_order = p_orders.id\n        GROUP BY\n            p_orders.id_customer\n\n        UNION ALL\n\n        SELECT\n            h_orders.id_customer AS id_customer,\n            COUNT(DISTINCT h_orders.id) AS num_orders,\n            SUM(h_items.price) AS total_money\n        FROM\n            h_orders\n            INNER JOIN h_items ON h_items.id_order = h_orders.id\n        GROUP BY\n            h_orders.id_customer\n    ) AS combined ON combined.id_customer = customer.id\nGROUP BY\n    customer.id,\n    customer.name\nORDER BY\n    customer.id ASC;