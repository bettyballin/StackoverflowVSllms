DECLARE @xml xml\nSELECT @xml = XmlCol FROM Data\n\n;WITH PersonCTE AS (\n    SELECT\n        Persons.PersonCollection.value('(personid)[1]', 'NVARCHAR(50)') AS PersonId,\n        Persons.PersonCollection.value('(firstname)[1]', 'NVARCHAR(50)') AS FirstName,\n        Persons.PersonCollection.value('(lastname)[1]', 'NVARCHAR(50)') AS LastName,\n        EnterTimes.EnterTime.value('.', 'NVARCHAR(50)') AS EnterTime,\n        LeaveTimes.LeaveTime.value('.', 'NVARCHAR(50)') AS LeaveTime\n    FROM @xml.nodes('root/person') AS Persons(PersonCollection)\n    OUTER APPLY Persons.PersonCollection.nodes('entertime') AS EnterTimes(EnterTime)\n    OUTER APPLY Persons.PersonCollection.nodes('leavetime') AS LeaveTimes(LeaveTime)\n)\nSELECT \n    PersonId,\n    FirstName,\n    LastName,\n    EnterTime,\n    LeaveTime\nFROM PersonCTE\nORDER BY PersonId, EnterTime