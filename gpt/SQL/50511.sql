SELECT xmlelement(name "SalesOrders",\n    xmlagg(\n        xmlelement(name "SalesOrder",\n            xmlattributes(so.id AS "Id", so.Code AS "Code"),\n            xmlelement(name "Customer",\n                xmlattributes(cu.Code AS "Code", cu.Name AS "Name")\n            ),\n            xmlagg(\n                xmlelement(name "SalesItem",\n                    xmlattributes(si.Item_Num AS "Item", pa.Code AS "PartCode")\n                )\n            )\n        )\n    )\n) AS result\nFROM tblSalesOrder so\nJOIN tblCustomer cu ON so.customer_id = cu.ID\nLEFT JOIN tblSalesItem si ON si.SalesOrder_ID = so.Id\nLEFT JOIN tblPart pa ON pa.Id = si.Part_Id\nGROUP BY so.id, so.Code, cu.Code, cu.Name;