SELECT \n    i.name AS ispname, \n    i.img_link, \n    c.download, \n    c.upload, \n    c.monthly_price, \n    c.link,\n    GROUP_CONCAT(a.name) AS addons, \n    SUM(pa.monthly_fee) AS addon_price\nFROM \n    isp i \nJOIN \n    product p ON i.id = p.isp_id\nJOIN \n    connection c ON p.id = c.product_id \nLEFT JOIN \n    product_addon pa ON pa.product_id = p.id AND pa.forced = 0\nLEFT JOIN \n    addon a ON pa.addon_id = a.id \nWHERE \n    p.id IN (\n        SELECT pa2.product_id\n        FROM product_addon pa2\n        WHERE pa2.addon_id IN (1, 14, 237)\n        GROUP BY pa2.product_id\n        HAVING COUNT(DISTINCT pa2.addon_id) = 3 -- number of add-ons to match\n    )\nGROUP BY \n    c.id;