SELECT \n    t1.number,\n    (t1.index + t2.index) AS index\nFROM \n    (SELECT \n         number, type, serial, index,\n         (SELECT COUNT(*) \n          FROM table1 AS x \n          WHERE x.number = t.number \n          AND x.type = t.type \n          AND x.serial = t.serial \n          AND x.index <= t.index) AS row_num\n     FROM table1 AS t) AS t1\nINNER JOIN \n    (SELECT \n         number, type, serial, index,\n         (SELECT COUNT(*) \n          FROM table2 AS y \n          WHERE y.number = s.number \n          AND y.type = s.type \n          AND y.serial = s.serial \n          AND y.index <= s.index) AS row_num\n     FROM table2 AS s) AS t2\nON \n    t1.row_num = t2.row_num\nORDER BY \n    t1.row_num;