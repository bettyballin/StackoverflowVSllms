-- Step 1: Create temporary tables to hold mapping of old and new IDs\nCREATE TABLE #CustomerMap (OldCustID INT, NewCustID INT);\nCREATE TABLE #InvoiceMap (OldInvoiceNum INT, NewInvoiceNum INT);\n\n-- Step 2: Copy the Customer and capture the new custID\nINSERT INTO dbo.Customer (name)\nOUTPUT inserted.custID INTO #CustomerMap (NewCustID)\nSELECT name\nFROM dbo.Customer\nWHERE custID = @OldCustID;  -- Replace @OldCustID with the ID of the customer to copy\n\n-- Step 3: Copy the Invoice and capture the new invoiceNum\nINSERT INTO dbo.Invoice (custID, Description)\nOUTPUT inserted.invoiceNum, inserted.custID INTO #InvoiceMap (NewInvoiceNum, OldInvoiceNum)\nSELECT \n    (SELECT NewCustID FROM #CustomerMap WHERE OldCustID = i.custID), \n    Description\nFROM dbo.Invoice i\nWHERE i.custID = @OldCustID;  -- Replace @OldCustID with the ID of the customer to copy\n\n-- Step 4: Copy the InvoiceDetail using the new invoiceNum\nINSERT INTO dbo.InvoiceDetail (invoiceNum, sequence, description, price)\nSELECT \n    im.NewInvoiceNum, \n    id.sequence, \n    id.description, \n    id.price\nFROM dbo.InvoiceDetail id\nJOIN #InvoiceMap im ON id.invoiceNum = im.OldInvoiceNum;\n\n-- Clean up temporary tables\nDROP TABLE #CustomerMap;\nDROP TABLE #InvoiceMap;