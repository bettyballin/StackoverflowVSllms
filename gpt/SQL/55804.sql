WITH state_durations AS (\n    SELECT\n        name,\n        state,\n        LEAD(time, 1, '10:15 AM') OVER (PARTITION BY name ORDER BY time) AS next_time\n    FROM\n        your_table\n    WHERE\n        time BETWEEN '10:00 AM' AND '10:15 AM'\n),\ndurations AS (\n    SELECT\n        name,\n        state,\n        ROUND((EXTEND(next_time, YEAR TO FRACTION) - EXTEND(time, YEAR TO FRACTION))::INTERVAL SECOND TO FRACTION(5) / 60, 2) AS duration_in_minutes\n    FROM\n        state_durations\n)\nSELECT\n    name,\n    state,\n    CASE\n        WHEN duration_in_minutes = 1 THEN '1 Minute'\n        ELSE TRIM(TO_CHAR(duration_in_minutes, '999')) || ' Minutes'\n    END AS Duration\nFROM\n    durations\nWHERE\n    duration_in_minutes > 0\nORDER BY\n    name, state;