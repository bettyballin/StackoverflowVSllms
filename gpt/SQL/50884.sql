WITH possible_periods AS (\n    SELECT\n        generate_series(@start_range_start, @start_range_end, '1 day'::interval) AS possible_start,\n        generate_series(@start_range_start, @start_range_end, '1 day'::interval) + @duration * interval '1 day' AS possible_end\n)\nSELECT * FROM possible_periods p\nWHERE NOT EXISTS (\n    SELECT 1\n    FROM periods\n    WHERE NOT (p.possible_start > periods.range_end OR p.possible_end < periods.range_start)\n);