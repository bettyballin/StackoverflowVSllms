SELECT a.code, a.ad_id, a.position, a.type, a.image, a.url, a.height, a.width\nFROM " . AD_TABLE ." a\nJOIN " . USER_GROUP_TABLE . " g ON FIND_IN_SET(g.group_id, a.groups)\nWHERE (a.max_views >= a.views OR a.max_views = '0')\n  AND (FIND_IN_SET(" .$forum_id. ", a.show_forums) > 0 OR a.show_all_forums = '1')\n  AND g.user_id = " . $user->data['user_id'] . "\n  AND FIND_IN_SET(" . $user->data['user_rank'] . ", a.ranks)\n  AND a.start_time < " . time() . "\n  AND a.end_time > " . time() . "\n  AND (a.clicks <= a.max_clicks OR a.max_clicks = '0')