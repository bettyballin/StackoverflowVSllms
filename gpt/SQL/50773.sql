CREATE OR REPLACE FUNCTION Clob_Concat_Connect_By(deptno IN NUMBER)\n  RETURN CLOB IS\n  v_clob CLOB := EMPTY_CLOB();\n  v_buffer VARCHAR2(32000);\n  CURSOR emp_cursor IS\n    SELECT ename \n    FROM (\n      SELECT ename, ROW_NUMBER() OVER (ORDER BY empno) rn \n      FROM wd_emp \n      WHERE deptno = deptno\n    )\n    ORDER BY rn;\nBEGIN\n  FOR emp_rec IN emp_cursor LOOP\n    v_buffer := v_buffer || ',' || emp_rec.ename;\n    IF LENGTH(v_buffer) > 32000 THEN\n      v_clob := v_clob || TO_CLOB(v_buffer);\n      v_buffer := NULL;\n    END IF;\n  END LOOP;\n  v_clob := v_clob || TO_CLOB(v_buffer);\n  RETURN SUBSTR(v_clob, 2);\nEND Clob_Concat_Connect_By;\n/