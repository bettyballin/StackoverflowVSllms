WITH sample_data AS (\n    SELECT sample_id, created_on\n    FROM sample\n    WHERE sam_tmpl_id = 18\n),\ntest_status AS (\n    SELECT sample_id,\n           MAX(CASE WHEN tst_tmpl_id = 36 THEN status END) AS s_acid,\n           MAX(CASE WHEN tst_tmpl_id = 43 THEN status END) AS s_ph,\n           MAX(CASE WHEN tst_tmpl_id = 66 THEN status END) AS s_titr\n    FROM test\n    JOIN sample_data\n    USING (sample_id)\n    GROUP BY sample_id\n)\nSELECT sd.sample_id,\n       sd.created_on,\n       ts.s_acid,\n       ts.s_ph,\n       ts.s_titr\nFROM sample_data sd\nJOIN test_status ts\nUSING (sample_id);