-- SQL Code Begin\ncreate table #t1 (key1 int, key2 int);\ncreate table #t2 (row_id int identity(101, 1), key1 int);\n\ninsert into #t1\nselect 1, 11 union select 1, 12 union select 1, 13 union select 1, 14 union \nselect 2, 13 union select 2, 15 union select 2, 16 union select 2, 17 union \nselect 3, 13 union select 3, 12 union select 3, 16 union select 3, 17;\n\ninsert into #t2 (key1)\nselect 1 union select 2 union select 3;\n\nwith A as (\n    select key2 from #t1 where key1 = 1\n),\nB as (\n    select key2 from #t1 where key1 = 2\n),\nC as (\n    select key2 from #t1 where key1 = 3\n),\nA_only as (\n    select key2 from A \n    where key2 not in (select key2 from B)\n    and key2 not in (select key2 from C)\n),\nB_only as (\n    select key2 from B \n    where key2 not in (select key2 from A)\n    and key2 not in (select key2 from C)\n),\nC_only as (\n    select key2 from C \n    where key2 not in (select key2 from A)\n    and key2 not in (select key2 from B)\n),\nAB as (\n    select key2 from A \n    where key2 in (select key2 from B)\n    and key2 not in (select key2 from C)\n),\nAC as (\n    select key2 from A \n    where key2 in (select key2 from C)\n    and key2 not in (select key2 from B)\n),\nBC as (\n    select key2 from B \n    where key2 in (select key2 from C)\n    and key2 not in (select key2 from A)\n),\nABC as (\n    select key2 from A \n    where key2 in (select key2 from B)\n    and key2 in (select key2 from C)\n)\n\nselect 1001 as row_id, key2, 'A' as segment from A_only\nunion\nselect 1002 as row_id, key2, 'B' as segment from B_only\nunion\nselect 1003 as row_id, key2, 'C' as segment from C_only\nunion\nselect 1004 as row_id, key2, 'A I B' as segment from AB\nunion\nselect 1005 as row_id, key2, 'A I C' as segment from AC\nunion\nselect 1006 as row_id, key2, 'B I C' as segment from BC\nunion\nselect 1007 as row_id, key2, 'A I B I C' as segment from ABC\norder by row_id, key2;\n-- SQL Code End