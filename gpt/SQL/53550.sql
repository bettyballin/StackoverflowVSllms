WITH CTE AS (\n    SELECT \n        ProdID,\n        IssueID,\n        PublishDate,\n        ProdName,\n        ROW_NUMBER() OVER (PARTITION BY ProdID, DATEPART(dw, PublishDate) ORDER BY PublishDate DESC) AS rn\n    FROM Issue\n    JOIN Product ON Issue.ProdID = Product.ProdID\n)\nSELECT \n    CTE1.ProdName,\n    CTE1.PublishDate AS CurrentIssue,\n    CTE2.PublishDate AS PreviousIssue\nFROM \n    CTE AS CTE1\nLEFT JOIN \n    CTE AS CTE2 \nON \n    CTE1.ProdID = CTE2.ProdID \n    AND DATEPART(dw, CTE1.PublishDate) = DATEPART(dw, CTE2.PublishDate) \n    AND CTE1.rn = CTE2.rn + 1\nWHERE \n    CTE1.PublishDate = '2008-12-31'\nORDER BY \n    CTE1.ProdName;