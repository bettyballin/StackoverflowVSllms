CREATE OR REPLACE PACKAGE web_service_util AS\n  FUNCTION build_soap_envelope(namespace VARCHAR2, method_name VARCHAR2, parameters VARCHAR2) RETURN CLOB;\n  FUNCTION call_web_service(endpoint VARCHAR2, soap_action VARCHAR2, soap_envelope CLOB) RETURN CLOB;\nEND web_service_util;\n/\n\nCREATE OR REPLACE PACKAGE BODY web_service_util AS\n  FUNCTION build_soap_envelope(namespace VARCHAR2, method_name VARCHAR2, parameters VARCHAR2) RETURN CLOB IS\n    l_soap_envelope CLOB;\n  BEGIN\n    l_soap_envelope := '<?xml version="1.0" encoding="UTF-8"?>' ||\n                       '<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" ' ||\n                       'xmlns:ns="' || namespace || '">' ||\n                       '<soapenv:Header/>' ||\n                       '<soapenv:Body>' ||\n                       '<ns:' || method_name || '>' ||\n                       parameters ||\n                       '</ns:' || method_name || '>' ||\n                       '</soapenv:Body>' ||\n                       '</soapenv:Envelope>';\n    RETURN l_soap_envelope;\n  END build_soap_envelope;\n\n  FUNCTION call_web_service(endpoint VARCHAR2, soap_action VARCHAR2, soap_envelope CLOB) RETURN CLOB IS\n    l_http_request  UTL_HTTP.req;\n    l_http_response UTL_HTTP.resp;\n    l_response_text CLOB;\n  BEGIN\n    l_http_request := UTL_HTTP.begin_request(endpoint, 'POST', 'HTTP/1.1');\n    UTL_HTTP.set_header(l_http_request, 'Content-Type', 'text/xml;charset=UTF-8');\n    UTL_HTTP.set_header(l_http_request, 'SOAPAction', soap_action);\n    UTL_HTTP.write_text(l_http_request, soap_envelope);\n\n    l_http_response := UTL_HTTP.get_response(l_http_request);\n    UTL_HTTP.read_text(l_http_response, l_response_text);\n    UTL_HTTP.end_response(l_http_response);\n\n    RETURN l_response_text;\n  EXCEPTION\n    WHEN OTHERS THEN\n      UTL_HTTP.end_response(l_http_response);\n      RAISE;\n  END call_web_service;\nEND web_service_util;\n/