CREATE PROCEDURE CompareAllTables\n    @database1 NVARCHAR(128),\n    @database2 NVARCHAR(128)\nAS\nBEGIN\n    DECLARE @tableName NVARCHAR(128);\n    DECLARE @columns NVARCHAR(MAX);\n    DECLARE @sql NVARCHAR(MAX);\n\n    -- Cursor to iterate through all tables in the first database\n    DECLARE table_cursor CURSOR FOR\n    SELECT TABLE_NAME\n    FROM INFORMATION_SCHEMA.TABLES\n    WHERE TABLE_TYPE = 'BASE TABLE' AND TABLE_CATALOG = @database1;\n\n    OPEN table_cursor;\n    FETCH NEXT FROM table_cursor INTO @tableName;\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        -- Retrieve column names for the current table\n        SELECT @columns = STRING_AGG(COLUMN_NAME, ', ')\n        FROM INFORMATION_SCHEMA.COLUMNS\n        WHERE TABLE_CATALOG = @database1 AND TABLE_NAME = @tableName;\n\n        -- Construct and execute the symmetric difference query\n        SET @sql = '\n            SELECT ''' + @tableName + ''' AS TableName, * FROM (\n                SELECT ' + @columns + ' FROM ' + @database1 + '.dbo.' + @tableName + '\n                EXCEPT\n                SELECT ' + @columns + ' FROM ' + @database2 + '.dbo.' + @tableName + '\n                UNION\n                SELECT ' + @columns + ' FROM ' + @database2 + '.dbo.' + @tableName + '\n                EXCEPT\n                SELECT ' + @columns + ' FROM ' + @database1 + '.dbo.' + @tableName + '\n            ) AS SymmetricDifference\n        ';\n\n        EXEC sp_executesql @sql;\n\n        FETCH NEXT FROM table_cursor INTO @tableName;\n    END;\n\n    CLOSE table_cursor;\n    DEALLOCATE table_cursor;\nEND\nGO