#include <stdio.h>\n#include <stdlib.h>\n\ntypedef volatile int spinlock_t;\n\nvoid spinlock_init(spinlock_t *lock) {\n    *lock = 0;\n}\n\nvoid spinlock_lock(spinlock_t *lock) {\n    while (__sync_lock_test_and_set(lock, 1)) {\n        while (*lock) {\n            // Busy wait\n        }\n    }\n}\n\nvoid spinlock_unlock(spinlock_t *lock) {\n    __sync_lock_release(lock);\n}\n\nvoid critical_section() {\n    // Code for critical section\n}\n\nint main() {\n    spinlock_t lock;\n    spinlock_init(&lock);\n\n    spinlock_lock(&lock);\n    critical_section();\n    spinlock_unlock(&lock);\n\n    return 0;\n}