#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>  // for read\n\nvoid receive_file(int socket, char *save_to, int file_size) {\n    FILE *handle = fopen(save_to, "wb");\n    if (handle != NULL) {\n        int SIZE = 1024;\n        char buffer[SIZE];\n        memset(buffer, 0, SIZE);\n        int read_so_far = 0;\n        int read_now = 0;\n        int reading_unit = (file_size < SIZE) ? file_size : SIZE;\n\n        while (read_so_far < file_size) {\n            read_now = read(socket, buffer, reading_unit);\n            if (read_now <= 0) {\n                // Handle read error or end of file\n                break;\n            }\n            fwrite(buffer, 1, read_now, handle);\n            read_so_far += read_now;\n            memset(buffer, 0, SIZE);\n        }\n\n        fclose(handle);\n    } else {\n        extern int errno;\n        printf("Error creating file. Error code: %d\n", errno);\n        exit(-1);\n    }\n}