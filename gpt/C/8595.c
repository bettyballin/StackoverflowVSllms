#include <ApplicationServices/ApplicationServices.h>\n\nvoid createJPEGWithQuality(CGImageRef image, CFURLRef url, float quality) {\n    // Create the image destination\n    CGImageDestinationRef destination = CGImageDestinationCreateWithURL(url, kUTTypeJPEG, 1, NULL);\n    if (!destination) {\n        fprintf(stderr, "Failed to create image destination\n");\n        return;\n    }\n\n    // Set the options for the image destination\n    CFMutableDictionaryRef options = CFDictionaryCreateMutable(NULL, 0, &kCFTypeDictionaryKeyCallBacks, &kCFTypeDictionaryValueCallBacks);\n    if (!options) {\n        fprintf(stderr, "Failed to create options dictionary\n");\n        CFRelease(destination);\n        return;\n    }\n\n    // Set the compression quality\n    CFNumberRef qualityNum = CFNumberCreate(NULL, kCFNumberFloatType, &quality);\n    if (qualityNum) {\n        CFDictionarySetValue(options, kCGImageDestinationLossyCompressionQuality, qualityNum);\n        CFRelease(qualityNum);\n    }\n\n    // Add the image to the destination\n    CGImageDestinationAddImage(destination, image, options);\n    CFRelease(options);\n\n    // Finalize the destination\n    if (!CGImageDestinationFinalize(destination)) {\n        fprintf(stderr, "Failed to finalize image destination\n");\n    }\n\n    // Clean up\n    CFRelease(destination);\n}\n\n// Example usage\nint main() {\n    // Assume we have a valid CGImageRef 'image' and CFURLRef 'url'\n    CGImageRef image = ...; // Your image reference here\n    CFURLRef url = ...; // Your file URL here\n\n    float quality = 0.8f; // Compression quality (0.0 to 1.0)\n    createJPEGWithQuality(image, url, quality);\n\n    return 0;\n}