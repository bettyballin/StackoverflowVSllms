#include <stdint.h>\n#include <stdbool.h>\n\n// Function prototypes\nuint16_t generate_pseudo_random_id(uint16_t seed);\nbool is_id_used(uint16_t id);\nuint16_t get_next_unique_id(void);\n\n// Global variable to keep track of the last used identifier\nstatic uint16_t last_used_id = 0;\n\nuint16_t generate_pseudo_random_id(uint16_t seed) {\n    // Simple pseudo-random number generator (e.g., linear congruential generator)\n    return (seed * 1103515245 + 12345) & 0xFFFF;\n}\n\nbool is_id_used(uint16_t id) {\n    // Implement the logic to check if the ID is already used in the external Flash\n    // This will involve SPI transactions and scanning through the Flash\n    // Return true if the ID is used, false otherwise\n    // Dummy implementation for illustration:\n    return false; // Replace with actual check\n}\n\nuint16_t get_next_unique_id(void) {\n    uint16_t seed = last_used_id;\n    uint16_t new_id;\n\n    // First try with pseudo-random numbers\n    for (int i = 0; i < 100; ++i) { // Limit the number of attempts to avoid infinite loops\n        new_id = generate_pseudo_random_id(seed);\n        if (!is_id_used(new_id)) {\n            last_used_id = new_id;\n            return new_id;\n        }\n        seed = new_id; // Update seed for the next iteration\n    }\n\n    // Fallback to sequential incrementing\n    new_id = last_used_id;\n    do {\n        new_id++;\n        if (new_id == 0xFFFF) new_id = 1; // Wrap around if necessary\n    } while (is_id_used(new_id));\n\n    last_used_id = new_id;\n    return new_id;\n}