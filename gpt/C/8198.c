if (data.size > 0) {\n    data.data = (unsigned char*)malloc(data.size);\n    if (data.data == NULL) {\n        // Handle memory allocation failure\n        perror("malloc");\n        exit(EXIT_FAILURE);\n    }\n    memset(data.data, 0, data.size);\n\n    int remainingSize = data.size;\n    unsigned char *iter = data.data;\n    int count = 0;\n\n    while (remainingSize > 0) {\n        count = read(connect_fd, iter, remainingSize);\n        if (count < 0) {\n            // Handle read error\n            perror("read");\n            free(data.data);\n            data.data = NULL;\n            exit(EXIT_FAILURE);\n        } else if (count == 0) {\n            // Handle EOF\n            break;\n        }\n\n        iter += count;\n        remainingSize -= count;\n    }\n\n    if (remainingSize > 0) {\n        // Handle incomplete read\n        fprintf(stderr, "Incomplete read, expected %u bytes but got %u bytes\n", data.size, data.size - remainingSize);\n        free(data.data);\n        data.data = NULL;\n        exit(EXIT_FAILURE);\n    }\n} else {\n    data.data = NULL;\n}