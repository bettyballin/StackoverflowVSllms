from django.db.models import Count\n\n# Filter persons who have more than one home\npersons = Person.objects.annotate(home_count=Count('homes')).filter(home_count__gt=1)\n\n# Prefetch homes and rooms to minimize database queries\npersons = persons.prefetch_related('homes__rooms')\n\nfor person in persons:\n    homes = [home for home in person.homes.all() if home.rooms.count() > 1]\n    if homes:\n        print(f"{person.name} has the following homes with more than one room:")\n        for home in homes:\n            print(f"  Home at {home.address} with rooms:")\n            for room in home.rooms.all():\n                print(f"    {room.name}")