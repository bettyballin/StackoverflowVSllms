import os\nimport platform\n\nif platform.system() == "Windows":\n    import msvcrt\n    def open_file_exclusive(path, mode):\n        file = open(path, mode)\n        try:\n            if "w" in mode:\n                msvcrt.locking(file.fileno(), msvcrt.LK_NBLCK, 1)  # Exclusive lock for writing\n            else:\n                msvcrt.locking(file.fileno(), msvcrt.LK_NBRLCK, 1)  # Shared lock for reading\n        except IOError:\n            file.close()\n            raise IOError("File is already locked")\n        return file\nelse:\n    import fcntl\n    def open_file_exclusive(path, mode):\n        fd = os.open(path, os.O_RDWR if "w" in mode else os.O_RDONLY)\n        try:\n            if "w" in mode:\n                fcntl.flock(fd, fcntl.LOCK_EX | fcntl.LOCK_NB)  # Exclusive lock for writing\n            else:\n                fcntl.flock(fd, fcntl.LOCK_SH | fcntl.LOCK_NB)  # Shared lock for reading\n        except IOError:\n            os.close(fd)\n            raise IOError("File is already locked")\n        return os.fdopen(fd, mode)\n\n# Usage example\ntry:\n    file = open_file_exclusive("c:\\scr.txt", "r")\n    # Perform file operations\nfinally:\n    file.close()