# middleware.py\nimport threading\n\n_thread_locals = threading.local()\n\ndef get_current_request():\n    return getattr(_thread_locals, 'request', None)\n\nclass ThreadLocalMiddleware:\n    def __init__(self, get_response):\n        self.get_response = get_response\n\n    def __call__(self, request):\n        _thread_locals.request = request\n        response = self.get_response(request)\n        return response