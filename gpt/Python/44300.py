from django.shortcuts import get_object_or_404\n   from django.http import JsonResponse\n\n   def add_to_favorites(request, product_id):\n       product = get_object_or_404(Product, id=product_id)\n       \n       if request.user.is_authenticated:\n           Favorite.objects.create(user=request.user, product=product)\n       else:\n           session_key = request.session.session_key\n           if not session_key:\n               request.session.create()\n               session_key = request.session.session_key\n           Favorite.objects.create(session_key=session_key, product=product)\n       \n       return JsonResponse({'status': 'success'})