from bs4 import BeautifulSoup\nimport re\n\ndef trim_html(html, length):\n    def get_text_length(tag):\n        return len(re.sub(r'\s+', ' ', tag.get_text()))\n\n    soup = BeautifulSoup(html, 'html.parser')\n    text_length = 0\n\n    for element in soup.recursiveChildGenerator():\n        if isinstance(element, str):\n            text_length += len(element)\n            if text_length > length:\n                element.replace_with(element[:length - (text_length - len(element))] + '...')\n                break\n        elif element.name:\n            element_length = get_text_length(element)\n            if text_length + element_length > length:\n                remaining_length = length - text_length\n                for child in element.children:\n                    if isinstance(child, str):\n                        if len(child) > remaining_length:\n                            child.replace_with(child[:remaining_length] + '...')\n                            break\n                        remaining_length -= len(child)\n                    else:\n                        child_length = get_text_length(child)\n                        if child_length > remaining_length:\n                            trim_html(str(child), remaining_length)\n                            break\n                        remaining_length -= child_length\n                break\n            text_length += element_length\n\n    return str(soup)\n\nhtml_content = """<p>This problem is a challenging one. Our application allows users to post news on the homepage. That news is input via a rich text editor which allows HTML. On the homepage we want to only display a truncated summary of the news item.</p>\n<blockquote>\n  <p>For example, here is the full text we are displaying, including HTML</p>  \n  <p><br/>\n  In an attempt to make a bit more space in the office, kitchen, I've pulled out all of the random mugs and put them onto the lunch room table. <strong>Unless you feel strongly about the ownership of that Cheyenne Courier mug from 1992 or perhaps that BC Tel Advanced Communications mug from 1997, they will be put in a box and donated to an office in more need of mugs than us.</strong>\n  <br/></p>\n</blockquote>"""\n\ntrimmed_html = trim_html(html_content, 250)\nprint(trimmed_html)