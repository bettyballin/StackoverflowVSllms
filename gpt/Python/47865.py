import imaplib\nimport email\nimport requests\n\nIMAP_SERVER = 'imap.example.com'\nIMAP_PORT = 993\nEMAIL_ACCOUNT = 'your-email@example.com'\nEMAIL_PASSWORD = 'your-password'\nURL_ENDPOINT = 'https://your-endpoint.com/process-email'\n\ndef post_email_to_endpoint(mail_content):\n    response = requests.post(URL_ENDPOINT, data={'email_content': mail_content})\n    if response.status_code == 200:\n        print("Successfully posted email content to endpoint.")\n    else:\n        print("Failed to post email content to endpoint:", response.status_code, response.text)\n\ndef process_new_mail(mail):\n    for num in mail[0].split():\n        typ, data = mail.fetch(num, '(RFC822)')\n        raw_email = data[0][1]\n        msg = email.message_from_bytes(raw_email)\n        \n        if msg.is_multipart():\n            for part in msg.walk():\n                if part.get_content_type() == 'text/plain':\n                    email_content = part.get_payload(decode=True).decode('utf-8')\n                    post_email_to_endpoint(email_content)\n        else:\n            email_content = msg.get_payload(decode=True).decode('utf-8')\n            post_email_to_endpoint(email_content)\n\ndef idle():\n    mail = imaplib.IMAP4_SSL(IMAP_SERVER, IMAP_PORT)\n    mail.login(EMAIL_ACCOUNT, EMAIL_PASSWORD)\n    mail.select('inbox')\n\n    while True:\n        mail.idle()\n        response = mail.idle_check(timeout=60)\n        if response[0]:\n            mail.idle_done()\n            typ, mail_ids = mail.search(None, 'UNSEEN')\n            if mail_ids[0]:\n                process_new_mail(mail)\n            mail.idle()\n\ntry:\n    idle()\nexcept Exception as e:\n    print("An error occurred:", e)