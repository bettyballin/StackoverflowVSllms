from datetime import datetime\n    from sqlalchemy import update\n\n    def soft_delete_user(session: Session, user_id: int, user: str, ip: str):\n        session.execute(\n            update(User).\n            where(User.id == user_id).\n            values(is_deleted=True)\n        )\n        session.commit()\n\n        # Log to audit table\n        session.execute(\n            "INSERT INTO audit_log (table_name, record_id, field_name, old_value, new_value, changed_at, changed_by, ip_address) "\n            "VALUES ('users', :record_id, 'is_deleted', 'False', 'True', :changed_at, :changed_by, :ip_address)",\n            {\n                'record_id': user_id,\n                'changed_at': datetime.utcnow(),\n                'changed_by': user,\n                'ip_address': ip\n            }\n        )\n        session.commit()