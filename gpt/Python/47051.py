import redis\nimport json\nimport time\nfrom datetime import datetime\nimport smtplib\nfrom email.mime.text import MIMEText\n\n# Connect to Redis\nr = redis.Redis()\n\ndef send_email(email_details):\n    msg = MIMEText(email_details["body"])\n    msg["Subject"] = email_details["subject"]\n    msg["From"] = "your-email@example.com"\n    msg["To"] = email_details["to"]\n\n    with smtplib.SMTP("smtp.gmail.com", 587) as server:\n        server.starttls()\n        server.login("your-email@example.com", "your-email-password")\n        server.sendmail("your-email@example.com", [email_details["to"]], msg.as_string())\n\ndef process_emails():\n    while True:\n        task_json = r.lpop("email_queue")\n        if task_json:\n            task = json.loads(task_json)\n            scheduled_time = datetime.fromisoformat(task["scheduled_time"])\n            now = datetime.now()\n            \n            # If the scheduled time is in the past or now, send the email\n            if scheduled_time <= now:\n                send_email(task["email_details"])\n            else:\n                # Re-enqueue the task if it's not yet time\n                r.rpush("email_queue", task_json)\n        time.sleep(60)  # Sleep for a minute before checking the queue again\n\nif __name__ == "__main__":\n    process_emails()