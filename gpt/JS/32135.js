(function() {\n    var providers = new Array();\n    providers['tinyurl.com'] = function(link, fragment) {\n        link.title = "Loading...";\n        GM_xmlhttpRequest({\n            method: 'GET',\n            url: 'http://preview.tinyurl.com/' + fragment,\n            onload: function(res) {\n                var re = res.responseText.match(/<blockquote><b>(.+)<\/b><\/blockquote>/);\n                if (re) {\n                    link.title = re[1].replace(/\<br \/\>/g, "").replace(/&amp;/g, "&");\n                } else {\n                    link.title = "Parsing failed...";\n                }\n            },\n            onerror: function() {\n                link.title = "Connection failed...";\n            }\n        });\n    };\n\n    var uriPattern = /(tinyurl\.com)\/([a-zA-Z0-9]+)/;\n    var aTags = document.getElementsByTagName("a");\n\n    for (var i = 0; i < aTags.length; i++) {\n        (function(link) {\n            var data = link.href.match(uriPattern);\n            if (data != null && data.length > 1 && data[2] != "preview") {\n                var source = data[1];\n                var fragment = data[2];\n                link.addEventListener("mouseover", function() {\n                    if (link.title == "") {\n                        providers[source](link, fragment);\n                    }\n                }, false);\n            }\n        })(aTags[i]);\n    }\n})();