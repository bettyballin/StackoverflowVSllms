(function($) {\n    $.fn.blowfish = function() {\n        // hide original ul dom tree\n        $(this).hide();\n\n        // create container from top-level li tags\n        var top = $(this).children('li');\n        var container = $('<div>').addClass('bfcontainer').attr('id', 'cv' + Math.floor(Math.random() * 10e10)).insertAfter(this);\n        var topdiv = $('<div>').appendTo(container);\n\n        $.each(top, function(i, item) {\n            var topitem = $(':eq(0)', item).clone().data('sub', $(item).children('ul')).appendTo(topdiv);\n\n            if ($(topitem).data('sub').length) {\n                $(topitem).addClass('hasChildMenu');\n\n                // Check for specific browser with feature detection instead of $.browser\n                if (navigator.userAgent.indexOf('Safari') != -1 && navigator.userAgent.indexOf('Chrome') == -1) {\n                    $(topitem).css({ 'margin-right': '15px' });\n                }\n            }\n        });\n\n        // event handlers\n        container.on('click', 'a', function() {\n            var container = $(this).parents('.bfcontainer');\n\n            // click handler\n            var level = $('div', container).index($(this).parents('div'));\n\n            // remove blocks to the right in the tree, and 'deactivate' other links within the same level\n            $('div:gt(' + level + ')', container).remove();\n            $('div:eq(' + level + ') a', container).removeClass('active').removeClass('inpath');\n            $('.active', container).addClass('inpath');\n            $(this).addClass('active');\n\n            if ($(this).data('sub').children('li').length) {\n                // add submenu if container has children\n                submenu(container, this);\n            } else {\n                // show title or link if container has no children\n                var title = $('<a>').attr({ href: $(this).attr('href') }).text($(this).attr('title') ? $(this).attr('title') : $(this).text());\n                var featurebox = $('<div>').html(title).addClass('feature').appendTo(container);\n\n                // set width\n                var remainingspace = 0;\n\n                $.each($(container).children('div').slice(0, -1), function(i, item) {\n                    remainingspace += $(item).width();\n                });\n\n                var fillwidth = $(container).width() - remainingspace;\n\n                $(featurebox).css({ 'top': 0, 'left': remainingspace }).width(fillwidth).show('slow');\n            }\n\n            return false;\n        });\n    };\n})(jQuery);