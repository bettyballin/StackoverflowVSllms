function getSelectedText() {\n    let selectedText = "";\n\n    function getTextFromWindow(win) {\n        let text = "";\n        if (win.getSelection) {\n            text = win.getSelection().toString();\n        } else if (win.document.selection && win.document.selection.type != "Control") {\n            text = win.document.selection.createRange().text;\n        }\n        return text;\n    }\n\n    function iterateFrames(win) {\n        let text = getTextFromWindow(win);\n        if (text) {\n            selectedText += text + "\n";\n        }\n\n        for (let i = 0; i < win.frames.length; i++) {\n            try {\n                // Check if we can access the frame\n                if (win.frames[i].document) {\n                    iterateFrames(win.frames[i]);\n                }\n            } catch (e) {\n                console.error("Cannot access frame: ", e);\n            }\n        }\n    }\n\n    // Get selected text from the main document\n    selectedText += getTextFromWindow(window);\n\n    // Iterate over all frames in the main document\n    iterateFrames(window);\n\n    return selectedText.trim();\n}\n\n// Example usage\nlet selectedText = getSelectedText();\nconsole.log("Selected text: ", selectedText);