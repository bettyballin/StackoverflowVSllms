document.addEventListener("DOMContentLoaded", function() {\n    var contentEditableElement = document.getElementById("editor");\n\n    contentEditableElement.addEventListener("keypress", function(event) {\n        if (event.key === '"' || event.key === "'") {\n            event.preventDefault();\n            var selection = window.getSelection();\n            var range = selection.getRangeAt(0);\n            var textNode = range.startContainer;\n            var offset = range.startOffset;\n            var text = textNode.nodeValue;\n\n            var isOpening = (event.key === '"' && (offset === 0 || text[offset - 1] === ' ')) ||\n                            (event.key === "'" && (offset === 0 || text[offset - 1] === ' '));\n\n            var replacementChar = event.key === '"' ? (isOpening ? '“' : '”') :\n                                  event.key === "'" ? (isOpening ? '‘' : '’') : event.key;\n\n            textNode.nodeValue = text.slice(0, offset) + replacementChar + text.slice(offset);\n            range.setStart(textNode, offset + 1);\n            range.setEnd(textNode, offset + 1);\n            selection.removeAllRanges();\n            selection.addRange(range);\n\n            // Add a custom undo state\n            document.execCommand('insertText', false, '');\n        }\n    });\n\n    contentEditableElement.addEventListener("keydown", function(event) {\n        if (event.ctrlKey && event.key === 'z') {\n            event.preventDefault();\n            document.execCommand('undo');\n        }\n    });\n});