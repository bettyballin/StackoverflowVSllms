// ==UserScript==\n// @name         Limited GM_xmlhttpRequest Interface\n// @namespace    http://tampermonkey.net/\n// @version      0.1\n// @description  Provide a safe interface to GM_xmlhttpRequest\n// @include      http://yourwebsite.com/*\n// @grant        GM_xmlhttpRequest\n// @grant        unsafeWindow\n// ==/UserScript==\n\n(function() {\n    'use strict';\n\n    // Listen for messages from the page context\n    window.addEventListener('message', function(event) {\n        if (event.source !== window) return;\n        if (event.data.type && event.data.type === 'GM_xmlhttpRequest') {\n            const requestDetails = event.data.details;\n            GM_xmlhttpRequest({\n                method: requestDetails.method,\n                url: requestDetails.url,\n                headers: requestDetails.headers,\n                onload: function(response) {\n                    window.postMessage({\n                        type: 'GM_xmlhttpRequestResponse',\n                        response: {\n                            status: response.status,\n                            statusText: response.statusText,\n                            responseText: response.responseText\n                        }\n                    }, '*');\n                }\n            });\n        }\n    });\n\n    // Inject code into the page context\n    var script = document.createElement('script');\n    script.type = 'application/javascript';\n    script.textContent = `(${function() {\n        window.foo = function() {\n            window.postMessage({\n                type: 'GM_xmlhttpRequest',\n                details: {\n                    method: "GET",\n                    url: "http://www.example.net/",\n                    headers: {\n                        "User-Agent": navigator.userAgent,\n                        "Accept": "text/html"\n                    }\n                }\n            }, '*');\n        };\n\n        // Listen for the response and handle it\n        window.addEventListener('message', function(event) {\n            if (event.source !== window) return;\n            if (event.data.type && event.data.type === 'GM_xmlhttpRequestResponse') {\n                const response = event.data.response;\n                console.log(response);\n                alert(`Status: ${response.status}\nResponse: ${response.responseText}`);\n            }\n        });\n    }})();`;\n    document.body.appendChild(script);\n})();