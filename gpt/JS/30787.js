function fitStringToSize(str, len) {\n    var shortStr = str;\n    var f = document.createElement("span");\n    f.style.visibility = 'hidden'; // Use visibility instead of display to avoid reflow issues\n    f.style.padding = '0px';\n    document.body.appendChild(f);\n\n    // Check if string fits within the length initially\n    f.textContent = str;\n    var diff = f.offsetWidth - len;\n\n    // If the string is too long, shorten it\n    while (diff > 0) {\n        var newLength = shortStr.length - Math.ceil(diff / 5);\n        shortStr = str.substring(0, Math.max(newLength, 0)) + 'â€¦';\n        f.textContent = shortStr;\n        diff = f.offsetWidth - len;\n    }\n\n    document.body.removeChild(f);\n\n    // If the string was shortened, use an abbr element with a title attribute\n    if (shortStr.length < str.length) {\n        return '<abbr title="' + encodeHTML(str) + '">' + encodeHTML(shortStr) + '</abbr>';\n    } else {\n        return encodeHTML(str);\n    }\n}\n\n// Function to encode HTML entities to prevent XSS\nfunction encodeHTML(s) {\n    return s.replace(/&/g, '&amp;')\n            .replace(/</g, '&lt;')\n            .replace(/>/g, '&gt;')\n            .replace(/"/g, '&quot;')\n            .replace(/'/g, '&#39;');\n}