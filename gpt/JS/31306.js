var maxConcurrentRequests = 2;\nvar requestQueue = [];\nvar activeRequests = 0;\n\nfunction sendRequest(url) {\n  if (activeRequests < maxConcurrentRequests) {\n    activeRequests++;\n    var xhr = createXMLHttpRequest();\n    xhr.open('GET', url);\n    xhr.onreadystatechange = function() {\n      if (xhr.readyState === 4) {\n        activeRequests--;\n        if (requestQueue.length > 0) {\n          var nextRequest = requestQueue.shift();\n          sendRequest(nextRequest);\n        }\n      }\n    };\n    xhr.send('');\n  } else {\n    requestQueue.push(url);\n  }\n}\n\nfunction createXMLHttpRequest() {\n  if (window.XMLHttpRequest) {\n    return new XMLHttpRequest();\n  } else if (window.ActiveXObject) {\n    return new ActiveXObject("Msxml2.XMLHTTP");\n  }\n}\n\nfor (var i = 0; i < 5; ++i) {\n  sendRequest('/Test/LongOperation?p=' + new Date());\n}