'If the same data exists for the same patient in a record less than 21 days old then drop it\nDim RecordLookup As Integer = 0\nRecordLookup = (From rc In CDEvodb.RISKCHANGEs _\n                Where rc.NHI = tmpNHI And _\n                      rc.RECDATE > Date.Now.AddDays(-21) And _\n                      rc.BPSYS = Convert.ToDecimal(Drow.Item("BPSYS")) And _\n                      rc.CHOL = Convert.ToDecimal(Drow.Item("CHOL")) And _\n                      rc.HDL = Convert.ToDecimal(Drow.Item("HDL"))).Count()\n\nIf (RecordLookup = 0) Then\n    Dim riskchange As New RISKCHANGE\n    riskchange.NHI = Drow.Item("NHI")\n    riskchange.RECDATE = Date.Now.Date()\n    riskchange.RISK = CalculatedRisk\n    riskchange.BPSYS = Drow.Item("BPSYS")\n    riskchange.CHOL = Drow.Item("CHOL")\n    riskchange.HDL = Drow.Item("HDL")\n    \n    ' Do not set the IDENTITY field, let the database handle it\n\n    Try\n        CDEvodb.RISKCHANGEs.InsertOnSubmit(riskchange)\n        CDEvodb.SubmitChanges()\n    Catch ex As Exception\n        myLogging.OutputError("<" & DateTime.Now.ToString & "> " & "Error - creating risk change record in dataset for patient " & Drow.Item("NHI").ToString() & " - " & ex.Message)\n    End Try\nEnd If