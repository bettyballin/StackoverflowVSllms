Public Shared Function Save(ByRef appointment As MyLinq.Appointment, ByRef db As MyEntities) As Boolean\n    If appointment.id = 0 Then\n        db.AddToAppointments(appointment)\n    Else\n        ' Ensure entity is attached and mark it as modified\n        If Not db.Appointments.Local.Any(Function(a) a.id = appointment.id) Then\n            db.Appointments.Attach(appointment)\n        End If\n        db.Entry(appointment).State = EntityState.Modified\n    End If\n\n    Return db.SaveChanges() > 0\nEnd Functio