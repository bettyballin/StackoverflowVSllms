Imports System.Text.RegularExpressions\n\nPublic Class RtfCleaner\n    Public Function CleanRtf(inputRtf As String) As String\n        ' Define regular expressions to match and preserve \ul, \b, \i tags\n        Dim preserveTags As String = "(\\ul|\\ulnone|\\b|\\b0|\\i|\\i0)"\n        \n        ' Remove any RTF header and font/color tables\n        Dim cleanedRtf As String = Regex.Replace(inputRtf, "{\\rtf1[^}]*}", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "{\\fonttbl[^}]*}", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "{\\colortbl[^}]*}", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\viewkind4\\uc1\\pard", String.Empty)\n        \n        ' Remove any RTF formatting tags that are not in the preserve list\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\[^\\s]*", Function(m) If(Regex.IsMatch(m.Value, preserveTags), m.Value, String.Empty))\n        \n        ' Remove any remaining RTF braces and other unnecessary characters\n        cleanedRtf = Regex.Replace(cleanedRtf, "[{}]", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\par", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\highlight\\d+", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\lang\\d+", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\f\\d+", String.Empty)\n        cleanedRtf = Regex.Replace(cleanedRtf, "\\\\fs\\d+", String.Empty)\n        \n        Return cleanedRtf.Trim()\n    End Function\nEnd Class