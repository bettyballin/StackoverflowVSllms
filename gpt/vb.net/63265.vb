Dim tfs As TeamFoundationServer = TeamFoundationServerFactory.GetServer(txtServer.Text)\n\n' Get a reference to Source Control.\nDim versionControl As VersionControlServer = CType(tfs.GetService(GetType(VersionControlServer)), VersionControlServer)\n\n' Create a workspace.\nDim workspace As Workspace = versionControl.GetWorkspace(txtProject.Text)\n\nIf Not String.IsNullOrEmpty(txtUpdateScript.Text) Then\n    Dim fooString = Array.Find(Of WorkingFolder)(workspace.Folders, Function(m) m.ServerItem.Contains("$/FOO.NET"))\n    Directory.CreateDirectory(IO.Path.Combine(IO.Path.Combine(txtProject.Text, "FOOAdmin\Updates"), txtVersion.Text))\n    Directory.CreateDirectory(fooString.ServerItem & "/FOOAdmin/Updates/" & txtVersion.Text)\n    IO.File.Copy(txtUpdateScript.Text, IO.Path.Combine(IO.Path.Combine(IO.Path.Combine(txtProject.Text, "FOOAdmin\Updates"), txtVersion.Text), "Update.sql"), True)\n    workspace.PendAdd(IO.Path.Combine(IO.Path.Combine(txtProject.Text, "FOOAdmin\Updates"), txtVersion.Text))\n    workspace.PendAdd(IO.Path.Combine(IO.Path.Combine(IO.Path.Combine(txtProject.Text, "FOOAdmin\Updates"), txtVersion.Text), "Update.sql"))\nEnd If\n\n' Get Pending changes\nDim pendingChanges As PendingChange() = workspace.GetPendingChanges()\n\n' Checkin the items we added.\nDim changesetNumber As Integer = workspace.CheckIn(pendingChanges, "FOO.Net AutoBuild")\n\n' Refresh the project to show the new files\nDim dte As EnvDTE.DTE = CType(Microsoft.VisualStudio.Shell.Package.GetGlobalService(GetType(EnvDTE.DTE)), EnvDTE.DTE)\nFor Each proj As EnvDTE.Project In dte.Solution.Projects\n    If proj.FullName = txtProject.Text Then\n        proj.ProjectItems.AddFromFile(IO.Path.Combine(IO.Path.Combine(txtProject.Text, "FOOAdmin\Updates"), txtVersion.Text, "Update.sql"))\n        Exit For\n    End If\nNext