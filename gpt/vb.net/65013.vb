Dim nInvValue As Decimal\nDim nCreditValue As Decimal\n\nFor Each oReferenceItem In oMatchInvoices\n    Dim nUnallocated As Decimal = oReferenceItem.DocumentOutstandingValue - oReferenceItem.DocumentAllocatedValue\n    If ((nUnallocated <> 0) And (sReferenceValue = oReferenceItem.InstrumentNo)) Then\n        iCount = iCount + 1\n        If (oReferenceItem.IsDebit) And (nUnallocated > 0) Then\n            nInvValue = nInvValue + nUnallocated\n            InvoiceList.Add(nUnallocated.ToString("C2"), oReferenceItem.URN.ToString)\n        End If\n        If (oReferenceItem.IsCredit) And (nUnallocated < 0) Then\n            nCreditValue = nCreditValue - nUnallocated\n            CreditList.Add(nUnallocated.ToString("C2"), oReferenceItem.URN.ToString)\n        End If\n    End If\nNext