# Define variables\n$siteName = "Default Web Site" # Change this to your site name\n$virtualDirName = "MyVirtualDirectory"\n$networkSharePath = "\\servername\sharename\directory"\n$authUsername = "domain\username"\n$authPassword = "password"\n\n# Get the IIS WMI object\n$iis = Get-WmiObject -Namespace "root\MicrosoftIISv2" -Class "IIsWebVirtualDirSetting"\n\n# Get the specific site object\n$site = $iis | Where-Object { $_.Name -eq "W3SVC/1/Root" } # Adjust "1" to your site's identifier\n\n# Create the virtual directory\n$virtualDir = ([WmiClass]"\\.\root\MicrosoftIISv2:IIsWebVirtualDir").CreateInstance()\n$virtualDir.Name = "W3SVC/1/Root/$virtualDirName" # Adjust "1" to your site's identifier\n$virtualDir.Path = $networkSharePath\n$virtualDir.AccessFlags = 513 # Read and Script access\n$virtualDir.AuthFlags = 1 # Basic authentication\n\n# Set the credentials for the virtual directory\n$virtualDir.AppFriendlyName = $virtualDirName\n$virtualDir.AppIsolated = 2\n$virtualDir.AppRoot = "LM/W3SVC/1/Root/$virtualDirName" # Adjust "1" to your site's identifier\n$virtualDir.AppPoolId = "DefaultAppPool" # Change if necessary\n\n# Commit the changes\n$virtualDir.Put()\n\n# Set the authentication user\n$virtualDirApp = ([WmiClass]"\\.\root\MicrosoftIISv2:IIsWebVirtualDirSetting").CreateInstance()\n$virtualDirApp.Name = "W3SVC/1/Root/$virtualDirName" # Adjust "1" to your site's identifier\n$virtualDirApp.Path = $networkSharePath\n$virtualDirApp.AccessFlags = 513\n$virtualDirApp.AuthFlags = 1\n$virtualDirApp.AppFriendlyName = $virtualDirName\n$virtualDirApp.AppIsolated = 2\n$virtualDirApp.AppRoot = "LM/W3SVC/1/Root/$virtualDirName" # Adjust "1" to your site's identifier\n$virtualDirApp.AppPoolId = "DefaultAppPool" # Change if necessary\n$virtualDirApp.Put()\n\n# Set the user credentials\n$wmiObject = Get-WmiObject -Namespace "root\MicrosoftIISv2" -Query "SELECT * FROM IIsWebVirtualDirSetting WHERE Name='W3SVC/1/Root/$virtualDirName'"\n$wmiObject.AuthFlags = 4 # Integrated Windows authentication\n$wmiObject.AuthUserName = $authUsername\n$wmiObject.AuthPassword = $authPassword\n$wmiObject.Put()\n\nWrite-Output "Virtual directory created successfully."