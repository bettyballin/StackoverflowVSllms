#include <comdef.h>\n#include <atlbase.h>\n\nHRESULT ReportError(LPCTSTR errorMessage, REFIID riid, HRESULT hr)\n{\n    CComPtr<ICreateErrorInfo> spCreateErrorInfo;\n    if (SUCCEEDED(CreateErrorInfo(&spCreateErrorInfo)))\n    {\n        spCreateErrorInfo->SetGUID(riid);\n        spCreateErrorInfo->SetDescription(CComBSTR(errorMessage));\n        CComPtr<IErrorInfo> spErrorInfo;\n        if (SUCCEEDED(spCreateErrorInfo->QueryInterface(IID_IErrorInfo, (void**)&spErrorInfo)))\n        {\n            SetErrorInfo(0, spErrorInfo);\n        }\n    }\n    return hr;\n}\n\n// Usage in your method\nreturn ReportError(_T("Not connected"), __uuidof(IMyInterface), HRESULT_FROM_WIN32(ERROR_CONNECTION_INVALID));