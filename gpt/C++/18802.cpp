void CServiceModule::SetServiceStatus(DWORD dwState)\n{\n    m_status.dwCurrentState = dwState;\n    ::SetServiceStatus(m_hServiceStatus, &m_status);\n}\n\nvoid CServiceModule::Run()\n{\n    // Initialize the service, setup message loop, etc.\n    \n    // Main message loop:\n    MSG msg;\n    while (GetMessage(&msg, nullptr, 0, 0))\n    {\n        TranslateMessage(&msg);\n        DispatchMessage(&msg);\n    }\n\n    // Cleanup code here\n    \n    SetServiceStatus(SERVICE_STOPPED);\n}\n\nvoid CServiceModule::Stop()\n{\n    SetServiceStatus(SERVICE_STOP_PENDING);\n\n    // Signal the message loop to exit\n    ::PostThreadMessage(dwThreadID, WM_QUIT, 0, 0);\n}