#if defined(__GNUC__) && !defined(__NO_THREADSAFE_STATICS__)\n     // Compiler is GCC and supports thread-safe statics\n     void foo() {\n       static Bar b;\n       // use b\n     }\n     #else\n     // Fallback for other compilers or if thread-safe statics are disabled\n     pthread_mutex_t mutex = PTHREAD_MUTEX_INITIALIZER;\n     void foo() {\n       static Bar b;\n       pthread_mutex_lock(&mutex);\n       static bool initialized = false;\n       if (!initialized) {\n         // initialize b\n         initialized = true;\n       }\n       pthread_mutex_unlock(&mutex);\n       // use b\n     }\n     #endif