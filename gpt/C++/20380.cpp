#include <Exdisp.h>   // For IWebBrowser2\n#include <Exdispid.h> // For DISPID_NAVIGATECOMPLETE2\n#include <AtlBase.h>\n#include <AtlCom.h>\n\n// Assuming you already have a pointer to the IWebBrowser2 interface\nCComPtr<IWebBrowser2> spWebBrowser2;\n\n// Function to get the current URL\nCString GetCurrentPageURL(IWebBrowser2* pWebBrowser2)\n{\n    if (!pWebBrowser2) return _T("");\n\n    BSTR bstrURL;\n    HRESULT hr = pWebBrowser2->get_LocationURL(&bstrURL);\n    if (FAILED(hr)) return _T("");\n\n    CString strURL(bstrURL);\n    SysFreeString(bstrURL);\n    return strURL;\n}\n\n// Example usage\nCString currentURL = GetCurrentPageURL(spWebBrowser2);\nAfxMessageBox(currentURL);