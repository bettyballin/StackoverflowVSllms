IMSMQMessagePtr pMessage(__uuidof(MSMQMessage));\nIAnalisisPtr pAnalisis(__uuidof(Analisis));\n\nWCHAR *imagen = L"imagen1.jpg";\npAnalisis->setImgName(imagen);\n\n// Set other properties\npAnalisis->setFruitSize(20.00);\n\n// Serialize the object to a stream\nCComPtr<IStream> pStream;\nCreateStreamOnHGlobal(NULL, TRUE, &pStream);\npAnalisis->Save(pStream, TRUE);\n\n// Get the HGLOBAL handle\nHGLOBAL hGlobal;\nGetHGlobalFromStream(pStream, &hGlobal);\n\n// Lock the global memory to get a pointer\nvoid* pData = GlobalLock(hGlobal);\n\n// Set the message body\npMessage->put_Body(pData);\n\n// Unlock the global memory\nGlobalUnlock(hGlobal);\n\n// Send the message\npMessage->Send(pQueue);