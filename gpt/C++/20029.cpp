STDMETHODIMP CAnalisis::Save(IStream *pStm, BOOL fClearDirty)\n{\n    HRESULT hr;\n    ULONG written;\n\n    // Serialize the DOUBLE, float, etc.\n    hr = pStm->Write(&img.size, sizeof(DOUBLE), &written);\n    if (FAILED(hr)) return hr;\n\n    hr = pStm->Write(&img.color, sizeof(float), &written);\n    if (FAILED(hr)) return hr;\n\n    hr = pStm->Write(&img.light, sizeof(float), &written);\n    if (FAILED(hr)) return hr;\n\n    // Serialize BSTR imgName\n    ULONG len = SysStringByteLen(img.imgName);\n    hr = pStm->Write(&len, sizeof(ULONG), &written);\n    if (FAILED(hr)) return hr;\n    hr = pStm->Write(img.imgName, len, &written);\n    if (FAILED(hr)) return hr;\n\n    // Serialize BSTR uname\n    len = SysStringByteLen(img.uname);\n    hr = pStm->Write(&len, sizeof(ULONG), &written);\n    if (FAILED(hr)) return hr;\n    hr = pStm->Write(img.uname, len, &written);\n    if (FAILED(hr)) return hr;\n\n    return S_OK;\n}