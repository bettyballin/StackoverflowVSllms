#include <Windows.h>\n#include <GdiPlus.h>\n#pragma comment (lib,"Gdiplus.lib")\n\nULONG_PTR gdiplusToken;\nGdiplus::GdiplusStartupInput gdiplusStartupInput;\nGdiplus::GdiplusStartup(&gdiplusToken, &gdiplusStartupInput, NULL);\n\nGdiplus::Bitmap bitmap(hBackBitmap, NULL);\nCLSID clsid;\nGetEncoderClsid(L"image/jpeg", &clsid);\n\nHGLOBAL hGlobal = GlobalAlloc(GMEM_MOVEABLE, 0); // Moveable memory\nif(!hGlobal)\n    return;\n\nIStream* pStream = NULL;\nif(CreateStreamOnHGlobal(hGlobal, TRUE, &pStream) != S_OK)\n    return;\n\nbitmap.Save(pStream, &clsid);\n\n// Get the size of the stream\nSTATSTG statstg;\nif (pStream->Stat(&statstg, STATFLAG_NONAME) != S_OK)\n    return;\nULONG jpegSize = statstg.cbSize.LowPart; // Size of the JPEG in bytes\n\n// Access the data in the stream\nHGLOBAL hMem = NULL;\nif (GetHGlobalFromStream(pStream, &hMem) != S_OK)\n    return;\nVOID* pData = GlobalLock(hMem);\nif (pData == NULL)\n    return;\n\n// At this point, pData points to the JPEG data and jpegSize contains the size of this data\n\n// Use pData and jpegSize as needed\n\n// Clean up\nGlobalUnlock(hMem);\npStream->Release();\nGlobalFree(hGlobal);\n\nGdiplus::GdiplusShutdown(gdiplusToken);