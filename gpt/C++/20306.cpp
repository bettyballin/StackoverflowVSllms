#include <atlbase.h>\n#include <atlcom.h>\n#include <mshtml.h>\n#include <exdisp.h>\n\nbool IsIEContainer(IOleClientSite* pClientSite)\n{\n    if (!pClientSite)\n        return false;\n\n    CComPtr<IOleContainer> spContainer;\n    CComPtr<IServiceProvider> spServiceProvider;\n    CComPtr<IWebBrowser2> spWebBrowser2;\n    CComQIPtr<IHTMLDocument2> spHtmlDoc;\n\n    // Traverse the container hierarchy\n    while (pClientSite)\n    {\n        // Get the container\n        if (FAILED(pClientSite->GetContainer(&spContainer)))\n            return false;\n\n        // Query for IServiceProvider\n        spServiceProvider = spContainer;\n        if (spServiceProvider)\n        {\n            // Query for IWebBrowser2\n            if (SUCCEEDED(spServiceProvider->QueryService(SID_SWebBrowserApp, IID_IWebBrowser2, (void**)&spWebBrowser2)) && spWebBrowser2)\n            {\n                // Query for IHTMLDocument2\n                if (SUCCEEDED(spWebBrowser2->get_Document((IDispatch**)&spHtmlDoc)) && spHtmlDoc)\n                {\n                    // The container is Internet Explorer\n                    return true;\n                }\n            }\n        }\n\n        // Get the parent client site\n        CComQIPtr<IOleObject> spOleObject = spContainer;\n        if (spOleObject && SUCCEEDED(spOleObject->GetClientSite(&pClientSite)))\n        {\n            spContainer.Release();\n            spServiceProvider.Release();\n            spWebBrowser2.Release();\n            spHtmlDoc.Release();\n        }\n        else\n        {\n            break;\n        }\n    }\n\n    // No IE container found\n    return false;\n}