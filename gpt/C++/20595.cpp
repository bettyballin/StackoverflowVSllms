#include <windows.h>\n#include <rapi.h>\n\nHANDLE hEvent;\nHRESULT hr;\n\n// Callback function for CeRapiInitEx\nDWORD WINAPI RapiInitCallback(LPVOID lpParam) {\n    // Wait for the device to connect\n    hr = CeRapiInit();\n    SetEvent(hEvent);\n    return 0;\n}\n\n// Dialog procedure\nBOOL CALLBACK DialogProc(HWND hwndDlg, UINT message, WPARAM wParam, LPARAM lParam) {\n    switch (message) {\n        case WM_INITDIALOG:\n            // Initialize the connection in a separate thread\n            hEvent = CreateEvent(NULL, TRUE, FALSE, NULL);\n            CreateThread(NULL, 0, RapiInitCallback, NULL, 0, NULL);\n            return TRUE;\n        case WM_COMMAND:\n            if (LOWORD(wParam) == IDCANCEL) {\n                // Cancel button clicked\n                CeRapiUninit();\n                EndDialog(hwndDlg, 0);\n                return TRUE;\n            }\n            break;\n    }\n    return FALSE;\n}\n\n// Main function\nint WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPSTR lpCmdLine, int nCmdShow) {\n    // Create and display the dialog\n    DialogBox(hInstance, MAKEINTRESOURCE(IDD_DIALOG_CONNECT), NULL, DialogProc);\n\n    // Wait for the connection to complete or be cancelled\n    WaitForSingleObject(hEvent, INFINITE);\n\n    // Connection result\n    if (SUCCEEDED(hr)) {\n        MessageBox(NULL, "Device connected successfully.", "Success", MB_OK);\n    } else {\n        MessageBox(NULL, "Failed to connect to device.", "Error", MB_OK);\n    }\n\n    // Clean up\n    CloseHandle(hEvent);\n    return 0;\n}