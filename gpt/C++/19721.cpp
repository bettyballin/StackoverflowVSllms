void SaveDatasetToCSV(const String &filename, TClientDataSet *dataset) {\n    TStringList *csvData = new TStringList();\n\n    TStringList *row = new TStringList();\n    row->Delimiter = ',';\n\n    for (int i = 0; i < dataset->FieldDefs->Count; i++) {\n        row->Add(dataset->FieldDefs->Items[i]->Name);\n    }\n    csvData->Add(row->DelimitedText);\n\n    dataset->First();\n    while (!dataset->Eof) {\n        row->Clear();\n        for (int i = 0; i < dataset->FieldDefs->Count; i++) {\n            row->Add(dataset->Fields->Fields[i]->AsString);\n        }\n        csvData->Add(row->DelimitedText);\n        dataset->Next();\n    }\n\n    csvData->SaveToFile(filename);\n\n    delete row;\n    delete csvData;\n}