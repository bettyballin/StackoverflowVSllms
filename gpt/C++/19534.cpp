#include <comdef.h>\n#include <atlbase.h>\n#include <atlcom.h>\n\nSTDMETHODIMP CMyClass::GetArrayOfStrings(SAFEARRAY **rgBstrStringArray)\n{\n    if (rgBstrStringArray == nullptr)\n        return E_POINTER;\n\n    // Define an array of strings\n    const wchar_t* strings[] = { L"String1", L"String2", L"String3" };\n    int count = sizeof(strings) / sizeof(strings[0]);\n\n    // Create a SafeArray\n    SAFEARRAYBOUND sabound;\n    sabound.lLbound = 0;\n    sabound.cElements = count;\n\n    SAFEARRAY* psa = SafeArrayCreate(VT_BSTR, 1, &sabound);\n    if (!psa)\n        return E_OUTOFMEMORY;\n\n    // Populate the SafeArray\n    for (long i = 0; i < count; ++i)\n    {\n        BSTR bstr = SysAllocString(strings[i]);\n        if (!bstr)\n        {\n            SafeArrayDestroy(psa);\n            return E_OUTOFMEMORY;\n        }\n        HRESULT hr = SafeArrayPutElement(psa, &i, bstr);\n        SysFreeString(bstr);\n        if (FAILED(hr))\n        {\n            SafeArrayDestroy(psa);\n            return hr;\n        }\n    }\n\n    *rgBstrStringArray = psa;\n    return S_OK;\n}