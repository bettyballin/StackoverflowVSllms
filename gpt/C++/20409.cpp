// utils.cpp\n#include "utils.h"\n#include <iostream>\n\nhttp::http() {\n    // Initialize WinHTTP session\n    hSession = WinHttpOpen(L"WinHTTP Example/1.0", \n                           WINHTTP_ACCESS_TYPE_DEFAULT_PROXY,\n                           WINHTTP_NO_PROXY_NAME, \n                           WINHTTP_NO_PROXY_BYPASS, 0);\n}\n\nhttp::~http() {\n    // Clean up WinHTTP handles\n    if (hRequest) WinHttpCloseHandle(hRequest);\n    if (hConnect) WinHttpCloseHandle(hConnect);\n    if (hSession) WinHttpCloseHandle(hSession);\n}\n\nstd::string http::getText() {\n    std::string result;\n    if (hSession) {\n        hConnect = WinHttpConnect(hSession, L"www.microsoft.com", INTERNET_DEFAULT_HTTPS_PORT, 0);\n        if (hConnect) {\n            hRequest = WinHttpOpenRequest(hConnect, L"GET", NULL, NULL, WINHTTP_NO_REFERER, WINHTTP_DEFAULT_ACCEPT_TYPES, WINHTTP_FLAG_SECURE);\n            if (hRequest) {\n                BOOL bResults = WinHttpSendRequest(hRequest, WINHTTP_NO_ADDITIONAL_HEADERS, 0, WINHTTP_NO_REQUEST_DATA, 0, 0, 0);\n                if (bResults) bResults = WinHttpReceiveResponse(hRequest, NULL);\n                if (bResults) {\n                    DWORD dwSize = 0;\n                    DWORD dwDownloaded = 0;\n                    LPSTR pszOutBuffer;\n                    do {\n                        dwSize = 0;\n                        if (!WinHttpQueryDataAvailable(hRequest, &dwSize)) {\n                            printf("Error %u in WinHttpQueryDataAvailable.\n", GetLastError());\n                        } else if (dwSize > 0) {\n                            pszOutBuffer = new char[dwSize + 1];\n                            if (pszOutBuffer) {\n                                ZeroMemory(pszOutBuffer, dwSize + 1);\n                                if (WinHttpReadData(hRequest, (LPVOID)pszOutBuffer, dwSize, &dwDownloaded)) {\n                                    result.append(pszOutBuffer, dwDownloaded);\n                                }\n                                delete[] pszOutBuffer;\n                            }\n                        }\n                    } while (dwSize > 0);\n                }\n            }\n        }\n    }\n    return result;\n}