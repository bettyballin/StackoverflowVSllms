rate = 5.0; // unit: messages\nper  = 8.0; // unit: seconds\nallowance = rate; // unit: messages\nlast_check = now(); // floating-point, e.g. usec accuracy. Unit: seconds\n\nwhen (message_received):\n  current = now();\n  time_passed = current - last_check;\n  last_check = current;\n  allowance += time_passed * (rate / per);\n  if (allowance > rate):\n    allowance = rate; // throttle\n  if (allowance < 1.0):\n    discard_message();\n  else:\n    forward_message();\n    allowance -= 1.0;