from threading import local\n\n_thread_locals = local()\ndef get_current_user():\n    return getattr(getattr(_thread_locals, 'user', None),'id',None)\n\nclass ThreadLocals(object):\n    """Middleware that gets various objects from the\n    request object and saves them in thread local storage."""\n    def process_request(self, request):\n        _thread_locals.user = getattr(request, 'user', None)