(function($){\n\n    var history;\n\n    function getHistory() {\n        var tmp = $.cookie("history");\n        if (tmp===undefined || tmp===null) tmp = "";\n        if ($.trim(tmp)=="") tmp = [];\n        else tmp = tmp.split("||");\n        history = [];\n        $.each(tmp, function(){\n            var split = this.split("|");\n            history.push({\n                title: split[0],\n                url: split[1]\n            });\n        });\n    }\n\n    function saveHistory() {\n        var tmp = [];\n        $.each(history, function(){\n            tmp.push(this.title+"|"+this.url);\n        });\n        $.cookie("history",tmp.join("||"),{ expires: 60, path: "/" });\n    }\n\n    function addToHistory(title,url) {\n        var newHistory = []\n        $.each(history, function(){\n            if (this.url!=url) newHistory.push(this);\n        });\n        history = newHistory;\n        if (history.length>=10) {\n            history.shift();\n        }\n        history.push({\n            title: title,\n            url: url\n        });\n        saveHistory();\n        writeHistory();\n    }\n\n    function writeHistory() {\n        var list = $("<ul />");\n        $.each(history, function() {\n            var element = $("<li />");\n            var link = $("<a />");\n            link.attr("href",this.url);\n            link.text(this.title);\n            element.append(link);\n            list.append(element);\n        });\n        $("#history").empty().append(list);\n    }\n\n    $(document).ready(function(){\n        getHistory();\n        var url = document.location.href;\n        var split = url.split("#");\n        var title;\n        if (split.length > 1) {\n            title = $("#"+split[1]).text();\n        } else {\n            title = document.title;\n        }\n        if (title===undefined || title===null || $.trim(title)=="") title = url;\n        addToHistory(title,url);\n        url = split[0];\n        $("a[href^='#']").click(function(){\n            var link = $(this);\n            var href = link.attr("href");\n            var linkUrl = url+href;\n            var title = $(href).text();\n            if (title===undefined || title===null || $.trim(title)==="") title = linkUrl;\n            addToHistory(title,linkUrl);\n        });\n    });\n\n})(jQuery);