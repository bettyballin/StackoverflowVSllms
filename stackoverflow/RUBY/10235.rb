def access_control (code, options={})\n  options = {:allow => [], :disallow => []}.merge(options)\n\n  options[:allow].each do |user|\n    it "#{code} should allow #{user.to_s}" do\n      login_as(user)\n      eval code\n      response.should_not redirect_to(login_path)\n    end\n  end\n\n  options[:disallow].each do |user|\n    it "#{code} should disallow #{user.to_s}" do\n      login_as(user)\n      eval code\n      response.should redirect_to(login_path)\n    end\n  end\nend