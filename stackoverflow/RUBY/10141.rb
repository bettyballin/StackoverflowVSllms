keep = []\nlocations = Location.find(:all)\n\nlocations.each do |loc|\n  # get all Locations's with the same coords as this one\n  same_coords = locations.select { |l| l.lat == loc.lat and \\n                                       l.lng == loc.lng }\n  with_urls = same_coords.select { |l| !l.url.empty? }\n\n  # decide which list to use depending if there were any urls\n  same_coords = with_urls.any? ? with_urls : same_coords\n\n  # pick the best one\n  keep << same_coords.sort { |a,b| b.created_at <=> a.created_at }.first.id\nend\n\n# only keep unique ids\nkeep.uniq!\n\n# now we just delete all the rows we didn't decide to keep\nlocations.each do |loc|\n  loc.destroy unless keep.include?( loc.id )\nend