\nImports System.Runtime.InteropServices\n\nPublic Module modShell\n\n    <StructLayout(LayoutKind.Sequential)> _\n    Public Structure STARTUPINFO\n        Public cb As Integer\n        Public lpReserved As String\n        Public lpDesktop As String\n        Public lpTitle As String\n        Public dwX As Integer\n        Public dwY As Integer\n        Public dwXSize As Integer\n        Public dwYSize As Integer\n        Public dwXCountChars As Integer\n        Public dwYCountChars As Integer\n        Public dwFillAttribute As Integer\n        Public dwFlags As Integer\n        Public wShowWindow As Short\n        Public cbReserved2 As Short\n        Public lpReserved2 As Integer\n        Public hStdInput As Integer\n        Public hStdOutput As Integer\n        Public hStdError As Integer\n    End Structure\n\n    <StructLayout(LayoutKind.Sequential)> _\n    Public Structure PROCESS_INFORMATION\n        Public hProcess As IntPtr\n        Public hThread As IntPtr\n        Public dwProcessId As Integer\n        Public dwThreadId As Integer\n    End Structure\n\n    Public Declare Unicode Function CreateProcessWithLogonW Lib "Advapi32" (ByVal lpUsername As String, ByVal lpDomain As String, ByVal lpPassword As String, ByVal dwLogonFlags As Int32, ByVal lpApplicationName As String, ByVal lpCommandLine As String, ByVal dwCreationFlags As Int32, ByVal lpEnvironment As IntPtr, ByVal lpCurrentDirectory As String, ByRef si As STARTUPINFO, ByRef pi As PROCESS_INFORMATION) As Integer\n    Public Declare Function CloseHandle Lib "kernel32" (ByVal hObject As IntPtr) As Integer\n\n    Public Const LOGON_WITH_PROFILE As Int32 = &H1\n\n    Public Const NORMAL_PRIORITY_CLASS As Int32 = &H20&\n\n    Public Const STARTF_USESHOWWINDOW As Int32 = &H1\n    Public Const SW_HIDE As Int16 = 0\n    Public Const SW_SHOW As Int16 = 5\n\n    Public Function Shell(ByVal strCmdLine As String, ByVal strCurrentDirectory As String) As Boolean\n\n        Dim pi As PROCESS_INFORMATION\n        Dim si As New STARTUPINFO\n\n        si.cb = Marshal.SizeOf(si)\n        si.dwFlags = STARTF_USESHOWWINDOW\n        si.wShowWindow = SW_SHOW\n\n        Dim result As Integer = CreateProcessWithLogonW("username", "domain", "password", 0, vbNullString, strCmdLine, NORMAL_PRIORITY_CLASS, IntPtr.Zero, strCurrentDirectory, si, pi)\n\n        If result <> 0 Then\n            Call CloseHandle(pi.hThread)\n            Call CloseHandle(pi.hProcess)\n        Else\n            Return False\n        End If\n\n        Return True\n\n    End Function\n\nEnd Module