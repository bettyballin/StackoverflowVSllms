Public Function ExcelWorksheetCompare(ByVal sWorkbook1, ByVal sWorksheet1, ByVal sWorkbook2, ByVal sWorksheet2, ByVal objParameter)\nDim boolRC, boolSheetExists\nDim FSO, XLHandle\nDim XLBook1, XLBook2, XLSheet1, XLSheet2\nDim Iter, objCell\n\n‘Verify both files exist\nSet FSO = CreateObject(”Scripting.FileSystemObject”)\nboolRC = FSO.FileExists(sWorkbook1)\nIf Not boolRC Then\nExcelWorksheetCompare = FALSE\nExit Function\nEnd If\nboolRC = FSO.FileExists(sWorkbook2)\nIf Not boolRC Then\nExcelWorksheetCompare = FALSE\nExit Function\nEnd If\nSet FSO = Nothing\n\nSet XLHandle = CreateObject(”Excel.Application”)\nXLHandle.DisplayAlerts = False\n\n‘Open workbook1\nSet XLBook1 = XLHandle.WorkBooks.Open(sWorkbook1)\n\n‘Verify sheet exists (1)\nIf isNumeric(sWorksheet1) Then\nsWorksheet1 = CInt(sWorksheet1)\nIf (sWorksheet1 &gt;0) AND (sWorksheet1&lt;=XLBook1.Worksheets.Count) Then\nSet XLSheet1 = XLBook1.Worksheets(sWorksheet1)\nboolSheetExists = TRUE\nElse\nboolSheetExists = FALSE\nEnd If\nElse\nboolSheetExists = FALSE\nFor Iter = 1To XLBook1.Worksheets.Count\nIf XLBook1.Worksheets(Iter).Name = sWorksheet1 Then\nSet XLSheet1 = XLBook1.Worksheets(Iter)\nboolSheetExists = TRUE\nEnd If\nNext\nEnd If\n\nIf Not boolSheetExists Then\nXLBook1.Close\nXLHandle.Quit\nSet XLBook1 = Nothing\nSet XLHandle = Nothing\n\nExcelWorksheetCompare = FALSE\nExit Function\nEnd If\n\n‘Open workbook2\nSet XLBook2 = XLHandle.WorkBooks.Open(sWorkbook2)\n\n‘Verify sheet exists (2)\nIf isNumeric(sWorksheet2) Then\nsWorksheet2 = CInt(sWorksheet2)\nIf (sWorksheet2 &gt;0) AND (sWorksheet2&lt;=XLBook2.Worksheets.Count) Then\nSet XLSheet2 = XLBook2.Worksheets(sWorksheet2)\nboolSheetExists = TRUE\nElse\nboolSheetExists = FALSE\nEnd If\nElse\nboolSheetExists = FALSE\nFor Iter = 1To XLBook2.Worksheets.Count\nIf XLBook2.Worksheets(Iter).Name = sWorksheet2 Then\nSet XLSheet2 = XLBook2.Worksheets(Iter)\nboolSheetExists = TRUE\nEnd If\nNext\nEnd If\n\nIf Not boolSheetExists Then\nXLBook1.Close\nXLBook2.Close\nXLHandle.Quit\nSet XLSheet1 = Nothing\nSet XLBook1 = Nothing\nSet XLBook2 = Nothing\nSet XLHandle = Nothing\n\nExcelWorksheetCompare = FALSE\nExit Function\nEnd If\n\n‘Mark range\n\n‘Compare and mark mismatches red\nFor Each objCell In XLSheet2.UsedRange\nIf objCell.Value &lt;&gt; XLSheet1.Range(objCell.Address).Value Then\nobjCell.Interior.ColorIndex = 3\nElse\nobjCell.Interior.ColorIndex = 0\nEnd If\nNext\n\n‘Save and close\n\nXLBook1.Close\n\nXLBook2.Save\nXLBook2.Close\n\nXLHandle.Quit\n\nSet XLSheet1 = Nothing\nSet XLSheet2 = Nothing\nSet XLBook1 = Nothing\nSet XLBook2 = Nothing\nSet XLHandle = Nothing\n\nExcelWorksheetCompare = TRUE\n\nEnd Functio