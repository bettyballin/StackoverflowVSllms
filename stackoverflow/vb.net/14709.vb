Public MustInherit Class Repository(Of T As Class)\n    Implements IRepository(Of T)\n\n    Private mConnectionString As String = ConfigurationManager.ConnectionStrings("Northwind.ConnectionString").ConnectionString\n    Private mConnection As IDbConnection\n    Private mTransaction As IDbTransaction\n\n    Public Sub New()\n        mConnection = Nothing\n        mTransaction = Nothing\n    End Sub\n\n    Public Sub New(ByVal connection As IDbConnection, ByVal transaction As IDbTransaction)\n        mConnection = connection\n        mTransaction = transaction\n    End Sub\n\n    Public MustOverride Function BuildEntity(ByVal cmd As SqlCommand) As List(Of T)\n\n    Public Function ExecuteReader(ByVal Parameter As Parameter) As List(Of T) Implements IRepository(Of T).ExecuteReader\n        Dim entityList As List(Of T)\n        If Not mConnection Is Nothing Then\n            Using cmd As SqlCommand = mConnection.CreateCommand()\n                cmd.Transaction = mTransaction\n                cmd.CommandType = Parameter.Type\n                cmd.CommandText = Parameter.Text\n                If Not Parameter.Items Is Nothing Then\n                    For Each param As SqlParameter In Parameter.Items\n                        cmd.Parameters.Add(param)\n                    Next\n                End If\n                entityList = BuildEntity(cmd)\n                If Not entityList Is Nothing Then\n                    Return entityList\n                End If\n            End Using\n        Else\n            Using conn As SqlConnection = New SqlConnection(mConnectionString)\n                Using cmd As SqlCommand = conn.CreateCommand()\n                    cmd.CommandType = Parameter.Type\n                    cmd.CommandText = Parameter.Text\n                    If Not Parameter.Items Is Nothing Then\n                        For Each param As SqlParameter In Parameter.Items\n                            cmd.Parameters.Add(param)\n                        Next\n                    End If\n                    conn.Open()\n                    entityList = BuildEntity(cmd)\n                    If Not entityList Is Nothing Then\n                        Return entityList\n                    End If\n                End Using\n            End Using\n        End If\n\n        Return Nothing\n    End Function\nEnd Class