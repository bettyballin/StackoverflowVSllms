Main\n\nFunction Main\n  'Usage: cscript /nologo lookup.vbs mydomain username\n  Wscript.Echo CanDialIn(Wscript.Arguments(0), Wscript.Arguments(1))\n  Main = 0\nEnd Function\n\nFunction CanDialIn(domainname, username)\n  'Take a user name and query whether they have permission to Dial in or not\n  'http://www.microsoft.com/technet/scriptcenter/resources/qanda/aug05/hey0825.mspx\n  Const ADS_SCOPE_SUBTREE = 2\n  Dim objConnection\n  Dim objCommand\n  Dim objRecordSet\n\n  Set objConnection = CreateObject("ADODB.Connection")\n  Set objCommand =   CreateObject("ADODB.Command")\n  objConnection.Provider = "ADsDSOObject"\n  objConnection.Open "Active Directory Provider"\n  Set objCommand.ActiveConnection = objConnection\n\n  objCommand.Properties("Page Size") = 1000\n  objCommand.Properties("Searchscope") = ADS_SCOPE_SUBTREE \n\n  'Three possible values for msNPAllowDialin:\n  'TRUE = "Allow Access"\n  'FALSE = "Deny Access"\n  'EMPTY = "Control access through remote access policy"\n  objCommand.CommandText = _\n    "SELECT msNPAllowDialin FROM 'LDAP://dc=" & domainname & ",dc=com' WHERE objectCategory='user' AND sAMAccountName = '" & username & "'"\n  On Error Resume Next\n  Set objRecordSet = objCommand.Execute\n  if objRecordSet.EOF then\n    CanDialIn = "Could not find user " & username\n  else\n    if objRecordSet.Fields("msNPAllowDialin").Value = True then\n      CanDialIn = "Allow"\n    else\n      if objRecordSet.Fields("msNPAllowDialin").Value = False then\n        CanDialIn = "Deny"\n      else\n        CanDialIn = "Control"\n      end if\n    end if  \n  end if\nEnd Functio