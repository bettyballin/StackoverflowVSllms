<?php\n$con = mysqli::connect("localhost", "user", "", "ebay");\n\nif (!$con) {\n    echo "Can't connect to MySQL Server. Errorcode: %s\n". mysqli_connect_error();\n    exit;\n}\n\n$con->query("SET NAMES 'utf8'");\n$cmd = "word";\n\n//normally retrieved from GET\nif($cmd=="deleterec") {\n    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";\n    if ($delRecord = $con->prepare($deleteQuery)) {\n        $delRecord->bind_param("s", $pk);\n        $delRecord->execute();\n    }\n}\n\n$table = 'AUCTIONS';\n$brand = "test";\n$countQuery = "SELECT ARTICLE_NO FROM ? WHERE upper(ARTICLE_NAME) LIKE '% ? %'";\n\nif ($numRecords = $con->prepare($countQuery)) {\n    $numRecords->bind_param("ss", $table, $brand);\n    $numRecords->execute();\n    $data = $con->query($countQuery) or die(print_r($con->error));\n\n    // Here is the property that you can reference to determine the affected rows from the previous query. -- gabriel\n    $rowcount = $data->num_rows; \n    $rows = getRowsByArticleSearch($query, $table, $max);\n    $last = ceil($rowcount/$page_rows);\n}\n\n$self = htmlspecialchars($_SERVER['PHP_SELF'],ENT_QUOTES,'utf-8');\n\nforeach ($rows as $row) // print table rows {\n    echo '<tr>' . "\n";\n    echo '<td><a href="#" onclick="doThings(\'Layer2\', \'' . $pk . '\')">'.$row['USERNAME'].'</a></td>' . "\n";\n    // repeated for each column\n}\n\nfunction getRowsByArticleSearch($searchString, $table, $max) {\n    //global $con; Globals are BAD!! Please don't use.\n    $con = mysqli::connet("localhost", "user", "", "ebay");\n\n    $recordsQuery = "SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME, date_format(str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s'), '%d %m %Y' ) AS shortDate FROM ? WHERE upper(ARTICLE_NAME) LIKE '%?%' ORDER BY str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s')" . $max;\n    if ($getRecords = $con->prepare($recordsQuery)) {\n        $getRecords->bind_param("ss", $searchString, $table);\n        $getRecords->execute();\n        $getRecords->bind_result($ARTICLE_NO, $USERNAME, $ACCESSSTARTS, $ARTICLE_NAME, $shortDate);\n        while ($getRecords->fetch()) {\n                $result = $con->query($recordsQuery);\n                $rows = array();\n\n                // Notice the adjusted function call to retrieve the associate array for each record within the result set. -- gabriel\n                while($row = $result->fetch_assoc()) {\n                        $rows[] = $row;\n                }\n                return $rows;\n        }\n    }\n}