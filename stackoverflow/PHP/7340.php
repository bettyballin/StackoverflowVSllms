#here's where we'll store the cached images\n$cachedir=$_SERVER['DOCUMENT_ROOT'].'/imgcache/'\n\n#get the score and sanitize it\n$score=$_GET['score'];\nif (preg_match('/^[0-9]\.[0-9]{1,2}$/', $score)\n{\n    #figure out filename of cached file\n    $file=$cachedir.'score'.$score.'gif';   \n\n    #regenerate cached image\n    if (!file_exists($file))\n    {\n        #generate image - this is lifted straight from the php\n        #manual, you'll need to work out how to make your\n        #image, but this will get you started\n\n        #load a background image\n        $im     = imagecreatefrompng("images/button1.png");\n\n        #allocate color for the text\n        $orange = imagecolorallocate($im, 220, 210, 60);\n\n        #attempt to centralise the text  \n        $px     = (imagesx($im) - 7.5 * strlen($score)) / 2;\n        imagestring($im, 3, $px, 9, $score, $orange);\n\n        #save to cache\n        imagegif($im, $file);\n        imagedestroy($im);\n    }\n\n    #return image to browser, but return a 304 if they already have it\n    $mtime=filemtime($file);\n\n    $headers = apache_request_headers(); \n    if (isset($headers['If-Modified-Since']) && \n        (strtotime($headers['If-Modified-Since']) >= $mtime)) \n    {\n        // Client's cache IS current, so we just respond '304 Not Modified'.\n        header('Last-Modified: '.gmdate('D, d M Y H:i:s', $mtime).' GMT', true, 304);\n        exit;\n    }\n\n\n    header('Content-Type:image/gif');\n    header('Content-Length: '.filesize($file));\n    header('Last-Modified: '.gmdate('D, d M Y H:i:s', $mtime).' GMT');\n    readfile($file);\n\n\n}\nelse\n{\n    header("HTTP/1.0 401 Invalid score requested");\n}