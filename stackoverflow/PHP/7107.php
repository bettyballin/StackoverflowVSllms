<?php\n\n$nested_array = array();\n$nested_array[] = array('name' => 'foo', 'depth' => 0);\n$nested_array[] = array('name' => 'bar', 'depth' => 0);\n$nested_array[] = array('name' => 'sub-bar', 'depth' => 1);\n$nested_array[] = array('name' => 'sub-sub-bar', 'depth' => 2);\n$nested_array[] = array('name' => 'sub-bar2', 'depth' => 1);\n$nested_array[] = array('name' => 'sub-sub-bar3', 'depth' => 3);\n$nested_array[] = array('name' => 'sub-sub3', 'depth' => 2);\n$nested_array[] = array('name' => 'baz', 'depth' => 0);\n\n$doc = new DOMDocument('1.0', 'iso-8859-1');\n$doc->formatOutput = true;\n$rootNode = $doc->createElement('div');\n$doc->appendChild($rootNode);\n\n$rootList = $doc->createElement('ul');\n$rootNode->appendChild($rootList);\n\n$listStack = array($rootList); // Stack of created XML list elements\n$depth = 0; // Current depth\n\nforeach ($nested_array as $nael) {\n    while ($depth < $nael['depth']) {\n        // New list element\n        if ($listStack[$depth]->lastChild == null) {\n            // More than one level at once\n            $li = $doc->createElement('li');\n            $listStack[$depth]->appendChild($li);\n        }\n        $listEl = $doc->createElement('ul');\n        $listStack[$depth]->lastChild->appendChild($listEl);\n        array_push($listStack, $listEl);\n\n        $depth++;\n    }\n\n    while ($depth > $nael['depth']) {\n        array_pop($listStack);\n        $depth--;\n    }\n\n    // Add the element itself\n    $li = $doc->createElement('li');\n    $li->appendChild($doc->createTextNode($nael['name']));\n    $listStack[$depth]->appendChild($li);\n}\n\necho $doc->saveXML();