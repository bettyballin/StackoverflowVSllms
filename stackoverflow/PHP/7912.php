<pre>\n<?php\n\n$input_str = file_get_contents("in.txt");\nprint_r(parse_lualike($input_str));\n\nfunction parse_lualike($str){    \n    $str = preg_replace('/[\n]|[;]/','',$str);\n    preg_match_all('/[a-zA-Z][a-zA-Z0-9_]*|[(]\s*([^)]*)\s*[)]|[{]|[}]/', $str, $matches);\n    $tree = array();\n    $stack = array();\n    $pos = 0;\n    $stack[$pos] = &$tree;\n    foreach($matches[0] as $index => $token){\n        if($token == '{'){\n            $node = &$stack[$pos];\n            $node[$ident] = array();\n            $pos++;\n            $stack[$pos] =  &$node[$ident];\n        }elseif($token=='}'){\n            unset($stack[$pos]);\n            $pos--;\n        }elseif($token[0] == '('){\n            $stack[$pos][$ident] = $matches[1][$index];\n        }else{\n            $ident =  $token;\n        }\n    }\n    return $tree;\n}\n\n?>