<?php\n$string = "some random text http://tinyurl.com/9uxdwc some http://google.com random text http://tinyurl.com/787988";\n\n$regex = '$\b(https?|ftp|file)://[-A-Z0-9+&@#/%?=~_|!:,.;]*[-A-Z0-9+&@#/%=~_|]$i';\n\npreg_match_all($regex, $string, $result, PREG_PATTERN_ORDER);\n$A = $result[0];\n\nforeach($A as $B)\n{\n   $URL = GetRealURL($B);\n   echo "$URL<BR>";   \n}\n\n\nfunction GetRealURL( $url ) \n{ \n   $options = array(\n      CURLOPT_RETURNTRANSFER => true,\n      CURLOPT_HEADER         => true,\n      CURLOPT_FOLLOWLOCATION => true,\n      CURLOPT_ENCODING       => "",\n      CURLOPT_USERAGENT      => "spider",\n      CURLOPT_AUTOREFERER    => true,\n      CURLOPT_CONNECTTIMEOUT => 120,\n      CURLOPT_TIMEOUT        => 120,\n      CURLOPT_MAXREDIRS      => 10,\n   ); \n\n   $ch      = curl_init( $url ); \n   curl_setopt_array( $ch, $options ); \n   $content = curl_exec( $ch ); \n   $err     = curl_errno( $ch ); \n   $errmsg  = curl_error( $ch ); \n   $header  = curl_getinfo( $ch ); \n   curl_close( $ch ); \n   return $header['url']; \n}  \n\n?>