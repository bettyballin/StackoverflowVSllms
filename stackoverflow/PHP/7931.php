function wrap($fontSize, $angle, $fontFace, $string, $width){\n\n    $ret = "";\n\n    $arr = explode(' ', $string);\n\n    foreach ( $arr as $word ){\n\n        $teststring = $ret.' '.$word;\n        $testbox = imagettfbbox($fontSize, $angle, $fontFace, $teststring);\n        if ( $testbox[2] > $width ){\n            $ret.=($ret==""?"":"\n").$word;\n        } else {\n            $ret.=($ret==""?"":' ').$word;\n        }\n    }\n\n    return $ret;\n}