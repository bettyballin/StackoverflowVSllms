// The PHP copy function blindly copies over existing files.  We don't wish\n// this to happen, so we have to perform the copy a bit differently.  The\n// only safe way to ensure we don't overwrite an existing file is to call\n// fopen in create-only mode (mode 'x').  If it succeeds, the file did not\n// exist before, and we've successfully created it, meaning we own the\n// file.  After that, we can safely copy over our own file.\n\n$filename = 'sourcefile.txt'\n$copyname = 'sourcefile_copy.txt'\nif ($file = @fopen($copyname, 'x')) {\n    // We've successfully created a file, so it's ours.  We'll close\n    // our handle.\n    if (!@fclose($file)) {\n        // There was some problem with our file handle.\n        return false;\n    }\n\n    // Now we copy over the file we created.\n    if (!@copy($filename, $copyname)) {\n        // The copy failed, even though we own the file, so we'll clean\n        // up by itrying to remove the file and report failure.\n        unlink($copyname);\n        return false;\n    }\n\n    return true;\n}