<?php\n//display results\n// now we retrieve the routes from the db\n$query = "SELECT * FROM routes ORDER BY `id`;";\n\n// run the query. if it fails, display error\n$result = @mysql_query( "$query" ) or die( '<p class="error">There was an unexpected error grabbing routes from the database.</p>' );\n\n?>\n<tr>\n    <td\n        style="background: url(http://www.teamdelta.byethost12.com/barbg.jpg) repeat-x top;">\n    <center><b><font color="#F3EC84">»Matches«</font></b></center>\n    </td>\n</tr>\n\n<tr>\n    <td style="background: #222222;"></font>\n    <table border="0" width="100%">\n        <tr>\n\n\n            <td width="10%"><b>\n            <center><b>Player</b></center>\n            </b></td>\n            <td width="10%">\n            <center><b>Base</b></center>\n            </td>\n            <td width="10%"><b>Location</b></td>\n            <td width="5%"><b>Econ</b></td>\n            <td width="10%"><b>Distance</b></td>\n            <td width="10%">\n            <center><b>Profit cred./h</b></center>\n            </td>\n            <td width="40%"><b>Comment</b></td>\n            <td width="5%"><align="right"><b>Delete</b></align></td>\n\n        </tr> \n\n<?\n\n// while we still have rows from the db, display them\n$resultSet = array();\nwhile ( $row = mysql_fetch_array( $result ) )\n{\n\n  $dname = stripslashes( $row['name'] );\n  $dbase = stripslashes( $row['base'] );\n  $dlocation = stripslashes( $row['location'] );\n  $dx = stripslashes( $row['x'] );\n  $dy = stripslashes( $row['y'] );\n  $dgalaxy = stripslashes( $row['galaxy'] );\n  $dplanet = stripslashes( $row['planet'] );\n  $dcomment = stripslashes( $row['comment'] );\n  $did = stripslashes( $row['id'] );\n  $decon = stripslashes( $row['econ'] );\n\n  $distance = -1; //default\n\n\n  //distance calc\n  if ( $dgalaxy == $galaxy )\n  { //interstellar\n    if ( ( $dx == $x ) && ( $dy == $y ) )\n    { //inter planitary\n      if ( ( floor( $planet / 10 ) * 10 ) == ( floor( $dplanet / 10 ) * 10 ) )\n      { // intra planitary loonar\n        $distance = abs( fmod( $planet, 10 ) - fmod( $planet, 10 ) ) * 0.1;\n      } else\n      { // inter planitary\n        $distance = abs( ( floor( $planet / 10 ) * 10 ) - ( floor( $planet / 10 ) * 10 ) ) * 0.2;\n      }\n    } else\n    { //interstllar\n      $distance = round( Sqrt( pow( ( $dx - $x ), 2 ) + pow( ( $dy - $y ), 2 ) ) ); //interstllar\n    }\n  } else\n  { //intergalatic\n    if ( ( floor( $galaxy / 10 ) * 10 ) == ( floor( $dgalaxy / 10 ) * 10 ) )\n    { //intra galactic cluster\n      $distance = abs( ( $galaxy - $dgalaxy ) ) * 200;\n    } else\n    { //inter galactic cluster\n      if ( $galaxy < $dgalaxy )\n      { //anti clockwise inter galactic cluster\n        $distance = ( ( ( 9 - fmod( $galaxy, 10 ) ) * 200 ) + 2000 + ( fmod( $dgalaxy, 10 ) * 200 ) );\n      } else\n      { //clockwise inter galactic cluster\n        $distance = ( ( ( fmod( $galaxy, 10 ) ) * 200 ) + 2000 + ( fmod( 9 - $dgalaxy, 10 ) * 200 ) );\n      }\n    }\n  }\n  $row['distance'] = $distance;\n  $row['profit'] = round( Sqrt( min( $decon, $econ ) ) * ( 1 + Sqrt( $distance ) / 75 + Sqrt( $players ) / 10 ) );\n  $resultSet[] = $row;\n}\n\n//  Perform custom sort\nusort( $resultSet, 'sorter' );\nfunction sorter( $a, $b )\n{\n  if ( $a['profit'] == $b['profit'] ) return 0;\n  return ( $a['profit'] < $b['profit'] ) ? -1 : 1;\n}\n\n//  Switch to "descending"\narray_reverse( $resultSet );\n\n//  Output escape the values\n$safeForHtml = array_map( 'htmlspecialchars', $resultSet );\n\nforeach( $safeForHtml as $row )\n{\n  echo ( '<tr>\n                <td width=\'20px\'><center>(' . $row['name'] . ')</center></td>\n                <td><center>' . $row['base'] . '</center></td>\n                <td><a href="http://delta.astroempires.com/map.aspx?loc=' . $row['location'] . '">' . $row['location'] . '</a></td>\n                <td>' . $row['econ'] . '</td>\n                <td>' . $row['distance'] . ' </td>\n                <td>' . $row['profit'] . '</td>\n                <td>[' . $row['comment'] . ']</td>\n                <td><a href=deleterouteconfirm.php?id=' . $row['id'] . '>Delete</a></td>\n                </tr>' );\n}\n?>\n</table>\n    <!--display results table-->