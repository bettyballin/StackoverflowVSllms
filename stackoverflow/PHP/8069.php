public function __sleep() {\n    return $this->serialize();\n}\nprotected function serialize($processed = array()) {\n    if (($position = array_search($this, $processed, true)) !== false) {\n        # This object has already been processed, you can use the\n        # $position of this object in the $processed array to reference it.\n        return;\n    }\n    $processed[] = $this;\n    # do your actual serialization here\n    # ...\n}