private function run_lengthy_job($command, $message) {\n    printf("%s\t", $message);\n\n    for($handle = popen($command, 'r'),\n        stream_set_blocking($handle, FALSE),\n        stream_set_timeout($handle, 3); \n        !feof($handle); sleep(1)) {\n\n        echo '.';\n\n        exec(sprintf('logger "%s"', \n            escapeshellarg(stream_get_contents($handle))));\n    }\n\n    $exit_status = pclose($handle);\n\n    if(pcntl_wifexited($exit_status) \n        && pcntl_wexitstatus($exit_status) == 0) {\n        echo "done!\n";\n    } else {\n        echo "failed!\n";\n    }\n}