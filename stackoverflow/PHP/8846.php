<?php\n/**\n   NAME        : autolink()\n   VERSION     : 1.0\n   AUTHOR      : J de Silva\n   DESCRIPTION : returns VOID; handles converting\n                 URLs into clickable links off a string.\n   TYPE        : functions\n   ======================================*/\n\nfunction autolink( &$text, $target='_blank', $nofollow=true )\n{\n  // grab anything that looks like a URL...\n  $urls  =  _autolink_find_URLS( $text );\n  if( !empty($urls) ) // i.e. there were some URLS found in the text\n  {\n    array_walk( $urls, '_autolink_create_html_tags', array('target'=>$target, 'nofollow'=>$nofollow) );\n    $text  =  strtr( $text, $urls );\n  }\n}\n\nfunction _autolink_find_URLS( $text )\n{\n  // build the patterns\n  $scheme         =       '(http:\/\/|https:\/\/)';\n  $www            =       'www\.';\n  $ip             =       '\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}';\n  $subdomain      =       '[-a-z0-9_]+\.';\n  $name           =       '[a-z][-a-z0-9]+\.';\n  $tld            =       '[a-z]+(\.[a-z]{2,2})?';\n  $the_rest       =       '\/?[a-z0-9._\/~#&=;%+?-]+[a-z0-9\/#=?]{1,1}';            \n  $pattern        =       "$scheme?(?(1)($ip|($subdomain)?$name$tld)|($www$name$tld))$the_rest";\n\n  $pattern        =       '/'.$pattern.'/is';\n  $c              =       preg_match_all( $pattern, $text, $m );\n  unset( $text, $scheme, $www, $ip, $subdomain, $name, $tld, $the_rest, $pattern );\n  if( $c )\n  {\n    return( array_flip($m[0]) );\n  }\n  return( array() );\n}\n\nfunction _autolink_create_html_tags( &$value, $key, $other=null )\n{\n  $target = $nofollow = null;\n  if( is_array($other) )\n  {\n    $target      =  ( $other['target']   ? " target=\"$other[target]\"" : null );\n    // see: http://www.google.com/googleblog/2005/01/preventing-comment-spam.html\n    $nofollow    =  ( $other['nofollow'] ? ' rel="nofollow"'            : null );     \n  }\n  $value = "<a href=\"$key\"$target$nofollow>$key</a>";\n} \n\n?>