$in = $_SERVER['HTTP_DATE'];\n$out = 0;\n\n$strptime_patterns = array(\n    // Matches: Sun, 06 Nov 1994 08:49:37 GMT\n    '%a, %d %h %Y %H:%M:%S %z',\n    '%a, %d %h %Y %H:%M:%S %Z',\n    // Matches: Sunday, 06-Nov-94 08:49:37 GMT\n    '%A, %d-%h-%y %H:%M:%S %z',\n    '%A, %d-%h-%y %H:%M:%S %Z',\n    // Matches: Sun Nov  6 08:49:37 1994\n    '%a %h %e %H:%M:%S %Y'\n);\n\nforeach ($strptime_patterns as $pat) {\n    if ($arr = strptime($in, $pat)) {\n        $out = mktime($arr['tm_hour'], $arr['tm_min'], $arr['tm_sec'], $arr['tm_mon'], $arr['tm_mday'], $arr['tmp_year'] + 1900);\n        break;\n    }\n}\n\nif ($out > gmmktime()) {\n    // Invalid date - in the future\n} elseif ($out >= gmmktime() - (15 * 60)) {\n    // Valid, not expired\n} elseif ($out > 0) {\n    // Valid date, but expired\n} else {\n    // Invalid date\n}