$str = <<<A\nLorem ipsum dolor sit amet, consectetur adipiscing elit. Donec sodales lacus et erat accumsan consectetur. Sed lacinia enim vitae erat suscipit fermentum. Quisque lobortis nisi et lacus imperdiet ac malesuada dui imperdiet. <pre><code>ThIs Is \nCoDe 1</code></pre>Donec vestibulum commodo quam rhoncus luctus. Nam vitae ipsum sed nibh dignissim condimentum. Sed ultrices fermentum dapibus. Vivamus mattis nisi nec enim convallis quis aliquet arcu accumsan. Suspendisse potenti. Nullam eget fringilla nunc. Nulla porta justo justo. Nunc consectetur egestas malesuada. Mauris ac nisi ipsum, et accumsan lorem. Quisque interdum accumsan pellentesque. Sed at felis metus. Nulla gravida tincidunt tortor, <pre><code>AnD cOdE 2</code></pre>nec aliquam tortor ultricies vel. Integer semper libero eu magna congue eget lacinia purus auctor. Nunc volutpat ultricies feugiat. Nullam id mauris eget ipsum ultricies ullamcorper non vel risus. Proin volutpat volutpat interdum. Nulla orci odio, ornare sit amet ullamcorper non, condimentum sagittis libero. <pre><code>aNd\nCoDe\nNuMbEr 3\n</code></pre>Ut non justo at neque convallis luctus ultricies amet. \nA;\nvar_dump($str);\n\n// Extract the codes\n$matches = array();\npreg_match_all('#<pre><code>(.*?)</code></pre>#s', $str, $matches);\nvar_dump($matches);\n\n// Remove the codes\n$str_nocode = preg_replace('#<pre><code>.*?</code></pre>#s', 'THIS_IS_A_NOCODE_MARKER', $str);\nvar_dump($str_nocode);\n\n// Do whaterver you want with $str_nocode\n$str_nocode = strtoupper($str_nocode);\nvar_dump($str_nocode);\n\n// And put back the codes :\n$str_codes = $str_nocode;\nforeach ($matches[0] as $code) {\n    $str_codes = preg_replace('#THIS_IS_A_NOCODE_MARKER#', $code, $str_codes, 1);\n}\nvar_dump($str_codes);