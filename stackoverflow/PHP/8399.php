<?php\nfunction smarty_block_products($params, $content, &$smarty, &$repeat)\n{\n    global $conf;\n\n    $category = $params['category'];\n    $md5 = md5($category);\n    if (empty($content))\n    {\n        if (empty($category))\n        {\n            $smarty->trigger_error("products: missing 'category' parameter"); \n        }\n        $sql = str_replace('{$category}', $category, $conf['get-products-sql-template']);\n        $query = mysql_query($sql);\n\n        $result = array();\n        while ($row = mysql_fetch_assoc($query))\n        {\n            $result[] = $row;\n        }\n        if (count($result) == 0)\n        {\n            $result = false;\n        }\n        $GLOBALS['__SMARTY_PRODUCTS'][$md5] = $result;\n    }\n    if (is_array($GLOBALS['__SMARTY_PRODUCTS'][$md5]))\n    {\n        $field = "product";\n        if (isset($params['item']))\n        {\n            $field = $params['item'];\n        }\n\n        $product = array_shift($GLOBALS['__SMARTY_PRODUCTS'][$md5]);            \n\n        $smarty->assign($field, $product);\n\n        if (count($GLOBALS['__SMARTY_PRODUCTS'][$md5]) == 0)\n        {\n            $GLOBALS['__SMARTY_PRODUCTS'][$md5] = false;\n        }\n        $repeat = true;\n    } else {\n        $repeat = false;\n    }\n    echo $content;\n}\n?>