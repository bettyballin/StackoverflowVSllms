function scan_ftp_dir($conn, $dir, $pattern) {\n    $files = ftp_nlist($conn, $dir);\n    if (!$files) {\n        return;\n    }\n\n    foreach ($files as $file) {\n        //the quickest way i can think of to check if is a directory\n        if (ftp_size($conn, $file) == -1) {\n\n            //get just the directory name\n            $dirName = substr($file, strrpos($file, '/') + 1);\n\n            if (preg_match($pattern, $dirName)) {\n                echo $file . ' matched pattern';\n            } else {        \n                //directory didn't match pattern, recurse   \n                scan_ftp_dir($conn, $file, $pattern);\n            }\n        } \n    }\n}