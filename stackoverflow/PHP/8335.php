function system_extension_mime_types() {\n    # Returns the system MIME type mapping of extensions to MIME types, as defined in /etc/mime.types.\n    $out = array();\n    $file = fopen('/etc/mime.types', 'r');\n    while(($line = fgets($file)) !== false) {\n        $line = trim(preg_replace('/#.*/', '', $line));\n        if(!$line)\n            continue;\n        $parts = preg_split('/\s+/', $line);\n        if(count($parts) == 1)\n            continue;\n        $type = array_shift($parts);\n        foreach($parts as $part)\n            $out[$part] = $type;\n    }\n    fclose($file);\n    return $out;\n}\n\nfunction system_extension_mime_type($file) {\n    # Returns the system MIME type (as defined in /etc/mime.types) for the filename specified.\n    #\n    # $file - the filename to examine\n    static $types;\n    if(!isset($types))\n        $types = system_extension_mime_types();\n    $ext = pathinfo($file, PATHINFO_EXTENSION);\n    if(!$ext)\n        $ext = $file;\n    $ext = strtolower($ext);\n    return isset($types[$ext]) ? $types[$ext] : null;\n}\n\nfunction system_mime_type_extensions() {\n    # Returns the system MIME type mapping of MIME types to extensions, as defined in /etc/mime.types (considering the first\n    # extension listed to be canonical).\n    $out = array();\n    $file = fopen('/etc/mime.types', 'r');\n    while(($line = fgets($file)) !== false) {\n        $line = trim(preg_replace('/#.*/', '', $line));\n        if(!$line)\n            continue;\n        $parts = preg_split('/\s+/', $line);\n        if(count($parts) == 1)\n            continue;\n        $type = array_shift($parts);\n        if(!isset($out[$type]))\n            $out[$type] = array_shift($parts);\n    }\n    fclose($file);\n    return $out;\n}\n\nfunction system_mime_type_extension($type) {\n    # Returns the canonical file extension for the MIME type specified, as defined in /etc/mime.types (considering the first\n    # extension listed to be canonical).\n    #\n    # $type - the MIME type\n    static $exts;\n    if(!isset($exts))\n        $exts = system_mime_type_extensions();\n    return isset($exts[$type]) ? $exts[$type] : null;\n}