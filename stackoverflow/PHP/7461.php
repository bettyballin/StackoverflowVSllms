$iterator = new RecursiveIteratorIterator(\n    new Site_Node_List(array($root)),\n    RecursiveIteratorIterator::SELF_FIRST);\n\n$sides = array();\n$s = 0;\n$i = 0;\n$parents = array();\nforeach ($iterator as $item) {\n    $js = array_splice($parents, $depth, count($parents), array($i));\n    foreach (array_reverse($js) as $j) {\n        $sides[$j]['right'] = ++$s;\n    }\n    $sides[$i]['left'] = ++$s;\n    $i++;\n}\nforeach (array_reverse($parents) as $j) {\n    $sides[$j]['right'] = ++$s;\n}