$data = array(\n    array('user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'),\n    array('user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'),\n    array('user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'),\n    array('user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar')\n);\n$final = array();\nforeach ($data as $item) {\n    if (!isset($final[$item['user_name']])) {\n        $final[$item['user_name']] = array(\n            'name' => $item['user_name'],\n            'tags' => array()\n        );\n    }\n    $final[$item['user_name']]['tags'][] = array(\n        'id'   => $item['tag_id'],\n        'name' => $item['tag_name']\n    );\n}\n$final = array_values($final);