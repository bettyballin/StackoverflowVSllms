<?php\n\n/** Plugin system **/\n\n$listeners = array();\n\n/* Create an entry point for plugins */\nfunction hook() {\n    global $listeners;\n\n    $num_args = func_num_args();\n    $args = func_get_args();\n\n    if($num_args < 2)\n        trigger_error("Insufficient arguments", E_USER_ERROR);\n\n    // Hook name should always be first argument\n    $hook_name = array_shift($args);\n\n    if(!isset($listeners[$hook_name]))\n        return; // No plugins have registered this hook\n\n    foreach($listeners[$hook_name] as $func) {\n        $args = $func($args); \n    }\n    return $args;\n}\n\n/* Attach a function to a hook */\nfunction add_listener($hook, $function_name) {\n    global $listeners;\n    $listeners[$hook][] = $function_name;\n}\n\n/////////////////////////\n\n/** Sample Plugin **/\nadd_listener('a_b', 'my_plugin_func1');\nadd_listener('str', 'my_plugin_func2');\n\nfunction my_plugin_func1($args) {\n    return array(4, 5);\n}\n\nfunction my_plugin_func2($args) {\n    return str_replace('sample', 'CRAZY', $args[0]);\n}\n\n/////////////////////////\n\n/** Sample Application **/\n\n$a = 1;\n$b = 2;\n\nlist($a, $b) = hook('a_b', $a, $b);\n\n$str  = "This is my sample application\n";\n$str .= "$a + $b = ".($a+$b)."\n";\n$str .= "$a * $b = ".($a*$b)."\n";\n\n$str = hook('str', $str);\necho $str;\n?>