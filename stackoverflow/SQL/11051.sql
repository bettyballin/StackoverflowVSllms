DECLARE @run_date datetime\nDECLARE @min_date datetime\n\nSET @run_date = {d '2009-01-03'}\n\n-- get day before any entries in the table to use as a false baseline date\nSELECT @min_date = DATEADD(day, -1, MIN(processing_date)) FROM history_of_jerkiness\n\n-- get last not a jerk date for each name that is before or on the run date\n-- the difference in days between the run date and the last not a jerk date is the number of days as a jerk\nSELECT [name], DATEDIFF(day, MAX(processing_date), @run_date)\nFROM (\n     SELECT processing_date, [name], is_jerk\n     FROM history_of_jerkiness\n     UNION ALL\n     SELECT DISTINCT @min_date, [name], 0\n     FROM history_of_jerkiness ) as data\nWHERE is_jerk = 0\n  AND processing_date <= @run_date\nGROUP BY [name]\nHAVING DATEDIFF(day, MAX(processing_date), @run_date) > 0