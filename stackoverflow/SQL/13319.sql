SELECT\n  c1.customer,\n  c1.food_type,\n  100 * c1.food_type_value / sum(c2.food_type_value),\n  c3.FOOD_TYPE_VALUE / sum(c2.food_type_value) as IDEAL_PERC\nFROM\n  mytable c1 INNER JOIN mytable c2\n  ON c1.customer = c2.customer\n  INNER JOIN (\n    SELECT FOOD_TYPE, FOOD_TYPE_VALUE\n    FROM mytable\n    WHERE customer = 3) c3\n  ON c2.FOOD_TYPE = c3.FOOD_TYPE\ngroup by c1.customer, c1.food_type, c1.food_type_value, c3.FOOD_TYPE_VALUE