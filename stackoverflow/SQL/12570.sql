select n.name, \n    (select count(*) \n     from myTable n1\n     where n1.name = n.name and n1.id >= n.id and (n1.id <=\n        (\n        select isnull(min(nn.id), (select max(id) + 1 from myTable))\n        from myTable nn\n        where nn.id > n.id and nn.name <> n.name\n        )\n     ))\nfrom myTable n\nwhere not exists (\n   select 1\n   from myTable n3\n   where n3.name = n.name and n3.id < n.id and n3.id > (\n            select isnull(max(n4.id), (select min(id) - 1 from myTable))\n            from myTable n4\n            where n4.id < n.id and n4.name <> n.name\n            )\n)