SELECT d.id, d.name, h.last_user_id\n    FROM Documents d LEFT JOIN\n         (SELECT r.doc_id AS id, user_id AS last_user_id\n              FROM History r JOIN\n                   (SELECT doc_id, MAX("timestamp") AS "timestamp"\n                        FROM History\n                        GROUP BY doc_id\n                   ) AS l\n                   ON  r."timestamp" = l."timestamp"\n                   AND r.doc_id      = l.doc_id\n         ) AS h\n         ON d.id = h.id