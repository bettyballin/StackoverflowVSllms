DECLARE @xml as xml\nDECLARE @path as varchar(max)\nDECLARE @index int, @count int\n\nSET @xml = \n'<doc>\n <a>1</a>\n <b ba="1" bb="2" bc="3" />\n <c bd="3"/>\n</doc>'\n\n\n\nSELECT @index = 1\n\nSET @count = @xml.query('count(/doc/b/@*)').value('.','int')\n\nWHILE @index <= @count \nBEGIN\n    SELECT  @xml.value('local-name((/doc/b/@*[sql:variable("@index")])[1])', 'varchar(max)')\n    SET @index = @index + 1\nEND