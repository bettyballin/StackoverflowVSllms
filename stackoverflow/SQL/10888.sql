/* TEST TABLE */\nDECLARE @PEOPLE AS TABLE ([Name] VARCHAR(20),  [Address] XML )\nINSERT INTO @PEOPLE SELECT \n    'Joel', \n    '<address>\n      <street>Street 1</street>\n      <city>City 1</city>\n      <state>State 1</state>\n      <zipcode>Zip Code 1</zipcode>\n    </address>\n    <address>\n      <street>Street 2</street>\n      <city>City 2</city>\n      <state>State 2</state>\n      <zipcode>Zip Code 2</zipcode>\n    </address>'\nUNION ALL SELECT\n    'Kim', \n    '<address>\n      <street>Street 3</street>\n      <city>City 3</city>\n      <state>State 3</state>\n      <zipcode>Zip Code 3</zipcode>\n    </address>'\n\nSELECT * FROM @PEOPLE\n\n-- BUILD XML\nDECLARE @x XML\nSELECT @x = \n( SELECT \n      [Name]\n    , [Address].query('\n            for $a in //address\n            return <address \n                street="{$a/street}" \n                city="{$a/city}" \n                state="{$a/state}" \n                zipcode="{$a/zipcode}" \n            />\n        ') \n  FROM @PEOPLE AS people \n  FOR XML AUTO\n) \n\n-- RESULTS\nSELECT [Name]    = T.Item.value('../@Name', 'varchar(20)'),\n       street    = T.Item.value('@street' , 'varchar(20)'),\n       city      = T.Item.value('@city'   , 'varchar(20)'),\n       state     = T.Item.value('@state'  , 'varchar(20)'),\n       zipcode   = T.Item.value('@zipcode', 'varchar(20)')\nFROM   @x.nodes('//people/address') AS T(Item)\n\n/* OUTPUT*/\n\nName | street   | city   | state   | zipcode\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\nJoel | Street 1 | City 1 | State 1 | Zip Code 1\nJoel | Street 2 | City 2 | State 2 | Zip Code 2\nKim  | Street 3 | City 3 | State 3 | Zip Code 3