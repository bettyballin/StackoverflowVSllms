CREATE FUNCTION [dbo].[udf_GetDateInBusinessDays]\n(\n  @StartDate datetime,  --Start Date\n  @NumberDays int           --Good days ahead\n)\nRETURNS datetime\nAS\nBEGIN\n-- Declare the return variable here\nDECLARE @ReturnDate datetime\nSET @ReturnDate = dateadd(d, @NumberDays, @StartDate);\n\n\nDECLARE @d int;\nSET @d = (select count(1) from baddates where startdate >= @StartDate and startdate <= @ReturnDate);\n\ndeclare @t datetime;\n\nWHILE   @d > 0\nBEGIN\n    set @t = @ReturnDate;\n    set @ReturnDate = dateadd(d, @d, @ReturnDate);\n    SET @d = (select count(1) from baddates where startdate > @t and startdate <= @ReturnDate);\nEND\n\nRETURN @ReturnDate\nEND