select t.sp_name, sum(t.lines_of_code) - 1 as lines_ofcode, t.type_desc\nfrom\n(\n    select o.name as sp_name, \n    (len(c.text) - len(replace(c.text, char(10), ''))) as lines_of_code,\n    case when o.xtype = 'P' then 'Stored Procedure'\n    when o.xtype in ('FN', 'IF', 'TF') then 'Function'\n    end as type_desc\n    from sysobjects o\n    inner join syscomments c\n    on c.id = o.id\n    where o.xtype in ('P', 'FN', 'IF', 'TF')\n    and o.category = 0\n    and o.name not in ('fn_diagramobjects', 'sp_alterdiagram', 'sp_creatediagram', 'sp_dropdiagram', 'sp_helpdiagramdefinition', 'sp_helpdiagrams', 'sp_renamediagram', 'sp_upgraddiagrams', 'sysdiagrams')\n) t\ngroup by t.sp_name, t.type_desc\norder by 1