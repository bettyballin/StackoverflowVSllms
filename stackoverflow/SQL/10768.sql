WHILE EXISTS (SELECT * FROM ShoppingCartItem WHERE ShoppingCartItem.PurchID = @PurchID)\nBEGIN\n    SELECT TOP 1 \n            @TmpGFSID = ShoppingCartItem.GFSID, \n            @TmpQuantity = ShoppingCartItem.Quantity,\n            @TmpShoppingCartItemID = ShoppingCartItem.ShoppingCartItemID,\n    FROM\n            ShoppingCartItem INNER JOIN GoodsForSale on ShoppingCartItem.GFSID = GoodsForSale.GFSID\n    WHERE ShoppingCartItem.PurchID = @PurchID\n\n    EXEC @ErrorCode = spGoodsForSale_ReverseReservations @TmpGFSID, @TmpQuantity\n    IF @ErrorCode <> 0\n    BEGIN\n            Goto Cleanup    \n    END\n\n    BEGIN TRANSACTION delete\n\n        DELETE FROM ShoppingCartItem WHERE ShoppingCartItem.ShoppingCartItemID = @TmpShoppingCartItemID\n        -- @@ROWCOUNT is 1 after this\n\n    COMMIT TRANSACTION delete\nEND