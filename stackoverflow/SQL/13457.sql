WITH\nOrderedTable as (\n    select value, rownr = row_number() over (order by userid, id)\n    from YourTable\n    where userid = 2287\n),\nHeads as (\n    select cur.rownr, CurValue = cur.value\n    ,   headnr = row_number() over (order by cur.rownr)\n    from OrderedTable cur\n    left join OrderedTable prev on cur.rownr = prev.rownr+1 \n    where IsNull(prev.value,-1) != cur.value\n),\nValuesWithHead as (\n    select value\n    ,   HeadNr = (select max(headnr) \n                from Heads \n                where Heads.rownr <= data.rownr)\n    from OrderedTable data\n)\nselect Value, [Count] = count(*)\nfrom ValuesWithHead\ngroup by HeadNr, value\norder by count(*) desc