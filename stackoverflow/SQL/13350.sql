SELECT ticket.id\n     , game.home_team_id AS Home\n     , game.away_team_id AS Away\n     , game_count\nFROM (SELECT COUNT(game.id) as game_count FROM game WHERE game.date <  DATE_SUB(ticket.time_sold, INTERVAL 1 DAY AND (game.home_score > game.away_score AND game.home_team = Home OR game.away_score > game.home_score AND game.away_team = Away))) as home_team_wins\n   ,ticket JOIN game ON game.id = ticket.game_id