select head.userid, head.id, sum(profit), count(*)\nfrom #bingo b\ninner join (\n    select cur.userid, cur.id\n    from #bingo cur\n    left join #bingo prev \n        on cur.userid = prev.userid\n        and prev.id < cur.id\n        and not exists(\n            select * \n            from #bingo inbetween \n            where prev.userid = inbetween.userid \n            and prev.id < inbetween.id \n            and inbetween.id < cur.id)\n    where cur.winner = 1\n    and IsNull(prev.winner,0) = 0\n) head\n    on head.userid = b.userid \n    and head.id <= b.id 