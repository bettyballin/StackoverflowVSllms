with q(SchedId, PaymentNum, DueDate, RunningExpectedTotal) as\n    (select SchedId,\n            1 as PaymentNum,\n            StartDate as DueDate,\n            PaymentAmt as RunningExpectedTotal\n     from PaymentScheduleTable\n     union all\n     select q.SchedId,\n             1 + q.PaymentNum as PaymentNum,\n             DATEADD(month, s.Frequency, q.DueDate) as DueDate,\n             q.RunningExpectedTotal + s.PaymentAmt as RunningExpectedTotal\n     from q\n          inner join PaymentScheduleTable s\n                  on s.SchedId = q.SchedId\n     where q.PaymentNum <= s.Term / s.Frequency)\nselect *\nfrom q\norder by SchedId, PaymentNum