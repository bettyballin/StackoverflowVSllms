DECLARE @NumberOfRows INT\n\nSELECT @NumberOfRows = Count(* ) FROM   user_details\n WITH messageentries\n      AS (SELECT   Row_number()\n                  OVER(ORDER BY score DESC) AS row,\n                Count(DISTINCT town.townid) AS towns,\n                user_details.username,\n                user_score.score,\n                allience.alliencename,\n                allience.allienceid,\n                allience.alliencetagname,\n                @NumberOfRows AS numberofrows\n       FROM     user_details\n                INNER JOIN user_score\n                  ON user_details.username = user_score.username\n                INNER JOIN town\n                  ON user_details.username = town.townownername\n                LEFT OUTER JOIN allience_roles\n                  ON user_details.useralliencerole = allience_roles.roleid\n                LEFT OUTER JOIN allience\n                  ON allience_roles.allienceid = allience.allienceid\n       GROUP BY user_details.username,\n                user_score.score,\n                allience.alliencename,\n                allience.allienceid,\n                allience.alliencetagname)\n SELECT *, MyRowNumber.row AS myself\n FROM   messageentries,\n        (SELECT row FROM messageentries WHERE username = 'myUsername') MyRowNumber\n WHERE  row BETWEEN @startRowIndex AND @StartRowIndex + @RowsPerPage - 1