CREATE PROCEDURE uspPrintDependencies\n(\n    @obj_name varchar(300),\n    @level int\n)\nAS\nSET NOCOUNT ON\nDECLARE @sub_obj_name varchar(300)\n\nif @level > 0 begin\n    PRINT Replicate(' ',@level) + @obj_name\nend\nelse begin\n    PRINT @obj_name\nend\n\nDECLARE myCursor CURSOR LOCAL FOR \n    SELECT \n        DISTINCT c.name \n    FROM dbo.sysdepends a\n        INNER JOIN dbo.sysobjects b ON a.id = b.id\n        INNER JOIN dbo.sysobjects c ON a.depid = c.id\n    WHERE b.name = @obj_name\nOPEN myCursor\nSET @level = @level + 1\nFETCH NEXT FROM myCursor INTO @sub_obj_name \nWHILE @@FETCH_STATUS = 0 BEGIN \n    EXEC uspPrintDependencies @sub_obj_name, @level \n    FETCH NEXT FROM myCursor INTO @sub_obj_name \nEND\nCLOSE myCursor\nDEALLOCATE myCursor\nGO