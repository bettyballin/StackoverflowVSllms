select id, min(start_date) period_start, max(end_date) period_end\nfrom\n(\nselect \n    id, start_date, end_date,\n    max(contig) over (partition by id order by end_date) contiguous_group\nfrom\n(\nselect \n    id, start_date, end_date,\n    case \n        when lag(end_date) over (partition by id order by end_date) != start_date-1 or row_number() over (partition by id order by end_date)=1 \n            then row_number() over (partition by id order by end_date) else null end contig\nfrom t2\n)\n)\ngroup by id, contiguous_group\norder by id, period_start\n/