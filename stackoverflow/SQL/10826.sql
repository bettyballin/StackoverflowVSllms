CREATE FUNCTION string_similarity(str1 varchar, str2 varchar)\nRETURNS float8 AS '\n\nstr1.downcase! \npairs1 = (0..str1.length-2).collect {|i| str1[i,2]}.reject {\n  |pair| pair.include? " "}\nstr2.downcase! \npairs2 = (0..str2.length-2).collect {|i| str2[i,2]}.reject {\n  |pair| pair.include? " "}\nunion = pairs1.size + pairs2.size \nintersection = 0 \npairs1.each do |p1| \n  0.upto(pairs2.size-1) do |i| \n    if p1 == pairs2[i] \n      intersection += 1 \n      pairs2.slice!(i) \n      break \n    end \n  end \nend \n(2.0 * intersection) / union\n\n' LANGUAGE 'plruby';