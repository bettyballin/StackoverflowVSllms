SELECT  @avgmonths = AVG(x.[count])\nFROM    ( SELECT    CAST(COUNT(DISTINCT DATEPART(month,\n                                                 DATEADD(month,\n                                                         DATEDIFF(month, 0, dscdate),\n                                                         0))) AS FLOAT) AS [count]\n          FROM      HospDscDate\n          GROUP BY  hosp\n         ) x\n\nIF @avgmonths > 7 \n    SET @months = 12\nELSE \n    SET @months = 6\n\n\nSELECT  'Submitter missing data for some months' AS [WarningType],\n     t.id\nFROM    TheTable t\nWHERE   EXISTS ( SELECT 1\n                 FROM   TheTable t1\n                 WHERE  t.id = t1.id\n                 HAVING COUNT(DISTINCT DATEPART(month,\n                       DATEADD(month, DATEDIFF(month, 0, t1.Date), 0))) < @months )\nGROUP BY t.id