CREATE TYPE tp_concat AS (data TEXT[], delimiter TEXT);\n\nCREATE OR REPLACE FUNCTION group_concat_iterate(_state tp_concat, _value TEXT, delimiter TEXT, is_distinct boolean)\n  RETURNS tp_concat AS\n$BODY$\n  SELECT\n    CASE\n      WHEN $1 IS NULL THEN ARRAY[$2]\n      WHEN $4 AND $1.data @> ARRAY[$2] THEN $1.data\n      ELSE $1.data || $2\n  END,\n  $3\n$BODY$\n  LANGUAGE 'sql' VOLATILE;\n\nCREATE OR REPLACE FUNCTION group_concat_finish(_state tp_concat)\n  RETURNS text AS\n$BODY$\n    SELECT array_to_string($1.data, $1.delimiter)\n$BODY$\n  LANGUAGE 'sql' VOLATILE;\n\nCREATE AGGREGATE group_concat(text, text, boolean) (SFUNC = group_concat_iterate, STYPE = tp_concat, FINALFUNC = group_concat_finish);