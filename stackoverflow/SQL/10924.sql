CREATE PROC TagMe(@TagName VARCHAR(100),@TaggedRecordId INT)\nAS\n\nDECLARE @TagId INT\n\nSET @TagId = SELECT TagId FROM Tag WHERE TagName = @TagName\n\nIF @TagId IS NOT NULL\n    BEGIN\n    --Tag exists\n        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)\n    RETURN\n    END\nELSE\n    -- New tag\n    BEGIN\n        INSERT INTO Tag (TagName) OUTPUT inserted.id INTO @TagId VALUES(@TagName)\n        INSERT INTO TaggedRecords (TagId, TaggedRecordId) VALUES(@TagId,@TaggedRecordId)\n    RETURN\nEND