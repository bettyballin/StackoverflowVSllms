create table #temp ([timestamp] date,value int);\ninsert into #temp (timestamp,value) values ('2009-01-01',100)\ninsert into #temp (timestamp,value) values ('2009-01-02',105)\ninsert into #temp (timestamp,value) values ('2009-01-03',120)\ninsert into #temp (timestamp,value) values ('2009-01-04',0)\ninsert into #temp (timestamp,value) values ('2009-01-05',9);\n\nwith numbered as\n(\n    select ROW_NUMBER() over (order by timestamp) id,value from #temp\n)\nselect sum(n1.value-n2.value) from numbered n1 join numbered n2 on n1.id=n2.id+1 where n1.value!=0\n\ndrop table #temp;