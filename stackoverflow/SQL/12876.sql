SELECT query.historyID\n    FROM\n    (SELECT MAX(track.trackID) AS maxTrackID, track.historyID\n    FROM RS_HistoryTracker track\n    WHERE track.trackDateTime <= '2009-08-06 23:59:59'\n      AND track.action LIKE 'STATUS:%'\n    GROUP BY historyID) AS query, RS_HistoryTracker track\n    WHERE track.historyID = query.historyID\n      AND track.trackID = query.maxTrackID\n      AND track.action LIKE 'STATUS:%:DRAFT'