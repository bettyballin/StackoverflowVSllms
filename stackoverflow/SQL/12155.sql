CREATE TABLE CheckConstraint\n(\n  Id TINYINT,\n  Name VARCHAR(50),\n  RecordStatus TINYINT\n)\nGO\n\nCREATE FUNCTION CheckActiveCount(\n  @Id INT\n) RETURNS INT AS BEGIN\n\n  DECLARE @ret INT;\n  SELECT @ret = COUNT(*) FROM CheckConstraint WHERE Id = @Id AND RecordStatus = 1;\n  RETURN @ret;\n\nEND;\nGO\n\nALTER TABLE CheckConstraint\n  ADD CONSTRAINT CheckActiveCountConstraint CHECK (NOT (dbo.CheckActiveCount(Id) > 1 AND RecordStatus = 1));\n\nINSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);\nINSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);\nINSERT INTO CheckConstraint VALUES (1, 'No Problems', 2);\nINSERT INTO CheckConstraint VALUES (1, 'No Problems', 1);\n\nINSERT INTO CheckConstraint VALUES (2, 'Oh no!', 1);\nINSERT INTO CheckConstraint VALUES (2, 'Oh no!', 2);\n-- Msg 547, Level 16, State 0, Line 14\n-- The INSERT statement conflicted with the CHECK constraint "CheckActiveCountConstraint". The conflict occurred in database "TestSchema", table "dbo.CheckConstraint".\nINSERT INTO CheckConstraint VALUES (2, 'Oh no!', 1);\n\nSELECT * FROM CheckConstraint;\n-- Id   Name         RecordStatus\n-- ---- ------------ ------------\n-- 1    No Problems  2\n-- 1    No Problems  2\n-- 1    No Problems  2\n-- 1    No Problems  1\n-- 2    Oh no!       1\n-- 2    Oh no!       2\n\nALTER TABLE CheckConstraint\n  DROP CONSTRAINT CheckActiveCountConstraint;\n\nDROP FUNCTION CheckActiveCount;\nDROP TABLE CheckConstraint;