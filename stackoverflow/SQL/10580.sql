START TRANSACTION ISOLATION LEVEL SERIALIZABLE, READ WRITE;\n\nCREATE SCHEMA so;\n\nSET search_path TO SO,"$user",public;\n\nCREATE DOMAIN so.HashedPassword AS \n    BIGINT CONSTRAINT HashedPassword_Unsigned_Chk CHECK (VALUE >= 0);\n\nCREATE TABLE so."User"\n(\n    USER_ID SERIAL NOT NULL,\n    USER_NAME CHARACTER VARYING(50) NOT NULL,\n    EMAIL_ADDRESS CHARACTER VARYING(256) NOT NULL,\n    HASHED_PASSWORD so.HashedPassword NOT NULL,\n    OPEN_ID CHARACTER VARYING(512),\n    A_MODERATOR BOOLEAN,\n    LOGGED_IN BOOLEAN,\n    HAS_BEEN_SENT_A_MODERATOR_MESSAGE BOOLEAN,\n    CONSTRAINT User_PK PRIMARY KEY(USER_ID)\n);\n\nCREATE TABLE so.Question\n(\n    QUESTION_ID SERIAL NOT NULL,\n    TITLE CHARACTER VARYING(256) NOT NULL,\n    WAS_SENT_AT_TIME TIMESTAMP NOT NULL,\n    BODY CHARACTER VARYING NOT NULL,\n    USER_ID INTEGER NOT NULL,\n    FLAGGED_FOR_MODERATOR_REMOVAL BOOLEAN,\n    WAS_LAST_CHECKED_BY_MODERATOR_AT_TIME TIMESTAMP,\n    CONSTRAINT Question_PK PRIMARY KEY(QUESTION_ID)\n);\n\nCREATE TABLE so.Tag\n(\n    TAG_ID SERIAL NOT NULL,\n    TAG_NAME CHARACTER VARYING(20) NOT NULL,\n    CONSTRAINT Tag_PK PRIMARY KEY(TAG_ID),\n    CONSTRAINT Tag_UC UNIQUE(TAG_NAME)\n);\n\nCREATE TABLE so.QuestionTaggedTag\n(\n    QUESTION_ID INTEGER NOT NULL,\n    TAG_ID INTEGER NOT NULL,\n    CONSTRAINT QuestionTaggedTag_PK PRIMARY KEY(QUESTION_ID, TAG_ID)\n);\n\nCREATE TABLE so.Answer\n(\n    ANSWER_ID SERIAL NOT NULL,\n    BODY CHARACTER VARYING NOT NULL,\n    USER_ID INTEGER NOT NULL,\n    QUESTION_ID INTEGER NOT NULL,\n    CONSTRAINT Answer_PK PRIMARY KEY(ANSWER_ID)\n);\n\nALTER TABLE so.Question \n    ADD CONSTRAINT Question_FK FOREIGN KEY (USER_ID) \n    REFERENCES so."User" (USER_ID) ON DELETE RESTRICT ON UPDATE RESTRICT;\n\nALTER TABLE so.QuestionTaggedTag \n    ADD CONSTRAINT QuestionTaggedTag_FK1 FOREIGN KEY (QUESTION_ID) \n    REFERENCES so.Question (QUESTION_ID) ON DELETE RESTRICT ON UPDATE RESTRICT;\n\nALTER TABLE so.QuestionTaggedTag \n    ADD CONSTRAINT QuestionTaggedTag_FK2 FOREIGN KEY (TAG_ID) \n    REFERENCES so.Tag (TAG_ID) ON DELETE RESTRICT ON UPDATE RESTRICT;\n\nALTER TABLE so.Answer \n    ADD CONSTRAINT Answer_FK1 FOREIGN KEY (USER_ID) \n    REFERENCES so."User" (USER_ID) ON DELETE RESTRICT ON UPDATE RESTRICT;\n\nALTER TABLE so.Answer \n    ADD CONSTRAINT Answer_FK2 FOREIGN KEY (QUESTION_ID) \n    REFERENCES so.Question (QUESTION_ID) ON DELETE RESTRICT ON UPDATE RESTRICT;\n\nCOMMIT WORK;