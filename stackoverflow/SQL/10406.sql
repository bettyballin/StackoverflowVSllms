SELECT ID, DES, LEFT(DIDS, LEN(DIDS)-1) AS DIDS\n FROM MASTER M1 INNER JOIN DETAIL D on M1.ID = D.MID \n  CROSS APPLY (\n    SELECT DID + ', '\n    FROM MASTER M2 INNER JOIN DETAIL D on M2.ID = D.MID \n    WHERE M1.ID = M2.ID\n    FOR XML PATH('')\n   ) pre_trimmed (DIDS)\nGROUP BY ID, DES, DIDS