with Links(id,link,data) as (\n  select\n    id, redirectid, data\n  from T\n  where redirectid is null\n  union all\n  select\n    id, redirectid, null\n  from T\n  where redirectid is not null\n  union all\n  select\n    Links.id,\n    T.redirectid,\n    case when T.redirectid is null then T.data else null end\n  from T\n  join Links\n  on Links.link = T.id\n)\n  select id, data\n  from Links\n  where data is not null;