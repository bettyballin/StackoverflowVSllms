select Sum(VisitingCount)as VisitingCount, [Time]\nfrom (\n  select Sum(VisitingCount)as VisitingCount, [Time]\n    from #Temp group by [Time]\n  Union All\n    select count(page) as VisitingCount, \n    (datepart(hour,Date)*60+datepart(minute,Date))/30 as [Time]\n    from scr_SecuristLog\n    where Date between '2009-05-04 10:30' and '2009-05-04 12:30'\n    GROUP BY (datepart(hour,Date)*60+datepart(minute,Date))/30--scr\n  ) X\ngroup by [Time]\norder by 2 asc