INSERT INTO @ResultTable (StaffName, Stage1Count, Stage2Count)\n  SELECT StaffName,0,0 FROM ViewJob\n  GROUP BY StaffName\n\nUPDATE @ResultTable Stage1Count= (\n  SELECT COUNT(*) AS count FROM ViewJob\n  WHERE InStage1 = 1\n  @ResultTable.StaffName = StaffName)\n\nUPDATE @ResultTable Stage2Count= (\n  SELECT COUNT(*) AS count FROM ViewJob\n  WHERE InStage2 = 1\n  @ResultTable.StaffName = StaffName)