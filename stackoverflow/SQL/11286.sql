CREATE TABLE #LogEntries (\n  ID INT IDENTITY,\n  LogEntry VARCHAR(100)\n)\n\nINSERT INTO #LogEntries VALUES ('beans')\nINSERT INTO #LogEntries VALUES ('beans')\nINSERT INTO #LogEntries VALUES ('beans')\nINSERT INTO #LogEntries VALUES ('cabbage')\nINSERT INTO #LogEntries VALUES ('cabbage')\nINSERT INTO #LogEntries VALUES ('carrots')\nINSERT INTO #LogEntries VALUES ('beans')\nINSERT INTO #LogEntries VALUES ('beans')\nINSERT INTO #LogEntries VALUES ('carrots')\n\nSELECT logentry, COUNT(*) FROM (\n    SELECT logentry, \n    ISNULL((SELECT MAX(id) FROM #logentries l2 WHERE l1.logentry<>l2.logentry AND l2.id < l1.id), 0) AS id\n    FROM #LogEntries l1\n) AS a\nGROUP BY logentry, id\n\n\nDROP TABLE #logentries 