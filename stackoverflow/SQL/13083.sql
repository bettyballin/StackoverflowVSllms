SELECT  userid, COUNT(*) as cnt,\n        (\n        SELECT  CASE t.userid WHEN winner THEN winner_elo ELSE loser_elo END\n        FROM    webl_games l\n        WHERE   t.userid IN (winner, loser)\n        ORDER BY\n                reported_on DESC\n        LIMIT 1\n        ) AS last_elo\nFROM    (\n        SELECT  winner as userid\n        FROM    webl_games g \n        WHERE   (g.reported_on > now() - interval 4 day\n        UNION ALL \n        SELECT  loser as userid\n        FROM    webl_games g \n        WHERE   g.reported_on > now() - interval 4 day\n        ) t\nGROUP BY\n        userid