create table #Orders (\n    order_no int,\n    suboperation varchar(30),\n    finished smalldatetime)\n\ninsert into #Orders values (1 , 'preparing' , '01/01/2009')\ninsert into #Orders values (1 , 'scrubbing' , '01/05/2009')\ninsert into #Orders values (1 , 'painting' , '01/10/2009')\ninsert into #Orders values (2 , 'preparing' , '02/05/09')\ninsert into #Orders values (2 , 'painting' , NULL)\ninsert into #Orders values (3 , 'preparing' , '03/01/2009')\ninsert into #Orders values (3 , 'scrubbing' , '03/15/2009')\ninsert into #Orders values (3 , 'painting' , '03/10/2009')\ninsert into #Orders values (4 , 'bending' , NULL)\ninsert into #Orders values (4 , 'crashing' , NULL)\ninsert into #Orders values (4 , 'staining' , NULL)\ninsert into #Orders values (4 , 'painting' , NULL)\n\nselect \n    order_no, \n    count(1) As NoOfSubtasks --count(1) gives the number of rows in the group\n    count(finished) As NoFinished, --count will not count nulls\nfrom #Stuff\ngroup by \n     order_no\nhaving \n    count(finished) = count(1) --if finished = number of tasks then it's complete\n\ndrop table #Orders