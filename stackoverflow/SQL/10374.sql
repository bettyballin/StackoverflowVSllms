CREATE TABLE rank (name VARCHAR(20) NOT NULL, points INTEGER NOT NULL);\n\nCREATE INDEX ix_rank_points ON rank(points, name);\n\nCREATE PROCEDURE prc_ranks(fromrank INT, tillrank INT)\nBEGIN\n  SET @fromrank = fromrank;\n  SET @tillrank = tillrank;\n  PREPARE STMT FROM\n  '\n  SELECT  rn, rank, name, points\n  FROM  (\n    SELECT  CASE WHEN @cp = points THEN @rank ELSE @rank := @rn + 1 END AS rank,\n            @rn := @rn + 1 AS rn,\n            @cp := points,\n            r.*\n    FROM (\n         SELECT @cp := -1, @rn := 0, @rank = 1\n         ) var,\n         (\n         SELECT *\n         FROM rank\n         FORCE INDEX (ix_rank_points)\n         ORDER BY\n           points DESC, name DESC\n         LIMIT ?\n         ) r\n    ) o\n  WHERE rn >= ?\n  ';\n  EXECUTE STMT USING @tillrank, @fromrank;\nEND;\n\nCALL prc_ranks (2, 5);