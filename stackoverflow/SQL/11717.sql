DECLARE @Date DATETIME,\n        @StartOfDay FLOAT,\n        @EndOfDay FLOAT,\n        @DateAdd DATETIME\n\nSELECT  @Date ='2009-06-26 15:45:00.000',\n        @StartOfDay = 8.5,\n        @EndOfDay = 17.5,\n        @DateAdd = '1900-01-01 09:00:00.000'\n\n--fix up start date\n--before start of day, move to start of day\nIF ((CAST(@Date - DATEADD(dd,0, DATEDIFF(dd,0,@Date)) AS FLOAT) * 24) < @StartOfDay)\nBEGIN\n    SET @Date = DATEADD(mi, @StartOfDay * 60, DATEDIFF(dd,0,@Date))\nEND\n\n--after close of day, move to start of next day\nIF ((CAST(@Date - DATEADD(dd,0, DATEDIFF(dd,0,@Date)) AS FLOAT) * 24) > @EndOfDay)\nBEGIN\n    SET @Date = DATEADD(mi, @StartOfDay * 60, DATEDIFF(dd,0,@Date)) + 1\nEND\n\n--move to monday if on weekend\nWHILE DATENAME(dw, @Date) IN ('Saturday','Sunday')\nBEGIN\n    SET @Date = @Date + 1\nEND\n\n--get the number of hours to add and the total hours per day\nDECLARE @HoursPerDay FLOAT\nDECLARE @HoursAdd FLOAT\nSET @HoursAdd = DATEDIFF(hh, '1900-01-01 00:00:00.000', @DateAdd)\nSET @HoursPerDay = @EndOfDay - @StartOfDay\n\n--date the time of geiven day\nDECLARE @CurrentHours FLOAT\nSET @CurrentHours = CAST(@Date - DATEADD(dd,0, DATEDIFF(dd,0,@Date)) AS FLOAT) * 24\n\n--if we stay in the same day, all is fine\nIF (@CurrentHours + @HoursAdd <= @EndOfDay)\nBEGIN\n    SET @Date = @Date + @DateAdd\nEND\nELSE\nBEGIN\n    --remove part of day\n    SET @HoursAdd = @HoursAdd - (@EndOfDay - @CurrentHours)\n    --,ove to next day\n    SET @Date = DATEADD(dd,0, DATEDIFF(dd,0,@Date)) + 1\n\n    --loop day\n    WHILE @HoursAdd > 0\n    BEGIN\n        --add day but keep hours to add same\n        IF (DATENAME(dw,@Date) IN ('Saturday','Sunday'))\n        BEGIN\n            SET @Date = @Date + 1\n        END\n        ELSE\n        BEGIN\n            --add a day, and reduce hours to add\n            IF (@HoursAdd > @HoursPerDay)\n            BEGIN\n                SET @Date = @Date + 1\n                SET @HoursAdd = @HoursAdd - @HoursPerDay\n            END\n            ELSE\n            BEGIN\n                --add the remainder of the day\n                SET @Date = DATEADD(mi, (@HoursAdd + @StartOfDay) * 60, DATEDIFF(dd,0,@Date))\n                SET @HoursAdd = 0\n            END\n        END     \n    END\nEND\n\nSELECT @Date