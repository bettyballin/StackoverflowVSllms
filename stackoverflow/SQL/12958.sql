select\n    c.name as company,\n    d.name as division,\n    s.name as salesperson,\n    sum(h.callsinbound) as callsinboundsum,\n    sum(h.callsoutbound) as callsoutboundsum,\n    sum(h.issuedorders) as issuedorderssum,\n    sum(h.revenue) as revenuesum\nfrom\n    sales_history_performance h\n    inner join\n        (select\n            th.salespersonid,\n            date(th.timestamp) as my_date,\n            max(th.timestamp) as max_time\n        from\n            sales_history_performance th\n            inner join salesperson ts on\n                th.salespersonid = ts.id\n        where\n            th.timestamp between '5/1/2009' and '5/3/2009' --inclusive in MySQL\n        group by\n            th.salespersonid,\n            date(th.timestamp)\n        ) t on\n      h.salespersonid = t.salespersonid\n      and h.timestamp = t.max_time\n    inner join salesperson s on\n        h.salespersonid = s.id\n    inner join division d on\n        s.divisionid = d.id\n    inner join company c on\n        d.companyid = c.id\ngroup by\n    c.name,\n    d.name,\n    s.name\norder by 1,2,3