SELECT Subscribers.ID, '1' AS TemplateID\nFROM Subscribers \nWHERE EXISTS( SELECT *\n                FROM SubscriberGroups\n               WHERE Subscribers.ID=SubscriberGroups.SubscriberID\n                                 AND SubscriberGroups.GroupID IN ('1', '2', '3') )\n\n  AND NOT EXISTS( SELECT *\n                    FROM SubscriberGroups\n                   WHERE Subscribers.ID=SubscriberGroups.SubscriberID \n                     AND SubscriberGroups.GroupID IN ('4', '5', '6')\n    );