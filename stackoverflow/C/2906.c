#include <typeinfo>\n#include <map>\n#include <string>\nusing namespace std;\n\nclass SomeClass\n{\npublic:\n    virtual ~SomeClass() {} // virtual function to get a v-table\n};\n\nstruct type_info_less\n{\n    bool operator() (const std::type_info* lhs, const std::type_info* rhs) const\n    {\n        return lhs->before(*rhs) != 0;\n    }\n};\n\nclass TypeMap\n{\n    typedef map <type_info *, void *, type_info_less> TypenameToObject;\n    TypenameToObject ObjectMap;\n\npublic:\n    template <typename T> \n    T *Get () const\n    {\n        TypenameToObject::const_iterator iType = ObjectMap.find(&typeid(T));\n        if (iType == ObjectMap.end())\n            return NULL;\n        return reinterpret_cast<T *>(iType->second);\n    }\n    template <typename T> \n    void Set(T *value) \n    {\n        ObjectMap[&typeid(T)] = reinterpret_cast<void *>(value);\n    }\n};\n\nint main()\n{\n    TypeMap Services;\n    Services.Set<SomeClass>(new SomeClass());\n    SomeClass *x = Services.Get<SomeClass>();\n}