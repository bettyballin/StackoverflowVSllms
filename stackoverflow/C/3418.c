//*************************************************************\n//\n//  RegDelnodeRecurse()\n//\n//  Purpose:    Deletes a registry key and all it's subkeys / values.\n//\n//  Parameters: hKeyRoot    -   Root key\n//              lpSubKey    -   SubKey to delete\n//\n//  Return:     TRUE if successful.\n//              FALSE if an error occurs.\n//\n//*************************************************************\n\nBOOL RegDelnodeRecurse (HKEY hKeyRoot, LPTSTR lpSubKey)\n{\n    LPTSTR lpEnd;\n    LONG lResult;\n    DWORD dwSize;\n    TCHAR szName[MAX_PATH];\n    HKEY hKey;\n    FILETIME ftWrite;\n\n    // First, see if we can delete the key without having\n    // to recurse.\n\n    lResult = RegDeleteKey(hKeyRoot, lpSubKey);\n\n    if (lResult == ERROR_SUCCESS) \n        return TRUE;\n\n    lResult = RegOpenKeyEx (hKeyRoot, lpSubKey, 0, KEY_READ, &hKey);\n\n    if (lResult != ERROR_SUCCESS) \n    {\n        if (lResult == ERROR_FILE_NOT_FOUND) {\n            printf("Key not found.\n");\n            return TRUE;\n        } \n        else {\n            printf("Error opening key.\n");\n            return FALSE;\n        }\n    }\n\n    // Check for an ending slash and add one if it is missing.\n\n    lpEnd = lpSubKey + lstrlen(lpSubKey);\n\n    if (*(lpEnd - 1) != TEXT('\\')) \n    {\n        *lpEnd =  TEXT('\\');\n        lpEnd++;\n        *lpEnd =  TEXT('\0');\n    }\n\n    // Enumerate the keys\n\n    dwSize = MAX_PATH;\n    lResult = RegEnumKeyEx(hKey, 0, szName, &dwSize, NULL,\n                           NULL, NULL, &ftWrite);\n\n    if (lResult == ERROR_SUCCESS) \n    {\n        do {\n\n            StringCchCopy (lpEnd, MAX_PATH*2, szName);\n\n            if (!RegDelnodeRecurse(hKeyRoot, lpSubKey)) {\n                break;\n            }\n\n            dwSize = MAX_PATH;\n\n            lResult = RegEnumKeyEx(hKey, 0, szName, &dwSize, NULL,\n                                   NULL, NULL, &ftWrite);\n\n        } while (lResult == ERROR_SUCCESS);\n    }\n\n    lpEnd--;\n    *lpEnd = TEXT('\0');\n\n    RegCloseKey (hKey);\n\n    // Try again to delete the key.\n\n    lResult = RegDeleteKey(hKeyRoot, lpSubKey);\n\n    if (lResult == ERROR_SUCCESS) \n        return TRUE;\n\n    return FALSE;\n}\n\n//*************************************************************\n//\n//  RegDelnode()\n//\n//  Purpose:    Deletes a registry key and all it's subkeys / values.\n//\n//  Parameters: hKeyRoot    -   Root key\n//              lpSubKey    -   SubKey to delete\n//\n//  Return:     TRUE if successful.\n//              FALSE if an error occurs.\n//\n//*************************************************************\n\nBOOL RegDelnode (HKEY hKeyRoot, LPTSTR lpSubKey)\n{\n    TCHAR szDelKey[MAX_PATH*2];\n\n    StringCchCopy (szDelKey, MAX_PATH*2, lpSubKey);\n    return RegDelnodeRecurse(hKeyRoot, szDelKey);\n}