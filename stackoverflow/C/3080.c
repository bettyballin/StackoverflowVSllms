float a = d.Dot( d ) ;\nfloat b = 2*f.Dot( d ) ;\nfloat c = f.Dot( f ) - r*r ;\n\nfloat discriminant = b*b-4*a*c;\nif( discriminant < 0 )\n{\n  // no intersection\n}\nelse\n{\n  // ray didn't totally miss sphere,\n  // so there is a solution to\n  // the equation.\n  \n  discriminant = sqrt( discriminant );\n\n  // either solution may be on or off the ray so need to test both\n  // t1 is always the smaller value, because BOTH discriminant and\n  // a are nonnegative.\n  float t1 = (-b - discriminant)/(2*a);\n  float t2 = (-b + discriminant)/(2*a);\n\n  // 3x HIT cases:\n  //          -o->             --|-->  |            |  --|->\n  // Impale(t1 hit,t2 hit), Poke(t1 hit,t2>1), ExitWound(t1<0, t2 hit), \n\n  // 3x MISS cases:\n  //       ->  o                     o ->              | -> |\n  // FallShort (t1>1,t2>1), Past (t1<0,t2<0), CompletelyInside(t1<0, t2>1)\n  \n  if( t1 >= 0 && t1 <= 1 )\n  {\n    // t1 is the intersection, and it's closer than t2\n    // (since t1 uses -b - discriminant)\n    // Impale, Poke\n    return true ;\n  }\n\n  // here t1 didn't intersect so we are either started\n  // inside the sphere or completely past it\n  if( t2 >= 0 && t2 <= 1 )\n  {\n    // ExitWound\n    return true ;\n  }\n  \n  // no intn: FallShort, Past, CompletelyInside\n  return false ;\n}