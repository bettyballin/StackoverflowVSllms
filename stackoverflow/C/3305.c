/*\n    MySQL 4.1.1 password hashing: SHA conversion (see RFC 2289, 3174) twice\n    applied to the password string, and then produced octet sequence is\n    converted to hex string.\n    The result of this function is used as return value from PASSWORD() and\n    is stored in the database.\n  SYNOPSIS\n    make_scrambled_password()\n    buf       OUT buffer of size 2*SHA1_HASH_SIZE + 2 to store hex string\n    password  IN  NULL-terminated password string\n*/\n\nvoid\nmake_scrambled_password(char *to, const char *password)\n{\n  SHA1_CONTEXT sha1_context;\n  uint8 hash_stage2[SHA1_HASH_SIZE];\n\n  mysql_sha1_reset(&sha1_context);\n  /* stage 1: hash password */\n  mysql_sha1_input(&sha1_context, (uint8 *) password, (uint) strlen(password));\n  mysql_sha1_result(&sha1_context, (uint8 *) to);\n  /* stage 2: hash stage1 output */\n  mysql_sha1_reset(&sha1_context);\n  mysql_sha1_input(&sha1_context, (uint8 *) to, SHA1_HASH_SIZE);\n  /* separate buffer is used to pass 'to' in octet2hex */\n  mysql_sha1_result(&sha1_context, hash_stage2);\n  /* convert hash_stage2 to hex string */\n  *to++= PVERSION41_CHAR;\n  octet2hex(to, (const char*) hash_stage2, SHA1_HASH_SIZE);\n}