#include <vector>\n#include <boost/shared_ptr.hpp>\n#include <boost/weak_ptr.hpp>\n\nstruct InputData\n{\n    float diameter;\n    float length;\n    unsigned long vertIndex;\n    boost::weak_ptr<InputData> parent;\n    std::vector< boost::shared_ptr<InputData> > children;\n    bool deadEnd;\n\n    InputData(float dia, float lngth, boost::weak_ptr<InputData> p = boost::weak_ptr<InputData>(), bool de = false)\n        : diameter(dia), length(lngth), vertIndex(0), parent(p), deadEnd(de) {}\n};\n\nstruct SimpleVertex\n{\n    float Pos;\n\n    SimpleVertex(float position) : Pos(position) {}\n};\n\nvoid BuildMeshVertices(boost::shared_ptr<InputData> current, std::vector<SimpleVertex>& vertices)\n{\n    current->vertIndex = vertices.size();\n\n    //Add vertices..\n    if(current->children.size() == 1)\n    {\n        BuildMeshVertices(current->children[0], vertices);\n    }\n    else if(current->children.size() == 0 && current->deadEnd == false)\n    {\n          // this was a stack variable, so the pointer became invalid when going out of ambit.\n        boost::shared_ptr<InputData> iDeadEnd( new InputData(1.01f, 0.5f, current, true) );\n        current->children.push_back(iDeadEnd);         \n\n        BuildMeshVertices(iDeadEnd, vertices);\n    }\n}\n\nvoid BuildMeshIndices(boost::shared_ptr<InputData> current, std::vector<unsigned long>& indices)\n{\n    unsigned long vi = current->vertIndex;\n    unsigned long  ioffset[] = { vi+2, vi, vi+1, vi+3, vi, vi+2};\n    indices.insert(indices.end(), ioffset, ioffset+6);\n\n    boost::shared_ptr<InputData> parent = current->parent.lock();\n    if (parent && parent->children.size() == 1)\n    {   \n        unsigned long offs = current->vertIndex;\n          unsigned long voffset[] = \n          { offs+7, offs+5, offs+4, offs+6, offs+5, offs+7,\n            offs+10, offs+8, offs+9, offs+11, offs+8, offs+10,\n            offs+15, offs+13, offs+12, offs+14, offs+13, offs+15,\n            offs+18, offs+16, offs+17, offs+19, offs+16, offs+18 };\n          indices.insert(indices.end(), voffset, voffset+24);\n    }\n\n    if(current->children.size() == 1 && current->deadEnd == false)\n    {\n        BuildMeshIndices(current->children[0], indices);\n    }\n}\n\nint main()\n{\n    boost::shared_ptr<InputData> i0( new InputData(3.0f, 3.0f) );\n    boost::shared_ptr<InputData> i1( new InputData(2.0f, 2.0f) );\n    boost::shared_ptr<InputData> i2( new InputData(1.0f, 1.0f) );\n    boost::shared_ptr<InputData> i3( new InputData(1.0f, 1.0f) );\n    boost::shared_ptr<InputData> i4( new InputData(1.0f, 1.0f) );\n    boost::shared_ptr<InputData> i5( new InputData(1.01f, 0.5f) );\n\n    i0->children.push_back(i1);\n    i1->children.push_back(i2);\n    i2->children.push_back(i3);\n    i3->children.push_back(i4);\n    i4->children.push_back(i5);\n\n    i1->parent = i0;\n    i2->parent = i1;\n    i3->parent = i2;\n    i4->parent = i3;\n    i5->parent = i4;\n\n    // Create vertex buffer\n    std::vector<SimpleVertex> vertices;\n    BuildMeshVertices(i0, vertices);\n\n    // Create index buffer\n    std::vector<unsigned long> indices;\n    BuildMeshIndices(i0, indices);\n\n    return 0;\n}