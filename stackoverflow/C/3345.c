connectedRegion(const Point& source, RegionType& region, const Color target)\n{\n    Color src_color = color_of(source, region);\n    if (region.count(source) == 0 || src_color == target)\n        return;\n    std::queue<Point> analyze_queue;\n    analyze_queue.push(source);\n\n    while (!analyze_queue.empty())\n    {\n        if (color_of(analyze_queue.front()) != src_color)\n        {\n            analyze_queue.pop();\n            continue;\n        }\n        Point leftmost_pt = analyze_queue.front();\n            leftmost_pt.col -= 1;\n        analyze_queue.pop();\n        Point rightmost_pt = leftmost_pt;\n            rightmost_pt.col += 2;\n        while (color_of(leftmost_pt, region) == src_color)\n            --leftmost_pt.col;\n\n        while (color_of(rightmost_pt, region) == src_color)\n            ++rightmost_pt.col;\n\n        bool check_above = true;\n        bool check_below = true;\n            Point pt = leftmost_pt;\n            ++pt.col;\n        for (; pt.col < rightmost_pt.col; ++pt.col)\n        {\n            set_color(pt, region, target);\n\n            Point pt_above = pt;\n                    --pt_above.row;\n            if (check_above)\n            {\n                if (color_of(pt_above, region) == src_color)\n                {\n                    analyze_queue.push(pt_above);\n                    check_above = false;\n                }\n            }\n            else // !check_above\n            {\n                check_above = (color_of(pt_above, region) != src_color);\n            }\n\n            Point pt_below = pt;\n                    ++pt_below.row;\n            if (check_below)\n            {\n                if (color_of(pt_below, region) == src_color)\n                {\n                    analyze_queue.push(pt_below);\n                    check_below = false;\n                }\n            }\n            else // !check_below\n            {\n                check_below = (color_of(pt_below, region) != src_color);\n            }\n        } // for \n    } // while queue not empty\n    return connected;\n}