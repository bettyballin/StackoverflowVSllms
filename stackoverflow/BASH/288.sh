rm -rf clone?\n\n# clone 1 is the working copy\nmkdir clone1\n(\n    cd clone1\n    git init\n    echo foo >> file1\n    git add file1\n    git commit -m "Initial state"\n)\n\n# clone 2 is the staging repo\ngit clone clone1 clone2\n\n# create patches\n(\n    cd clone1\n    git tag staging # tag to track what's in staging\n\n    echo feature1 >> file1\n    git add file1\n    git commit -m "Feature 1"\n\n    echo feature2 >> file1\n    git add file1\n    git commit -m "Feature 2"\n\n    rm *.patch\n    git format-patch staging\n)\n\n# apply patches\n(\n    cd clone2\n    git am ../clone1/*.patch\n    # Cygwin/msysgit line ending weirdness when patching. Aborting and\n    # reapplying clears it up.\n    git am --abort \n    git am ../clone1/*.patch\n    git log\n    git status\n)