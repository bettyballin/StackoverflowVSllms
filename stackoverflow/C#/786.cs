public static int BinarySearchForMatch<T>(this IList<T> list,\n    Func<T,int> comparer)\n{\n    int min = 0;\n    int max = list.Count-1;\n\n    while (min <= max)\n    {\n        int mid = (min + max) / 2;\n        int comparison = comparer(list[mid]);\n        if (comparison == 0)\n        {\n            return mid;\n        }\n        if (comparison < 0)\n        {\n            min = mid+1;\n        }\n        else\n        {\n            max = mid-1;\n        }\n    }\n    return ~min;\n}