static string CutIt(string s, int limit)\n{\n    if (s.Length < limit) return s;\n\n    int okIndex = 0;\n    bool inClosingTag = false;\n    int numOpenTags = 0;\n\n    for (int i = 0; i < limit; i++)\n    {\n        if (s[i]=='<')\n        {\n            if (s[i+1]=='/')\n            {\n                inClosingTag = true;    \n            }\n            else\n            {\n                numOpenTags++;   \n            }\n        }\n        if (s[i]=='>')\n        {\n            if (s[i-1]=='/')\n            {\n                numOpenTags--;\n            }\n            if (inClosingTag)\n            {\n                numOpenTags--;\n            }\n        }\n\n        if (numOpenTags == 0) okIndex = i;\n\n    }\n    return s.Substring(0, okIndex + 1);\n}