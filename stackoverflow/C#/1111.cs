<%@ Page Language="C#" AutoEventWireup="true" %>\n<%@ Import Namespace="System.Data" %>\n<%@ Import Namespace="System.Data.OracleClient" %>\n\n<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">\n\n<html xmlns="http://www.w3.org/1999/xhtml">\n<head runat="server">\n<title>GridView w/ Oracle Ref Cursor</title>\n<style type="text/css">\n    body {padding:25px;}\n    .Button1 {margin:35px 0;}\n</style>\n<script runat="server" type="text/C#">\n    protected void Page_Load(object sender, EventArgs e) {\n    }\n\n    protected void Button1_Click(object sender, EventArgs e) {\n        var dataSet = new DataSet();\n        // get connection string from web.config\n        var connStr = ConfigurationManager.ConnectionStrings["ConnStr1"].ConnectionString;\n        // create connection\n        using (var conn = new OracleConnection(connStr)) {\n            // create & define the parameter\n            var refCursorParam = new OracleParameter();\n            refCursorParam.ParameterName = "RET";\n            refCursorParam.OracleType = OracleType.Cursor;\n            refCursorParam.Direction = ParameterDirection.Output;\n            // create & define the command\n            var cmd = new OracleCommand();\n            cmd.CommandText = "GET_ALL_EMPS";\n            cmd.CommandType = CommandType.StoredProcedure;\n            cmd.Parameters.Add(refCursorParam);\n            cmd.Connection = conn;\n            // use data adapter to fill dataset\n            using (var adapter = new OracleDataAdapter(cmd))\n                adapter.Fill(dataSet);\n        }\n        // set some gridview properties\n        GridView1.AllowPaging = true;\n        GridView1.PageSize = 5;\n\n        // bind dataset to grid\n        GridView1.DataSourceID = null;\n        var dv = dataSet.Tables[0].AsDataView();\n        // save dataview to session so gridview can be re-bound later\n        Session["dataView"] = dv;\n        GridView1.DataSource = dv;\n        GridView1.DataBind();\n\n        pCount.InnerText = "Total Row Count: " + dataSet.Tables[0].Rows.Count.ToString();\n\n        // dispose of dataset\n        dataSet.Dispose();\n    }\n\n    void GridView1_PageIndexChanging(object sender, GridViewPageEventArgs e) {\n        // get dataview from session\n        var dv = (DataView)Session["dataView"];\n        GridView1.DataSource = dv;\n        GridView1.PageIndex = e.NewPageIndex;\n        GridView1.DataBind(); // re-bind data\n    }\n</script>\n</head>\n<body>\n<form id="form1" runat="server">\n<asp:ScriptManager ID="ScriptManager1" runat="server" />\n<div>\n    <asp:UpdatePanel id="updatepanel1" runat="server">\n        <ContentTemplate>\n            <asp:Button ID="Button1"\n                runat="server"\n                Text="Refresh GridView"\n                OnClick="Button1_Click" />\n            <p id="pCount" runat="server" />\n            <asp:GridView ID="GridView1"\n                          runat="server"\n                          OnPageIndexChanging="GridView1_PageIndexChanging" />\n        </ContentTemplate>\n    </asp:UpdatePanel>\n</div>\n</form>\n</body>\n</html>