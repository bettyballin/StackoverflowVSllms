public static void EncryptAndSerialize(string filename, MyObject obj, SymmetricAlgorithm key)\n{\n    using(FileStream fs = File.Open(filename, FileMode.Create))\n    {\n        using(CryptoStream cs = new CryptoStream(fs, key.CreateEncryptor(), CryptoStreamMode.Write))\n        {\n            XmlSerializer xmlser = new XmlSerializer(typeof(MyObject));\n            xmlser.Serialize(cs, obj); \n        }\n    }\n}