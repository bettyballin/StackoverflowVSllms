// --------------------------------------------------------------------------------------------------------------------- \n// <copyright file="Program.cs" company="">\n//   \n// </copyright>\n// <summary>\n//   Defines the WmiChangeEventTester type.\n// </summary>\n// ---------------------------------------------------------------------------------------------------------------------\nnamespace WmiExample\n{\n    using System;\n    using System.Management;\n\n    /// <summary>\n    /// </summary>\n    public class WmiChangeEventTester\n    {\n        /// <summary>\n        /// Initializes a new instance of the <see cref="WmiChangeEventTester"/> class.\n        /// </summary>\n        public WmiChangeEventTester()\n        {\n            try\n            {\n                // Your query goes below; "KeyPath" is the key in the registry that you\n                // want to monitor for changes. Make sure you escape the \ character.\n                WqlEventQuery query = new WqlEventQuery(\n                     "SELECT * FROM RegistryValueChangeEvent WHERE " +\n                     "Hive = 'HKEY_LOCAL_MACHINE'" +\n                     @"AND KeyPath = 'SOFTWARE\\Microsoft\\.NETFramework' AND ValueName='InstallRoot'");\n\n                ManagementEventWatcher watcher = new ManagementEventWatcher(query);\n                Console.WriteLine("Waiting for an event...");\n\n                // Set up the delegate that will handle the change event.\n                watcher.EventArrived += new EventArrivedEventHandler(HandleEvent);\n\n                // Start listening for events.\n                watcher.Start();\n\n                // Do something while waiting for events. In your application,\n                // this would just be continuing business as usual.\n                System.Threading.Thread.Sleep(100000000);\n\n                // Stop listening for events.\n                watcher.Stop();\n            }\n            catch (ManagementException managementException)\n            {\n                Console.WriteLine("An error occurred: " + managementException.Message);\n            }\n        }\n\n        /// <summary>\n        /// </summary>\n        /// <param name="sender">\n        /// The sender.\n        /// </param>\n        /// <param name="e">\n        /// The e.\n        /// </param>\n        private void HandleEvent(object sender, EventArrivedEventArgs e)\n        {\n            Console.WriteLine("Received an event.");\n            // RegistryKeyChangeEvent occurs here; do something.\n        }\n\n        /// <summary>\n        /// </summary>\n        public static void Main()\n        {\n            // Just calls the class above to check for events...\n            WmiChangeEventTester receiveEvent = new WmiChangeEventTester();\n        }\n    }\n}