private void CompressAndSaveImage(Image img, string fileName, \n        long quality) {\n    EncoderParameters parameters = new EncoderParameters(1);\n    parameters.Param[0] = new EncoderParameter(Encoder.Quality, quality);\n    img.Save(fileName, GetCodecInfo("image/jpeg"), parameters);\n}\n\nprivate static ImageCodecInfo GetCodecInfo(string mimeType) {\n    foreach (ImageCodecInfo encoder in ImageCodecInfo.GetImageEncoders())\n        if (encoder.MimeType == mimeType)\n            return encoder;\n    throw new ArgumentOutOfRangeException(\n        string.Format("'{0}' not supported", mimeType));\n}