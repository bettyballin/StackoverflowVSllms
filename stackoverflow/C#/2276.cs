private const int FSCTL_SET_COMPRESSION = 0x9C040;\nprivate const short COMPRESSION_FORMAT_DEFAULT = 1;\n\n[DllImport("kernel32.dll", SetLastError = true)]\nprivate static extern int DeviceIoControl(\n    SafeFileHandle hDevice,\n    int dwIoControlCode,\n    ref short lpInBuffer,\n    int nInBufferSize,\n    IntPtr lpOutBuffer,\n    int nOutBufferSize,\n    ref int lpBytesReturned,\n    IntPtr lpOverlapped);\n\npublic static bool EnableCompression(SafeFileHandle handle)\n{\n    int lpBytesReturned = 0;\n    short lpInBuffer = COMPRESSION_FORMAT_DEFAULT;\n\n    return DeviceIoControl(handle, FSCTL_SET_COMPRESSION,\n        ref lpInBuffer, sizeof(short), IntPtr.Zero, 0,\n        ref lpBytesReturned, IntPtr.Zero) != 0;\n}