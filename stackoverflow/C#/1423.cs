string stringValue = "testtesttesttest4notaduped+c+d+f+d+c+d+f+d+c+d+f+d+c+d+f+testtesttest";\n\n        for(int i = 0; i < stringValue.Length; i++)\n        {\n            for (int k = 1; (k*2) + i <= stringValue.Length; k++)\n            {\n                int count = 1;\n\n                string compare1 = stringValue.Substring(i,k);\n                string compare2 = stringValue.Substring(i + k, k);\n\n                //Count if and how many duplicates\n                while (compare1 == compare2) \n                {\n                    count++;\n                    k += compare1.Length;\n                    if (i + k + compare1.Length > stringValue.Length)\n                        break;\n\n                    compare2 = stringValue.Substring(i + k, compare1.Length);\n                } \n\n                if (count > 1)\n                {\n                    //New code.  Added a space to the end to avoid [test]4 \n                    //turning using an invalid number ie: [test]44.\n                    string addString = "[" + compare1 + "]" + count + " ";\n\n                    //Only add code if we are saving space\n                    if (addString.Length < compare1.Length * count)\n                    {\n                        stringValue = stringValue.Remove(i, count * compare1.Length);\n                        stringValue = stringValue.Insert(i, addString);\n                        i = i + addString.Length - 1;\n                    }\n                    break;\n                }\n            }\n        }