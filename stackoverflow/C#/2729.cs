using System;\nusing System.Web;\n\npublic class Global_asax : System.Web.HttpApplication\n{\n    private void Application_BeginRequest(object sender, EventArgs e)\n    {\n        /* \n        Fix for the Flash Player Cookie bug in Non-IE browsers.\n        Since Flash Player always sends the IE cookies even in FireFox\n        we have to bypass the cookies by sending the values as part of the POST or GET\n        and overwrite the cookies with the passed in values.\n\n        The theory is that at this point (BeginRequest) the cookies have not been ready by\n        the Session and Authentication logic and if we update the cookies here we'll get our\n        Session and Authentication restored correctly\n        */\n\n        HttpRequest request = HttpContext.Current.Request;\n\n        try\n        {\n            string sessionParamName = "ASPSESSID";\n            string sessionCookieName = "ASP.NET_SESSIONID";\n\n            string sessionValue = request.Form[sessionParamName] ?? request.QueryString[sessionParamName];\n            if (sessionValue != null)\n            {\n                UpdateCookie(sessionCookieName, sessionValue);\n            }\n        }\n        catch (Exception ex)\n        {\n            // TODO: Add logging here.\n        }\n\n        try\n        {\n            string authParamName = "AUTHID";\n            string authCookieName = FormsAuthentication.FormsCookieName;\n\n            string authValue = request.Form[authParamName] ?? request.QueryString[authParamName];\n            if (authValue != null)\n            {\n                UpdateCookie(authCookieName, authValue);\n            }\n        }\n        catch (Exception ex)\n        {\n            // TODO: Add logging here.\n        }\n    }\n\n    private void UpdateCookie(string cookieName, string cookieValue)\n    {\n        HttpCookie cookie = HttpContext.Current.Request.Cookies.Get(cookieName);\n        if (cookie == null)\n        {\n            HttpCookie newCookie = new HttpCookie(cookieName, cookieValue);\n            Response.Cookies.Add(newCookie);\n        }\n        else\n        {\n            cookie.Value = cookieValue;\n            HttpContext.Current.Request.Cookies.Set(cookie);\n        }\n    }\n}