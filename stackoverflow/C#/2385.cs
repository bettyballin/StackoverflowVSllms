/// <summary>\n/// Removes control characters and other non-UTF-8 characters\n/// </summary>\n/// <param name="inString">The string to process</param>\n/// <returns>A string with no control characters or entities above 0x00FD</returns>\npublic static string RemoveTroublesomeCharacters(string inString)\n{\n    if (inString == null) return null;\n\n    StringBuilder newString = new StringBuilder();\n    char ch;\n\n    for (int i = 0; i < inString.Length; i++)\n    {\n\n        ch = inString[i];\n        // remove any characters outside the valid UTF-8 range as well as all control characters\n        // except tabs and new lines\n        //if ((ch < 0x00FD && ch > 0x001F) || ch == '\t' || ch == '\n' || ch == '\r')\n        //if using .NET version prior to 4, use above logic\n        if (XmlConvert.IsXmlChar(ch)) //this method is new in .NET 4\n        {\n            newString.Append(ch);\n        }\n    }\n    return newString.ToString();\n\n}