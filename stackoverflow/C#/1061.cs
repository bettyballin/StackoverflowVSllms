public class LineReader : IDisposable\n{\n    private Stream stream;\n    private BinaryReader reader;\n\n    public LineReader(Stream stream) { reader = new BinaryReader(stream); }\n\n    public string ReadLine()\n    {\n        StringBuilder result = new StringBuilder();\n        char lastChar = reader.ReadChar();\n        // an EndOfStreamException here would propogate to the caller\n\n        try\n        {\n            char newChar = reader.ReadChar();\n            if (lastChar == '\r' && newChar == '\n')\n                return result.ToString();\n\n            result.Append(lastChar);\n            lastChar = newChar;\n        }\n        catch (EndOfStreamException)\n        {\n            result.Append(lastChar);\n            return result.ToString();\n        }\n    }\n\n    public void Dispose()\n    {\n        reader.Close();\n    }\n}