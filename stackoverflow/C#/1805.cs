private ManagementEventWatcher WatchForProcessStart(string processName)\n    {\n        string queryString =\n            "SELECT TargetInstance" +\n            "  FROM __InstanceCreationEvent " +\n            "WITHIN  10 " +\n            " WHERE TargetInstance ISA 'Win32_Process' " +\n            "   AND TargetInstance.Name = '" + processName + "'";\n\n        // The dot in the scope means use the current machine\n        string scope = @"\\.\root\CIMV2";\n\n        // Create a watcher and listen for events\n        ManagementEventWatcher watcher = new ManagementEventWatcher(scope, queryString);\n        watcher.EventArrived += ProcessStarted;\n        watcher.Start();\n        return watcher;\n    }\n\n    private ManagementEventWatcher WatchForProcessEnd(string processName)\n    {\n        string queryString =\n            "SELECT TargetInstance" +\n            "  FROM __InstanceDeletionEvent " +\n            "WITHIN  10 " +\n            " WHERE TargetInstance ISA 'Win32_Process' " +\n            "   AND TargetInstance.Name = '" + processName + "'";\n\n        // The dot in the scope means use the current machine\n        string scope = @"\\.\root\CIMV2";\n\n        // Create a watcher and listen for events\n        ManagementEventWatcher watcher = new ManagementEventWatcher(scope, queryString);\n        watcher.EventArrived += ProcessEnded;\n        watcher.Start();\n        return watcher;\n    }\n\n    private void ProcessEnded(object sender, EventArrivedEventArgs e)\n    {\n        ManagementBaseObject targetInstance = (ManagementBaseObject) e.NewEvent.Properties["TargetInstance"].Value;\n        string processName = targetInstance.Properties["Name"].Value.ToString();\n        Console.WriteLine(String.Format("{0} process ended", processName));\n    }\n\n    private void ProcessStarted(object sender, EventArrivedEventArgs e)\n    {\n        ManagementBaseObject targetInstance = (ManagementBaseObject)e.NewEvent.Properties["TargetInstance"].Value;\n        string processName = targetInstance.Properties["Name"].Value.ToString();\n        Console.WriteLine(String.Format("{0} process started", processName));\n    }