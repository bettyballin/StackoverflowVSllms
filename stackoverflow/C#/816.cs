public static SqlQueryText GetFullQueryInfo(DataContext dataContext, IQueryable query)\n    {\n        DbCommand dbCommand = dataContext.GetCommand(query);\n\n        var result = new SqlQueryText();\n\n        result.Text = dbCommand.CommandText;\n        int nParams = dbCommand.Parameters.Count;\n        result.Params = new ParameterText[nParams];\n        for (int j = 0; j < nParams; j++)\n        {\n            var param = new ParameterText();\n            DbParameter pInfo = dbCommand.Parameters[j];\n            param.Name = pInfo.ParameterName;\n            param.SqlType = pInfo.DbType.ToString();\n            object paramValue = pInfo.Value;\n            if (paramValue == null)\n            {\n                param.Value = null;\n            }\n            else\n            {\n                param.Value = pInfo.Value.ToString();\n            }\n            result.Params[j] = param;\n        }\n        return result;\n    }