class ListViewToCSV\n{\n    public static void ListViewToCSV(ListView listView, string filePath, bool includeHidden)\n    {\n        //make header string\n        StringBuilder result = new StringBuilder();\n        WriteCSVRow(result, listView.Columns.Count, i => includeHidden || listView.Columns[i].Width > 0, i => listView.Columns[i].Text);\n\n        //export data rows\n        foreach (ListViewItem listItem in listView.Items)\n            WriteCSVRow(result, listView.Columns.Count, i => includeHidden || listView.Columns[i].Width > 0, i => listItem.SubItems[i].Text);\n\n        File.WriteAllText(filePath, result.ToString());\n    }\n\n    private static void WriteCSVRow(StringBuilder result, int itemsCount, Func<int, bool> isColumnNeeded, Func<int, string> columnValue)\n    {\n        bool isFirstTime = true;\n        for (int i = 0; i < itemsCount; i++)\n        {\n            if (!isColumnNeeded(i))\n                continue;\n\n            if (!isFirstTime)\n                result.Append(",");\n            isFirstTime = false;\n\n            result.Append(String.Format("\"{0}\"", columnValue(i)));\n        }\n        result.AppendLine();\n    }\n}