private void RecurseThroughFolders(Outlook.Folder theRootFolder, int depth)\n    {\n        if ( theRootFolder.DefaultItemType != Outlook.OlItemType.olMailItem ) {\n            return;\n        }\n\n        Console.WriteLine("{0}", theRootFolder.FolderPath);\n\n        foreach( Object item in theRootFolder.Items ) {\n            if (item.GetType() == typeof( Outlook.MailItem )) {\n                Outlook.MailItem mi = (Outlook.MailItem)item;\n                if (mi.Categories.Length > 0) {\n                    WriteLinePrefix(depth);\n                    Console.WriteLine("  $ {0}", mi.Categories);\n                }\n            }\n        }\n\n        foreach (Outlook.Folder folder in theRootFolder.Folders) {\n            RecurseThroughFolders(folder, depth + 1);\n        }\n    }\n\nprivate void ThisAddIn_Startup(object sender, System.EventArgs e)\n{\n    Outlook.Application olApp = new Outlook.Application();\n\n    Console.WriteLine("Default Profile = {0}", olApp.DefaultProfileName);\n\n    Console.WriteLine("Default Store = {0}", olApp.Session.DefaultStore.DisplayName);\n\n    selectExplorers = this.Application.Explorers;\n    selectExplorers.NewExplorer += new Outlook.ExplorersEvents_NewExplorerEventHandler( newExplorer_Event );\n\n    Outlook.Folder theRootFolder  = (Outlook.Folder) olApp.Session.DefaultStore.GetRootFolder();\n    RecurseThroughFolders( theRootFolder, 0 );\n}