CommonDialogClass class1 = new CommonDialogClass();\nDevice d = class1.ShowSelectDevice(WiaDeviceType.UnspecifiedDeviceType, true,false);\nif (d != null)\n{\n    settings.DeviceID = d.DeviceID;\n    settings.Save();\n}\n\n\nItem item = device.ExecuteCommand(CommandID.wiaCommandTakePicture);\nforeach (string format in item.Formats)\n{\n    if (format == jpegGuid)\n    {\n        WIA.ImageFile imagefile = item.Transfer(format) as WIA.ImageFile;\n        filename = GetFreeFileName();\n        if (string.IsNullOrEmpty(filename) == false)\n        {\n            imagefile.SaveFile(filename);\n        }\n        this.picLastImage.Load(filename);\n        return filename;\n    }\n}