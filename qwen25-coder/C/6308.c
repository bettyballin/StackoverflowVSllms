while(y1 < tex->height  && cmp_color(old_color, get_pixel_color(tex, x, y1)) ) {\n    set_pixel_color_with_style(payload, tex, x, y1);\n\n    if(!spanLeft && x > 0 && cmp_color(old_color, get_pixel_color(tex, x - 1, y1))) {\n        if(!push(x - 1, y1, tex->width)) return;\n        spanLeft = true;\n    } else if(spanLeft && (x <= 0 || !cmp_color(old_color, get_pixel_color(tex, x - 1, y1)))) {\n        spanLeft = false;\n    }\n\n    if(!spanRight && x < tex->width - 1 && cmp_color(old_color, get_pixel_color(tex, x + 1, y1))) {\n        if(!push(x + 1, y1, tex->width)) return;\n        spanRight = true;\n    } else if(spanRight && (x >= tex->width - 1 || !cmp_color(old_color, get_pixel_color(tex, x + 1, y1)))) {\n        spanRight = false;\n    }\n\n    y1++;\n}