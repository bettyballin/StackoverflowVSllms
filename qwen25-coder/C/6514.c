#include <sys/types.h>\n#include <sys/socket.h>\n#include <sys/un.h>\n#include <sys/ucred.h>\n#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <unistd.h>\n\nvoid receive_credentials(int sockfd) {\n    char buf[1];\n    struct msghdr msg;\n    struct cmsghdr *cmsg;\n    struct iovec iov;\n    char cmsgbuf[CMSG_SPACE(sizeof(struct xucred))];\n\n    memset(&iov, 0, sizeof(iov));\n    iov.iov_base = buf;\n    iov.iov_len = sizeof(buf);\n\n    memset(&msg, 0, sizeof(msg));\n    msg.msg_iov = &iov;\n    msg.msg_iovlen = 1;\n\n    memset(cmsgbuf, 0, sizeof(cmsgbuf));\n    msg.msg_control = cmsgbuf;\n    msg.msg_controllen = sizeof(cmsgbuf);\n\n    recvmsg(sockfd, &msg, 0);\n\n    for (cmsg = CMSG_FIRSTHDR(&msg); cmsg != NULL; cmsg = CMSG_NXTHDR(&msg,cmsg)) {\n        if (cmsg->cmsg_level == SOL_SOCKET &&\n            cmsg->cmsg_type == SCM_CREDS) {\n            struct xucred *xuc = (struct xucred *)CMSG_DATA(cmsg);\n            printf("Received credentials: pid %d, uid %d\n", xuc->cr_pid, xuc->cr_uid);\n        }\n    }\n}\n\nint main() {\n    int server_sockfd, client_len;\n    struct sockaddr_un server_address;\n\n    server_sockfd = socket(AF_UNIX, SOCK_STREAM, 0);\n\n    unlink("server_socket");\n    memset(&server_address, 0, sizeof(server_address));\n    server_address.sun_family = AF_UNIX;\n    strcpy(server_address.sun_path, "server_socket");\n\n    bind(server_sockfd, (struct sockaddr *)&server_address, sizeof(server_address));\n\n    listen(server_sockfd, 5);\n    printf("Server waiting for connections...\n");\n\n    int client_sockfd = accept(server_sockfd, NULL, NULL);\n\n    // Enable credential passing\n    int on = 1;\n    setsockopt(client_sockfd, SOL_SOCKET, LOCAL_CREDS, &on, sizeof(on));\n\n    receive_credentials(client_sockfd);\n\n    close(client_sockfd);\n    close(server_sockfd);\n\n    return 0;\n}