#include <stdio.h>\n#include <stdlib.h>\n#include <string.h>\n#include <sys/time.h>\n#include <unistd.h>\n\n#define BUFFER_LEN 1024\n\n// Simulated sending packet function; in a real application you'd use sockets or similar.\nvoid send_packet(char *buffer, size_t len) {\n    // Simulate network delay\n    sleep(1);\n}\n\n// Simulated receiving packet function.\nssize_t receive_packet(char *buffer, size_t len) {\n    return len;\n}\n\nint main() {\n    char buffer[BUFFER_LEN];\n    \n    struct timeval ts_send[100], ts_recv[100];\n    int n_packets = 10; // Example of number of packets to send\n    double one_way_delays[n_packets - 1], ipdv_values[n_packets - 2];\n\n    for (int i = 0; i < n_packets; ++i) {\n        // Sender side: timestamp, prepare packet and send\n        gettimeofday(&ts_send[i], NULL);\n        memset(buffer, 0, BUFFER_LEN);\n        memcpy(buffer, &ts_send[i], sizeof(struct timeval));\n        \n        send_packet(buffer, sizeof(struct timeval));\n\n        // Receiver side: receive packet and timestamp\n        ssize_t received_bytes = receive_packet(buffer, BUFFER_LEN);\n        if (received_bytes != sizeof(struct timeval)) {\n            fprintf(stderr, "Packet size mismatch\n");\n            return EXIT_FAILURE;\n        }\n        gettimeofday(&ts_recv[i], NULL);\n\n        struct timeval recv_timestamp;\n        memcpy(&recv_timestamp, buffer, sizeof(struct timeval));\n\n        // Optionally estimate clock skew using two-way method and adjust timestamps\n        // For this example, we assume no adjustment is required or done outside.\n\n        if (i == 0) continue; // No delay calculation for first packet\n\n        one_way_delays[i-1] = \n            ((double)(ts_recv[i].tv_sec - recv_timestamp.tv_sec) * 1e6 + \n             ts_recv[i].tv_usec - recv_timestamp.tv_usec) / 1e3;\n\n        if (i > 1) {\n            ipdv_values[i-2] = one_way_delays[i-1] - one_way_delays[i-2];\n            printf("IPDV for packet %d: %.3f ms\n", i, ipdv_values[i-2]);\n        }\n    }\n\n    return EXIT_SUCCESS;\n}