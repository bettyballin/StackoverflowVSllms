// Example of using libarchive to create a tar.gz archive\n   #include <archive.h>\n   #include <archive_entry.h>\n   #include <fcntl.h>\n   #include <unistd.h>\n\n   int main(void) {\n       struct archive *a;\n       struct archive Entry;\n       int fd;\n\n       a = archive_write_new();\n       archive_write_add_filter_gzip(a);\n       archive_write_set_format_pax_restricted(a);\n\n       if (archive_write_open_filename(a, "out.tar.gz", 10240)) {\n           fprintf(stderr, "%s\n", archive_error_string(a));\n           exit(1);\n       }\n\n       Entry = archive_entry_new();\n       fd = open("file_to_archive.txt", O_RDONLY | O_BINARY);\n\n       archive_entry_copy_sourcepath(entry, "file_to_archive.txt");\n       archive_entry_set_filetype(entry, AE_IFREG);\n       archive_entry_set_perm(entry, 0644);\n       archive_entry_set_size(entry, lseek(fd, 0, SEEK_END));\n\n       if (archive_write_header(a, entry)) {\n           fprintf(stderr, "%s\n", archive_error_string(a));\n           exit(1);\n       }\n\n       char buff[8192];\n       ssize_t length;\n       while ((length = read(fd, buff, sizeof(buff))) > 0) {\n           if (archive_write_data(a, buff, length) < length) {\n               fprintf(stderr, "%s\n", archive_error_string(a));\n               exit(1);\n           }\n       }\n\n       close(fd);\n       archive_entry_free(entry);\n       archive_write_close(a);\n       archive_write_free(a);\n\n       return 0;\n   }