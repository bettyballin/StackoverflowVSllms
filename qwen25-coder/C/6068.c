#include <windows.h>\n#include <winternl.h>\n\ntypedef struct _PROCESS_BASIC_INFORMATION {\n    PVOID Reserved1;\n    PPEB PebBaseAddress;\n    PVOID Reserved2[2];\n    ULONG UniqueProcessId;\n    PVOID Reserved3;\n} PROCESS_BASIC_INFORMATION, *PPROCESS_BASIC_INFORMATION;\n\ntypedef NTSTATUS (NTAPI *pNtQueryInformationProcess)(\n    HANDLE ProcessHandle,\n    DWORD ProcessInformationClass,\n    PVOID ProcessInformation,\n    ULONG ProcessInformationLength,\n    PULONG ReturnLength);\n\nDWORD GetParentPID()\n{\n    pNtQueryInformationProcess NtQueryInformationProcess = \n        (pNtQueryInformationProcess)GetProcAddress\n            (GetModuleHandle("ntdll.dll"), "NtQueryInformationProcess");\n\n    if (NtQueryInformationProcess == NULL)\n        return 0;\n\n    HANDLE hProcess = OpenProcess(PROCESS_QUERY_INFORMATION, FALSE, GetCurrentProcessId());\n    if (hProcess == NULL)\n        return 0;\n\n    PROCESS_BASIC_INFORMATION pbi;\n    NTSTATUS status = NtQueryInformationProcess(\n        hProcess,\n        0, // ProcessBasicInformation\n        &pbi,\n        sizeof(pbi),\n        NULL);\n\n    CloseHandle(hProcess);\n\n    if (!status) {\n        HANDLE hParent = OpenProcess(PROCESS_QUERY_INFORMATION, FALSE, pbi.Reserved3);\n        DWORD parentPid = GetProcessId(hParent);\n        CloseHandle(hParent);\n        return parentPid;\n    }\n\n    return 0;\n}