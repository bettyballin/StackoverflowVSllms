#include <windows.h>\n#include <psapi.h>\n#include <tlhelp32.h>\n\n#pragma comment(lib, "Psapi.lib")\n\nvoid GetLoadedModules(DWORD processId) {\n    HANDLE hProcess = OpenProcess(PROCESS_QUERY_INFORMATION | PROCESS_VM_READ, FALSE, processId);\n    if (NULL == hProcess)\n        return;\n\n    HMODULE hMods[1024];\n    DWORD cbNeeded;\n    unsigned int i;\n\n    if (EnumProcessModules(hProcess, hMods, sizeof(hMods), &cbNeeded)) {\n        for (i = 0; i < (cbNeeded / sizeof(HMODULE)); i++) {\n            TCHAR szModName[MAX_PATH];\n\n            // Get the full path to the module's file.\n            if (GetModuleFileNameEx(hProcess, hMods[i], szModName,\n                                    sizeof(szModName) / sizeof(TCHAR))) {\n                _tprintf(TEXT("\t%s\n"), szModName);\n            }\n        }\n    }\n\n    CloseHandle(hProcess);\n}