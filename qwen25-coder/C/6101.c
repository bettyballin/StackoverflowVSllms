#include <Windows.h>\n#include <Aclapi.h>\n\nSECURITY_ATTRIBUTES CreatePipeSecurity() {\n    SECURITY_DESCRIPTOR sd;\n    SECURITY_ATTRIBUTES sa;\n    PSID pEveryoneSID = NULL;\n    PACL pACL;\n\n    // Initialize security descriptor\n    if (!InitializeSecurityDescriptor(&sd, SECURITY_DESCRIPTOR_REVISION)) return sa;\n\n    // Allocate and initialize SID for Everyone group\n    SID_IDENTIFIER_AUTHORITY SIDAuthWorld = SECURITY_WORLD_SID_AUTHORITY;\n    if (!AllocateAndInitializeSid(\n        &SIDAuthWorld,\n        1,\n        SECURITY_WORLD_RID,\n        0, 0, 0, 0, 0, 0, 0,\n        &pEveryoneSID)) return sa;\n\n    // Create a new ACL\n    pACL = (PACL)LocalAlloc(LPTR, ACL_SIZE_INFORMATION);\n    if (!InitializeAcl(pACL, ACL_SIZE_INFORMATION, ACL_REVISION2)) {\n        FreeSid(&pEveryoneSID);\n        return sa;\n    }\n\n    // Add an ACE to the DACL for everyone with read/write access\n    if(!AddAccessAllowedAce(pACL, ACL_REVISION2,\n                             GENERIC_READ | GENERIC_WRITE,\n                             pEveryoneSID)){\n        LocalFree((HLOCAL)pACL);\n        FreeSid(&pEveryoneSID);\n        return sa;\n    }\n\n    // Set the security descriptor's DACL\n    if (!SetSecurityDescriptorDacl(&sd, TRUE, pACL, FALSE)) {\n        LocalFree((HLOCAL)pACL);\n        FreeSid(&pEveryoneSID);\n        return sa;\n    }\n\n    sa.nLength = sizeof(SECURITY_ATTRIBUTES);\n    sa.lpSecurityDescriptor = &sd;\n    sa.bInheritHandle = FALSE; // Pipes do not inherit handles\n\n    // Cleanup\n    FreeSid(pEveryoneSID);\n\n    return sa;\n}\n\n// Usage in server context:\nHANDLE hPipe = CreateNamedPipe(\n    TEXT("\\\\.\\pipe\\MyPipe"),\n    PIPE_ACCESS_DUPLEX,\n    PIPE_TYPE_MESSAGE | PIPE_READMODE_MESSAGE |\n        PIPE_WAIT,\n    PIPE_UNLIMITED_INSTANCES,\n    0,              // No outbound buffer\n    0,              // No inbound buffer\n    5000,           // Timeout in milliseconds\n    &CreatePipeSecurity()\n);