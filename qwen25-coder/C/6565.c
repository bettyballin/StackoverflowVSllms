/* {{{ php_log_err */\nPHPAPI void php_log_err(char *log_message TSRMLS_DC)\n{\n    FILE *log_file;\n    char error_time_str[128];\n    struct tm tmbuf;\n    time_t error_time;\n\n    /* Try to use the specified logging location. */\n    if (PG(error_log) != NULL) {\n#ifdef HAVE_SYSLOG_H\n        if (!strcmp(PG(error_log), "syslog")) {\n            // Fetch REQUEST_URI from _SERVER superglobal array\n            char *request_uri = NULL;\n            zval **server_array;\n            zval **request_uri_var;\n\n            // Check if we are in a web context where _SERVER exists\n            if (zend_hash_find(&EG(symbol_table), "_SERVER", sizeof("_SERVER"), (void **) &server_array) == SUCCESS) {\n                if (zend_hash_find(Z_ARRVAL_PP(server_array), "REQUEST_URI", sizeof("REQUEST_URI"), (void **) &request_uri_var) == SUCCESS) {\n                    convert_to_string_ex(request_uri_var);\n                    request_uri = Z_STRVAL_PP(request_uri_var);\n                }\n            }\n\n            // Append REQUEST_URI to the log message if it exists\n            char log_buf[520]; // 512 chars for message + null terminator + some extra space\n            snprintf(log_buf, sizeof(log_buf), "%.500s%s", log_message, request_uri ? request_uri : "");\n\n            php_syslog(LOG_NOTICE, "%s", log_buf);\n            return;\n        }\n#endif\n        log_file = VCWD_FOPEN(PG(error_log), "ab");\n        if (log_file != NULL) {\n            time(&error_time);\n            strftime(error_time_str, sizeof(error_time_str), "%d-%b-%Y %H:%M:%S", php_localtime_r(&error_time, &tmbuf));\n            fprintf(log_file, "[%s] ", error_time_str);\n            fprintf(log_file, "%s", log_message);\n            fprintf(log_file, "%s", PHP_EOL);\n            fclose(log_file);\n            return;\n        }\n    }\n\n    /* Otherwise fall back to the default logging location, if we have one */\n\n    if (sapi_module.log_message) {\n        sapi_module.log_message(log_message);\n    }\n}\n/* }}} */