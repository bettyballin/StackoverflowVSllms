#include <ldap.h>\n#include <sys/socket.h>\n\nvoid set_ldap_keepalive(LDAP *ld) {\n    int optval = 1;\n    int tcpKeepIdle = 60;   // seconds to wait before sending the first keepalive probe\n    int tcpKeepIntvl = 30;  // interval between successive probes if no response is received\n    int tcpKeepCnt = 5;     // number of probes before the connection is considered broken\n\n    // Set TCP keepalive options on the LDAP socket\n    ber_sockbuf_add_io((struct berelement *)ld, "tcp", LBER_SBIOD_START);\n    int sock = ldap_get_option_extended(ld, LDAP_OPT_CUSTOM_IO_CTX,\n                                         (void **)&ber_sockbufs, NULL);\n\n    setsockopt(sock, SOL_SOCKET, SO_KEEPALIVE, &optval, sizeof(optval));\n    setsockopt(sock, IPPROTO_TCP, TCP_KEEPIDLE, &tcpKeepIdle, sizeof(tcpKeepIdle));\n    setsockopt(sock, IPPROTO_TCP, TCP_KEEPINTVL, &tcpKeepIntvl, sizeof(tcpKeepIntvl));\n    setsockopt(sock, IPPROTO_TCP, TCP_KEEPCNT, &tcpKeepCnt, sizeof(tcpKeepCnt));\n}