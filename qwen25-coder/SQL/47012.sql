WITH RankedPrices AS (\n    SELECT\n        ingredient_id,\n        price,\n        created_at,\n        ROW_NUMBER() OVER (PARTITION BY ingredient_id ORDER BY created_at DESC) as rn\n    FROM ingredient_prices\n)\nSELECT \n    rp.ingredient_id,\n    i.name AS ingredient_name,\n    rp.price,\n    rp.created_at\nFROM RankedPrices rp\nJOIN ingredients i ON rp.ingredient_id = i.id\nWHERE rp.rn = 1;