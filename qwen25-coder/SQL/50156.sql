MERGE INTO DimCustomer AS Target\nUSING (SELECT CustomerID, FirstName, LastName FROM StagingCustomer) AS Source (CustomerID, FirstName, LastName)\nON Target.CustomerID = Source.CustomerID AND Target.IsCurrent = 1\n\nWHEN MATCHED AND \n    (Target.FirstName <> Source.FirstName OR Target.LastName <> Source.LastName)\nTHEN\n    UPDATE SET \n        IsCurrent = 0,\n        EndDate = GETDATE()\n\nWHEN NOT MATCHED THEN\n    INSERT (CustomerID, FirstName, LastName, StartDate, IsCurrent) \n    VALUES (Source.CustomerID, Source.FirstName, Source.LastName, GETDATE(), 1);