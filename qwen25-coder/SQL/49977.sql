-- For A ∩ B ∩ C\nSELECT 1003 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nJOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nJOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103;\n\n-- For A ∩ B - A ∩ B ∩ C\nSELECT 1002 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nJOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nLEFT JOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nWHERE c.row_id IS NULL;\n\n-- For A ∩ C - A ∩ B ∩ C\nSELECT 1004 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nJOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nLEFT JOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nWHERE b.row_id IS NULL;\n\n-- For B ∩ C - A ∩ B ∩ C\nSELECT 1005 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nJOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nLEFT JOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nWHERE a.row_id IS NULL;\n\n-- For A' - Elements not in B or C\nSELECT 1006 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nLEFT JOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nLEFT JOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nWHERE b.row_id IS NULL AND c.row_id IS NULL;\n\n-- For B' - Elements not in A or C\nSELECT 1007 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nLEFT JOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nLEFT JOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nWHERE a.row_id IS NULL AND c.row_id IS NULL;\n\n-- For C' - Elements not in A or B\nSELECT 1008 AS segment_id, t1.key2\nFROM #t1 t1\nJOIN #t2 c ON t1.key1 = c.key1 AND c.row_id = 103\nLEFT JOIN #t2 a ON t1.key1 = a.key1 AND a.row_id = 101\nLEFT JOIN #t2 b ON t1.key1 = b.key1 AND b.row_id = 102\nWHERE a.row_id IS NULL AND b.row_id IS NULL;