SELECT xmlelement(name "SalesOrders",\n       xmlagg(xmlelement(name "SalesOrder", \n            xmlattributes(so.id as id, so.code as Code),\n            xmlelement(name "Customer", \n                xmlattributes(cu.Code as Code, cu.Name as Name)\n            ),\n            (SELECT xmlagg(\n                    xmlelement(name "SalesItem",\n                        xmlattributes(si.Item_Num as Item, pa.Code as PartCode)\n                    )\n                 ) FROM tblSalesItem si\n                  LEFT JOIN tblPart pa ON pa.Id = si.Part_Id\n                 WHERE so.id = si.SalesOrder_ID)\n        ))\n    ) AS XMLData\nFROM tblSalesOrder so\nJOIN tblCustomer cu ON so.customer_id = cu.ID;