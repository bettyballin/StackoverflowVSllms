WITH JerkStreak AS (\n    SELECT \n        name,\n        processing_date,\n        is_jerk,\n        DATEADD(day, -ROW_NUMBER() OVER (PARTITION BY name ORDER BY processing_date), processing_date) AS grp\n    FROM \n        history_of_jerkiness\n    WHERE \n        processing_date <= '20090103'  -- Change this date to the desired report date\n        AND is_jerk = true\n),\nStreakCounts AS (\n    SELECT \n        name,\n        COUNT(*) AS days_jerky\n    FROM \n        JerkStreak\n    GROUP BY \n        name, grp\n)\nSELECT \n    name,\n    MAX(days_jerky) AS days_jerky\nFROM \n    StreakCounts\nGROUP BY \n    name;