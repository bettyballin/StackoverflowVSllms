WITH RankedNames AS (\n    SELECT \n        UniqueName,\n        ROW_NUMBER() OVER (PARTITION BY UniqueName ORDER BY (SELECT NULL)) - 1 AS RowNum,\n        UniqueName + CASE WHEN ROW_NUMBER() OVER (PARTITION BY UniqueName ORDER BY (SELECT NULL)) > 1 \n                         THEN CAST(ROW_NUMBER() OVER (PARTITION BY UniqueName ORDER BY (SELECT NULL)) - 1 AS VARCHAR(10))\n                         ELSE ''\n                    END AS NewUniqueName\n    FROM Persons\n)\nUPDATE RankedNames\nSET UniqueName = NewUniqueName;