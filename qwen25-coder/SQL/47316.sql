DECLARE @listCol VARCHAR(2000)\nDECLARE @query VARCHAR(4000)\n\n-- Create a list of columns ordered by BucketNum\nSELECT  @listCol = STUFF(( SELECT distinct ', [' + [size]\n                           FROM     #t\n                           ORDER BY BucketNum\n                         FOR\n                           XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), \n                         1, 2, '')\n\nSET @query = 'SELECT OID, ' + @listCol + '\n              FROM (\n                SELECT OID,  [size], [quantity]\n                FROM #t \n              ) src\n              PIVOT (SUM(quantity) FOR Size\n              IN (' + RIGHT(@listCol, LEN(@listCol)-1) + ')) AS pvt'\n\n-- Remove the last comma and space from the list of columns for the pivot\nSET @query = REPLACE(@query, ', ]', ']')\n\nEXECUTE sp_executesql @query