-- Initial setup of customer table with total_spent\nCREATE TABLE customers (\n    customer_id INT PRIMARY KEY,\n    name VARCHAR(255),\n    total_spent DECIMAL(10, 2) DEFAULT 0\n);\n\n-- Purchase orders table\nCREATE TABLE purchase_orders (\n    order_id INT PRIMARY KEY,\n    customer_id INT,\n    amount DECIMAL(10, 2),\n    FOREIGN KEY (customer_id) REFERENCES customers(customer_id)\n);\n\n-- Trigger function to update total_spent on insert or update\nDELIMITER $$\nCREATE FUNCTION UpdateTotalSpent(customerId INT, amount DECIMAL(10, 2))\nRETURNS VOID\nBEGIN\n    UPDATE customers c\n    SET c.total_spent = c.total_spent + amount\n    WHERE c.customer_id = customerId;\nEND$$\n\n-- Trigger for inserting a new order\nCREATE TRIGGER after_order_insert\nAFTER INSERT ON purchase_orders\nFOR EACH ROW\nBEGIN\n    CALL UpdateTotalSpent(NEW.customer_id, NEW.amount);\nEND$$\n\n-- Trigger for updating an existing order (assuming only amount can change)\nCREATE TRIGGER after_order_update\nAFTER UPDATE ON purchase_orders\nFOR EACH ROW\nBEGIN\n    CALL UpdateTotalSpent(OLD.customer_id, NEW.amount - OLD.amount);\nEND$$\n\nDELIMITER ;