WITH RankedMessages AS (\n    SELECT \n        MessageID,\n        SendingUserID,\n        ReceivingUserID,\n        ROW_NUMBER() OVER (PARTITION BY LEAST(SendingUserID, ReceivingUserID), GREATEST(SendingUserID, ReceivingUserID) ORDER BY MessageID DESC) as rn\n    FROM \n        Messages\n)\nSELECT \n    MessageID,\n    SendingUserID,\n    ReceivingUserID\nFROM \n    RankedMessages\nWHERE \n    rn = 1;