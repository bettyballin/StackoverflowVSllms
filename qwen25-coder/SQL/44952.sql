SELECT \n    MAX(CASE WHEN a.AttributeName = 'generation' THEN pa.StringValue END) AS Generation,\n    SUM(CAST(MAX(CASE WHEN a.AttributeName = 'capacity' THEN pa.FloatValue END) AS UNSIGNED)) AS TotalCapacity\nFROM \n    Products p\nJOIN \n    ProductAttributes pa ON p.ID = pa.ProductID\nJOIN \n    Attributes a ON pa.AttributeID = a.ID\nWHERE \n    a.ProductGroupID = (SELECT ID FROM ProductGroups WHERE Name = 'Ipods')\nGROUP BY \n    Generation;