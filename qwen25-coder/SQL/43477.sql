SELECT \n  a.username,\n  CONCAT(a.firstname || ' ', a.lastname) AS name,\n  a.email,\n  a.phone,\n  (\n    SELECT \n      LTRIM(SYS_CONNECT_BY_PATH(res, ', '), ', ')\n    FROM (\n      SELECT \n        COUNT(*) OVER() AS cnt, \n        ROW_NUMBER() OVER(ORDER BY ar.ofield) AS rnum, \n        (SELECT r.name FROM rooms r WHERE r.code = ar.roomcode) AS res\n      FROM adminrooms ar\n      WHERE ar.roomcode = a.code /* Correlating subquery with main query using aliases */\n    )\n    WHERE cnt = rnum START WITH rnum = 1 CONNECT BY PRIOR rnum = (rnum - 1)\n  ) AS groups\nFROM admins a\nWHERE a.frozen = 0 AND (a.type <> 'root' OR a.type IS NULL);