WITH RankedAudits AS (\n    SELECT\n        ID,\n        CustomerID,\n        Name,\n        Address,\n        AuditDateTime,\n        AuditCode,\n        ROW_NUMBER() OVER (PARTITION BY CustomerID ORDER BY AuditDateTime DESC) as rn\n    FROM AuditLog\n    WHERE AuditDateTime BETWEEN '2009-07-17 00:00:00' AND '2009-07-18 00:00:00'\n)\nSELECT\n    ID,\n    CustomerID,\n    Name,\n    Address,\n    AuditDateTime,\n    AuditCode\nFROM RankedAudits\nWHERE rn = 1;