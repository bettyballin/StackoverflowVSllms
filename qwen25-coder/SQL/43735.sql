WITH RankedDays AS (\n    SELECT \n        es.EmployeeID,\n        es.ProjectID,\n        dn.Day AS DateValue,\n        ROW_NUMBER() OVER (PARTITION BY es.EmployeeID, es.ProjectID ORDER BY dn.Day) - ROW_NUMBER() OVER (PARTITION BY es.EmployeeID, es.ProjectID, DATEADD(day, -ROW_NUMBER() OVER (PARTITION BY es.EmployeeID, es.ProjectID ORDER BY dn.Day), dn.Day)) AS grp\n    FROM \n        [Employee Schedule] es\n    JOIN \n        [Day Numbers] dn ON es.DayID = dn.ID\n),\nGroups AS (\n    SELECT \n        EmployeeID,\n        ProjectID,\n        MIN(DateValue) AS StartDate,\n        MAX(DateValue) AS EndDate\n    FROM \n        RankedDays\n    GROUP BY \n        EmployeeID, ProjectID, grp\n)\nSELECT \n    EmployeeID, \n    ProjectID, \n    FORMAT(StartDate, 'yyyy-MM-dd') + ' to ' + FORMAT(EndDate, 'yyyy-MM-dd') AS Duration\nFROM \n    Groups\nORDER BY \n    EmployeeID, ProjectID, StartDate;