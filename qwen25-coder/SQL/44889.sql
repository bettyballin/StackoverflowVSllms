WITH TimeBuckets AS (\n    select \n        Count(Page) as VisitingCount,\n        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5), Date, 108)) as [TIME]\n    from \n        scr_SecuristLog     \n    where \n        Date between '2009-04-30' and '2009-05-02' \n        and [user] in (\n            select USERNAME               \n            from scr_CustomerAuthorities \n            where customerID = Convert(varchar,4) \n              and ID = Convert(varchar,43) \n        )\n    group by \n        dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5), Date, 108))\n)\nselect\n    VisitingCount,\n    [TIME]\nfrom \n    TimeBuckets\norder by \n    [TIME] asc;