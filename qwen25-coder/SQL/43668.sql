-- Assuming a single customer at the root level for simplicity.\nCREATE PROCEDURE CloneCustomer\n    @SourceCustomerName varchar(50),\n    @TargetCustomerName varchar(50)\nAS\nBEGIN\n    DECLARE @NewCustID int;\n\n    -- Step 1: Insert new Customer record and get the new custID\n    INSERT INTO [dbo].[Customer] ([name]) VALUES (@TargetCustomerName);\n    SET @NewCustID = SCOPE_IDENTITY();\n\n    -- Step 2: Copy Invoices for the customer\n    DECLARE @TempTable TABLE (\n        OldInvoiceNum int,\n        NewInvoiceNum int);\n\n    -- Insert into Invoice and get mappings old/new invoice numbers\n    INSERT INTO [dbo].[Invoice] ([custID], [Description])\n    OUTPUT inserted.invoiceNum, inserted.custID INTO @TempTable (NewInvoiceNum, OldInvoiceNum)\n    SELECT @NewCustID, Description FROM Invoice WHERE custID = \n        (SELECT custID FROM Customer WHERE name = @SourceCustomerName);\n\n    -- Step 3: Copy InvoiceDetails for each invoice\n    INSERT INTO [dbo].[InvoiceDetail] ([invoiceNum], [sequence], [description], [price])\n    SELECT T.NewInvoiceNum, ID.sequence, ID.description, ID.price\n    FROM InvoiceDetail ID\n    INNER JOIN @TempTable T ON T.OldInvoiceNum = ID.invoiceNum;\n\nEND;