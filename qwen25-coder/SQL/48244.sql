WITH cteLevelOne AS (\n    SELECT a.ParentID, a.CustID, 0 AS Depth\n    FROM tblCustomer AS a\n    WHERE a.CustID = @LookupID \n    UNION ALL\n    SELECT a.ParentID, a.CustID, cl.Depth + 1\n    FROM tblCustomer AS a\n    INNER JOIN cteLevelOne AS cl ON a.CustID = cl.ParentID\n    WHERE a.CustID <> cl.ParentID  -- Corrected this condition to avoid infinite loop\n)\nSELECT ParentID, CustID\nFROM cteLevelOne\nWHERE Depth = (SELECT MAX(Depth) FROM cteLevelOne);