WITH RankedActivity AS (\n    SELECT \n        sessionid,\n        activity_description,\n        ROW_NUMBER() OVER (PARTITION BY sessionid ORDER BY created ASC) as rn_asc,\n        ROW_NUMBER() OVER (PARTITION BY sessionid ORDER BY created DESC) as rn_desc\n    FROM activity_details\n)\nINSERT INTO activity_summary (sessionid, first_activity_desc, last_activity_desc)\nSELECT \n    ra.sessionid,\n    MAX(CASE WHEN ra.rn_asc = 1 THEN ra.activity_description END) AS first_activity_desc,\n    MAX(CASE WHEN ra.rn_desc = 1 THEN ra.activity_description END) AS last_activity_desc\nFROM RankedActivity ra\nGROUP BY ra.sessionid;