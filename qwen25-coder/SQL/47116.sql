CREATE PROCEDURE GetNextUniqueID\n       @KeyName VARCHAR(50),\n       @NewID INT OUTPUT\n   AS\n   BEGIN\n       SET NOCOUNT ON;\n\n       DECLARE @CurrentID INT;\n\n       -- Begin transaction to ensure atomicity\n       BEGIN TRANSACTION;\n       \n       -- Retrieve the current last used ID\n       SELECT @CurrentID = LastUsedID\n       FROM UniqueIDGenerator WITH (UPDLOCK, ROWLOCK)\n       WHERE KeyName = @KeyName;\n\n       IF @CurrentID IS NULL\n           RAISERROR('Key name does not exist in the UniqueIDGenerator table.', 16, 1);\n\n       -- Increment the ID and update the table\n       SET @CurrentID = @CurrentID + 1;\n       UPDATE UniqueIDGenerator\n       SET LastUsedID = @CurrentID\n       WHERE KeyName = @KeyName;\n\n       COMMIT TRANSACTION;\n\n       -- Return the new unique ID\n       SET @NewID = @CurrentID;\n   END;