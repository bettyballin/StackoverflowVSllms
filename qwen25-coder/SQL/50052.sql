WITH RankedPhotos AS (\n    SELECT \n        id,\n        ROW_NUMBER() OVER (ORDER BY id ASC) AS row_num,\n        COUNT(*) OVER () AS total_photos\n    FROM \n        photos\n),\nCurrentPhotoRow AS (\n    SELECT \n        row_num\n    FROM \n        RankedPhotos\n    WHERE \n        id = :current_photo_id\n)\nSELECT \n    rp.id\nFROM \n    RankedPhotos rp,\n    CurrentPhotoRow cpr\nWHERE \n    (rp.row_num BETWEEN cpr.row_num - 4 AND cpr.row_num + 4) OR\n    (cpr.row_num <= 5 AND rp.row_num <= 9) OR\n    (cpr.row_num >= total_photos - 4 AND rp.row_num >= total_photos - 8)\nORDER BY \n    rp.id ASC\nLIMIT 9;