-- Check if the current server is the active node\nDECLARE @ActiveNodeName NVARCHAR(256);\nSELECT \n    @ActiveNodeName = ISNULL((SELECT TOP 1 member_name FROM sys.dm_hadr_cluster_members WHERE role_description = 'Owner'), N'Not in cluster or No data');\n\n-- Assume @PreviousActiveServer is a table or variable that stores the last-known active server\nIF (SELECT TOP 1 ServerName FROM dbo.LastKnownActiveServer) <> @ActiveNodeName\nBEGIN\n    -- Log failover and send alert\n    INSERT INTO dbo.ServerFailovers (OldActiveServer, NewActiveServer, FailoverTime)\n    VALUES ((SELECT TOP 1 ServerName FROM dbo.LastKnownActiveServer), @ActiveNodeName, GETDATE());\n    \n    EXEC msdb.dbo.sp_send_dbmail\n        @profile_name = 'YourMailProfile',\n        @recipients = 'admin@example.com',\n        @body = 'The failover cluster has switched from ' + (SELECT TOP 1 ServerName FROM dbo.LastKnownActiveServer) + ' to ' + @ActiveNodeName,\n        @subject = 'SQL Server Failover Notification';\n\n    -- Update the last known active server\n    UPDATE dbo.LastKnownActiveServer SET ServerName = @ActiveNodeName;\nEND