BEGIN;\n-- Claim a job\nUPDATE tbl \nSET owner = connection_id(), status = 'CLAIMED', claimed_at = CURRENT_TIMESTAMP\nWHERE id IN (\n    SELECT id\n    FROM tbl\n    WHERE available AND owner IS NULL AND status != 'CLAIMED'\n    ORDER BY priority_column -- Replace with actual logic to determine which jobs to pick first\n    LIMIT 1 FOR UPDATE SKIP LOCKED\n);\n\n-- Fetch the job details\nSELECT col1, col2, ... -- Your columns\nFROM tbl \nWHERE id = (\n    SELECT id\n    FROM tbl\n    WHERE owner = connection_id() AND status = 'CLAIMED'\n);\nCOMMIT;