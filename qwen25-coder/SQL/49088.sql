DO $$\nDECLARE\n    rec RECORD;\nBEGIN\n    -- Loop over all tables in the public schema that have sequences associated with their primary keys\n    FOR rec IN\n        SELECT c.relname AS table_name, a.attname AS column_name, c2.relname AS sequence_name\n        FROM pg_class c\n        JOIN pg_attribute a ON c.oid = a.attrelid AND a.attnum > 0 AND NOT a.attisdropped\n        JOIN pg_inherits i ON c.oid = i.inhrelid\n        JOIN pg_class c2 ON c2.oid = i.inhparent\n        JOIN pg_namespace n ON c.relnamespace = n.oid\n        JOIN (\n            SELECT tc.table_name, kcu.column_name, ccu.sequence_name\n            FROM information_schema.table_constraints AS tc\n            JOIN information_schema.key_column_usage AS kcu ON tc.constraint_name = kcu.constraint_name\n            JOIN information_schema.constraint_column_usage AS ccu ON ccu.constraint_name = tc.constraint_name\n            WHERE constraint_type = 'PRIMARY KEY'\n        ) pk ON c.relname = pk.table_name AND a.attname = pk.column_name\n        WHERE n.nspname = 'public' AND c2.relkind = 'S'\n    LOOP\n        EXECUTE format(\n            'SELECT setval(%L, (SELECT MAX(%I) FROM %I))',\n            rec.sequence_name, rec.column_name, rec.table_name\n        );\n    END LOOP;\nEND $$;