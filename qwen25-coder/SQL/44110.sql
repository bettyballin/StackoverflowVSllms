WITH AllDescendants AS (\n    SELECT \n        t.Key,\n        t.ParentKey,\n        CAST(t.Name AS NVARCHAR(MAX)) Path\n    FROM Table2 t WHERE t.ParentKey IS NULL\n\n    UNION ALL\n\n    SELECT \n        t.Key,\n        t.ParentKey,\n        CAST(ad.Path + ',' + t.Name AS NVARCHAR(MAX)) Path\n    FROM Table2 t\n    INNER JOIN AllDescendants ad ON ad.Key = t.ParentKey\n)\nSELECT * FROM AllDescendants ad WHERE ad.Path NOT LIKE '%,2,%'