select\n      decode(wid_location,28.3,'CL',29.6,'DA') as site,\n      (n*sum_xy - sum_x*sum_y)/(n*sum_x_sq - sum_x*sum_x) as m,\n      (sum_y - ((n*sum_xy - sum_x*sum_y)/(n*sum_x_sq - sum_x*sum_x))*sum_x)/n as b \n\nfrom (\n        select \n               wid_location,\n               sum(wids) as sum_x,\n               sum(mine) as sum_y,\n               sum(wids*mine) as sum_xy,\n               sum(wids*wids) as sum_x_sq,\n               count(*) as n\n\n        from (                                                                       \n                select \n                       trn.wid_location,\n                       con.empty_weight_total as wids,                                                                   \n                       case \n                              when trn.wid_location = 28.3 then con.empty_weight_total*0.900-1.0\n                              when trn.wid_location = 29.6 then con.empty_weight_total*0.950-1.5\n                        end as mine   \n\n                from widsys.train trn\n                     inner join widsys.consist con\n                     using (train_record_id)\n\n                where mine_code = 'YA'\n                      and to_char(trn.wid_date,'IYYY') = 2009\n                      and to_char(trn.wid_date,'IW') = 29\n\n                                 )\n\n        group by wid_location\n     )