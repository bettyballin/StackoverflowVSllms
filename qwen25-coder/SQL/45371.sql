CREATE FUNCTION dbo.fn_Split(\n    @sText VARCHAR(8000),\n    @sDelim CHAR(1) = ','\n)\nRETURNS @retArray TABLE (idx INT NOT NULL IDENTITY(1, 1), value VARCHAR(8000))\nAS\nBEGIN\n    DECLARE @iStart INT, @iEnd INT\n\n    SET @iStart = 1\n\n    WHILE (@iStart <= LEN(@sText))\n    BEGIN\n        SET @iEnd = CHARINDEX(@sDelim, @sText, @iStart)\n\n        IF (@iEnd = 0)\n            SET @iEnd = LEN(@sText) + 1\n\n        INSERT INTO @retArray (VALUE)\n        VALUES (SUBSTRING(@sText, @iStart, @iEnd - @iStart))\n\n        SET @iStart = @iEnd + 1\n    END\n\n    RETURN\nEND