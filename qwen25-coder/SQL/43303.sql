SELECT COUNT(*) AS c \nFROM BANS \nWHERE typeid=6 AND \n  UNHEX(ipaddr) & (UNHEX(REPEAT('0', FLOOR((128-cidr)/4))) CONCAT(\n    REPEAT('F', CEIL((cidr-1)/4)),\n    CASE WHEN MOD(cidr, 4) >= 1 THEN RIGHT(HEX(CONV((1 << MOD(cidr, 4)) - 1, 10, 16)), 1) ELSE '' END,\n    REPEAT('0', FLOOR((128-cidr-3)/4))\n  ) UNHEX(ipaddr & (UNHEX(REPEAT('0', FLOOR((128-cidr)/4))) CONCAT(\n    REPEAT('F', CEIL((cidr-1)/4)),\n    CASE WHEN MOD(cidr, 4) >= 1 THEN RIGHT(HEX(CONV((1 << MOD(cidr, 4)) - 1, 10, 16)), 1) END,\n    REPEAT('0', FLOOR((128-cidr-3)/4))\n  ) = UNHEX(ipaddr & (UNHEX(REPEAT('0', FLOOR((128-cidr)/4))) CONCAT(\n    REPEAT('F', CEIL((cidr-1)/4)),\n    CASE WHEN MOD(cidr, 4) >= 1 THEN RIGHT(HEX(CONV((1 << MOD(cidr, 4)) - 1, 10, 16)), 1) END,\n    REPEAT('0', FLOOR((128-cidr-3)/4))\n  ) & (UNHEX(REPEAT('F', 32))))