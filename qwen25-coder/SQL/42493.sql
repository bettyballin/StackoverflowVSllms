DECLARE @cols AS NVARCHAR(MAX),\n        @query  AS NVARCHAR(MAX);\n\n-- Construct the list of column names for the PIVOT clause\nSELECT @cols = STUFF((SELECT distinct ',' + QUOTENAME(PivotColumnName) \n                    FROM (SELECT DISTINCT PivotColumnValue AS PivotColumnName FROM SourceTable) x\n                    FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'),1,1,'')\n\n-- Prepare the dynamic SQL for the INSERT INTO ... SELECT statement\nSET @query = N'\nCREATE TABLE #DynamicPivot (\n    MainColumn NVARCHAR(255),\n    ' + @cols + '\n);\n\nINSERT INTO #DynamicPivot (MainColumn, ' + @cols + ')\nSELECT MainColumn, ' + @cols + '\nFROM (\n    SELECT MainColumn,\n           PivotColumnValue,\n           ValueColumn\n    FROM SourceTable\n) x\nPIVOT \n(\n    MAX(ValueColumn)\n    FOR PivotColumnValue IN (' + @cols + ')\n) p;\n';\n\n-- Execute the dynamic SQL\nEXEC sp_executesql @query;\n\n-- You can now use #DynamicPivot in your session\nSELECT * FROM #DynamicPivot;