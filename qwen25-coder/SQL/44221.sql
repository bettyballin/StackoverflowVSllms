SELECT \n    t1.locId,\n    (t1.temp - t2.temp) AS change\nFROM \n    your_table_name t1\nJOIN \n    your_table_name t2 ON t1.locId = t2.locId\nWHERE \n    t2.dtg = (\n        SELECT MAX(dtg)\n        FROM your_table_name\n        WHERE locId = t2.locId AND dtg < t1.dtg\n    )\nAND \n    t1.dtg = (\n        SELECT MAX(dtg)\n        FROM your_table_name\n        WHERE locId = t1.locId\n    );