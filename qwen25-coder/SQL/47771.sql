CREATE PROCEDURE SwapRecords\n    @TableName NVARCHAR(128),\n    @Id1 INT,\n    @Id2 INT,\n    @ColumnToExclude NVARCHAR(128)\nAS\nBEGIN\n    DECLARE @Columns NVARCHAR(MAX) = N'',\n            @SQL NVARCHAR(MAX)\n\n    -- Get column list excluding the specified column and identity columns\n    SELECT @Columns += '[' + COLUMN_NAME + '], '\n    FROM INFORMATION_SCHEMA.COLUMNS\n    WHERE TABLE_NAME = @TableName \n      AND COLUMN_NAME <> @ColumnToExclude \n      AND NOT EXISTS (\n          SELECT 1 \n          FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE kcu\n          WHERE kcu.TABLE_NAME = COLUMN_TABLE_NAME\n            AND kcu.COLUMN_NAME = COLUMN_NAME\n            AND OBJECTPROPERTY(OBJECT_ID('PK_' + COLUMN_TABLE_NAME), 'IsPrimaryKey') = 1\n        )\n\n    -- Trim the trailing comma and space\n    SET @Columns = LEFT(@Columns, LEN(@Columns) - 2)\n\n    -- Construct and execute the swap statement\n    IF LEN(@Columns) > 0\n    BEGIN\n        SET @SQL = N'\n            DECLARE @TempTable TABLE (' + @Columns + ')\n\n            -- Store values from first record in temp table\n            INSERT INTO @TempTable\n                SELECT ' + @Columns + '\n                FROM ' + QUOTENAME(@TableName) + ' WHERE [Id] = @Id1\n\n            -- Update second record with first value\n            UPDATE ' + QUOTENAME(@TableName) + '\n            SET ' + \n                STUFF((\n                    SELECT ', [' + COLUMN_NAME + '] = t.[' + COLUMN_NAME + ']'\n                    FROM INFORMATION_SCHEMA.COLUMNS\n                    WHERE TABLE_NAME = @TableName \n                      AND COLUMN_NAME <> @ColumnToExclude \n                      FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + '\n            FROM ' + QUOTENAME(@TableName) + ' t\n            INNER JOIN @TempTable temp ON t.[Id] = @Id1\n            WHERE ' + QUOTENAME(@TableName) + '.[Id] = @Id2\n\n            -- Update first record with second value directly from table\n            UPDATE ' + QUOTENAME(@TableName) + '\n            SET ' + \n                STUFF((\n                    SELECT ', [' + COLUMN_NAME + '] = t.[' + COLUMN_NAME + ']'\n                    FROM INFORMATION_SCHEMA.COLUMNS\n                    WHERE TABLE_NAME = @TableName \n                      AND COLUMN_NAME <> @ColumnToExclude \n                      FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 2, '') + '\n            FROM ' + QUOTENAME(@TableName) + ' t\n            WHERE ' + QUOTENAME(@TableName) + '.[Id] = @Id1\n              AND EXISTS (\n                  SELECT 1 \n                  FROM @TempTable temp \n                  WHERE temp.[Id] = @Id2\n              )'\n\n        -- Execute dynamic SQL with parameters\n        EXEC sp_executesql @SQL, N'@Id1 INT, @Id2 INT', @Id1, @Id2\n    END\nEND