-- Recursive CTE to find all dependent procedures\nWITH RecursiveProcDependencies (object_id, name, definition)\nAS (\n    -- Anchor member: start with the initial procedure\n    SELECT \n        sm.object_id,\n        OBJECT_NAME(sm.object_id) AS name,\n        sm.definition\n    FROM sys.sql_modules AS sm\n    WHERE OBJECT_DEFINITION(sm.object_id) LIKE '%[ ]<proc_name>%'\n\n    UNION ALL\n\n    -- Recursive member: find all procedures called by the current procedure(s)\n    SELECT \n        dm.referenced_entity_id,\n        OBJECT_NAME(dm.referenced_entity_id) AS name,\n        sm.definition\n    FROM sys.dm_sql_referenced_entities(('dbo.<proc_name>'), 'OBJECT') dm\n    JOIN sys.sql_modules sm ON dm.referenced_entity_id = sm.object_id\n    WHERE isnull(OBJECT_DEFINITION(dm.referenced_entity_id), 'notfound') NOT LIKE '%[ ]<proc_name>%'\n)\n-- Select the results to display\nSELECT  name,\n        definition \nFROM RecursiveProcDependencies\nOPTION (MAXRECURSION 0);