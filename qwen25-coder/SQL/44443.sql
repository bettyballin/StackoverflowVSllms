-- Suppose adding child 6 under parent node 2\n\n-- Insert the new node\nINSERT INTO Node (NodeId, NodeParentId, DisplaySeq, Title)\nVALUES (6, 2, 3, 'New Grandchild');\n\n-- Update ancestor table for all ancestors of node 6 to include itself as a descendant\nWITH RECURSIVE Hierarchy AS (\n    SELECT ancestorId\n    FROM Ancestor\n    WHERE nodeId = 2\n    UNION ALL\n    SELECT NodeParentId\n    FROM Node\n    INNER JOIN Hierarchy ON Node.NodeId = Hierarchy.AncestorId\n)\nINSERT INTO Ancestor (NodeId, AncestorId, hops)\nSELECT 6 as NodeId, ancestorId, hops + 1\nFROM Anc_Recursion ar\nLEFT OUTER JOIN Ancestor ex ON ar.ancestorid = ex.ancestorid AND ex.nodeid = 6\nWHERE ex.NodeId IS NULL AND ar.AncestorId != 6;\n\n-- Insert self-loop for node 6 in the ancestor table\nINSERT INTO Ancestor (NodeId, AncestorId, hops)\nVALUES (6, 6, 0);