WITH periods AS (\n    SELECT sensor_id,\n           start_date,\n           end_date,\n           description,\n           LEAD(acquired) OVER (PARTITION BY sensor_id ORDER BY acquired) AS next_acquired\n    FROM your_value_table v\n    WHERE EXISTS (\n        SELECT 1\n        FROM your_period_table p\n        WHERE v.sensor_id = p.sensor_id\n          AND v.acquired >= p.start_date\n    )\n)\nSELECT \n   p.sensor_id, \n   p.start_date,\n   (SELECT MAX(v2.value) FROM your_value_table v2 WHERE v2.sensor_id = p.sensor_id AND v2.acquired <= p.start_date) AS v1,\n   p.end_date,\n   (SELECT MIN(v3.value) FROM your_value_table v3 WHERE v3.sensor_id = p.sensor_id AND v3.acquired >= p.next_acquired) AS v2,\n   p.description\nFROM periods p, your_period_table pt\nWHERE p.sensor_id = pt.sensor_id \n  AND pt.start_date < LEAST(p.end_date, pt.range_end)\n  AND pt.end_date > GREATEST(p.start_date, pt.range_start)\nORDER BY sensor_id, start_date;