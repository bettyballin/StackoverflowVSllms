SELECT p.*, r.*\nFROM (\n    SELECT product_id,\n           @row_number := IF(@current_product = product_id, @row_number + 1, 1) AS rn,\n           @current_product := product_id\n    FROM revisions\n    JOIN (SELECT @row_number := 0, @current_product := NULL) AS vars\n    ORDER BY product_id, modified DESC\n) AS ranked_revisions\nJOIN products p ON p.product_id = ranked_revisions.product_id\nJOIN revisions r ON r.product_id = ranked_revisions.product_id AND r.modified = (\n    SELECT MAX(modified)\n    FROM revisions\n    WHERE product_id = ranked_revisions.product_id\n)\nWHERE rn = 1;