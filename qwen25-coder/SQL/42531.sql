WITH SplitComments AS (\n    SELECT \n        PurchaseOrderDetailID,\n        s ContractName\n    FROM \n        dbo.PurchaseOrderDetail pod\n    CROSS APPLY \n        dbo.Split(';', Comments) cn\n    WHERE \n        cn.pn = 1\n\n    UNION ALL\n\n    SELECT \n        PurchaseOrderDetailID,\n        s ContractNo\n    FROM \n        dbo.PurchaseOrderDetail pod\n    CROSS APPLY \n        dbo.Split(';', Comments) cno\n    WHERE \n        cno.pn = 2\n)\nSELECT \n    sp1.PurchaseOrderDetailID,\n    sp1.ContractName,\n    sp2.ContractNo\nFROM \n    SplitComments sp1\nLEFT JOIN \n    SplitComments sp2 ON sp1.PurchaseOrderDetailID = sp2.PurchaseOrderDetailID AND sp2.pn = 2\nWHERE \n    sp1.pn = 1;