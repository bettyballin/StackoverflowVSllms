-- Step 1: Increment AutoKey in Numbering and get the new value\nDECLARE @NewAutoKey INT;\nWITH UpdatedNumbering AS (\n    UPDATE Numbering \n    SET AutoKey = AutoKey + 1\n    OUTPUT inserted.AutoKey\n    WHERE ObjectCode = 4\n)\nSELECT TOP 1 @NewAutoKey = AutoKey FROM UpdatedNumbering;\n\n-- Step 2: Insert into Temp2 using the updated AutoKey value\nINSERT INTO Temp2(id, fkTemp1, data)\nSELECT @NewAutoKey + ROW_NUMBER() OVER (ORDER BY t1.id), t1.id, t1.data\nFROM Temp1 t1\nLEFT JOIN Temp2 t2 ON t2.fkTemp1 = t1.id\nWHERE t2.id IS NULL; -- only insert where a target row does not already exist