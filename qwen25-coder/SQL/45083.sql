WITH AreaProductSet AS (\n    SELECT \n        a.Name AS AreaName,\n        STUFF((\n            SELECT ',' + CAST(p.ProductId AS VARCHAR(50))\n            FROM AreaToProduct ap\n            INNER JOIN Product p ON ap.ProductId = p.Id\n            WHERE ap.AreaId = a.Id\n            ORDER BY p.ProductId\n            FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 1, '') AS ProductSetID\n    FROM \n        Area a\n)\nSELECT \n    aps.AreaName,\n    aps.ProductSetID\nFROM \n    AreaProductSet aps\nGROUP BY \n    aps.ProductSetID\nHAVING COUNT(*) > 1;