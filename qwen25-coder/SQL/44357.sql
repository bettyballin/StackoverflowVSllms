ALTER TRIGGER [dbo].[tr_CustomerSatisfactionAlertRepair] \nON [dbo].[tbl_repair_visit] \nAFTER UPDATE\nAS \nBEGIN\n    SET NOCOUNT ON;\n\n    -- Check if TENANTSATISFACTION was updated\n    IF UPDATE(TENANTSATISFACTION)\n    BEGIN\n        INSERT INTO alertmessagedata (TypeID, Contract, Address, ORDERID, ENGINEERS, Sent, DateAdded)\n        SELECT '5', p.contract, p.fulladdress, rv.orderid, rv.engineer, 0, GETDATE()\n        FROM tbl_repair_visit AS rv\n        INNER JOIN inserted AS X ON rv.VISITID = X.VISITID\n        INNER JOIN tbl_property AS p ON rv.PROPREF = p.PROPREF\n        WHERE rv.TENANTSATISFACTION = 'Poor'\n          AND COALESCE(deleted.TENANTSATISFACTION, '') <> 'Poor'; -- Ensure it changed from not 'Poor'\n    END\nEND