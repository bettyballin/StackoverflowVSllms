SELECT s.sid,\n       s.serial#,\n       s.username,\n       p.spid AS os_process_id,\n       q.sql_fulltext AS sql_text,\n       o.object_name,\n       o.subobject_name,\n       q.piece\nFROM v$session s\nJOIN v$sql q ON s.sql_address = q.address AND s.sql_hash_value = q.hash_value\nLEFT JOIN dba_objects o ON q.parsing_schema_name = o.owner \n                        AND (q.sql_fulltext LIKE '%' || o.object_name || '(' || '%'\n                          OR q.sql_fulltext LIKE '%' || o.object_name || '.' || o.subobject_name || '(' || '%')\nJOIN v$process p ON s.paddr = p.addr\nWHERE s.status = 'ACTIVE'\n  AND (o.object_type = 'PROCEDURE' OR o.object_type = 'PACKAGE BODY');