WITH RecursiveGroups AS (\n    SELECT g.Gruppe_ID, g.Navn, g.OverordnetGruppe_ID\n    FROM Gruppe g\n    JOIN KundeGruppeLink kgl ON kgl.Gruppe_ID = g.Gruppe_ID\n\n    UNION ALL\n\n    SELECT g.Gruppe_ID, g.Navn, g.OverordnetGruppe_ID\n    FROM Gruppe g\n    INNER JOIN RecursiveGroups rg ON g.Gruppe_ID = rg.OverordnetGruppe_ID\n)\nSELECT k.Kunde_ID, k.Navn AS Kundenavn, rg.Gruppe_ID AS MestForaeldreGruppeID, rg.Navn AS MestForaeldreGruppenavn\nFROM Kunde k\nJOIN RecursiveGroups rg ON k.Gruppe_ID = rg.Gruppe_ID\nWHERE rg.OverordnetGruppe_ID IS NULL\nGROUP BY k.Kunde_ID, k.Navn, rg.Gruppe_ID, rg.Navn;