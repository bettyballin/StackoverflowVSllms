WITH LatestSalesPersonData AS (\n    SELECT \n        sp.salesPersonId,\n        spd.order_id,\n        spd.timestamp,\n        spd.called_inbound,\n        spd.called_outbound,\n        spd.orders_issued,\n        spd.revenue_total,\n        ROW_NUMBER() OVER (PARTITION BY DATE(spd.timestamp), sp.salesPersonId ORDER BY spd.timestamp DESC) as rn\n    FROM \n        salesPerformanceData spd\n    JOIN \n        salesPerson sp ON spd.salesPersonId = sp.salesPersonId\n    WHERE \n        spd.timestamp >= '2009-05-01' AND spd.timestamp < '2009-05-07'\n)\nSELECT \n    salesPersonId,\n    SUM(called_inbound) as total_called_inbound,\n    SUM(called_outbound) as total_called_outbound,\n    SUM(orders_issued) as total_orders_issued,\n    SUM(revenue_total) as total_revenue\nFROM \n    LatestSalesPersonData\nWHERE \n    rn = 1\nGROUP BY \n    salesPersonId;