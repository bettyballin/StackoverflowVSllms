WITH RequiredAddons AS (\n    SELECT DISTINCT pa.product_id\n    FROM product_addon pa\n    WHERE pa.addon_id IN (1, 14, 237) -- Your list of mandatory add-ons\n    GROUP BY pa.product_id\n    HAVING COUNT(DISTINCT pa.addon_id) = 3 -- Must have all three specified addons\n)\n\nSELECT i.name AS ispname, \n       i.img_link, \n       c.download, \n       c.upload, \n       c.monthly_price, \n       c.link, \n       GROUP_CONCAT(a.name) AS addons, \n       SUM(pa.monthly_fee) AS addon_price\nFROM isp i\nJOIN product p ON i.id = p.isp_id\nJOIN `connection` c ON p.id = c.product_id\nLEFT JOIN RequiredAddons ra ON p.id = ra.product_id\nWHERE ra.product_id IS NOT NULL -- Ensures that the product has all specified addons\nLEFT JOIN product_addon pa ON pa.product_id = p.id AND pa.forced = 0\nLEFT JOIN addon a ON pa.addon_id = a.id\nGROUP BY i.name, i.img_link, c.download, c.upload, c.monthly_price, c.link;