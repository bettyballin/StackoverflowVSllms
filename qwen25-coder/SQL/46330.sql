CREATE PROCEDURE GetStaffJobCounts\nAS\nBEGIN\n  SET NOCOUNT ON;\n\n  DECLARE @ResultTable TABLE \n  (\n    StaffName NVARCHAR(100),\n    Stage1Count INT,\n    Stage2Count INT\n  );\n\n  -- Insert aggregated counts in one step\n  INSERT INTO @ResultTable (StaffName, Stage1Count, Stage2Count)\n  SELECT \n    StaffName,\n    SUM(CASE WHEN DateStarted IS NOT NULL AND DateFinished IS NULL THEN 1 ELSE 0 END) AS Stage1Count,\n    SUM(CASE WHEN DateStarted IS NOT NULL AND DateFinished IS NOT NULL THEN 1 ELSE 0 END) AS Stage2Count\n  FROM ViewJob\n  GROUP BY StaffName;\n\n  -- Select the results from the @ResultTable\n  SELECT * FROM @ResultTable;\nEND