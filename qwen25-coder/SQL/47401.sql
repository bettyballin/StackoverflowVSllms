USE master;\nGO\n\n-- Find server logins and their user mappings in databases\nSELECT \n    sp.name AS ServerLogin,\n    dp.name AS DatabaseUser,\n    DB_NAME() AS DatabaseName,\n    dp.type_desc AS UserType,\n    IsNULL(dp2.name, 'No role membership') AS RoleName\nFROM \n    sys.server_principals sp\nJOIN \n    sys.database_principals dp ON sp.sid = dp.sid\nLEFT JOIN \n    sys.database_role_members drm ON dp.principal_id = drm.member_principal_id\nLEFT JOIN \n    sys.database_principals dp2 ON dp2.principal_id = drm.role_principal_id\nWHERE \n    sp.type NOT IN ('R')\nORDER BY \n    ServerLogin, DatabaseName, DatabaseUser;