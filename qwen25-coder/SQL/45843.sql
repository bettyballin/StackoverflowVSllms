Create Proc Balance_Report (@AsOfDate datetime = NULL)\nAS\nBEGIN\n    -- Ensure @AsOfDate is either NULL or at the end of the day for accurate comparison\n    IF @AsOfDate IS NOT NULL\n        SET @AsOfDate = DATEADD(day, DATEDIFF(day, 0, @AsOfDate), 1) - 0.0000001\n\n    IF @AsOfDate IS NULL OR CAST(@AsOfDate AS date) = CAST(GETDATE() AS date)\n        SELECT \n            Current.Balance.AsOfDate,\n            Column1\n        FROM \n            Current.Balance\n    ELSE\n        SELECT \n            MonthEnd.Balance.AsOfDate,\n            Column1\n        FROM \n            MonthEnd.Balance\n        WHERE \n            DATEADD(day, DATEDIFF(day, 0, MonthEnd.Balance.AsOfDate), 1) - 0.0000001 = @AsOfDate\nEND