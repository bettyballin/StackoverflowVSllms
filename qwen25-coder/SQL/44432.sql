WITH RuleResults AS (\n    SELECT \n        x1, \n        x2, \n        x3,\n        MIN(x1_high_doM, x2_medium_doM) AS rule1_doM,\n        MAX(x2_high_doM, x3_medium_doM) AS rule2_doM,\n        z1 AS rule1_outputZ,\n        z2 AS rule2_outputZ\n    FROM FuzzyValues\n),\nDefuzzifyCOG AS (\n    SELECT \n        SUM(rule1_doM * rule1_outputZ + rule2_doM * rule2_outputZ) / \n        SUM(rule1_doM + rule2_doM) AS finalOutput\n    FROM RuleResults\n)\nSELECT finalOutput FROM DefuzzifyCOG;