SELECT \n    b.boardname, \n    COUNT(DISTINCT t.topicid) AS topics,\n    SUM(topic_msg_count.messagecount) AS messages, \n    lm.author AS last_author, \n    lm.date AS last_date, \n    lm.topicname AS last_topic_name\nFROM \n    boards b\nJOIN (\n    SELECT \n        topicid, \n        boardid, \n        COUNT(messageid) AS messagecount,\n        MAX(date) AS maxdate\n    FROM \n        messages\n    GROUP BY \n        topicid, boardid\n) AS topic_msg_count\nON \n    b.boardid = topic_msg_count.boardid\nJOIN (\n    SELECT \n        m.topicid, \n        m.author, \n        m.date, \n        t.topicname,\n        ROW_NUMBER() OVER (PARTITION BY m.topicid ORDER BY m.date DESC) as rn\n    FROM \n        messages m\n    JOIN topics t ON m.topicid = t.topicid\n) AS lm\nON \n    topic_msg_count.topicid = lm.topicid AND topic_msg_count.maxdate = lm.date AND lm.rn = 1\nGROUP BY \n    b.boardname, lm.author, lm.date, lm.topicname;