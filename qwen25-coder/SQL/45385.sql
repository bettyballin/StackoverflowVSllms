DECLARE @StartDate datetime = '2009-06-01'\nDECLARE @EndDate datetime = '2009-06-10'\n\n-- First create a temporary table or CTE for the date range\n;WITH DateRange AS (\n  SELECT @StartDate as dt \n  UNION ALL\n  SELECT DATEADD(day, 1, dt)\n  FROM DateRange\n  WHERE DATEADD(day, 1, dt) <= @EndDate\n),\nReservationStatus AS(\n  SELECT \n    reservation_object,\n    r.dt,\n    CASE WHEN r.ID IS NOT NULL THEN 'busy' ELSE 'free' END as status\n  FROM DateRange dr\n  LEFT JOIN Reservations R\n    ON dr.dt >= R.arrival AND dr.dt < R.departure\n)\n\n-- Now we need to build the dynamic SQL for PIVOT\nDECLARE @cols AS NVARCHAR(MAX),\n        @query AS NVARCHAR(MAX)\n\nSELECT @cols = STUFF((SELECT distinct ',' + QUOTENAME(dt)\n                      FROM DateRange \n                      FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'),1,1,'')\n\nSET @query = N'SELECT reservation_object,' + @cols + '\n               FROM ReservationStatus\n               PIVOT(\n                 MAX(status)\n                 FOR dt IN (' + @cols + ')\n              ) AS pvt\n              ORDER BY reservation_object'\n\nEXEC sp_executesql @query;