WITH RankedValues AS (\n    SELECT \n        USERID,\n        VALUE,\n        SUBMITTED,\n        DENSE_RANK() OVER (PARTITION BY USERID ORDER BY ID) - \n        ROW_NUMBER() OVER (PARTITION BY USERID, VALUE ORDER BY ID) AS grp\n    FROM YourTable\n),\nGroupedValues AS (\n    SELECT \n        USERID,\n        VALUE,\n        COUNT(*) AS SequenceCount\n    FROM RankedValues\n    GROUP BY USERID, VALUE, grp\n)\nSELECT \n    USERID,\n    VALUE,\n    MAX(SequenceCount) AS MaxConsecutiveCount\nFROM GroupedValues\nGROUP BY USERID, VALUE\nHAVING SequenceCount = MAX(SequenceCount);