WITH AliasHelper AS (\n    SELECT table1.someField AS theField,\n           COUNT(table2.someField) AS countedTable2Fields\n    FROM table1 \n    LEFT JOIN table2 ON table1.someField = table2.someField\n    GROUP BY table1.someField\n)\nSELECT ah.theField,\n       ah.countedTable2Fields / (SELECT COUNT(someField) FROM table1 WHERE someField = ah.theField) AS ratio\nFROM AliasHelper ah;