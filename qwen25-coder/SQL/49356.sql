select \n    card_type = case \n                when substring(pan, 1, 2) in ('37') then 'AMEX'\n                when substring(pan, 1, 1) = '3' then 'Diners'\n                when substring(pan, 1, 1) = '4' then 'VISA'\n                when substring(pan, 1, 1) = '5' then 'MasterCard'\n                else 'unknown' \n               end,\n    count(*),\n    sum(amount)\nfrom transactions\ngroup by card_type;