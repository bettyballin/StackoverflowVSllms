-- Retrieves data on jobs that completed/completed with errors during a given time span.\nDECLARE @Hour INT         -- Hour to start/end the day at (0-23)\nDECLARE @TimeSpan INT     -- TimeSpan in hours\n\nSET @Hour = 8            -- Default is 8am\nSET @TimeSpan = 24       -- Default is 24 hours\n\nDECLARE @dateStart DATETIME\nDECLARE @dateEnd DATETIME\n\n-- Calculate the start and end times based on current time, hour, and timespan\nIF GETDATE() > CAST(CONVERT(varchar, CONVERT(date, GETDATE())) + ' ' + RIGHT('0' + rtrim(@Hour), 2) + ':00:00.000' AS DATETIME)\nBEGIN\n    SET @dateEnd = DATEADD(hour, -@Hour, CAST(CONVERT(varchar, CONVERT(date, GETDATE()) + 1) AS DATETIME))\n    SET @dateStart = DATEADD(hour, -(@TimeSpan + @Hour), @dateEnd)\nEND\nELSE\nBEGIN\n    SET @dateEnd = DATEADD(hour, -@Hour, CAST(CONVERT(varchar, CONVERT(date, GETDATE())) AS DATETIME))\n    SET @dateStart = DATEADD(hour, -(@TimeSpan + @Hour), @dateEnd)\nEND\n\n-- Use these variables in your query to filter records\nSELECT *\nFROM Jobs j\nWHERE j.CompletionDate BETWEEN @dateStart AND @dateEnd;