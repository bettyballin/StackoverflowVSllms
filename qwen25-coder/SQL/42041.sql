DECLARE @XMLData XML = N'\n<Cookie>\n   <id>Chocolate Chip</id>\n   <ChocolateChipPeanutButter/>\n   <ChocolateChipPecan/>\n</Cookie>\n<Cookie>\n   <id>Raisin</id>\n</Cookie>\n<Cookie>\n   <id>Coconut</id>\n</Cookie>\n<Cookie>\n   <id>Sugar</id>\n</Cookie>';\n\nSELECT \n    T2.value('(./id/text())[1]', 'NVARCHAR(128)') AS CookieName,\n    CTE.nodeName AS SubCookieName\nFROM \n    @XMLData.nodes('/Cookie') AS T1(TheCookie)\nCROSS APPLY (\n    SELECT T2.value('(./id/text())[1]', 'NVARCHAR(128)') AS CookieName,\n           NULL AS nodeName\n    UNION ALL\n    SELECT T2.value('(./id/text())[1]', 'NVARCHAR(128)'),\n           T3.value('local-name(.)', 'NVARCHAR(128)')\n    FROM TheCookie.nodes('*[not(local-name() = ''id'')]') AS T4(T3)\n) AS CTE;