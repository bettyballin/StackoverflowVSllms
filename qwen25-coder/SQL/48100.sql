CREATE PROCEDURE spStats_GetSalesStatsByHour @ShopId INT\n   AS \n   BEGIN\n       DECLARE @LocalShopId INT;\n       SET @LocalShopId = @ShopId;\n\n       SELECT     \n           DATEADD(dd, 0, DATEDIFF(dd, 0, TableA.Created)) AS Day, \n           DATEPART(hh, TableA.Created) AS [Hour], \n           SUM(TableB.Quantity) AS Quantity, \n           SUM(TableB.Amount) AS Amount\n       FROM\n           TableA\n           INNER JOIN TableB ON TableA.BID = TableB.ID\n       WHERE     \n           (TableA.ShopId = @LocalShopId)\n       GROUP BY \n           DATEADD(dd, 0, DATEDIFF(dd, 0, TableA.Created)), \n           DATEPART(hh, TableA.Created)\n       ORDER BY \n           DATEPART(hh, TableA.Created);\n   END