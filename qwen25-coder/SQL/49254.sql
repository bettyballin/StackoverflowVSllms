WITH RECURSIVE time_intervals AS (\n    SELECT '00:00:00' as start_interval, ADDTIME('00:00:00', '00:15:00') as end_interval\n    UNION ALL\n    SELECT start_interval + INTERVAL 15 MINUTE,\n           end_interval + INTERVAL 15 MINUTE\n    FROM time_intervals\n    WHERE end_interval < '23:45:00'\n),\ntimesheet_intervals AS (\n    SELECT DATE_FORMAT(t.start_time, '%H:%i:%s') as ts_start,\n           DATE_FORMAT(t.end_time, '%H:%i:%s') as ts_end,\n           ti.start_interval,\n           ti.end_interval,\n           CASE \n               WHEN t.start_time <= ti.start_interval AND ti.end_interval <= t.end_time THEN 0.25\n               WHEN t.start_time <= ti.start_interval AND t.end_time BETWEEN ti.start_interval AND ti.end_interval THEN TIMEDIFF(t.end_time, ti.start_interval) / INTERVAL 1 HOUR\n               WHEN t.start_time >= ti.start_interval AND t.start_time < ti.end_interval AND t.end_time >= ti.end_interval THEN TIMEDIFF(ti.end_interval, t.start_time) / INTERVAL 1 HOUR\n               WHEN t.start_time >= ti.start_interval AND t.end_time <= ti.end_interval THEN TIMEDIFF(t.end_time, t.start_time) / INTERVAL 1 HOUR\n               ELSE 0\n           END as hours_worked\n    FROM timesheets t\n    CROSS JOIN time_intervals ti\n)\nSELECT DATE_FORMAT(TI.start_interval, '%H:%i') as interval_start,\n       SUM(hours_worked) as total_hours\nFROM timesheet_intervals TI\nGROUP BY interval_start\nORDER BY interval_start;