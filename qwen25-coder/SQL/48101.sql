SELECT \n    xml_data.value('(/event/action/value)[1]', 'varchar(max)') as SQLStatement,\n    DATEADD(hh, (DATEDIFF(hh, GETUTCDATE(), CURRENT_TIMESTAMP)), xml_data.value('(/event/@timestamp)[1]', 'datetime2')) AS LocalTime\nFROM (\n    SELECT \n        OBJECT_NAME(Object_id) AS ObjectName,\n        CAST(target_data AS XML)\n            .query('/RingBufferTarget/event') AS TargetData\n    FROM sys.dm_xe_sessions AS s\n        JOIN sys.dm_xe_targets AS t ON s.address = t.event_session_address\n        WHERE s.name = 'AllQueries'\n) AS EventSessions\nCROSS APPLY T.TargetData.nodes('.') AS XT(xml_data)