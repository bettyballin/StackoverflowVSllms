CREATE OR REPLACE PROCEDURE fetch_and_delete (\n    p_result OUT SYS_REFCURSOR -- Output parameter for result set\n) IS\n    TYPE my_record_type IS RECORD (\n        id NUMBER,\n        name VARCHAR2(100)\n    );\n\n    TYPE my_table_type IS TABLE OF my_record_type;\n\n    v_data my_table_type := my_table_type();\nBEGIN\n    SELECT id, name BULK COLLECT INTO v_data FROM my_queue WHERE condition = 'some_value';\n\n    -- Open the cursor to return the data via out parameter\n    OPEN p_result FOR\n        SELECT * FROM TABLE(CAST(v_data AS my_table_type));\n\n    FORALL i IN 1 .. v_data.COUNT\n        DELETE FROM my_queue WHERE id = v_data(i).id;\n\n    COMMIT;\nEND fetch_and_delete;\n/