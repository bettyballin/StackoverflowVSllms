SELECT \n    u.id AS owner,\n    SUM(CASE WHEN c.name = 'currency1' THEN a.amount ELSE 0 END) AS currency1,\n    SUM(CASE WHEN c.name = 'currency2' THEN a.amount ELSE 0 END) AS currency2,\n    SUM(CASE WHEN c.name = 'currency3' THEN a.amount ELSE 0 END) AS currency3\nFROM \n    users u\nJOIN \n    accounts a ON u.id = a.user_id\nJOIN \n    currency c ON a.currency_id = c.id\nGROUP BY \n    u.id;