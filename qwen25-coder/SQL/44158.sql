-- Script to find long running procedures\n\nUSE master;\nGO\n\nSELECT TOP 10 \n    sqltext.TEXT AS 'Procedure Text' ,\n    req.session_id,\n    req.total_elapsed_time / 1000 AS 'Elapsed Time (sec)',\n    req.cpu_time AS 'CPU Time',\n    req.logical_reads AS 'Logical Reads',\n    reqreads.logical_reads_session/reqreads.execution_count AS 'Avg Logical Read Per Execution',\n    req.writes AS 'Reads',\n    reqreads.reads_session/reqreads.execution_count AS 'Avg Write Per Execution',\n    req.status\nFROM \n    sys.dm_exec_requests req\nCROSS APPLY \n    (SELECT \n        t.text,\n        s.logical_reads as reads_last_execution,\n        s.reads as writes_last_execution,\n        s.total_logical_reads as logical_reads_session,\n        s.Reads as writes_Session, \n        qs.execution_count\n     FROM \n         sys.dm_exec_sql_text(req.sql_handle) AS t \n     JOIN \n         sys.dm_exec_query_stats AS qs ON req.sql_handle = qs.sql_handle\n     JOIN \n         (SELECT * FROM sys.dm_exec_sessions) AS s ON req.session_id = s.session_id) as sqltext\nWHERE \n    req.total_elapsed_time > 1000 -- Filter out queries that have taken less than 1 second\nORDER BY \n    req.total_elapsed_time DESC;