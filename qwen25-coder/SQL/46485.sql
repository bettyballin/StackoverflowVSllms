WITH CategoryOrder AS (\n    SELECT \n        Name,\n        ParentID,\n        CASE \n            WHEN ParentID IS NULL THEN Name  -- Root categories\n            ELSE (SELECT Name FROM Categories WHERE ID = ParentID)  -- Root category name for subcategories\n        END AS TopCategoryName,\n        ROW_NUMBER() OVER(PARTITION BY ParentID ORDER BY Name) AS SubcategoryOrder\n    FROM \n        Categories\n)\nSELECT \n    Name\nFROM \n    CategoryOrder\nORDER BY \n    TopCategoryName,  -- Order by top-level category name\n    CASE WHEN ParentID IS NULL THEN 0 ELSE 1 END,  -- Root categories first\n    SubcategoryOrder;  -- Then order subcategories alphabetically