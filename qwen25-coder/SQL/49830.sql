WITH RankedCourses AS (\n    SELECT \n        m.PersonName,\n        c.CourseName,\n        d.StartDate,\n        d.EndDate,\n        ROW_NUMBER() OVER (PARTITION BY m.ID ORDER BY d.EndDate DESC) as rn\n    FROM \n        Master m\n    JOIN \n        Detail d ON m.ID = d.MasterID\n    JOIN \n        Course c ON d.CourseID = c.ID\n)\nSELECT \n    PersonName, \n    CourseName, \n    StartDate, \n    EndDate\nFROM \n    RankedCourses\nWHERE \n    rn = 1;