-- Create an Extended event session to capture SQL Batch completing\nCREATE EVENT SESSION [CaptureRecentQueries]\nON SERVER \nADD EVENT sqlserver.sql_batch_completed(\n    ACTION(sqlserver.client_hostname,sqlserver.database_id,sqlserver.sql_text,sqlserver.username)\n)\nADD TARGET package0.event_file(SET filename=N'C:\YourPath\RecentQueries.xel')\nWITH (MAX_MEMORY=4096 KB,EVENT_RETENTION_MODE=ALLOW_SINGLE_EVENT_LOSS,MAX_DISPATCH_LATENCY=30 SECONDS,\nMAX_EVENT_SIZE=0 KB,MEMORY_PARTITION_MODE=NONE,TRACK_CAUSE_AND_EFFECT=OFF,STARTUP_STATE=OFF)\nGO\n\n-- Start the event session\nALTER EVENT SESSION [CaptureRecentQueries]\nON SERVER STATE = START;\nGO\n\n-- Stop and drop the session when done\nALTER EVENT SESSION [CaptureRecentQueries] ON SERVER STATE = STOP; \nDROP EVENT SESSION [CaptureRecentQueries] ON SERVER;