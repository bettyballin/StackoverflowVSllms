WITH TimeSlots AS (\n    SELECT \n        DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(VARCHAR(5), Date, 108)) / 30 * 30, 0) AS HalfHourSlot,\n        COUNT(Page) AS VisitingCount\n    FROM scr_SecuristLog \n    WHERE Date BETWEEN '2009-04-30' AND '2009-05-02'    \n      AND [user] IN (\n          SELECT USERNAME               \n          FROM scr_CustomerAuthorities \n          WHERE customerID = 4 -- No need to convert integers to varchar\n            AND ID = 43) -- Same here, no conversion necessary\n    GROUP BY DATEADD(MINUTE, DATEDIFF(MINUTE, 0, CONVERT(VARCHAR(5), Date, 108)) / 30 * 30, 0)\n)\n\nSELECT \n    SUM(VisitingCount) AS VisitingCount,\n    CONCAT(\n        RIGHT('0' + CAST(DATEPART(HOUR, HalfHourSlot) AS VARCHAR(2)), 2),\n        ':', \n        RIGHT('0' + CAST(DATEPART(MINUTE, HalfHourSlot) AS VARCHAR(2)), 2),\n        '-',\n        RIGHT('0' + CAST(DATEPART(HOUR, DATEADD(MINUTE, 30, HalfHourSlot)) AS VARCHAR(2)), 2),\n        ':', \n        RIGHT('0' + CAST(DATEPART(MINUTE, DATEADD(MINUTE, 30, HalfHourSlot)) AS VARCHAR(2)), 2)\n    ) AS [Time]\nFROM TimeSlots\nGROUP BY HalfHourSlot\nORDER BY HalfHourSlot;