WITH sub_tree AS (\n    SELECT node.name AS node_name, (COUNT(parent.name) - 1) AS depth\n    FROM line_items AS node\n    JOIN line_items AS parent ON node.lft BETWEEN parent.lft AND parent.rgt\n    WHERE node.name = 'Power Up'\n    GROUP BY node.name\n    ORDER BY node.lft\n)\nSELECT n.name, (COUNT(p.name) - (st.depth + 1)) AS depth\nFROM line_items AS n\nJOIN line_items AS p ON n.lft BETWEEN p.lft AND p.rgt\nJOIN sub_tree AS st ON n.name = st.node_name\nGROUP BY n.name\nHAVING depth <= 1\nORDER BY n.lft;