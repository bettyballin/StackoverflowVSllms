SELECT \n    p1.Product,\n    COALESCE(p3.Price, p2.Price, p1.Price) AS EffectivePrice,\n    CASE \n        WHEN p3.Price IS NOT NULL THEN 'Store Specific'\n        WHEN p2.Price IS NOT NULL THEN 'Region Specific'\n        ELSE 'Default Price'\n    END AS PriceType\nFROM \n    Prices AS p1  -- Default price (Region = NULL, Store = NULL)\nLEFT JOIN \n    Prices AS p2 ON p1.Product = p2.Product AND p2.Region = @Region AND p2.Store IS NULL  -- Region specific\nLEFT JOIN \n    Prices AS p3 ON p2.Product = p3.Product AND p3.Store = @Store  -- Store specific\nWHERE \n    p1.Region IS NULL AND p1.Store IS NULL;