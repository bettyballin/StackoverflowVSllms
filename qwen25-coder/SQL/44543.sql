SELECT \n   b.name AS building_name,\n   GROUP_CONCAT(CASE WHEN m.building IS NOT NULL THEN m.name END) AS men,\n   COUNT(DISTINCT CASE WHEN m.building IS NOT NULL THEN m.name END) AS men_count,\n   GROUP_CONCAT(CASE WHEN w.building IS NOT NULL THEN w.name END) AS women,\n   COUNT(DISTINCT CASE WHEN w.building IS NOT NULL THEN w.name END) AS women_count,\n   COUNT(DISTINCT CASE WHEN m.building IS NOT NULL OR w.building IS NOT NULL THEN m.name ELSE w.name END) AS total_count\nFROM \n   building b\nLEFT JOIN \n   men m ON b.name = m.building\nLEFT JOIN \n   women w ON b.name = w.building\nGROUP BY \n   b.name;