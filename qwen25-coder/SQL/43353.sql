CREATE TABLE #Temp (VisitingCount int, [Time] int, [Date] time )\nDECLARE @DateNow DATETIME,@i int,@Time int, @Date time\nset @DateNow='2023-01-01 00:00'  -- Initialize with a proper datetime value\n\nset @i=1;\nwhile(@i<=60)  \n    begin  \n        set @DateNow = DATEADD(minute, 30, @DateNow)\n        set @Time = (datepart(hour,@DateNow)*60+datepart(minute,@DateNow))/30 \n        set @Date = CONVERT(time(5),@DateNow, 108)\n        insert into #Temp(VisitingCount,[Time],[Date]) values(0,@Time,@Date )\n        set @i=@i+1\n    end\n\nselect Sum(VisitingCount) as VisitingCount, [Time], CAST(@Date AS nvarchar(5)) as Date\nfrom (\n  select Sum(VisitingCount)as VisitingCount, [Time],[Date]\n    from #Temp group by [Time],[Date]\n  Union All\n    select count(page) as VisitingCount, CONVERT(time(5),Date, 108), \n    (datepart(hour,Date)*60+datepart(minute,Date))/30 as [Time]\n    from scr_SecuristLog\n    where Date between '2009-05-12' and '2009-05-13'\n    GROUP BY (datepart(hour,Date)*60+datepart(minute,Date))/30,CONVERT(time(5),Date, 108)\n  ) X\ngroup by [Time],[Date]\norder by 2 asc