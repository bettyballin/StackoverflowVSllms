WITH LatestPrices AS (\n    SELECT \n        ThingID,\n        MAX(PriceDateTime) AS MaxPriceDateTime\n    FROM \n        Thing\n    WHERE \n        PriceDateTime >= CAST(CAST(GETDATE() AS DATE) AS DATETIME)\n        AND ThingID IN (1, 2, 3, 4, 5, 6)\n    GROUP BY \n        ThingID\n)\n\nSELECT \n    t.ThingID,\n    t.ID,\n    t.PriceDateTime,\n    t.Price\nFROM \n    Thing t\nJOIN \n    LatestPrices lp ON t.ThingID = lp.ThingID AND t.PriceDateTime = lp.MaxPriceDateTime;