-- Create table and sequence\nCREATE TABLE spool (\n    key BIGINT,\n    txt TEXT,\n    seq BIGINT\n);\n\nCREATE SEQUENCE key_seq START 1;\nCREATE SEQUENCE seq_seq START 1;\n\n-- Function to return timestamp in the same format as Oracle's TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')\nCREATE OR REPLACE FUNCTION tox_timestamp() RETURNS VARCHAR AS $$\nBEGIN\n    RETURN TO_CHAR(CURRENT_TIMESTAMP, 'YYYYMMDDHH24MISS');\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Functions to manage spool operations\nDO $$\nDECLARE \n    g_spool_key BIGINT;\nBEGIN\n    -- Function to begin spooling\n    CREATE OR REPLACE FUNCTION tox_begin_spool() RETURNS VOID AS $$\n    BEGIN\n        SELECT nextval('key_seq') INTO g_spool_key;\n    END;\n    $$ LANGUAGE plpgsql;\n\n    -- Function to insert into spool\n    CREATE OR REPLACE FUNCTION tox_into_spool(in_txt TEXT) RETURNS VOID AS $$\n    BEGIN\n        INSERT INTO spool (key, txt, seq)\n        VALUES (g_spool_key, in_txt, nextval('seq_seq'));\n    END;\n    $$ LANGUAGE plpgsql;\n\n    -- Function to reset spool\n    CREATE OR REPLACE FUNCTION tox_reset_spool() RETURNS VOID AS $$\n    BEGIN\n        DELETE FROM spool WHERE key = g_spool_key;\n        COMMIT;\n        PERFORM tox_begin_spool();\n    END;\n    $$ LANGUAGE plpgsql;\n\n    -- Function to end spooling and return results\n    CREATE OR REPLACE FUNCTION tox_end_spool() RETURNS SETOF spool AS $$\n    BEGIN\n        RETURN QUERY SELECT * FROM spool WHERE key = g_spool_key ORDER BY seq;\n        COMMIT;\n    END;\n    $$ LANGUAGE plpgsql;\nEND $$;