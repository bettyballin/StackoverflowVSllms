-- Create a BEFORE DELETE trigger on FILES to check dependencies and remove them\nCREATE TRIGGER CHECK_DEPS BEFORE DELETE ON FILES\nAS\nDECLARE VARIABLE DEPENDENT_FILE_ID INTEGER;\nBEGIN\n  FOR SELECT dependent_file_id FROM DEPENDENCIES WHERE file_id = OLD.file_id INTO :DEPENDENT_FILE_ID DO\n  BEGIN\n    DELETE FROM DEPENDENCIES WHERE dependent_file_id = :DEPENDENT_FILE_ID AND file_id = OLD.file_id;\n  END\n\n  -- Ensure that the file itself can be deleted if there are no dependencies\n  FOR SELECT dependent_file_id FROM DEPENDENCIES WHERE file_id = OLD.file_id INTO :DEPENDENT_FILE_ID DO\n  BEGIN\n    IF (:DEPENDENT_FILE_ID IS NOT NULL) THEN\n      EXCEPTION foreign_key_violation;\n  END\nEND;\n\n-- You might also need an AFTER DELETE trigger to clean up dependencies where the dependent_file is being deleted\nCREATE TRIGGER CLEAN_DEPS_AFTER_DELETE_FILE AFTER DELETE ON FILES\nAS\nBEGIN\n  IF (ROW_COUNT > 0) THEN\n    DELETE FROM DEPENDENCIES WHERE file_id IN (SELECT OLD.file_id FROM RDB$REMOVED_RECORDS);\nEND;