CREATE TABLE #RealTransactions AS\nSELECT E.EmployeeID, SUM(M.Amount) AS TotalAmount\nFROM Employees E\nLEFT JOIN MoneyTransactions M ON E.EmployeeID = M.EmployeeID\nGROUP BY E.EmployeeID;\n\nCREATE TABLE #BudgetTransactions AS\nSELECT E.EmployeeID, SUM(B.Amount) AS BudgetAmount\nFROM Employees E\nLEFT JOIN BudgetTransactions B ON E.EmployeeID = B.EmployeeID\nGROUP BY E.EmployeeID;\n\nCREATE TABLE #TimeTransactions AS\nSELECT E.EmployeeID, SUM(T.Hours) AS TotalHours, \n       SUM(CASE WHEN T.Type = 'Waste' THEN 1 ELSE 0 END) AS WastedHoursCount\nFROM Employees E\nLEFT JOIN TimeTransactions T ON E.EmployeeID = T.EmployeeID\nGROUP BY E.EmployeeID;\n\nCREATE TABLE #TimeBudgetTransactions AS\nSELECT E.EmployeeID, SUM(TB.Hours) AS BudgetHours\nFROM Employees E\nLEFT JOIN TimeBudgetTransactions TB ON E.EmployeeID = TB.EmployeeID\nGROUP BY E.EmployeeID;\n\nSELECT E.EmployeeName\n    , COALESCE(R.TotalAmount, 0) AS TotalAmount\n    , COALESCE(B.BudgetAmount, 0) AS BudgetAmount\n    , COALESCE(T.TotalHours, 0) AS TotalHours\n    , COALESCE(TB.BudgetHours, 0) AS BudgetHours\n    , T.WastedHoursCount * (SELECT AVG(Hours) FROM TimeTransactions WHERE Type = 'Waste') AS WastedHours\nFROM Employees E\nLEFT JOIN #RealTransactions R ON E.EmployeeID = R.EmployeeID\nLEFT JOIN #BudgetTransactions B ON E.EmployeeID = B.EmployeeID\nLEFT JOIN #TimeTransactions T ON E.EmployeeID = T.EmployeeID\nLEFT JOIN #TimeBudgetTransactions TB ON E.EmployeeID = TB.EmployeeID;