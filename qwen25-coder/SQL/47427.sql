SELECT \n    t1.shipment_id,\n    MIN(t2.time) AS start_time,\n    MAX(t3.time) AS end_time\nFROM \n    test t1\nJOIN \n    (SELECT shipment_id, MIN(time) AS time FROM test GROUP BY shipment_id) t2\nON \n    t1.shipment_id = t2.shipment_id AND t1.stop_seq = 1\nJOIN \n    (SELECT shipment_id, MAX(time) AS time FROM test GROUP BY shipment_id) t3\nON \n    t1.shipment_id = t3.shipment_id\nGROUP BY \n    t1.shipment_id;