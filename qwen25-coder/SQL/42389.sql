-- Temporary Table for initial setup\nCREATE TABLE #Temp (VisitingCount int, [Time] int );\n\nDECLARE \n    @DateNow DATETIME,\n    @i int,\n    @Time int;\n\nSET @DateNow='00:00'  \nSET @i=1;  \n\nWHILE(@i<48)  \nBEGIN  \n    SET @DateNow = DATEADD(minute, 30, @DateNow);\n    SET @Time = (DATEPART(hour,@DateNow)*60+DATEPART(minute,@DateNow))/30;\n    INSERT INTO #Temp(VisitingCount,[Time]) VALUES(0,@Time );\n    SET @i=@i+1;\nEND;\n\n-- Select from temporary table and log table\nSELECT \n    SUM(CASE WHEN t.VisitingCount IS NULL THEN 0 ELSE t.VisitingCount END) AS VisitingCount,\n    COALESCE(t.[Time], s.[Time]) AS [Time]\nFROM \n    #Temp a\nLEFT JOIN \n    (SELECT \n         COUNT(page) AS VisitingCount, \n         (DATEPART(hour,[Date])*60+DATEPART(minute,[Date]))/30 AS [Time]\n     FROM \n         scr_SecuristLog\n     WHERE \n         [Date] BETWEEN '2009-05-04 10:30' AND '2009-05-04 12:30'\n     GROUP BY \n         (DATEPART(hour,[Date])*60+DATEPART(minute,[Date]))/30) s\nON \n    a.[Time] = s.[Time]\nGROUP BY \n    COALESCE(t.[Time], s.[Time])\nORDER BY \n    [Time];