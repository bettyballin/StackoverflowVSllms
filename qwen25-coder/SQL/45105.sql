SELECT\n    customer.id,\n    customer.name,\n    COUNT(DISTINCT all_orders.id) AS num_orders,\n    SUM(all_items.price) AS total_money\nFROM\n    customer\nINNER JOIN (\n    SELECT * FROM p_orders UNION ALL SELECT * FROM h_orders\n) AS all_orders ON all_orders.id_customer = customer.id\nINNER JOIN (\n    SELECT * FROM p_items UNION ALL SELECT * FROM h_items\n) AS all_items ON all_items.id_order = all_orders.id\nGROUP BY\n    customer.id,\n    customer.name\nORDER BY\n    customer.id ASC;