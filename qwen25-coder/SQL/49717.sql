ALTER FUNCTION [VEZNE].[fnMakbuzIslemGetir] \n        ( \n              @refNo     as int      \n        ) \n\nRETURNS @tablename TABLE (kontrol1 char(1),key0 numeric(18,0) ,tarih datetime ,hizkod char(12),hizad char(75),ytlhizfiyat decimal(18,2) ,hizmiktar numeric(18,2),ytlhiztutar decimal(18,2))\n        AS \n        BEGIN\n\n            DECLARE @durum     AS VARCHAR\n            DECLARE @hastaTuru AS VARCHAR \n            DECLARE @makTipi   AS VARCHAR \n\n            SELECT TOP 1 @durum = durum FROM TH_RefKart WHERE RefNo = @refNo\n            SELECT TOP 1 @hastaturu = HastaTuru FROM TH_Dosya WHERE DosyaNo in (SELECT DosyaNo FROM TH_RefKart WHERE RefNo = @refNo)\n            SELECT TOP 1 @makTipi = maktipi FROM TH_Islem WHERE refNo = @refNo \n\n            IF ((@hastaTuru = 'Ãœcretli') AND (@durum = 'AYAKTA')) OR @makTipi = '0' \n            BEGIN \n                INSERT @tablename SELECT kontrol1, key0, tarih, hizkod, hizad, ytlhizfiyat, hizmiktar, ytlhiztutar \n                FROM TH_Islem \n                WHERE refno= @refNo and DekontNo = '0' and anahtar<> -1 \n            END \n\n        RETURN\n\n        END