WITH RankedReplies AS (\n    SELECT \n        Replies.id,\n        Replies.content,\n        Replies.post_id,\n        ROW_NUMBER() OVER (PARTITION BY Replies.post_id ORDER BY Replies.created_at DESC) as reply_rank\n    FROM \n        Replies\n)\nSELECT \n    p.title AS post_title,\n    p.content AS post_content,\n    rr.id AS reply_id,\n    rr.content AS reply_content\nFROM \n    Posts p\nLEFT JOIN \n    RankedReplies rr ON p.id = rr.post_id AND rr.reply_rank <= 3\nWHERE \n    p.id IN (\n        SELECT id FROM Posts ORDER BY created_at DESC LIMIT X\n    )\nORDER BY \n    p.id, rr.reply_rank;