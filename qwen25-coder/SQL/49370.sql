CREATE FUNCTION dbo.CapitalizeWords(@inputString NVARCHAR(MAX))\nRETURNS NVARCHAR(MAX)\nAS\nBEGIN\n    DECLARE @result NVARCHAR(MAX) = '';\n    WITH Split(Words) AS (\n        SELECT value \n        FROM STRING_SPLIT(@inputString, ' ')\n    ),\n    Capitalize(WordIndex, CapitalizedWord) AS (\n        SELECT ROW_NUMBER() OVER (ORDER BY (SELECT NULL)),\n               UPPER(LEFT(value, 1)) + LOWER(SUBSTRING(value, 2, LEN(value)))\n        FROM Split\n    )\n    SELECT @result = STRING_AGG(CapitalizedWord, ' ') \n    FROM Capitalize;\n    \n    RETURN @result;\nEND\n\n-- Usage\nDECLARE @testString NVARCHAR(MAX) = 'this is a test string';\nSELECT dbo.CapitalizeWords(@testString);