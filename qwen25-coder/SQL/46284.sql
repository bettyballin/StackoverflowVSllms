WITH NumberedRows AS (\n    SELECT *,\n           ROW_NUMBER() OVER (ORDER BY id) - ROW_NUMBER() OVER (PARTITION BY CASE WHEN id % 2 = 1 THEN 1 ELSE 0 END ORDER BY id) AS grp\n    FROM your_table_name\n),\nGroupedRows AS (\n    SELECT grp,\n           MIN(date) AS start_date,\n           MAX(date) AS end_date,\n           STRING_AGG(product, ' ') WITHIN GROUP (ORDER BY id) AS product\n    FROM NumberedRows\n    GROUP BY grp\n)\nSELECT ROW_NUMBER() OVER (ORDER BY start_date) AS row_num,\n       COALESCE(start_date, end_date) AS date1,\n       CASE WHEN COUNT(*) = 2 THEN MIN(end_date) END AS date2,\n       product\nFROM GroupedRows\nGROUP BY grp\nORDER BY start_date;