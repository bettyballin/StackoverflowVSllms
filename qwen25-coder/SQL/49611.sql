SELECT r.date, r.expiration, r.days, r.callput, r.iv, r.delta\nFROM RAWDATA r\nINNER JOIN (\n    SELECT date, Min(IIF(delta > 0.5, delta - 0.5, 1)) AS min_delta_diff, Min(days) AS min_days\n    FROM (    \n        SELECT \n            date,\n            expiration,\n            DateDiff("d", [date], [expiration]) AS days,\n            callput,\n            iv,\n            delta\n        FROM RAWDATA\n        WHERE callput = "C"\n          AND DateDiff("d", [date], [expiration]) BETWEEN 15 AND 50\n    ) subQuery\n    GROUP BY date\n) minD ON r.date = minD.date \nWHERE (r.delta - 0.5) = IIF(minD.min_delta_diff < 1, minD.min_delta_diff, NULL)\nAND r.days = minD.min_days;