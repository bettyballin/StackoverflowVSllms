-- Step 1: Insert into Parent Table\nWITH DistinctUsers AS (\n    SELECT DISTINCT UserID, Group\n    FROM ExternalData\n)\nINSERT INTO ParentTable (UserID, Group, Name)\nSELECT \n    ud.UserID,\n    ud.Group,\n    CONCAT('User ', ud.UserID, ' - ', ud.Group, ' data') AS Name\nFROM DistinctUsers ud;\n\n-- Step 2: Insert into Child Table\nWITH ParentRecordIDs AS (\n    SELECT UserID, Group, ID AS ParentID\n    FROM ParentTable\n),\nExternalDataWithParentId AS (\n    SELECT \n        ed.*, \n        pri.ParentID\n    FROM ExternalData ed\n    JOIN ParentRecordIDs pri ON ed.UserID = pri.UserID AND ed.Group = pri.Group\n)\nINSERT INTO ChildTable (ParentID, Value)\nSELECT ParentID, Value\nFROM ExternalDataWithParentId;