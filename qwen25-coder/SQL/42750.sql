WITH LatestLogons AS (\n    SELECT ResourceID, SystemConsoleUser0, LastConsoleUse0,\n           ROW_NUMBER() OVER (PARTITION BY ResourceID ORDER BY LastConsoleUse0 DESC) as rn\n    FROM v_GS_SYSTEM_CONSOLE_USER\n)\n\nSELECT \n    SV.Netbios_Name0 AS [NetBIOS Name],\n    LL.SystemConsoleUser0 AS [User Name],\n    CAST(LL.LastConsoleUse0 AS datetime) AS [Last Console Use],\n    IPA.IP_Addresses0 AS [IP Address]\nFROM \n    v_R_System_Valid SV\nLEFT JOIN \n    LatestLogons LL ON SV.ResourceID = LL.ResourceID AND LL.rn = 1\nLEFT JOIN \n    v_RA_System_IPAddresses IPA ON IPA.ResourceID = SV.ResourceID\nWHERE \n    (SV.Netbios_Name0 NOT LIKE 'ENC-%')\n    AND (SV.Netbios_Name0 NOT LIKE 'NL%')\nORDER BY \n    SV.Netbios_Name0;