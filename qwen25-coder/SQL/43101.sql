-- Define a Message Type for notifications\nCREATE MESSAGE TYPE [DataChangeNotification]\nVALIDATION = WELL_FORMED_XML;\n\n-- Define the contract based on the message type\nCREATE CONTRACT [DataChangeContract]\n([DataChangeNotification] SENT BY INITIATOR);\n\n-- Create queues and services\nCREATE QUEUE dbo.DataChangeQueue;\nCREATE SERVICE DataChangeService ON QUEUE dbo.DataChangeQueue ([DataChangeContract]);\n\n-- Create a trigger to send a notification when data changes\nCREATE TRIGGER NotifyOnOrderChange\n    ON Orders\nAFTER INSERT, UPDATE, DELETE\nAS\nBEGIN\n    DECLARE @hDialog uniqueidentifier;\n\n    -- Start the conversation and send a message\n    BEGIN DIALOG CONVERSATION @hDialog\n        FROM SERVICE [DataChangeService]\n        TO   SERVICE 'NotificationListener'\n        ON CONTRACT [DataChangeContract]\n        WITH ENCRYPTION = OFF;\n\n    SEND ON CONVERSATION @hDialog\n         MESSAGE TYPE [DataChangeNotification] \n         (N'<Notification>DataChanged</Notification>');\n\n    END CONVERSATION @hDialog;\nEND;