WITH ranked_mat AS (\n    SELECT material_id,\n           content_id,\n           resolution,\n           file_location,\n           file_size,\n           RANK() OVER (PARTITION BY content_id ORDER BY resolution DESC) as rank_res\n      FROM mat\n     WHERE content_id IN (\n         SELECT c.content_id\n           FROM con c\n          INNER JOIN con_groups cg ON c.content_id = cg.content_id\n          WHERE cg.content_group_id = 10\n     )\n)\nSELECT m.material_id,\n       m.content_id,\n       rm.file_location AS special_mat_file_location,\n       rm.file_size AS special_mat_file_size\n  FROM mat m\n INNER JOIN ranked_mat rm ON m.content_id = rm.content_id AND rm.rank_res = 1;