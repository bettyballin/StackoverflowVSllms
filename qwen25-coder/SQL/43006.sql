CREATE TRIGGER trg_AuditTable\nON SourceTable\nAFTER INSERT, UPDATE, DELETE\nAS\nBEGIN\n    DECLARE @xmlData XML\n\n    -- Build the change data as XML for INSERT/UPDATE conditions\n    SET @xmlData = (\n        SELECT (SELECT * FROM inserted WHERE i.id = d.id FOR XML AUTO) AS NewValues,\n               (SELECT * FROM deleted  WHERE i.id = d.id FOR XML AUTO) AS OldValues\n          FROM inserted i, deleted d\n          FOR XML PATH('Change'), ROOT('Changes')\n    )\n\n    -- Send message to service broker queue with the change data\n    BEGIN DIALOG CONVERSATION @handle\n        FROM SERVICE ChangeService\n        TO SERVICE 'TargetChangeService',\n        ON CONTRACT ChangeTrackingContract;\n    \n    SEND ON CONVERSATION @handle MESSAGE TYPE [ChangeDataMessage] (@xmlData);\nEND