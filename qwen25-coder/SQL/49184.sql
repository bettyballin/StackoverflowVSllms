SELECT \n    p.userid, \n    COUNT(*) AS game_count,\n    COALESCE(w.winner_elo, l.loser_elo) AS current_elo\nFROM (\n    SELECT winner AS userid FROM webl_games WHERE reported_on > NOW() - INTERVAL 4 DAY\n    UNION ALL\n    SELECT loser AS userid FROM webl_games WHERE reported_on > NOW() - INTERVAL 4 DAY\n) p\nLEFT JOIN (\n    SELECT \n        winner AS userid, \n        winner_elo AS elo,\n        ROW_NUMBER() OVER (PARTITION BY winner ORDER BY reported_on DESC) as rn\n    FROM webl_games\n    UNION ALL\n    SELECT \n        loser AS userid, \n        loser_elo AS elo,\n        ROW_NUMBER() OVER (PARTITION BY loser ORDER BY reported_on DESC) as rn\n    FROM webl_games\n) w ON p.userid = w.userid AND w.rn = 1\nLEFT JOIN (\n    SELECT \n        loser AS userid, \n        loser_elo AS elo,\n        ROW_NUMBER() OVER (PARTITION BY loser ORDER BY reported_on DESC) as rn\n    FROM webl_games\n) l ON p.userid = l.userid AND l.rn = 1\nWHERE p.userid IS NOT NULL\nGROUP BY p.userid\nHAVING COUNT(*) >= 3\nORDER BY current_elo DESC;