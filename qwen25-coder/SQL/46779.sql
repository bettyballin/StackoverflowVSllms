SELECT * \nFROM (\n    SELECT NEWID() AS guid, UserID, RoleId, ClubId, 0 AS GroupRole\n    FROM dbo.Portal_UserRoles\n\n    UNION ALL\n\n    SELECT NEWID() AS guid, dbo.Portal_UserGroups.UserId, \n           dbo.Portal_GroupRoles.RoleId, dbo.Portal_UserGroups.ClubId, \n           dbo.Portal_GroupRoles.GroupId AS GroupRole\n    FROM dbo.Portal_GroupRoles \n    INNER JOIN dbo.Portal_UserGroups \n        ON dbo.Portal_GroupRoles.GroupId = dbo.Portal_UserGroups.GroupId\n) AS derivedtbl_1\nINNER JOIN (\n    SELECT Portal_GroupRoles.RoleId, Portal_ClubGroups.ClubId\n    FROM Portal_GroupRoles \n    INNER JOIN Portal_ClubGroups\n        ON Portal_GroupRoles.GroupId = Portal_ClubGroups.GroupId\n) AS subquery\nON derivedtbl_1.RoleId = subquery.RoleId AND derivedtbl_1.ClubId = subquery.ClubId;