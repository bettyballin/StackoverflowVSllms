CREATE OR REPLACE PROCEDURE search_hierarchy (\n    p_search_term IN VARCHAR2,\n    p_root_level  IN VARCHAR2 DEFAULT NULL,\n    p_results OUT SYS_REFCURSOR\n) AS\nBEGIN\n    OPEN p_results FOR\n        SELECT DISTINCT CASE \n                            WHEN INSTR(search_string, ' > ') = 0 THEN search_string \n                            ELSE SUBSTR(search_string, 1, INSTR(search_string, ' > ') + 2) || '*' \n                         END AS search_result\n        FROM hierarchy_view\n        WHERE (p_root_level IS NULL AND CONTAINS(search_string, p_search_term) > 0)\n           OR (p_root_level IS NOT NULL AND CONTAINS(search_string, p_search_term WITHIN (p_root_level)) > 0);\nEND;