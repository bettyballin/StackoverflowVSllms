SELECT XMLELEMENT("SalesOrders",\n    XMLAGG(\n        XMLELEMENT("SalesOrder", \n            XMLATTRIBUTES(so.id AS "Id", so.code AS "Code"),\n            XMLELEMENT("Customer", \n                XMLATTRIBUTES(cu.Code AS "Code", cu.Name AS "Name")\n            ),\n            (SELECT XMLAGG(\n                    XMLELEMENT("SalesItem",\n                        XMLATTRIBUTES(si.Item_Num AS "Item", pa.Code AS "PartCode")\n                    )\n                 ) FROM tblSalesItem si\n                  LEFT JOIN tblPart pa ON pa.Id = si.Part_Id\n                 WHERE so.id = si.SalesOrder_ID)\n        )\n    )\n).getClobVal() AS XMLData\nFROM tblSalesOrder so\nJOIN tblCustomer cu ON so.customer_id = cu.ID;