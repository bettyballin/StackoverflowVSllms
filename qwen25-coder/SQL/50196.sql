-- Insert or update item\nINSERT INTO items (itemId, itemName) VALUES (?, ?)\nON DUPLICATE KEY UPDATE itemName = VALUES(itemName);\n\n-- Conditional batch insert into categories\nINSERT IGNORE INTO categories (catName)\nVALUES ('each'), ('category'), ('name');\n\n-- Batch delete from map then re-insert for the given itemId\nDELETE m FROM map AS m WHERE m.itemId = ?;\nINSERT INTO map (itemId, catId) \nSELECT ?, c.catId\nFROM categories c\nWHERE c.catName IN ('each', 'category', 'name');\n\n-- Delete orphaned categories in a single operation\nDELETE FROM categories\nWHERE catId NOT IN (SELECT DISTINCT catId FROM map);