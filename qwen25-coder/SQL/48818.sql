BEGIN\n    DECLARE @startRowIndex INT;\n    DECLARE  @PageIndex INT;\n    DECLARE  @RowsPerPage INT;\n\n    SET @PageIndex = 0;\n    SET @RowsPerPage = 15;\n    SET @startRowIndex = (@PageIndex * @RowsPerPage) + 1;\n\n    WITH messageentries AS (\n        SELECT \n            Row_number() OVER(ORDER BY score DESC) AS row,\n            Count(DISTINCT town.townid) AS towns,\n            user_details.username,\n            user_score.score,\n            allience.alliencename,\n            allience.allienceid,\n            allience.alliencetagname\n        FROM     \n            user_details\n        INNER JOIN \n            user_score ON user_details.username = user_score.username\n        INNER JOIN \n            town ON user_details.username = town.townownername\n        LEFT OUTER JOIN \n            allience_roles ON user_details.useralliencerole = allience_roles.roleid\n        LEFT OUTER JOIN \n            allience ON allience_roles.allienceid = allience.allienceid\n        GROUP BY \n            user_details.username,\n            user_score.score,\n            allience.alliencename,\n            allience.allienceid,\n            allience.alliencetagname\n    ),\n    total_and_user_row AS (\n        SELECT \n            *,\n            (SELECT COUNT(*) FROM messageentries) AS numberofrows,\n            MAX(CASE WHEN username = 'myUsername' THEN row END) OVER () AS myself\n        FROM \n            messageentries\n    )\n    SELECT \n        *,\n        numberofrows,\n        COALESCE(myself, 0) AS my_row_position\n    FROM   \n        total_and_user_row\n    WHERE  \n        row BETWEEN @startRowIndex AND @StartRowIndex + @RowsPerPage - 1;\nEND