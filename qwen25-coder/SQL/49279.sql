CREATE OR REPLACE PACKAGE employee_shift_test IS\n\n  -- %suite(Employee Shift Time Update Tests)\n\n  -- %test(Should update NIGHT_SHIFT table with correct employee IDs)\n  PROCEDURE test_update_employee_ids;\n\n  -- %test(Should rollback in case of an error and handle exceptions properly)\n  PROCEDURE test_exception_handling;\n\n  -- %beforeall\n  PROCEDURE setup_test_data;\n\n  -- %afterall\n  PROCEDURE teardown_test_data;\n\nEND;\n/\n\nCREATE OR REPLACE PACKAGE BODY employee_shift_test IS\n\n  RETVAL VARCHAR2(10);\n  ERRBUF VARCHAR2(4000);\n  RECORDS_UPDATED NUMBER;\n\n  PROCEDURE setup_test_data IS\n  BEGIN\n    INSERT INTO employees (employee_id, shift) VALUES (1, 'EVENING');\n    INSERT INTO employees (employee_id, shift) VALUES (2, 'EVENING');\n    INSERT INTO NIGHT_SHIFT (employee_id, some_dumb_field) VALUES (1, NULL);\n    INSERT INTO NIGHT_SHIFT (employee_id, some_dumb_field) VALUES (2, NULL);\n    COMMIT;\n  END;\n\n  PROCEDURE teardown_test_data IS\n  BEGIN\n    DELETE FROM employees;\n    DELETE FROM NIGHT_SHIFT;\n    COMMIT;\n  END;\n\n  PROCEDURE test_update_employee_ids IS\n  BEGIN\n    employee_pkg.set_shift_times_to_null(RETVAL, ERRBUF, RECORDS_UPDATED);\n    EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM NIGHT_SHIFT WHERE some_dumb_field IS NOT NULL' INTO RECORDS_UPDATED;\n    \n    ASSERT(RECORDS_UPDATED = 2, 'Expected 2 records to be updated');\n    ASSERT(RETVAL = '0', 'Procedure should return 0 indicating success');\n  END;\n\n  PROCEDURE test_exception_handling IS\n    PRAGMA AUTONOMOUS_TRANSACTION; -- Allows for transactional isolation in tests\n  BEGIN\n    -- Inject an error condition; e.g., altering table structure dynamically to cause an error.\n    EXECUTE IMMEDIATE 'ALTER TABLE NIGHT_SHIFT DROP COLUMN some_dumb_field';\n    \n    employee_pkg.set_shift_times_to_null(RETVAL, ERRBUF, RECORDS_UPDATED);\n    ASSERT(ERRBUF LIKE 'Error occurred - ORA-%', 'Error message should be related to ORA-');\n    ROLLBACK; -- Revert schema changes after test\n  END;\n\nEND;\n/