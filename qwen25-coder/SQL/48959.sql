CREATE PROCEDURE GetEventsWithTutorsAndRooms @Year VARCHAR(8)\nAS\nBEGIN\n    DECLARE @SQL NVARCHAR(4000)\n\n    SET @SQL = 'SELECT \n                    e.event_id,\n                    (SELECT name + '' + ''\n                     FROM ' + @Year + '.dbo.CT_EVENT_STAFF AS ES\n                     INNER JOIN ' + @Year + '.dbo.CT_STAFF AS S\n                        ON ES.staff_id = S.staff_id\n                     WHERE ES.event_id = e.event_id\n                     ORDER BY S.name\n                     FOR XML RAW('''' ''), ELEMENTS, TYPE).value(''.'', ''VARCHAR(MAX)'') AS Tutors,\n                    (SELECT R.room_name + '' + ''\n                     FROM ' + @Year + '.dbo.CT_EVENT_ROOM AS ER\n                     INNER JOIN ' + @Year + '.dbo.ROOM AS R\n                        ON ER.room_id = R.room_id\n                     WHERE ER.event_id = e.event_id\n                     ORDER BY R.room_name\n                     FOR XML RAW('''' ''), ELEMENTS, TYPE).value(''.'', ''VARCHAR(MAX)'') AS Rooms\n                FROM \n                    ' + @Year + '.dbo.events e'\n\n    EXEC SP_EXECUTESQL @SQL\nEND