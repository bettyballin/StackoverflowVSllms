DECLARE @sql NVARCHAR(MAX);\nDECLARE @columns NVARCHAR(MAX);\n\n-- Step 1: Create a comma-separated list of dynamic columns or IN clause values\nSELECT @columns = COALESCE(@columns + ',[' + CAST(EmployeeID AS VARCHAR) + ']', '[' + CAST(EmployeeID AS VARCHAR) + ']')\nFROM (SELECT DISTINCT EmployeeID FROM Employees) AS DynamicEmployeeIDs;\n\n-- Step 2: Construct the SQL query as a string\nSET @sql = N'\n    SELECT Department, ' + @columns + '\n    FROM (\n        SELECT Department, EmployeeID, Salary\n        FROM EmployeeSalaries\n    ) SourceTable\n    PIVOT (\n        SUM(Salary) FOR EmployeeID IN (' + @columns + ')\n    ) PivotTable;\n';\n\n-- Step 3: Execute the dynamic SQL\nEXEC sp_executesql @sql;