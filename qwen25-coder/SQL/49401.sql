SELECT \n    DATE(date) AS date,\n    item,\n    total\nFROM (\n    SELECT \n        DATE(date) AS date,\n        item,\n        COUNT(*) AS count,\n        SUM(COUNT(*)) OVER (PARTITION BY DATE(date)) AS total\n    FROM test_popularity\n    GROUP BY DATE(date), item\n) AS counted_items\nWHERE count = (\n    SELECT MAX(count)\n    FROM (\n        SELECT \n            DATE(date) AS date,\n            COUNT(*) AS count\n        FROM test_popularity\n        GROUP BY DATE(date), item\n    ) AS items_counted_by_date\n    WHERE counted_items.date = items_counted_by_date.date\n);