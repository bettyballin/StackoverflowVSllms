-- Step 1: Create a temporary table that matches the structure of the output from your stored procedure.\nCREATE TABLE #TempResults (\n    spid INT,\n    status NVARCHAR(30),\n    loginame NVARCHAR(128),\n    hostname NVARCHAR(128),\n    blkby NVARCHAR(5),\n    dbname NVARCHAR(128),\n    cmd NVARCHAR(16),\n    request_id INT\n);\n\n-- Step 2: Insert the results of the stored procedure into this temporary table.\nINSERT INTO #TempResults EXEC sp_who;\n\n-- Step 3: Declare a cursor to loop through the rows in your temp table and process them.\nDECLARE Cur CURSOR FOR \nSELECT loginname, spid FROM #TempResults WHERE loginname LIKE '%gatesb%';\n\nDECLARE @LoginName NVARCHAR(128), @SPID INT;\nOPEN Cur;\n\nFETCH NEXT FROM Cur INTO @LoginName, @SPID;\nWHILE @@FETCH_STATUS = 0\nBEGIN\n    -- Example: Kill the process for demonstration purposes.\n    PRINT 'Killing process for user: ' + @LoginName + ', SPID: ' + CAST(@SPID AS NVARCHAR(10));\n    -- Uncomment the line below to actually kill the process in production, after testing.\n    -- KILL @SPID;\n    \n    FETCH NEXT FROM Cur INTO @LoginName, @SPID;\nEND;\n\nCLOSE Cur;\nDEALLOCATE Cur;\n\n-- Step 4: Drop the temporary table if no longer needed.\nDROP TABLE #TempResults;