declare @date1 smalldatetime, @date2 smalldatetime, @page nvarchar(100), @sum int\nselect @date1='2009-06-06', @date2='2009-06-13', @page='Tüm Sayfalar'\n\n-- Use a subquery to assign the sum to the variable\nSELECT @sum = SUM(t.[VISITINGCOUNT])\nFROM (\n    SELECT COUNT(page) AS [VISITINGCOUNT],\n           CAST(DATENAME(year, DATE) + '-' + DATENAME(month, DATE) + '-' + DATENAME(day, DATE) AS smalldatetime) AS [DATE]\n    FROM scr_StatisticaLog\n    WHERE Date BETWEEN @date1 AND @date2\n      AND (Page = @page OR @page = 'Tüm Sayfalar')\n      AND ProcessType = 'PageView'\n    GROUP BY CAST(DATENAME(year, DATE) + '-' + DATENAME(month, DATE) + '-' + DATENAME(day, DATE) AS smalldatetime)\n) AS t\n\n-- Ensure @sum is not zero to avoid division by zero error\nIF @sum <> 0\nBEGIN\n    SELECT 100.0*(t.[VISITINGCOUNT]/@sum), t.[DATE]\n    FROM (\n        SELECT COUNT(page) AS [VISITINGCOUNT],\n               CAST(DATENAME(year, DATE) + '-' + DATENAME(month, DATE) + '-' + DATENAME(day, DATE) AS smalldatetime) AS [DATE]\n        FROM scr_StatisticaLog\n        WHERE Date BETWEEN @date1 AND @date2\n          AND (Page = @page OR @page = 'Tüm Sayfalar')\n          AND ProcessType = 'PageView'\n        GROUP BY CAST(DATENAME(year, DATE) + '-' + DATENAME(month, DATE) + '-' + DATENAME(day, DATE) AS smalldatetime)\n    ) AS t\nEND