CREATE PROCEDURE dbo.sp_PivotData (@EntityTypeID int)\nAS\nBEGIN\n    DECLARE @SQL nvarchar(MAX);\n    DECLARE @COLS nvarchar(MAX);\n\n    -- Building column names for the PIVOT clause dynamically\n    SELECT @COLS = COALESCE(@COLS+',','') + QUOTENAME(Name) \n    FROM c_EntityAttribute \n    WHERE EntityTypeID = @EntityTypeID;\n\n    -- Building and executing dynamic SQL query with PIVOT\n    SET @SQL = N'SELECT * \n                  FROM (\n                    SELECT EntityInstanceID, AttributeName, Value \n                    FROM v_EntityElementData \n                    WHERE EntityTypeID = ' + CAST(@EntityTypeID AS nvarchar) + '\n                  ) as s\n                  PIVOT ( MIN(Value) FOR AttributeName IN (' + @COLS + ') ) AS p;';\n\n    EXEC sp_executesql @SQL;\nEND