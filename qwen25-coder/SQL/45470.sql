-- Start Transaction\nBEGIN TRAN\n\n-- Update with ROWLOCK and output to return locked OrderIDs directly\nDECLARE @UpdatedOrders TABLE (OrderID INT);\n\nUPDATE  OrderTable WITH (ROWLOCK)\nSET     ProcessorID = @PROCID\nOUTPUT  INSERTED.OrderID INTO @UpdatedOrders\nWHERE   OrderID IN (\n            SELECT TOP (20) OrderID\n            FROM    OrderTable WITH (ROWLOCK, UPDLOCK, READPAST)\n            WHERE   ProcessorID = 0);\n\n-- Commit the transaction after locking rows\nCOMMIT TRAN\n\n-- Select all orders associated with current @PROCID\nSELECT  OrderID, ProcessorID, <other columns>\nFROM    OrderTable\nWHERE   OrderID IN (SELECT OrderID FROM @UpdatedOrders);