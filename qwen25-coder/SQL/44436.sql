CREATE FUNCTION dbo.GetDateInBusinessDays(\n    @StartDate DATE, \n    @NumberDays INT)\nRETURNS TABLE\nAS\nRETURN (\nWITH DateSeries AS (\n    SELECT TOP (@NumberDays + 10) -- Add buffer to account for weekend and bad days\n        DATEADD(DAY, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) - 1, @StartDate) AS [Date]\n    FROM \n        sys.all_columns c1,\n        sys.all_columns c2\n)\nSELECT TOP (@NumberDays)\n    ds.Date\nFROM DateSeries ds\nLEFT JOIN BadDates bd ON ds.Date = bd.StartDate\nWHERE bd.StartDate IS NULL -- Exclude bad dates\nORDER BY ds.Date\n);