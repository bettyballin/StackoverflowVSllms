WITH RankedRecords AS (\n    SELECT id, Type, Name,\n           ROW_NUMBER() OVER (PARTITION BY Type ORDER BY id) as rn\n    FROM Records\n    WHERE Name LIKE '%Foo%'\n),\nFilteredRecords AS (\n    SELECT rr.id, rr.Type, rr.Name, rr.rn\n    FROM RankedRecords rr\n    UNION ALL\n    SELECT TOP (100 - COUNT(DISTINCT rr.Type)) rr.id, rr.Type, rr.Name, rr.rn\n    FROM RankedRecords rr\n    WHERE rr.rn > 1\n    ORDER BY rr.rn, rr.Type\n),\nTypeCounts AS (\n    SELECT Type, COUNT(*) as TotalCount\n    FROM FilteredRecords\n    GROUP BY Type\n)\nSELECT fr.id, fr.Type, fr.Name, tc.TotalCount - 1 as MoreResultsOfType\nFROM FilteredRecords fr\nJOIN TypeCounts tc ON fr.Type = tc.Type\nORDER BY CASE WHEN fr.rn = 1 THEN 1 ELSE 2 END, fr.Type, fr.rn\nOPTION (MAXRECURSION 0);