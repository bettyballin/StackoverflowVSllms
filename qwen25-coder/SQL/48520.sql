CREATE PROCEDURE GetAccumulatedLeadValues\nAS\nBEGIN\n    -- Create a temp table for calculations\n    CREATE TABLE #TempTable (\n        Year INT,\n        MonthNumber INT,\n        MonthName NVARCHAR(20),\n        Value DECIMAL(18, 4)\n    );\n\n    INSERT INTO #TempTable (Year, MonthNumber, MonthName, Value)\n    SELECT \n        DATEPART(year, StartDate) AS Year,\n        DATEPART(month, StartDate) + MONTHS - 1 AS MonthNumber,\n        DATENAME(month, DATEADD(month, MONTHS - 1, StartDate)) AS MonthName,\n        Value / CAST(MONTHS AS DECIMAL(18, 4)) AS Value\n    FROM \n        dbo.LeadValues;\n\n    -- Calculate running total for each year\n    SELECT \n        Year,\n        MonthNumber,\n        MonthName,\n        SUM(Value) OVER (PARTITION BY Year ORDER BY MonthNumber ROWS BETWEEN UNBOUNDED PRECEDING AND CURRENT ROW) AS RunningTotal,\n        SUM(Value) OVER (PARTITION BY Year, MonthNumber) AS MonthlyValue\n    INTO #TempTableWithRunningTotal\n    FROM \n        #TempTable;\n\n    -- Return the result set for the report\n    SELECT DISTINCT\n        Year,\n        MonthNumber,\n        MonthName,\n        MonthlyValue,\n        RunningTotal\n    FROM \n        #TempTableWithRunningTotal\n    ORDER BY \n        Year, MonthNumber;\n\n    DROP TABLE #TempTable;\n    DROP TABLE #TempTableWithRunningTotal;\nEND;