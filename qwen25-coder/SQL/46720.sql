ALTER PROCEDURE [dbo].[GetNextSms]\n(   \n    @SmsId UNIQUEIDENTIFIER OUTPUT, \n    @SmsContent NVARCHAR(1024) OUTPUT, -- Specify length for NVARCHAR\n    @ToNumber VARCHAR(50) OUTPUT,      -- Specify length for VARCHAR\n    @TimeAccepted DATETIME OUTPUT\n)\nAS\nBEGIN TRANSACTION\n    -- 1. Get 1 row\n    SET ROWCOUNT 1\n        SELECT @SmsId = SmsId FROM SendQueue\n        WHERE ProcessingStarted = 0\n    SET ROWCOUNT 0\n    -- 2. Set as processing\n    UPDATE SendQueue \n        SET ProcessingStarted = 1\n        WHERE SmsId = @SmsId\n    -- 3. Return data\n    SELECT @SmsId = SmsId,\n           @SmsContent = SmsContent,\n           @ToNumber = ToNumber,\n           @TimeAccepted = TimeAccepted\n    FROM SendQueue\n    WHERE SmsId = @SmsId;\n\nCOMMIT