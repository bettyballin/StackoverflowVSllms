WITH RECURSIVE cte AS (\n    SELECT NodeID, ParentNodeID, EffectiveFrom, EffectiveTo\n    FROM Hierarchy\n    WHERE NodeID = :startNodeId AND EffectiveFrom <= :endDate AND EffectiveTo >= :startDate\n    UNION ALL\n    SELECT h.NodeID, h.ParentNodeID, h.EffectiveFrom, h.EffectiveTo\n    FROM cte\n    JOIN Hierarchy h ON cte.NodeID = h.ParentNodeID\n    WHERE h.EffectiveFrom <= :endDate AND h.EffectiveTo >= :startDate\n)\nSELECT NodeID, ParentNodeID, EffectiveFrom, EffectiveTo\nFROM cte;