DELIMITER //\n\nCREATE PROCEDURE ClaimMessage()\nBEGIN\n    DECLARE msg_id INT;\n    \n    -- Start a transaction\n    START TRANSACTION;\n    \n    -- Select and lock the first available message for update\n    SELECT id INTO msg_id FROM messages WHERE status = 'available' LIMIT 1 FOR UPDATE;\n    \n    IF msg_id IS NOT NULL THEN\n        -- Update the status of the selected message to 'claimed'\n        UPDATE messages SET status = 'claimed' WHERE id = msg_id;\n        \n        -- Return the claimed message\n        SELECT * FROM messages WHERE id = msg_id;\n    ELSE\n        SELECT 'No available messages' AS result;\n    END IF;\n\n    -- Commit the transaction\n    COMMIT;\nEND //\n\nDELIMITER ;\n\nCALL ClaimMessage();