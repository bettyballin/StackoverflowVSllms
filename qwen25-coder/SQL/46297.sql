CREATE FUNCTION dbo.udf_YearFrac(@StartDate DATETIME, @EndDate DATETIME)\nRETURNS FLOAT\nAS\nBEGIN\n    DECLARE @DayCountBasis INT = 0; -- Set your preferred day count basis here (0 for actual/actual)\n    DECLARE @DaysInStartYear INT;\n    DECLARE @DaysInEndYear INT;\n    DECLARE @FullYears INT;\n    DECLARE @FractionOfYearStart FLOAT;\n    DECLARE @FractionOfYearEnd FLOAT;\n\n    IF YEAR(@EndDate) = YEAR(@StartDate)\n        RETURN DATEDIFF(DAY, @StartDate, @EndDate) / CAST((CASE WHEN ISDATE(CONVERT(CHAR, YEAR(@StartDate)) + '-12-31') > 0 THEN CONVERT(DATE, CONVERT(CHAR, YEAR(@StartDate)) + '-12-31')\n                                                            ELSE DATEADD(DAY, -1, DATEADD(YEAR, DATEDIFF(YEAR, 0, @StartDate) + 1, 0))\n                                                      END) AS FLOAT);\n\n    -- Calculate days in the start year and end year\n    SET @DaysInStartYear = (CASE WHEN ISDATE(CONVERT(CHAR, YEAR(@StartDate)) + '-12-31') > 0 THEN CONVERT(DATE, CONVERT(CHAR, YEAR(@StartDate)) + '-12-31')\n                                  ELSE DATEADD(DAY, -1, DATEADD(YEAR, DATEDIFF(YEAR, 0, @StartDate) + 1, 0))\n                             END)  - @StartDate;\n    SET @DaysInEndYear = (CASE WHEN ISDATE(CONVERT(CHAR, YEAR(@EndDate)) + '-12-31') > 0 THEN CONVERT(DATE, CONVERT(CHAR, YEAR(@EndDate)) + '-12-31')\n                                ELSE DATEADD(DAY, -1, DATEADD(YEAR, DATEDIFF(YEAR, 0, @EndDate) + 1, 0))\n                          END) - @EndDate;\n\n    -- Calculate full years\n    SET @FullYears = YEAR(@EndDate) - YEAR(@StartDate) - 1;\n\n    -- Fraction of a year for the start and end periods\n    SET @FractionOfYearStart = (@DaysInStartYear + DATEDIFF(DAY, @StartDate, DATEADD(YEAR, DATEDIFF(YEAR, 0, @StartDate) + 1, 0)) - @StartDate) / CAST(@DaysInStartYear AS FLOAT);\n    SET @FractionOfYearEnd = (DATEDIFF(DAY, DATEADD(YEAR, DATEDIFF(YEAR, 0, @EndDate), 0), @EndDate) + 1) / CAST((@DaysInEndYear + 1) AS FLOAT);\n\n    RETURN (@FullYears + @FractionOfYearStart + @FractionOfYearEnd);\nEND;