CREATE PROCEDURE CreateBackupDirectoryAndBackup\n    @directoryPath NVARCHAR(MAX),\n    @backupFilePath NVARCHAR(MAX),\n    @databaseName NVARCHAR(MAX)\nAS\nBEGIN\n    -- Declare variable for command string\n    DECLARE @cmd NVARCHAR(MAX);\n\n    -- Check if the directory exists, and create it if it does not.\n    SET @cmd = 'IF NOT EXIST "' + @directoryPath + '" mkdir "' + @directoryPath + '"';\n    EXEC xp_cmdshell @cmd;\n\n    -- Perform the backup to the specified file path\n    BACKUP DATABASE @databaseName TO DISK = @backupFilePath WITH FORMAT;\nEND;