CREATE OR REPLACE FUNCTION check_event_timespan_conflicts()\nRETURNS TRIGGER AS $$\nDECLARE\n    conflict_exists BOOLEAN;\nBEGIN\n    SELECT TRUE INTO conflict_exists\n    FROM timespan t1, timespan t2\n    WHERE t1.event_id = NEW.event_id AND t2.event_id = NEW.event_id\n      AND t1.id <> t2.id\n      AND t1.day = t2.day\n      AND NOT (t1.end_time <= t2.start_time OR t1.start_time >= t2.end_time);\n\n    IF conflict_exists THEN\n        RAISE EXCEPTION 'Timespan conflicts with an existing timespan for the same event.';\n    END IF;\n\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER event_timespan_conflict_trigger\nBEFORE INSERT OR UPDATE ON timespan\nFOR EACH ROW EXECUTE FUNCTION check_event_timespan_conflicts();