SELECT c.CarId, cw.CarVer, cw.VersionTime AS CarVerTime, w.WheelId, ww.WheelVer, ww.VersionTime AS WheelVerTime, c.colour AS CarColour\nFROM Cars c\nJOIN (\n    SELECT a.CarId, MAX(a.CarVer) AS CarVer, VersionTime\n    FROM Cars a\n    WHERE VersionTime <= '2009-06-12 09:50'\n    GROUP BY CarId, DATE(VersionTime)\n) cw ON c.CarId = cw.CarId AND c.CarVer = cw.CarVer\nJOIN Wheels w ON c.CarId = w.CarId\nJOIN (\n    SELECT b.WheelId, MAX(b.WheelVer) AS WheelVer, VersionTime\n    FROM Wheels b\n    WHERE VersionTime <= '2009-06-12 09:50'\n    GROUP BY WheelId, DATE(VersionTime)\n) ww ON w.CarId = cw.CarId AND w.WheelId = ww.WheelId AND w.WheelVer = ww.WheelVer\nWHERE c.CarId = 1\nGROUP BY c.CarId, cw.CarVer, cw.VersionTime, w.WheelId, ww.WheelVer, ww.VersionTime, c.colour;