WITH filtered_tasks AS (\n    SELECT t.*\n    FROM tasks t\n    LEFT JOIN (\n        SELECT job_id \n        FROM tasks \n        WHERE completed_date = TRUNC(SYSDATE)\n        GROUP BY job_id\n    ) j ON t.job_id = j.job_id\n    WHERE t.status <> 3 OR j.job_id IS NOT NULL\n),\njob_min_dates AS (\n    SELECT job_id, MIN(to_do_by_date) as min_to_do_by_date\n    FROM filtered_tasks\n    GROUP BY job_id\n)\nSELECT ft.*\nFROM filtered_tasks ft\nJOIN job_min_dates jmd ON ft.job_id = jmd.job_id\nORDER BY jmd.min_to_do_by_date, ft.to_do_by_date;