WITH RankedRecords AS (\n    SELECT id, Type, Name,\n           ROW_NUMBER() OVER (PARTITION BY Type ORDER BY id) as rn\n    FROM Records\n    WHERE Name LIKE '%Foo%'\n),\nFilteredRecords AS (\n    SELECT rr.id, rr.Type, rr.Name, rr.rn\n    FROM RankedRecords rr\n    UNION ALL\n    SELECT TOP (100 - COUNT(DISTINCT rr.Type)) rr.id, rr.Type, rr.Name, rr.rn\n    FROM RankedRecords rr\n    WHERE rr.rn > 1\n    ORDER BY rr.rn, rr.Type\n)\nSELECT id, Type, Name\nFROM FilteredRecords\nORDER BY CASE WHEN rn = 1 THEN 1 ELSE 2 END, Type, rn\nOPTION (MAXRECURSION 0);