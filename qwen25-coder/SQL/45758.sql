-- Corrected Query\nSELECT \n    dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5), Date, 108)) AS [Time],\n    COUNT(Page) AS VisitingCount\nFROM scr_SecuristLog     \nWHERE Date BETWEEN '2009-04-30' AND '2009-05-02'\nAND [user] IN (\n    SELECT USERNAME               \n    FROM scr_CustomerAuthorities \n    WHERE customerID = 4 \n      AND ID = 43\n)    \nGROUP BY dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5), Date, 108))\nORDER BY dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5), Date, 108)) ASC\n\n-- User-defined function (no changes needed)\nCREATE FUNCTION [dbo].[fn_GetActivityLogsArranger]\n(\n    @time AS nvarchar(max)\n)\nRETURNS  nvarchar(max)\nAS\nBEGIN\n    DECLARE @Return varchar(30)\n\n    SELECT @Return = CASE \n        WHEN @time BETWEEN '15:00' AND '15:30' THEN '15:00-15:30'\n        WHEN @time BETWEEN '15:30' AND '16:00' THEN '15:30-16:00'\n        WHEN @time BETWEEN '16:00' AND '16:30' THEN '16:00-16:30'\n        WHEN @time BETWEEN '16:30' AND '17:00' THEN '16:30-17:00'\n        WHEN @time BETWEEN '17:00' AND '17:30' THEN '17:00-17:30'\n        WHEN @time BETWEEN '17:30' AND '18:00' THEN '17:30-18:00'\n        ELSE 'Unknown'\n    END\n\n    RETURN @Return\nEND