CREATE PROCEDURE GetStudentsAndTopMarks\n    @Criteria NVARCHAR(100) -- Define your criteria parameter here\nAS\nBEGIN\n    -- Create a CTE to filter students by criteria\n    WITH FilteredStudents AS (\n        SELECT StudentID, StudentName\n        FROM Students\n        WHERE <Your Criteria Condition Here> -- Replace with actual criteria condition\n    ),\n    RankedMarks AS (\n        SELECT \n            m.StudentID, \n            s.StudentName,\n            m.MarkValue,\n            ROW_NUMBER() OVER(PARTITION BY m.StudentID ORDER BY m.MarkValue DESC) AS Rank\n        FROM Marks m\n        INNER JOIN FilteredStudents s ON m.StudentID = s.StudentID\n    )\n\n    -- First result set: List of students meeting the criteria\n    SELECT StudentID, StudentName\n    FROM FilteredStudents;\n\n    -- Second result set: Top 5 marks per student\n    SELECT StudentID, StudentName, MarkValue\n    FROM RankedMarks\n    WHERE Rank <= 5;\nEND;