SELECT p.* \nFROM policies p \nWHERE EXISTS (\n    SELECT 0 \n    FROM status_changes sc \n    JOIN statuses s ON sc.status_id = s.id\n    WHERE sc.policy_id = p.id\n      AND s.status_category_id = '1'\n      AND sc.created_at BETWEEN '2009-03-10' AND '2009-03-12'\n) \nOR EXISTS (\n    SELECT 0 \n    FROM status_changes sc \n    JOIN statuses s ON sc.status_id = s.id\n    WHERE sc.created_at IN (\n        SELECT MAX(sc2.created_at)\n        FROM status_changes sc2\n        WHERE sc2.policy_id = p.id\n          AND sc2.created_at < '2009-03-10'\n    )\n      AND s.status_category_id = '1'\n      AND sc.policy_id = p.id\n) \nAND (\n    EXISTS (\n        SELECT 0 \n        FROM status_changes sc\n        WHERE sc.policy_id = p.id\n          AND sc.status_id = 7\n          AND sc.created_at BETWEEN '2008-12-31' AND '2009-03-12'\n    ) \n    OR EXISTS (\n        SELECT 0 \n        FROM status_changes sc\n        WHERE sc.created_at IN (\n            SELECT MAX(sc2.created_at)\n            FROM status_changes sc2\n            WHERE sc2.policy_id = p.id\n              AND sc2.created_at < '2008-12-31'\n        )\n          AND sc.status_id = 7\n          AND sc.policy_id = p.id\n    )\n);