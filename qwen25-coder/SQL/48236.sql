DECLARE @LookupID int\n\n-- Our test value\nSET @LookupID = 1\n\nWITH cteLevelOne AS (\n    SELECT a.ParentID, a.CustID\n    FROM tblCustomer AS a\n    WHERE a.CustID = @LookupID \n    UNION ALL\n    SELECT a.ParentID, a.CustID\n    FROM tblCustomer AS a\n    INNER JOIN cteLevelOne AS c ON a.CustID = c.ParentID\n    WHERE a.CustID <> c.ParentID  -- Corrected this condition to avoid infinite loop\n)\nSELECT TOP 1 ParentID, CustID\nFROM (\n    SELECT ParentID, CustID, ROW_NUMBER() OVER (ORDER BY (SELECT NULL)) AS rn\n    FROM cteLevelOne \n) AS subquery\nWHERE rn = 1