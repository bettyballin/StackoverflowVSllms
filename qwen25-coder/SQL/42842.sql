WITH LatestSalesPersonData AS (\n    SELECT \n        sp.salesPersonId,\n        sp.divisionId,\n        spd.order_id,\n        spd.timestamp,\n        spd.called_inbound,\n        spd.called_outbound,\n        spd.orders_issued,\n        spd.revenue_total,\n        ROW_NUMBER() OVER (PARTITION BY DATE(spd.timestamp), sp.salesPersonId ORDER BY spd.timestamp DESC) as rn\n    FROM \n        salesPerformanceData spd\n    JOIN \n        salesPerson sp ON spd.salesPersonId = sp.salesPersonId\n    WHERE \n        spd.timestamp >= '2009-05-01' AND spd.timestamp < '2009-05-07'\n),\nDivisionAggregatedData AS (\n    SELECT \n        d.divisionId,\n        d.name as divisionName,\n        SUM(spd.called_inbound) as total_called_inbound,\n        SUM(spd.called_outbound) as total_called_outbound,\n        SUM(spd.orders_issued) as total_orders_issued,\n        SUM(spd.revenue_total) as total_revenue\n    FROM \n        LatestSalesPersonData spd\n    JOIN \n        division d ON spd.divisionId = d.divisionId\n    WHERE \n        spd.rn = 1\n    GROUP BY \n        d.divisionId, d.name\n)\nSELECT \n    *\nFROM \n    DivisionAggregatedData\nORDER BY \n    total_revenue DESC -- or any other column for sorting\nLIMIT \n    10 OFFSET 0; -- for paginatio