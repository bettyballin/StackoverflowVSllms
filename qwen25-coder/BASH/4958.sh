#!/bin/bash\n\n# Define directories\nLOCAL_REPO_DIR="/path/to/local/repo"\nREMOTE_SERVERS=("server1" "server2" "server3")\nSTAGING_DIR="stage"\n\n# Ensure all changes are staged and committed to local repo\ncd $LOCAL_REPO_DIR\ngit pull origin main  # Fetch latest commit from remote\n\n# Generate a list of changed files since last deployment\nDEPLOY_FILES=$(git diff-tree -r --no-commit-id --name-only --diff-filter=ACMRTUXB HEAD^ HEAD)\n\n# Deploy only the modified or new files to staging and then servers\nif [ ! -z "$DEPLOY_FILES" ]\nthen\n    # Sync changes to staging directory locally\n    rsync -avz --files-from=<($DEPLOY_FILES) $LOCAL_REPO_DIR/ $STAGING_DIR/\n\n    # Sync from staging to each remote server\n    for SERVER in "${REMOTE_SERVERS[@]}"\n    do\n        echo "Deploying files to $SERVER"\n        rsync -avz $STAGING_DIR/ "$SERVER:/path/to/webroot/"\n    done\n\n    echo "All changes deployed successfully."\nelse\n    echo "No changes detected; nothing to deploy."\nfi