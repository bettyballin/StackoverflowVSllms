gradient = function(l, g) {\n    var r = [], s = [], f = g.length - 1;\n    \n    // Normalize and parse colors\n    for (var x = 0; x < g.length; x++)\n        g[x] = (typeof(g[x]) == 'string' ? g[x] : g[x].join(','))._replace(['#', ' ', 'rgb(', ')'], ''),\n        g[x] = (g[x].indexOf(',') != -1\n            ? g[x].split(',').map(Number) // Convert to numbers directly\n            : g[x].chunk(2).map(function(_) {\n                return _.fromBase('hex');\n            }));\n    \n    // Calculate step sizes between colors\n    for (var x = 0; x < f; x++)\n        s[x] = [(g[x][0] - g[x + 1][0]) / l, \n                (g[x][1] - g[x + 1][1]) / l, \n                (g[x][2] - g[x + 1][2]) / l];\n    \n    // Generate gradient\n    for (var x = 0; x < l; x++) {\n        var c = Math.floor(x * f / (l - 1));\n        var t = x === l - 1 ? 1 : x % (l / f) / (l / f);\n        r[x] = '';\n        ([0, 1, 2]).map(function(_) {\n            var v = Math.floor(g[c][_] - s[c][_]*t).toString(16);\n            r[x] += ('0' + v).slice(-2); // Ensure two-digit hex values\n        });\n    }\n    \n    return r;\n};