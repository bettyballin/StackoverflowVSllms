const text = '<p>This is a test <img src="http://example.com/image.jpg"> and here is a link http://example.com</p>';\nconst regex = /(https?:\/\/[\w.-]+(?:\/[\w.-]*)?|www\.[\w.-]+(?:\/[\w.-]*)?)(?!.*?<\/img>)/gi;\n\nconst result = text.replace(regex, (match) => {\n    // Check if match is not inside an <img> tag\n    if (!/<img\b[^<]*?\bsrc=["']?([^"'>]*?)["']?>/i.test(text.substring(0, text.indexOf(match)))) {\n        return `<a href="${match}">${match}</a>`;\n    }\n    return match;\n});\n\nconsole.log(result);