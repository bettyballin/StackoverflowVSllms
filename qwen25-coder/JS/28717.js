(function() {\n    var providers = {};\n    providers['tinyurl.com'] = function(link, fragment) {\n        link.title = "Loading...";\n        GM_xmlhttpRequest({\n            method: 'GET',\n            url: 'https://preview.tinyurl.com/' + fragment,\n            onload: function(res) {\n                var re = res.responseText.match(/<blockquote><b>(.+?)<\/b><\/blockquote>/);\n                if (re) {\n                    link.title = re[1].replace(/\<br \/\>/g, "").replace(/&amp;/g, "&");\n                } else {\n                    link.title = "Parsing failed...";\n                }\n            },\n            onerror: function() {\n                link.title = "Connection failed...";\n            }\n        });\n    };\n    var uriPattern = /(tinyurl\.com)\/([a-zA-Z0-9]+)/;\n    var aTags = document.getElementsByTagName("a");\n\n    for (var i = 0; i < aTags.length; i++) {\n        var data = aTags[i].href.match(uriPattern);\n        if (data != null && data.length > 1 && data[2] != "preview") {\n            (function(link, fragment) { // IIFE to capture current link and fragment\n                link.addEventListener("mouseover", function() {\n                    if (link.title === "") {\n                        providers['tinyurl.com'](link, fragment);\n                    }\n                }, false);\n            })(aTags[i], data[2]);\n        }\n    }\n})();