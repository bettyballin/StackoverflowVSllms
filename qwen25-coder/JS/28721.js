function haversineDistance(coords1, coords2) {\n    var toRad = function(x) { return x * Math.PI / 180; };\n    var dLat = toRad(coords2.latitude - coords1.latitude);\n    var dLon = toRad(coords2.longitude - coords1.longitude);\n    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +\n            Math.cos(toRad(coords1.latitude)) * Math.cos(toRad(coords2.latitude)) * \n            Math.sin(dLon/2) * Math.sin(dLon/2);  \n    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)); \n    var earthRadiusKm = 6371;\n    return earthRadiusKm * c; // Distance in km\n}