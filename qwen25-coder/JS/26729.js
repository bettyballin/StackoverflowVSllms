const { Client } = require('mysql2');\n\nconst mysqlClient = new Client({\n    host: 'localhost',\n    user: 'your_username',\n    password: 'your_password',\n    database: 'chat_db'\n});\n\nmysqlClient.connect();\n\nwss.on('connection', function connection(ws) {\n    // Fetch all previous messages and send them to the newly connected client\n    mysqlClient.query('SELECT message FROM chat_messages', (err, rows) => {\n        if (!err) {\n            rows.forEach(row => ws.send(row.message));\n        }\n    });\n\n    ws.on('message', function incoming(message) {\n        // Save the new message in the database\n        mysqlClient.query(`INSERT INTO chat_messages (message) VALUES ('${mysqlClient.escape(message)}')`, (error, results) => {\n            if (!error) {\n                // Broadcast to everyone else.\n                wss.clients.forEach(function each(client) {\n                    if (client !== ws && client.readyState === WebSocket.OPEN) {\n                        client.send(message);\n                    }\n                });\n            } else {\n                console.error('Error storing message:', error);\n            }\n        });\n    });\n\n    ws.on('close', function close() {\n        console.log('Client disconnected');\n    });\n});