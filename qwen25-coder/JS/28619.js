<script type="text/javascript">\n// Using var instead of const.\nvar S = 0;\nvar X = 1;\nvar S2 = 2;\nvar X2 = 3;\nvar M = 4;\nvar E = "SE";\n\nfunction doit() {\n    // Ensure elements exist before accessing them.\n    if (!document.getElementById("stat") || !document.getElementById("prog") || !document.getElementById("dat") || !document.getElementById("out")) {\n        alert("Missing HTML element(s).");\n        return;\n    }\n\n    var state = document.getElementById("stat").value;\n    var program = document.getElementById("prog").value.split("\n");\n    var index = document.getElementById("dat").value.indexOf("Z") >> 1;\n    var data = document.getElementById("dat").value.replace(/Z,/, "").split(",");\n\n    for (var i = 0; i < program.length; i++) {\n        program[i] = program[i].split(",");\n    }\n\n    while (state != E) {\n        var i;\n        for (i = 0; i < program.length; i++) {\n            if (program[i][S] == state && program[i][X] == data[index]) {\n                state = program[i][S2];\n                data[index] = program[i][X2];\n                index += parseInt(program[i][M]);\n\n                data.splice(index, 0, "Z");\n\n                if (data[data.length - 1] != "*") {\n                    data.push("*");\n                }\n                if (data[0] != "*") {\n                    data.unshift("*");\n                    index++;\n                }\n                document.getElementById("out").value += state + ": " + data.join(",") + "\r\n";\n\n                data.splice(index, 1);\n\n                break;\n            }\n        }\n\n        if (i == program.length)\n            break;\n    }\n\n    document.getElementById("out").value += "Done.\r\n";\n}\n</script>