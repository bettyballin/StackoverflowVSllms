function sanitizeAndEncodeXHTML(userContent) {\n    // Create a new DOMParser instance\n    var parser = new DOMParser();\n    \n    // Parse the user-provided content as XHTML\n    var doc = parser.parseFromString(userContent, "application/xhtml+xml");\n    \n    // Check for parsing errors by looking for a <parsererror> element\n    var parseError = doc.querySelector("parsererror");\n    if (parseError) {\n        // If there's an error, encode the user content as text\n        return userContent.replace(/</g, '&lt;').replace(/>/g, '&gt;');\n    } else {\n        // If no errors, serialize back to a string and clean up any unnecessary spaces\n        var serializer = new XMLSerializer();\n        return serializer.serializeToString(doc).trim();\n    }\n}\n\n// Example usage:\nvar userContent = "<div><spn>Invalid tag</span></div>";\nvar safeHTML = sanitizeAndEncodeXHTML(userContent);\nconsole.log(safeHTML); // Outputs: &lt;div&gt;&lt;spn&gt;Invalid tag&lt;/span&gt;&lt;/div&gt;