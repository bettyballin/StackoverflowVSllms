document.addEventListener('copy', function(event) {\n       // Get selected text\n       var selection = window.getSelection();\n       var htmlContent = selection.getRangeAt(0).cloneContents();\n\n       // Remove all elements with display: none\n       var hiddenElements = htmlContent.querySelectorAll('[style="display: none;"]');\n       hiddenElements.forEach(function(el) {\n           el.remove();\n       });\n\n       // Get plain text from the cleaned HTML\n       var plainText = new XMLSerializer().serializeToString(htmlContent);\n\n       // Set data for clipboard\n       event.clipboardData.setData('text/plain', plainText);\n       event.clipboardData.setData('text/html', htmlContent.innerHTML);\n\n       // Prevent default behavior to ensure our data is used\n       event.preventDefault();\n   });