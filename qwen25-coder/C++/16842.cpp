#include <windows.h>\n#include <iostream>\n\nusing namespace std;\n\nvolatile bool g_bExitThread = false;\nunsigned Counter = 0;\n\nvoid f()\n{\n    HANDLE hThread;\n    unsigned threadID;\n\n    // Create the second thread.\n    hThread = (HANDLE)_beginthreadex(NULL, 0, DoSomething, NULL, 0, &threadID);\n\n    if (WAIT_TIMEOUT == WaitForSingleObject(hThread, 5000))\n    {\n        g_bExitThread = true; // Signal the worker thread to exit.\n        WaitForSingleObject(hThread, INFINITE); // Wait for the thread to actually finish\n        wcout << L"Process is Timed Out";\n    }\n    else\n    {\n        wcout << L"Process is Ended OK";\n    }\n\n    CloseHandle(hThread);\n\n    wcout << Counter;\n}\n\nunsigned int _stdcall DoSomething(void* /*dummy*/)\n{\n    while (!g_bExitThread) // Check the exit flag periodically.\n    {\n        ++Counter; // Simulate some work\n    }\n    _endthreadex(0);\n    return 0;\n}