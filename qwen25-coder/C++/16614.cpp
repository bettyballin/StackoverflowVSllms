#include <windows.h>\n#include <aclapi.h>\n#include <stdio.h>\n\nBOOL CheckDirectoryWritePermission(LPCWSTR lpDirName)\n{\n    DWORD dwRes;\n    PACL pDacl = NULL;\n    PSECURITY_DESCRIPTOR psd = NULL;\n\n    // Open directory as an object so we can read the DACL.\n    dwRes = GetNamedSecurityInfo(\n                lpDirName,\n                SE_FILE_OBJECT,\n                DACL_SECURITY_INFORMATION,\n                NULL,   // no owner\n                NULL,   // no group\n                &pDacl, // get dacl\n                NULL,   // no sacl\n                &psd    // security descriptor\n            );\n\n    if (dwRes != ERROR_SUCCESS) {\n        printf("Failed to get security info for directory: %lu\n", dwRes);\n        return FALSE;\n    }\n\n    // Get the effective rights of the current user.\n    ACCESS_MASK grfAccessPermissions;\n    dwRes = GetEffectiveRightsFromAcl(\n                pDacl,\n                NULL,   // Use current user\n                &grfAccessPermissions);\n\n    if (dwRes != ERROR_SUCCESS) {\n        printf("Failed to get effective rights: %lu\n", dwRes);\n        LocalFree(psd);  // Cleanup before exit.\n        return FALSE;\n    }\n\n    if ((grfAccessPermissions & GENERIC_WRITE) == GENERIC_WRITE)\n    {\n        printf("Write permission is granted.\n");\n        LocalFree(psd);\n        return TRUE;  // Write permissions are present\n    }\n    else\n    {\n        printf("Write permission is NOT granted.\n");\n        LocalFree(psd);\n        return FALSE; // No write permissions\n    }\n}\n\nint main() {\n    LPCWSTR directory = L"C:\\mydir";\n    if (CheckDirectoryWritePermission(directory)) {\n        printf("The directory %ls is writable.\n", directory);\n    } else {\n        printf("The directory %ls is NOT writable.\n", directory);\n    }\n\n    return 0;\n}