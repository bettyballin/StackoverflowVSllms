HRESULT CMyInterface::SomeMethod()\n{\n    HRESULT hr = SomeOperationThatMayFail();\n    if (FAILED(hr))\n    {\n        CComObject<CErrorInfo>* pErrorInfo = NULL;\n        auto hRes = CComObject<CErrorInfo>::CreateInstance(&pErrorInfo);\n        if (SUCCEEDED(hRes))\n        {\n            pErrorInfo->AddRef(); // AddRef before passing back to caller\n            pErrorInfo->SetErrorMessage(_T("Not connected"));\n            pErrorInfo->SetErrorCode(hr);\n\n            return DispatchError(pErrorInfo, _T("MyMethod"), IID_IMyInterface);\n        }\n        return E_UNEXPECTED; // Failed to create error info object\n    }\n\n    return S_OK;\n}