#include <windows.h>\n#include <tchar.h>\n\nDWORD DeleteSubkeys(HKEY hKeyRoot, LPCTSTR pszBranch) {\n    TCHAR szCurSubkey[MAX_PATH];\n    LONG lRes;\n    DWORD dwLastValueNameLen = MAX_VALUE_NAME,\n          dwMaxSubKeyName, dwCntSubKeys=0, dwCntValues=0;\n\n    // Open the root key\n    HKEY hKey;\n    if( RegOpenKeyEx(hKeyRoot, pszBranch, 0, KEY_READ, &hKey) != ERROR_SUCCESS ) {\n        return ERROR_FILE_NOT_FOUND;\n    }\n    \n    // Get info about the branch\n    lRes = RegQueryInfoKey( hKey, NULL, NULL,\n                            NULL, &dwCntSubKeys, &dwMaxSubKeyName,\n                            NULL, &dwCntValues, &dwLastValueNameLen,\n                            NULL, NULL, NULL );\n    if (lRes != ERROR_SUCCESS) {\n        return ERROR_INVALID_DATA;\n    }\n\n    // Enumerate all subkeys and delete each\n    while(dwCntSubKeys--) {\n        DWORD dwCurKeyLen = dwMaxSubKeyName + 1;\n\n        lRes = RegEnumKeyEx( hKey, 0, szCurSubkey, &dwCurKeyLen,\n                              NULL, NULL, NULL, NULL );\n\n        if (lRes != ERROR_SUCCESS) return lRes;\n        \n        // Recurse to delete the subkey and its subkeys\n        if ((lRes = DeleteSubkeys(hKeyRoot, pszBranch)) != ERROR_SUCCESS)\n            return lRes;\n\n        // Delete each subkey once it's empty\n        RegDeleteKey( hKeyRoot, pszBranch );\n    }\n\n    // Close the initially opened key\n    RegCloseKey(hKey);\n\n    // Finally, delete the root branch passed in\n    RegDeleteKey(hKeyRoot, pszBranch );\n\n    return ERROR_SUCCESS;\n}\n\n// Example usage\nvoid CleanUpRegistry() {\n    HKEY hKey = HKEY_LOCAL_MACHINE;\n    LPCTSTR szSubkey = _T("SOFTWARE\\YourCompany\\YourApp");\n    \n    if( DeleteSubkeys(hKey, szSubkey) != ERROR_SUCCESS ) {\n        // Handle error here\n        OutputDebugString(_T("Failed to delete registry key\n"));\n    }\n}