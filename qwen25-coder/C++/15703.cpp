#include <windows.h>\n#include <comdef.h>\n\nHRESULT CreateCOMInstanceWithTimeout(REFCLSID rclsid, REFIID riid, LPVOID* ppvObj, DWORD timeoutMillis) {\n    HRESULT hr;\n    DWORD startTime = GetTickCount();\n\n    // Try to create the instance with a timeout\n    while (true) {\n        hr = CoCreateInstance(rclsid, nullptr, CLSCTX_LOCAL_SERVER, riid, ppvObj);\n        \n        // Check if creation was successful\n        if (SUCCEEDED(hr)) break;\n\n        // If it failed due to busy server\n        if (hr == RPC_E_CALL_REJECTED ||\n            hr == E_RPC_REQUEST_ABORTED ||\n            hr == RPC_S_SERVER_UNAVAILABLE) {\n            \n            // Pump messages to prevent dialog box from showing up\n            MSG msg;\n            while (PeekMessage(&msg, nullptr, 0, 0, PM_REMOVE)) {\n                TranslateMessage(&msg);\n                DispatchMessage(&msg);\n            }\n\n            // Check if we've exceeded the timeout\n            DWORD currentTime = GetTickCount();\n            if ((currentTime - startTime) >= timeoutMillis) break;\n\n            // Sleep for a short time before retrying\n            Sleep(100); // Adjust sleep duration as necessary\n        } else {\n            // Some other failure, exit loop\n            break;\n        }\n    }\n\n    return hr;\n}