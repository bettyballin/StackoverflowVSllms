#include <windows.h>\n#include <Wbemidl.h>\n\n#pragma comment(lib, "wbemuuid.lib")\n\nvoid CallMethodOnNetworkAdapter(BSTR methodToCall) {\n    HRESULT hres;\n\n    // Initialize COM library.\n    hres = CoInitializeEx(0, COINIT_MULTITHREADED);\n    if (FAILED(hres))\n        return;\n\n    ILocateCIMOM *pLoc;\n    IWbemLocator *pLocator;\n    IWbemServices *pSvc;\n\n    // Initialize WMI locator object\n    hres = CoCreateInstance(CLSID_WbemLocator, 0, CLSCTX_INPROC_SERVER,\n                            IID_ILocateCIMOM, (LPVOID *)&pLoc);\n    if (FAILED(hres)) {\n        CoUninitialize();\n        return;\n    }\n\n    // Connect to WMI\n    hres = pLoc->ConnectServerEx(0, bstr_t(L"ROOT\\CIMV2"), 0, NULL, 0L, 0, 0, &pSvc);\n    if (FAILED(hres)) {\n        pLoc->Release();\n        CoUninitialize();\n        return;\n    }\n\n    hres = pSvc->ExecQuery(\n        bstr_t("WQL"),\n        bstr_t("SELECT * FROM Win32_NetworkAdapter WHERE NetEnabled=True"),\n        WBEM_FLAG_FORWARD_ONLY | WBEM_FLAG_RETURN_IMMEDIATELY,\n        NULL,\n        &pUnsecApp);\n    \n    if (FAILED(hres)) {\n        pSvc->Release();\n        pLoc->Release();\n        CoUninitialize();\n        return;\n    }\n\n    IWbemClassObject *pclsObj = nullptr;\n    ULONG uReturn = 0;\n\n    while (pUnsecApp->Next(WBEM_INFINITE, 1, &pclsObj, &uReturn) == S_OK)\n    {\n        VARIANT vtProp;\n        \n        hres = pclsObj->GetObjectText(WBEM_FLAG_USE_AMENDED_QUALIFIERS, &vtProp);\n        wprintf(L"%s", vtProp.bstrVal);\n        VariantClear(&vtProp);\n\n        // Invoke method\n        BSTR ObjPath = SysAllocString(pclsObj->GetObjectText(0, 0)->bstrVal);\n        if (ObjPath) {\n            IWbemClassObject *pInParamsDefinition;\n            hres = pSvc->Get(L"Win32_NetworkAdapter", WBEM_FLAG_USE_AMENDED_QUALIFIERS, NULL, &pclsObj, NULL);\n\n            hres = pclsObj->GetMethod(methodToCall, 0, &pInParamsDefinition, NULL);\n            if (FAILED(hres)) {\n                SysFreeString(ObjPath);\n                continue;\n            }\n\n            IWbemClassObject *pInParamsInstance = nullptr;\n            hres = CoCreateInstance(CLSID_WbemLocator, 0, CLSCTX_INPROC_SERVER,\n                                    IID_IWbemClassObject, (LPVOID *)&pInParamsInstance);\n            if (!FAILED(hres)) {\n                hres = pclsObj->InvokeMethod(methodToCall, NULL, 0, NULL, &pInParamsInstance, NULL);\n                if (FAILED(hres))\n                    SysFreeString(ObjPath);\n                else\n                    wprintf(L"%s done.\n", methodToCall);\n\n                pInParamsInstance->Release();\n            }\n        }\n\n        SysFreeString(ObjPath);\n        pclsObj->Release();\n    }\n\n    pSvc->Release();\n    CoUninitialize();\n}