#include <windows.h>\n#include <httpfilt.h>\n\nBOOL WINAPI GetFilterVersion(PHTTP_FILTER_VERSION pVer)\n{\n    pVer->dwServerFilterVersion = HTTP_FILTER_REVISION;\n    pVer->dwFilterVersion = 1;\n    lstrcpyn(pVer->lpszFilterDesc, _T("Simple ISAPI Filter"), SF_MAX_FILTER_DESC_LEN);\n    \n    // Register for the event of interest\n    pVer->pfnHttpFilterProc = HttpFilterProc;\n    \n    return TRUE;\n}\n\nDWORD WINAPI HttpFilterProc(PHTTP_FILTER_CONTEXT pfc, DWORD NotificationType, LPVOID pvData)\n{\n    switch (NotificationType)\n    {\n        case SF_NOTIFY_ACCESS_DENIED:\n            ReportEvent(\n                RegisterEventSource(NULL, _T("ISAPIFilter")),\n                EVENTLOG_INFORMATION_TYPE,\n                0,\n                0,\n                NULL,\n                1,\n                0,\n                (const TCHAR**)&_T("Access Denied notification."),\n                NULL\n            );\n            break;\n        case SF_NOTIFY_END_OF_REQUEST:\n            ReportEvent(\n                RegisterEventSource(NULL, _T("ISAPIFilter")),\n                EVENTLOG_INFORMATION_TYPE,\n                0,\n                0,\n                NULL,\n                1,\n                0,\n                (const TCHAR**)&_T("Request processed."),\n                NULL\n            );\n            break;\n    }\n    return SF_STATUS_REQ_NEXT_NOTIFICATION;\n}