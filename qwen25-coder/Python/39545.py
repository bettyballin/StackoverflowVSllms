from django.db.models import OuterRef, Subquery, IntegerField\nfrom django.db.models.functions import Coalesce\n\n# All authors who have written books or not\nall_authors = Author.objects.annotate(\n    book_count=Coalesce(Subquery(\n        Book.authors.through.objects.filter(author_id=OuterRef('pk')).values('author').annotate(count=models.Count('*')).values('count')[:1]\n    ), 0)\n)\n\n# All books that have authors or not\nall_books = Book.objects.annotate(\n    author_count=Coalesce(Subquery(\n        Author.books.through.objects.filter(book_id=OuterRef('pk')).values('book').annotate(count=models.Count('*')).values('count')[:1]\n    ), 0)\n)\n\n# Combine results into a list of tuples (author_name, book_title, book_count, author_count)\nresult = [\n    (a.name, None, 0, a.book_count) for a in all_authors\n] + [\n    (None, b.title, b.author_count, 0) for b in all_books\n]\n\n# Optionally, sort if necessary\nresult.sort(key=lambda t: t[0] or '', reverse=False)\nresult.sort(key=lambda t: t[1] or '', reverse=False)\n\nprint(result)