from django.db.models import OuterRef, Subquery, Max\n\n# Assuming the following models\nclass Role(models.Model):\n    name = models.CharField(max_length=100)\n    weight = models.IntegerField()\n\nclass Person(models.Model):\n    name = models.CharField(max_length=100)\n    roles = models.ManyToManyField(Role)\n\n# Query to get people ordered by their heaviest role's weight\nheaviest_role_subquery = Role.objects.filter(\n    people=OuterRef('pk')\n).order_by('-weight').values('weight')[:1]\n\npeople_ordered_by_heaviest_role = Person.objects.annotate(\n    max_weight=Subquery(heaviest_role_subquery)\n).order_by('-max_weight')