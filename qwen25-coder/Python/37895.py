import random\n\ndef assign_gifts(pref_givers, pref_takers):\n    n = len(pref_givers)\n    assignments = {}\n    available = set(range(n))\n    \n    # First, try to place the "best matches" directly.\n    for giver in range(n):\n        preference_list = pref_givers[giver]\n        for taker in preference_list:\n            if taker in available and pref_takers[taker].index(giver) == 0:\n                assignments[giver] = taker\n                available.remove(taker)\n                break\n\n    # Assign remaining using random placements respecting rankings.\n    for giver in range(n):\n        if giver not in assignments:\n            for taker in pref_givers[giver]:\n                if taker in available:\n                    if taker not in (assignments.values() if assignments else []):\n                        assignments[giver] = taker\n                        available.remove(taker)\n                        break\n            # If no valid assignment, fall back to random from remaining.\n            if giver not in assignments:\n                choices = list(available - set(assignments.values()))\n                assignments[giver] = random.choice(choices)\n                available.remove(assignments[giver])\n\n    return assignments\n\n# Example usage with your scenario:\npref_givers = {\n    0: [1, 3, 2, 5, 4],  # A's preferences for gifting\n    1: [0, 3, 4, 2, 5],  # B's preferences for gifting\n    2: [0, 1, 3, 4, 5],  # C's preferences for gifting\n    3: [2, 0, 1, 4, 5],  # D's preferences for gifting\n    4: [0, 1, 2, 3, 5],  # E's preferences for gifting\n    5: [0, 1, 2, 3, 4]   # F's preferences for gifting\n}\n\npref_takers = {\n    0: [5, 3, 4, 1, 2],  # A's preferences for receiving\n    1: [5, 3, 4, 0, 2],  # B's preferences for receiving\n    2: [1, 0, 3, 4, 5],  # C's preferences for receiving\n    3: [2, 0, 1, 4, 5],  # D's preferences for receiving\n    4: [0, 1, 2, 3, 5],  # E's preferences for receiving\n    5: [0, 1, 2, 3, 4]   # F's preferences for receiving\n}\n\nassignments = assign_gifts(pref_givers, pref_takers)\nprint("Gift Assignments (Index): ", assignments)