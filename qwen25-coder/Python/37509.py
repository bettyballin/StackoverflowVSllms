import pickle\nfrom twisted.internet import reactor, protocol\nimport os.path\n\nclass EchoClient(protocol.Protocol):\n\n    def connectionMade(self):\n        file = "some_file_that_is_a_couple_of_megs"\n        filesize = os.path.getsize(file)\n        self.transport.write(pickle.dumps({"size": filesize}))\n\n        with open(file, "rb") as f:\n            contents = f.read(20)  # Read first 20 bytes\n            print(contents[:20])\n            self.transport.write(contents)\n\n    def connectionLost(self, reason):\n        print("connection lost")\n\nclass EchoFactory(protocol.ClientFactory):\n    protocol = EchoClient\n\n    def clientConnectionFailed(self, connector, reason):\n        print("Connection failed - goodbye!")\n        reactor.stop()\n\n    def clientConnectionLost(self, connector, reason):\n        print("Connection lost - goodbye!")\n        reactor.stop()\n\n\ndef main():\n    f = EchoFactory()\n    reactor.connectTCP("localhost", 8000, f)\n    reactor.run()\n\n\nif __name__ == '__main__':\n    main()