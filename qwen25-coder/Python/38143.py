import msvcrt\n\ndef open_file_exclusive(path, mode):\n    fd = os.open(path, os.O_RDWR if 'r' in mode and 'w' in mode else \\n                  os.O_RDONLY if 'r' in mode else \\n                  os.O_WRONLY if 'w' in mode else None)\n    \n    file_obj = open(fd, mode)\n\n    try:\n        if 'w' in mode or ('+' in mode):  # Exclusive lock only for writing\n            msvcrt.locking(fd, msvcrt.LK_NBLCK, os.path.getsize(path))  # Lock entire file\n        elif 'r' in mode:  # No write access needed\n            pass  # No locking necessary for reading\n    except IOError as e:\n        file_obj.close()\n        raise IOError("File is already locked: {}".format(e))\n\n    return file_obj\n\n# Usage\ntry:\n    file = open_file_exclusive('c:\\path\\to\\file.txt', 'w')\n    file.write('Hello, world!')\nfinally:\n    if file:\n        file.close()