import fcntl\nimport os\n\ndef open_file_exclusive(path, mode):\n    flags = os.O_RDWR if 'r' in mode and 'w' in mode else \\n            os.O_RDONLY if 'r' in mode else \\n            os.O_WRONLY if 'w' in mode else None\n    \n    fd = os.open(path, flags)\n    file_obj = open(fd, mode)\n\n    try:\n        if 'w' in mode:\n            fcntl.flock(fd, fcntl.LOCK_EX | fcntl.LOCK_NB)  # Exclusive lock\n        elif 'r' in mode:\n            fcntl.flock(fd, fcntl.LOCK_SH | fcntl.LOCK_NB)  # Shared lock\n    except IOError as e:\n        file_obj.close()\n        raise IOError("File is already locked: {}".format(e))\n\n    return file_obj\n\n# Usage\ntry:\n    file = open_file_exclusive('/path/to/file', 'w')\n    file.write('Hello, world!')\nfinally:\n    if file:\n        file.close()