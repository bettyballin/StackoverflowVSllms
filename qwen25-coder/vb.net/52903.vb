Public Function SearchEngine(ByVal Terms() As String, ByRef ResidentTBL As DataTable) As DataSet\n    Dim newdts As New DataSet("Users")\n    Dim newtable As DataTable = ResidentTBL.Clone()\n    Dim residentPassCeiling As Integer = ResidentTBL.Rows.Count - 1\n\n    ' Convert all search terms to uppercase once\n    Dim upperTerms(termsceiling) As String\n    For j As Integer = 0 To Terms.GetUpperBound(0)\n        upperTerms(j) = Terms(j).ToUpper()\n    Next\n\n    For j As Integer = 0 To Terms.GetUpperBound(0)\n        Dim tempTable As DataTable\n\n        If j < 1 Then\n            ' First pass through all rows in the original table\n            tempTable = newtable.Clone\n            For i As Integer = 0 To residentPassCeiling\n                Dim row As DataRow = ResidentTBL.Rows(i)\n                If MatchesTerm(row, upperTerms(j)) Then\n                    newtable.ImportRow(row)\n                End If\n            Next\n        Else\n            ' Subsequent passes filter through the previously filtered table\n            tempTable = newtable.Copy\n            newtable.Clear()\n            Dim tempPassCeiling As Integer = tempTable.Rows.Count - 1\n            For i As Integer = 0 To tempPassCeiling\n                Dim row As DataRow = tempTable.Rows(i)\n                If MatchesTerm(row, upperTerms(j)) Then\n                    newtable.ImportRow(row)\n                End If\n            Next\n        End If\n\n        ' Return early if we found an exact match\n        If newtable.Rows.Count = 1 And _\n           ContainsExactMatch(newtable.Rows(0).Item(TheColumns.AccountName - 1).ToString.ToUpper(), upperTerms) Then\n            newdts.Tables.Add(newtable)\n            Return newdts\n        End If\n    Next\n\n    newdts.Tables.Add(newtable)\n    Return newdts\nEnd Function\n\nPrivate Function ContainsExactMatch(ByVal value As String, ByVal terms() As String) As Boolean\n    For Each term In terms\n        If value = term Then\n            Return True\n        End If\n    Next\n    Return False\nEnd Function\n\nPrivate Function MatchesTerm(ByVal row As DataRow, ByVal term As String) As Boolean\n    Dim colsToSearch As Integer() = {\n        TheColumns.AccountName - 1,\n        TheColumns.displayName - 1,\n        TheColumns.sn - 1,\n        TheColumns.givenName - 1,\n        TheColumns.l - 1,\n        TheColumns.department - 1,\n        TheColumns.telephoneNumber - 1,\n        TheColumns.building - 1\n    }\n\n    For Each col As Integer In colsToSearch\n        If row.Item(col).ToString().ToUpper().StartsWith(term) Then\n            Return True\n        End If\n    Next\n\n    Return False\nEnd Functio