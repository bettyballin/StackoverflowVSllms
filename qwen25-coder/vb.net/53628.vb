Imports System.Drawing\n\nPublic Sub CreateSquaredThumbnail(ByVal SourceImage As Image, ByVal outputPath As String, ByVal ScaleWidth As Integer, ByVal ScaleHeight As Integer, ByVal backgroundColor As Color)\n    ' Determine the largest dimension\n    Dim newWidth As Integer = SourceImage.Width\n    Dim newHeight As Integer = SourceImage.Height\n\n    ' Calculate scaling factor and dimensions for drawing the source image on a square canvas\n    Dim scale = Math.Min(ScaleWidth / newWidth, ScaleHeight / newHeight)\n    Dim drawWidth = CInt(newWidth * scale)\n    Dim drawHeight = CInt(newHeight * scale)\n\n    ' Create the destination bitmap with the fixed dimensions\n    Using imgDest As New Bitmap(ScaleWidth, ScaleHeight)\n        imgDest.SetResolution(TARGET_RESOLUTION, TARGET_RESOLUTION)\n\n        ' Create graphics object for drawing\n        Using grDest As Graphics = Graphics.FromImage(imgDest)\n            ' Set background color\n            grDest.Clear(backgroundColor)\n\n            ' Calculate the starting point so the image will be centered\n            Dim x = (ScaleWidth - drawWidth) \ 2\n            Dim y = (ScaleHeight - drawHeight) \ 2\n\n            ' Draw the source image on to the canvas\n            grDest.DrawImage(SourceImage, x, y, drawWidth, drawHeight)\n\n            ' Save the final thumbnail image\n            imgDest.Save(outputPath, Imaging.ImageFormat.Jpeg)\n        End Using\n    End Using\nEnd Sub