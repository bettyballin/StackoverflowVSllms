Public Function SaveImageAndCreateThumbNails(ByVal intWidth As Integer, ByVal strInputFilePath As String, ByVal strFileName As String, ByVal strOutputFilePathForOriginal As String, ByVal strOutputFilePathForThumbnail As String) As Boolean\n    Dim lnWidth As Integer = intWidth\n    Dim lnHeight As Integer = 100\n    Dim bmpOut As System.Drawing.Bitmap = Nothing\n    \n    Try\n        ' Save the original image to the specified folder\n        File.Copy(strInputFilePath, HttpContext.Current.Server.MapPath(Path.Combine(strOutputFilePathForOriginal, strFileName)))\n\n        ' Create thumbnail logic\n        Dim loBMP As New Bitmap(HttpContext.Current.Server.MapPath(strInputFilePath))\n        Dim lnRatio As Decimal\n        Dim lnNewWidth As Integer = 0\n        Dim lnNewHeight As Integer = 0\n\n        If loBMP.Width < lnWidth AndAlso loBMP.Height < lnHeight Then\n            lnNewWidth = loBMP.Width\n            lnNewHeight = loBMP.Height\n        End If\n\n        If loBMP.Width > loBMP.Height Then\n            lnRatio = CDec(lnWidth) / loBMP.Width\n            lnNewWidth = lnWidth\n            Dim lnTemp As Decimal = loBMP.Height * lnRatio\n            lnNewHeight = CInt(lnTemp)\n        Else\n            lnRatio = CDec(lnHeight) / loBMP.Height\n            lnNewHeight = lnHeight\n            Dim lnTemp As Decimal = loBMP.Width * lnRatio\n            lnNewWidth = CInt(lnTemp)\n        End If\n\n        bmpOut = New Bitmap(lnNewWidth, lnNewHeight)\n        Dim g As Graphics = Graphics.FromImage(bmpOut)\n        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic\n        g.FillRectangle(Brushes.White, 0, 0, lnNewWidth, lnNewHeight)\n        g.DrawImage(loBMP, 0, 0, lnNewWidth, lnNewHeight)\n        loBMP.Dispose()\n        \n        ' Save the thumbnail to the specified folder\n        bmpOut.Save(HttpContext.Current.Server.MapPath(Path.Combine(strOutputFilePathForThumbnail, strFileName)))\n        bmpOut.Dispose()\n\n        Return True\n    Catch e As Exception\n        Throw New Exception("Failed to save image or create thumbnails: " & e.Message)\n        Return False\n    End Try\nEnd Functio