Imports System.Security.Cryptography\nImports System.IO\n\nPublic Function SanitizeFileName(fileName As String) As String\n    ' Hash the original filename for security and collision prevention\n    Dim md5Hasher = MD5.Create()\n    Dim data = md5Hasher.ComputeHash(Encoding.Default.GetBytes(fileName))\n    Return BitConverter.ToString(data).Replace("-", "").ToLowerInvariant()\nEnd Function\n\nPublic Sub SaveImage(imageFile As HttpPostedFile)\n    Dim fileName = SanitizeFileName(imageFile.FileName) & Path.GetExtension(imageFile.FileName)\n    Dim relativePath = "~/uploads/"\n    ' Ensure the uploads directory is outside of your web root if possible\n    imageFile.SaveAs(HttpContext.Current.Server.MapPath(relativePath & fileName))\nEnd Sub\n\nPublic Function InsertPhoto() As Integer\n    Dim pta As New GKPTableAdapters.tblPhotosTableAdapter()\n    ' Use Server.MapPath for physical paths instead of constructing URLs manually\n    Dim relativePath = "~/uploads/"\n    Dim fileName = SanitizeFileName(pta.FileName) & Path.GetExtension(pta.FileName)\n    Dim fullPath = HttpContext.Current.Server.MapPath(relativePath & fileName)\n\n    ' Construct the URL based on your site's configuration\n    Dim imageUrl = "http://www.myURL.com/uploads/" & fileName\n\n    ' Use parameterized queries to insert data safely into the database\n    Return pta.InsertPhoto(PhotoCaption:=PhotoCaption,\n                            PhotoDescription:=PhotoDescription,\n                            PhotoUrl:=imageUrl,\n                            IsDefault:=IsDefault,\n                            IsPicture:=IsPicture)\nEnd Functio