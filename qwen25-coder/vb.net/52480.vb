Imports EnvDTE\nImports System.Timers\n\nPublic Module EnvironmentEventsModule\n    Private WithEvents m_Documents As Documents\n\n    Private Sub EnvironmentEvents_Startup() Handles Me.Startup\n        ' Initialize the DocumentEvents events handler\n        m_Documents = DTE.Documents\n    End Sub\n\n    Private Sub m_Documents_DocumentOpened(ByVal Document As EnvDTE.Document) Handles m_Documents.DocumentOpened\n        Dim waitTimer As New Timer(500)  ' wait for 500 milliseconds (half a second)\n        AddHandler waitTimer.Elapsed, AddressOf OnDocumentOpenedDelayed\n        waitTimer.AutoReset = False\n        waitTimer.Enabled = True\n    End Sub\n\n    Private Sub OnDocumentOpenedDelayed(ByVal source As Object, ByVal e As ElapsedEventArgs)\n        Try\n            DTE.SuppressUI = True\n            Dim objSelection As TextSelection = DTE.ActiveDocument.Selection\n            objSelection.StartOfDocument()\n            Do While objSelection.FindText("#region", vsFindOptions.vsFindOptionsMatchInHiddenText)\n                objSelection.SelectLine()\n                objSelection.Collapse()\n            Loop\n            objSelection.StartOfDocument()\n            objSelection.ExpandAllRegions(vsHandyExpandOption.vsHandyExpandOptionExpandFully)\n        Catch ex As Exception\n            MsgBox("An error occurred: " & ex.Message)\n        Finally\n            DTE.SuppressUI = False\n        End Try\n    End Sub\n\n    Private Sub EnvironmentEvents_Shutdown() Handles Me.Shutdown\n    End Sub\nEnd Module