Imports System.Xml\n\nPrivate Function GetPreviousMonthsXml(ByVal months As Integer, ByVal startDate As Date, ByVal xDoc As XmlDocument, ByVal path As String, ByVal nodeName As String) As XmlDocument\n    Dim xp As New StringBuilder("//")\n    xp.Append(nodeName)\n    xp.Append("[")\n    For i As Integer = 0 To (months - 1)\n        xp.Append("starts-with(@Id, '")\n        xp.Append(startDate.AddMonths(-i).ToString("yyyy-MM"))\n        If i < (months - 1) Then\n            xp.Append("') or ")\n        Else\n            xp.Append("')]")\n        End If\n    Next\n\n    Dim xnl As XmlNodeList = xDoc.SelectNodes(xp.ToString())\n    Dim returnXDoc As New XmlDocument(xDoc.NameTable)\n    returnXDoc.LoadXml("<Root></Root>") ' Initialize with root element\n\n    Using writer As XmlWriter = returnXDoc.CreateNavigator().AppendChild()\n        writer.WriteStartElement(nodeName & "s") ' Create a wrapper for nodes\n        For Each node As XmlNode In xnl\n            writer.WriteNode(New XmlNodeReader(node), True)\n        Next\n        writer.WriteEndElement()\n        writer.Close()\n    End Using\n\n    Return returnXDoc\nEnd Functio