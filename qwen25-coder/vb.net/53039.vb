Public Shared Function GetDataTable(ByVal CmdText As String, ByVal parameters As Dictionary(Of String, Object)) As DataTable\n    Using myConn As New SqlConnection(ConfigurationManager.ConnectionStrings("Conn").ConnectionString)\n        Dim myCmd As New SqlCommand(CmdText, myConn)\n        \n        ' Add parameters to the command\n        For Each kvp In parameters\n            myCmd.Parameters.AddWithValue(kvp.Key, kvp.Value)\n        Next\n        \n        myConn.Open()\n        Using myReader As SqlDataReader = myCmd.ExecuteReader()\n            Dim myTable As New DataTable()\n            myTable.Load(myReader)\n            Return myTable\n        End Using\n    End Using\nEnd Function\n\n' Usage example\nDim cmdText As String = "SELECT key FROM ubis WHERE MemberID = @MemberID AND To >= @ToDate AND From <= @FromDate"\nDim parameters As New Dictionary(Of String, Object)()\nparameters.Add("@MemberID", 144)\nparameters.Add("@ToDate", DateTime.Parse("11/7/2009 9:11:23 pm"))\nparameters.Add("@FromDate", DateTime.Parse("11/7/2009 9:11:23 pm"))\n\nDim resultTable As DataTable = GetDataTable(cmdText, parameters)