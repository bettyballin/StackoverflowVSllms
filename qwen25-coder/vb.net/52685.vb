Imports System.Runtime.InteropServices\n\nPublic Class FileUtil\n    <StructLayout(LayoutKind.Sequential, CharSet:=CharSet.Auto)>\n    Public Structure PROCESSENTRY32\n        Dim dwSize As Integer\n        Dim cntUsage As Integer\n        Dim th32ProcessID As Integer\n        Dim th32DefaultHeapID As IntPtr\n        Dim th32ModuleID As Integer\n        Dim cntThreads As Integer\n        Dim th32ParentProcessID As Integer\n        Dim pcPriClassBase As Integer\n        Dim dwFlags As Integer\n        <MarshalAs(UnmanagedType.ByValTStr, SizeConst:=260)> Dim szExeFile As String\n    End Structure\n\n    Public Enum TH32CS Flags\n        None = &H0\n        SnapHeapsList = &H1\n        SnapProcess = &H2\n        SnapThread = &H4\n        SnapModules = &H8\n        SnapAll = (&H1 Or &H2 Or &H4 Or &H8)\n        Inherit = &H80000000UI\n    End Enum\n\n    <DllImport("kernel32.dll", SetLastError:=True)>\n    Public Shared Function CreateToolhelp32Snapshot(ByVal dwFlags As TH32CS, ByVal th32ProcessID As Integer) As IntPtr\n    End Function\n\n    <DllImport("kernel32.dll")>\n    Public Shared Function Process32First(ByVal hSnapshot As IntPtr, ByRef lppe As PROCESSENTRY32) As Boolean\n    End Function\n\n    <DllImport("kernel32.dll")>\n    Public Shared Function Process32Next(ByVal hSnapshot As IntPtr, ByRef lppe As PROCESSENTRY32) As Boolean\n    End Function\n\n    <DllImport("kernel32.dll", SetLastError:=True)>\n    Private Shared Function CloseHandle(ByVal hObject As IntPtr) As Boolean\n    End Function\n\n    Public Shared Sub ListProcesses()\n        Dim hSnapshot = CreateToolhelp32Snapshot(TH32CS.SnapProcess, 0)\n        If hSnapshot.ToInt32() <> -1 Then\n            Dim pe32 As New PROCESSENTRY32()\n            pe32.dwSize = Marshal.SizeOf(pe32)\n            If Process32First(hSnapshot, pe32) Then\n                Do\n                    Console.WriteLine("PROCESS NAME: " & pe32.szExeFile)\n                    ' You would need to check if this process has a handle to the file here.\n                Loop Until Not Process32Next(hSnapshot, pe32)\n            End If\n            CloseHandle(hSnapshot)\n        End If\n    End Sub\n\nEnd Class