Dim reg As New StdRegistry\n\nPublic Function CurrentWallpaper() As String\n    CurrentWallpaper = reg.ValueEx(HKEY_CURRENT_USER, "Control Panel\Desktop", "Wallpaper", REG_SZ, "")\nEnd Function\n\nPublic Sub SetWallpaper(cFilename As Variant)\n    If Dir(cFilename) <> "" Then ' Check if file exists\n        reg.ClassKey = HKEY_CURRENT_USER\n        reg.SectionKey = "Control Panel\Desktop"\n        reg.ValueKey = "Wallpaper"\n        reg.ValueType = REG_SZ\n        reg.Default = ""\n        reg.Value = cFilename\n        \n        Call SystemParametersInfo(SPI_SETDESKWALLPAPER, 0, cFilename, SPIF_UPDATEINIFILE Or SPIF_SENDCHANGE)\n    Else\n        MsgBox "File does not exist!", vbExclamation\n    End If\nEnd Sub\n\nPublic Declare Function SystemParametersInfo Lib "user32" Alias "SystemParametersInfoA" _\n    (ByVal uAction As Long, ByVal uParam As Long, ByVal lpvParam As Any, ByVal fuWinIni As Long) As Long\n\nPrivate Const SPI_SETDESKWALLPAPER = 20\nPrivate Const SPIF_UPDATEINIFILE = &H1\nPrivate Const SPIF_SENDCHANGE = &H2\n\nPublic Sub RefreshDesktop()\n    Dim oShell As Object\n    Set oShell = CreateObject("WScript.Shell")\n    oShell.Run "%windir%\System32\RUNDLL32.EXE user32.dll,UpdatePerUserSystemParameters", 1, True\nEnd Sub