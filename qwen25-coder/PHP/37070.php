<?php\n// Define paths\n$uploadDirectory = '../uploads/'; // Store uploads outside web root\n$file = $uploadDirectory . basename($_GET['file']); // Assume 'file' parameter contains the filename\n\n// Check if file exists\nif (!file_exists($file)) {\n    http_response_code(404);\n    die('File not found.');\n}\n\n// Start session and check permissions\nsession_start();\nif (!isset($_SESSION['user_id']) || !has_access_to_file($_SESSION['user_id'], $_GET['file'])) { // has_access_to_file() is a function you must implement to check user's file access rights\n    http_response_code(403);\n    die('Access denied.');\n}\n\n// Get file info\n$finfo = finfo_open(FILEINFO_MIME_TYPE);\n$mime_type = finfo_file($finfo, $file);\n\n// Serve the file\nheader('Content-Type: ' . $mime_type);\nheader('Content-Disposition: inline; filename="' . basename($file) . '"');\nreadfile($file);\n\nfunction has_access_to_file($user_id, $filename) {\n    // Logic to check if the user with $user_id can access $filename. Replace this with actual checks.\n    return true; // Dummy return value\n}\n?>