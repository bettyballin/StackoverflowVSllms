<?php\n// Set maximum file size to 2MB\n$maxFileSize = 2 * 1024 * 1024;\n\n// Allowed file types\n$allowedTypes = ['image/png', 'image/jpeg', 'image/gif'];\n\nif ($_SERVER['REQUEST_METHOD'] === 'POST' && isset($_FILES['image'])) {\n    $file = $_FILES['image'];\n    \n    // Check file size\n    if ($file['size'] > $maxFileSize) {\n        die("File is too large. Maximum 2MB allowed.");\n    }\n    \n    // Check file type\n    if (!in_array($file['type'], $allowedTypes)) {\n        die("Invalid file type. Only PNG, JPG and GIF are allowed.");\n    }\n    \n    // Securely upload and rename file\n    $extension = pathinfo($file['name'], PATHINFO_EXTENSION);\n    $imageName = uniqid() . '.' . $extension; // Generates a unique name\n    $uploadPath = __DIR__ . '/uploads/' . $imageName;\n\n    if (!move_uploaded_file($file['tmp_name'], $uploadPath)) {\n        die("Failed to upload file.");\n    }\n\n    // Create thumbnail and save it\n    $thumbnailName = uniqid() . '_thumb.' . $extension;\n    $thumbnailPath = __DIR__ . '/uploads/' . $thumbnailName;\n\n    // Create image instance based on file type\n    switch ($file['type']) {\n        case 'image/png':\n            $image = imagecreatefrompng($uploadPath);\n            break;\n        case 'image/jpeg':\n            $image = imagecreatefromjpeg($uploadPath);\n            break;\n        case 'image/gif':\n            $image = imagecreatefromgif($uploadPath);\n            break;\n        default:\n            die("Unsupported file type.");\n    }\n\n    // Set thumbnail size\n    $thumbnailWidth = 100;\n    $thumbnailHeight = 100;\n\n    // Create a blank image with the new dimensions\n    $thumbnailImage = imagescale($image, $thumbnailWidth, $thumbnailHeight);\n\n    // Save the thumbnail based on file type\n    switch ($extension) {\n        case 'png':\n            imagepng($thumbnailImage, $thumbnailPath);\n            break;\n        case 'jpeg':\n        case 'jpg':\n            imagejpeg($thumbnailImage, $thumbnailPath);\n            break;\n        case 'gif':\n            imagegif($thumbnailImage, $thumbnailPath);\n            break;\n    }\n\n    // Clean up\n    imagedestroy($image);\n    imagedestroy($thumbnailImage);\n\n    echo "Image and thumbnail uploaded successfully!";\n}\n?>\n\n<!-- HTML form for image upload -->\n<form method="post" enctype="multipart/form-data">\n    <input type="file" name="image" accept=".png,.jpg,.jpeg,.gif">\n    <button type="submit">Upload Image</button>\n</form>