class Booze_Plugin_AclPlugin extends Zend_Controller_Plugin_Abstract {\n\n    public function preDispatch(Zend_Controller_Request_Abstract $request) {\n        $auth = Booze_Permissions_Auth::getInstance();\n        $acl = Zend_Registry::get('acl');\n\n        if (!$auth->hasIdentity()) {\n            $role = Booze_Permissions_Roles::GUEST;\n        } else {\n            $role = $auth->getUser()->role;\n        }\n\n        $resource = $request->getControllerName();\n        $privilege = $request->getActionName();\n\n        if (!$acl->isAllowed($role, $resource, $privilege)) {\n            Booze_Log::log("ACLPlugin: Access denied");\n\n            // Check if the request is an AJAX request\n            if ($request->isXmlHttpRequest()) {\n                // Return JSON response indicating access Denied\n                $response = new Zend_Controller_Response_Http();\n                $response->setHttpResponseCode(403);\n                $response->setHeader('Content-Type', 'application/json');\n                $response->appendBody(json_encode(['message' => 'Access denied', 'redirect' => '/login']));\n                $response->sendResponse();\n                exit;\n            } else {\n                // Redirect to login page for non-AJAX requests\n                $request->setControllerName('login');\n                $request->setActionName('index');\n                $request->setDispatched(false);\n            }\n        }\n    }\n}