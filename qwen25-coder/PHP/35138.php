<?php\n\nfunction buildHierarchicalHTML($flatData) {\n    $html = '<div><ul>';\n    $stack = [];\n    \n    foreach ($flatData as $item) {\n        while (!empty($stack) && $item['depth'] <= end($stack)['depth']) {\n            array_pop($stack);\n            $html .= str_repeat('</li></ul>', count($stack) + 1 - sizeof($flatData));\n        }\n        \n        if (!empty($stack) && $item['depth'] > end($stack)['depth']) {\n            $html .= '<ul>';\n        }\n\n        $html .= "<li>{$item['name']}";\n        array_push($stack, ['name' => $item['name'], 'depth' => $item['depth']]);\n    }\n    \n    $html .= str_repeat('</li></ul>', count($stack)) . '</div>';\n    \n    return $html;\n}\n\n$nested_array = [];\n$nested_array[] = ['name' => 'foo', 'depth' => 0];\n$nested_array[] = ['name' => 'bar', 'depth' => 0];\n$nested_array[] = ['name' => 'sub-bar', 'depth' => 1];\n\necho buildHierarchicalHTML($nested_array);\n\n?>