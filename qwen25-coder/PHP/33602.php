function linkify($text) {\n    // Replace URLs starting with http/https\n    $text = preg_replace_callback(\n        '/\b(?:(?:https?|ftp):\/\/[^\s"]+)(?=\s|$)/i',\n        function ($matches) {\n            return '<a href="' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '">' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '</a>';\n        },\n        $text\n    );\n\n    // Replace URLs without http/https\n    $text = preg_replace_callback(\n        '/\b(?:www|[a-z][a-z0-9_-]+\.(?:com\b|[^:\.\s"\']+\b))/i',\n        function ($matches) {\n            return '<a href="http://' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '">' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '</a>';\n        },\n        $text\n    );\n\n    // Replace emails\n    $text = preg_replace_callback(\n        '/\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z]{2,}\b/i',\n        function ($matches) {\n            return '<a href="mailto:' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '">' . htmlspecialchars($matches[0], ENT_QUOTES, 'UTF-8') . '</a>';\n        },\n        $text\n    );\n\n    return $text;\n}\n\n$text = "http://www.cnn.com cnn.com www.cnn.com abc@def.com";\necho linkify($text);