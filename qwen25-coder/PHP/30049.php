foreach($eventfiles as $eventfile) {\n    if($eventfile['filename']) { \n        $file = $eventfile['filepath'];\n        // Open File\n        if (filter_var($file, FILTER_VALIDATE_URL)) {\n            // Use file_get_contents with stream context options for URLs\n            $context = stream_context_create(\n                array("http" => array('method' => 'GET', 'max_redirects' => 5))\n            );\n            \n            $data = @file_get_contents($file, false, $context);\n            if ($data === FALSE) {\n                echo '<br>CAN NOT READ FILE.';\n                exit;\n            }\n        } else {\n            // For local files\n            if (!($fp = fopen($file, "r"))) {\n                echo '<br>CAN NOT READ FILE.';\n                exit;\n            }\n            $data = "";\n            while (!feof($fp)) $data .= fread($fp, 1024);\n            fclose($fp); // Close the file pointer\n        }\n        \n        query("update event_rtab set html = '".escape($data)."' where id = {$eventfile[id]}");   \n    }\n    \n    if($eventfile['eventType']=='email') {\n        query("INSERT INTO event_email_rtab (event_id,subject) values ($eventfile[id],'".escape($eventfile[email_subject])."')");\n    }\n}