define('APPLICATION_PATH', realpath(dirname(__FILE__) . '/../application/'));\ndefine('APPLICATION_ENVIRONMENT', 'testing');\n\n// setup path to our library files\nset_include_path(APPLICATION_PATH . '/../library' . PATH_SEPARATOR .\n                 get_include_path());\n\n// register the autoloader\nrequire_once 'Zend/Loader.php';\nZend_Loader::registerAutoload();\n\n// set config in the registry\n$config = new Zend_Config_Ini(APPLICATION_PATH . '/../config/config.ini', APPLICATION_ENVIRONMENT);\nZend_Registry::set('config', $config);\n\n// setup logging\n$writer = new Zend_Log_Writer_Stream(APPLICATION_PATH . '/../log/debug.log');\n$logger = new Zend_Log($writer);\nZend_Registry::set('logger', $logger);\n\n// run!\n$frontController = Zend_Controller_Front::getInstance();\n$frontController->addModuleDirectory(APPLICATION_PATH);\n// initialize Zend_Layout's MVC helpers\nZend_Layout::startMvc();\n\n$frontController->throwExceptions(true);\n\ntry {\n    // Dispatch the front controller\n    Zend_Controller_Front::getInstance()->dispatch();\n\n    // After dispatching, set layout path for each module\n    $layout = Zend_Layout::getMvcInstance();\n    $moduleName = isset($_GET['module']) ? $_GET['module'] : 'default';\n\n    switch ($moduleName) {\n        case 'admin':\n            $layout->setLayoutPath(APPLICATION_PATH . '/admin/views/layouts');\n            break;\n        default:\n            $layout->setLayoutPath(APPLICATION_PATH . '/default/views/layouts');\n            break;\n    }\n\n} catch (Exception $exception) {\n\n    echo '<html><body><center>'  . 'An exception occured while dispatching the front controller.';\n    if (defined('APPLICATION_ENVIRONMENT') && APPLICATION_ENVIRONMENT != 'production' ) {\n        echo '<br /><br />' . $exception->getMessage() . '<br />'  . '<div align="left">Stack Trace:' . '<pre>' . $exception->getTraceAsString() . '</pre></div>';\n    }\n    echo '</center></body></html>';\n    exit(1);\n}