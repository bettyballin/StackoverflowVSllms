<?php\nsession_start();\n\n// Database connection (adjust credentials as needed)\n$host = 'localhost';\n$db   = 'your_database_name';\n$user = 'your_username';\n$pass = 'your_password';\n$charset = 'utf8mb4';\n\n$dsn = "mysql:host=$host;dbname=$db;charset=$charset";\n$options = [\n    PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,\n    PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,\n    PDO::ATTR_EMULATE_PREPARES   => false,\n];\ntry {\n     $pdo = new PDO($dsn, $user, $pass, $options);\n} catch (\PDOException $e) {\n     throw new \PDOException($e->getMessage(), (int)$e->getCode());\n}\n\n// Check if there's a referral token in the URL\nif(isset($_GET['ref'])) {\n    $referToken = $_GET['ref'];\n    setcookie("referrer", $referToken, time() + (86400 * 30), "/"); // 30 days expiration\n\n    // Log referral to database if necessary\n    // Assuming there's a table `referrals` with columns `user_id`, `referred_by`\n    // and you have a way to identify the user.\n    $userId = getUserIdFromSessionOrCookie(); // You need to define this function\n    if($userId) {\n        $stmt = $pdo->prepare("INSERT INTO referrals (user_id, referred_by) VALUES (?, ?)");\n        $stmt->execute([$userId, $referToken]);\n    }\n}\n\n// Function to get user ID from session or cookie\nfunction getUserIdFromSessionOrCookie() {\n    // This is a placeholder function. You should implement logic based on your application.\n    if(isset($_SESSION['user_id'])) {\n        return $_SESSION['user_id'];\n    } elseif (isset($_COOKIE['user_id'])) {\n        return intval($_COOKIE['user_id']); // Ensure it's an integer\n    }\n    return null;\n}\n?>