if (!$mbox = imap_open ("{myserver.com:110/pop3/notls}INBOX", "u", "p")) {\n    die ('Cannot connect/check mail! Exiting');\n}\n\n$messages = imap_search($mbox, 'ALL');\n\nforeach ($messages as $message) {\n    $overview = imap_fetch_overview($mbox, $message);\n    $structure = imap_fetchstructure($mbox, $message);\n\n    if (isset($structure->parts)) { // if email has parts\n        foreach ($structure->parts as $i => $part) {\n            if (!empty($part->disposition) && in_array(strtoupper($part->disposition), ['ATTACHMENT', 'INLINE'])) {\n                $data = imap_fetchbody($mbox, $message, $i + 1);\n\n                switch ($part->encoding) {\n                    case ENCBINARY:\n                        $data = imap_base64($data);\n                        break;\n                    case ENCBASE64:\n                        $data = imap_base64($data);\n                        break;\n                    case ENCHex:\n                        $data = imap_hex2bin($data);\n                        break;\n                    default:\n                        $data = imap_qprint($data);\n                }\n\n                // Determine the file name\n                if (empty($part->dparameters[0]->value)) {\n                    $filename = "unknown" . ($i + 1) . "." . strtolower($part->subtype);\n                } else {\n                    $filename = $part->dparameters[0]->value;\n                }\n\n                // Save the file\n                file_put_contents('/path/to/save/' . basename($filename), $data);\n            }\n        }\n    }\n}\n\nimap_close($mbox);