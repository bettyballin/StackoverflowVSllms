<?php\n$con = mysqli_connect("localhost", "user", "", "ebay");\nif (!$con) {\n    echo "Can't connect to MySQL Server. Errorcode: %s\n". mysqli_connect_error();\n    exit;\n}\nmysqli_query($con, "SET NAMES 'utf8'");\n\n$cmd = "word"; // Normally retrieved from GET\nif ($cmd == "deleterec") {\n    $deleteQuery = "DELETE FROM AUCTIONS1 WHERE ARTICLE_NO = ?";\n    if ($delRecord = $con->prepare($deleteQuery)) {\n        $pk = 123; // Example pk value, should be sanitized and set properly\n        $delRecord->bind_param("i", $pk);\n        $delRecord->execute();\n    }\n}\n\n$table = 'AUCTIONS';\n$brand = "test"; // Example brand value, should be sanitized\n\n$countQuery = "SELECT ARTICLE_NO FROM $table WHERE upper(ARTICLE_NAME) LIKE CONCAT('%', ?, '%')";\nif ($numRecords = $con->prepare($countQuery)) {\n    $numRecords->bind_param("s", $brand);\n    $numRecords->execute();\n    $result = $numRecords->get_result(); // Get the result set\n    $rowcount = $result->num_rows; // Number of rows\n\n    // Fetch records\n    $rows = getRowsByArticleSearch($table, $brand);\n    $last = ceil($rowcount / $page_rows);\n}\n\n$self = htmlspecialchars($_SERVER['PHP_SELF'], ENT_QUOTES, 'utf-8');\nforeach ($rows as $row) { // print table rows\n    echo '<tr>' . "\n";\n    echo '<td><a href="#" onclick="doThings(\'Layer2\', \'' . $pk . '\')">'.$row['USERNAME'].'</a></td>' . "\n";\n    // repeated for each column\n    echo '</tr>';\n}\n\nfunction getRowsByArticleSearch($table, $searchString) {\n    global $con;\n    $max = " LIMIT 10"; // Example limit clause, should be set properly\n    $recordsQuery = "SELECT ARTICLE_NO, USERNAME, ACCESSSTARTS, ARTICLE_NAME, date_format(str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s'), '%d %m %Y' ) AS shortDate FROM $table WHERE upper(ARTICLE_NAME) LIKE CONCAT('%', ?, '%') ORDER BY str_to_date(ACCESSSTARTS, '%d/%m/%Y %k:%i:%s')" . $max;\n    $rows = [];\n    \n    if ($getRecords = mysqli_prepare($con, $recordsQuery)) {\n        mysqli_stmt_bind_param($getRecords, "s", $searchString);\n        mysqli_stmt_execute($getRecords);\n        mysqli_stmt_store_result($getRecords); // Store the result\n        \n        // Bind variables to the prepared statement as parameters\n        mysqli_stmt_bind_result($getRecords, $ARTICLE_NO, $USERNAME, $ACCESSSTARTS, $ARTICLE_NAME, $shortDate);\n\n        while (mysqli_stmt_fetch($getRecords)) { \n            $rows[] = [\n                'ARTICLE_NO' => $ARTICLE_NO,\n                'USERNAME' => $USERNAME,\n                'ACCESSSTARTS' => $ACCESSSTARTS,\n                'ARTICLE_NAME' => $ARTICLE_NAME,\n                'shortDate' => $shortDate\n            ];\n        }\n        mysqli_stmt_close($getRecords);\n    }\n\n    return $rows;\n}\n?>