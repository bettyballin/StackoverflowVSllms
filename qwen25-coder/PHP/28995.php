$image_url = "http://www.example.com/image.jpg";\n$temp_image_file = imagecreatefromjpeg($image_url);\n\nlist($width, $height) = getimagesize($image_url);\n$thumb_width = 166;\n$thumb_height = 103;\n\n// Calculate the dimensions for resizing while maintaining aspect ratio\n$ratio = min($thumb_width / $width, $thumb_height / $height);\n$new_width = (int)($width * $ratio);\n$new_height = (int)($height * $ratio);\n\n// Create a new image with a black background\n$image_file = imagecreatetruecolor($thumb_width, $thumb_height);\n$black = imagecolorallocate($image_file, 0, 0, 0);\nimagefill($image_file, 0, 0, $black);\n\n// Calculate the position to center the resized image\n$xpos = ($thumb_width - $new_width) / 2;\n$ypos = ($thumb_height - $new_height) / 2;\n\n// Resize and copy the original image into the new canvas\nimagecopyresampled($image_file, $temp_image_file, \n    (int)$xpos, (int)$ypos, // destination x, y (for centering)\n    0, 0, // source x, y\n    $width, $height, // width, height from the original image\n    $new_width, $new_height); // resized dimensions\n\nimagejpeg($image_file, "thumbnails/thumbnail.jpg", 50);\nimagedestroy($temp_image_file);\nimagedestroy($image_file);