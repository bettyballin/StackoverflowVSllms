$file = "phpsettings.php";\n\ntry {\n    // Check if file exists and remove it\n    if (file_exists($file) && !unlink($file)) {\n        throw new Exception("Cannot delete existing file.");\n    }\n\n    // Create a fresh file with proper permissions\n    $handle = fopen($file, 'x'); // Use 'x' to ensure atomic creation only\n    if (!$handle) {\n        throw new Exception("Failed to create prefs file. Check permissions.");\n    }\n\n    // Sanitize input (important for security)\n    $mypref = htmlspecialchars($_POST['mypref'], ENT_QUOTES, 'UTF-8');\n\n    // Write preferences securely\n    fwrite($handle, "<?php\n\$pref1 = " . var_export($mypref, true) . ";\n?>");\n\n} catch (Exception $e) {\n    error_log('Error writing prefs file: ' . $e->getMessage());\n    echo "There was an error saving your preferences. Contact support.";\n    // Optionally, restore to defaults here\n}\n\nfclose($handle);