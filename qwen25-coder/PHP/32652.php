<?php\n\nfunction renderTemplate($template, $data) {\n    // Find all block sections (e.g., {{#SECTION}}...{{/SECTION}})\n    $pattern = '/\{\{#(\w+)\}\}([\s\S]*?)\{\{\/\1\}\}/';\n    \n    if (preg_match_all($pattern, $template, $matches)) {\n        foreach ($matches[0] as $index => $fullBlock) {\n            list($blockName, $blockContent) = [$matches[1][$index], $matches[2][$index]];\n            \n            if (!isset($data[$blockName])) {\n                // Replace the block with an empty string if no data is found\n                $template = str_replace($fullBlock, '', $template);\n            } elseif (is_array($data[$blockName])) {\n                $replacement = '';\n                foreach ($data[$blockName] as $item) {\n                    $replacement .= renderTemplate($blockContent, $item);\n                }\n                $template = str_replace($fullBlock, $replacement, $template);\n            }\n        }\n    }\n\n    // Replace simple tags (e.g., {{TAG}})\n    $pattern = '/\{\{(\w+)\}\}/';\n    if (preg_match_all($pattern, $template, $matches)) {\n        foreach ($matches[0] as $index => $fullTag) {\n            $tagName = $matches[1][$index];\n            $replacement = isset($data[$tagName]) ? $data[$tagName] : '';\n            $template = str_replace($fullTag, $replacement, $template);\n        }\n    }\n\n    return $template;\n}\n\n$template = <<<EOT\n{{HEADER}}\n\nHello my name is {{NAME}}\n\n{{#CONTENT}}\n    This is the content ...\n\n    {{#PERSONS}}\n\n        <p>My name is {{NAME}}.</p>\n\n    {{/PERSONS}}\n\n{{/CONTENT}}\n\n{{FOOTER}}\nEOT;\n\n$data = array(\n    'HEADER' => 'This is a header',\n    'NAME' => 'David',\n    'CONTENT' => array('PERSONS' => array(array('NAME' => 'Heino'), array('NAME' => 'Sebastian'))),\n    'FOOTER' => 'This is the footer'\n);\n\necho renderTemplate($template, $data);\n?>