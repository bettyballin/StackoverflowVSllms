/**\n * Truncates $str and returns it with $ending on the end, if $str is longer than $limit characters.\n *\n * @param string $str The input string to truncate.\n * @param int $length The maximum length of the string before truncating.\n * @param string $ending The suffix to append to the truncated string.\n * @return string\n */\nfunction truncate_string($str, $length, $ending = "...") {\n    // Ensure the ending is only added if there's enough space for it\n    $trueLength = strlen($str);\n    if ($trueLength > $length) {\n        return substr($str, 0, max(0, $length - strlen($ending))) . $ending;\n    }\n    return $str;\n}