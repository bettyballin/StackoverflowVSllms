$uploadTempFile = $myField['tmp_name'];\nlist($uploadWidth, $uploadHeight, $uploadType) = getimagesize($uploadTempFile);\n\n$srcImage = imagecreatefrompng($uploadTempFile);\n$targetImage = imagecreatetruecolor(128, 128);\n\n// Make sure both the target and source images handle transparency correctly\nimagealphablending($srcImage, false);\nimagealphablending($targetImage, false);\nimagesavealpha($srcImage, true);\nimagesavealpha($targetImage, true);\n\n// Create a transparent background for the target image\n$transparentBackground = imagecolorallocatealpha($targetImage, 0, 0, 0, 127);\nimagefill($targetImage, 0, 0, $transparentBackground);\n\nimagecopyresampled($targetImage, $srcImage,\n    0, 0, \n    0, 0, \n    128, 128, \n    $uploadWidth, $uploadHeight);\n\nimagepng($targetImage, 'out.png', 9);\nimagedestroy($srcImage); // Free up memory\nimagedestroy($targetImage);