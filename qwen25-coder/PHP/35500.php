$database = new PDO("mysql:host=host;dbname=mysql_db","username","password");\n// Turn off autocommit\n$database->beginTransaction();\n\ntry {\n    while (notDone()) {\n        // Start transaction block\n        $add_row = $database->prepare("INSERT INTO table (columns) VALUES (?)");\n        $add_row->execute(array('values'));\n\n        // PROCESSING STUFF THAT TAKES A LONG TIME GOES HERE\n\n        // If everything is successful within the loop, commit.\n        // This example assumes you want to commit after each iteration.\n        $database->commit();\n\n        // Begin transaction again for next iteration\n        $database->beginTransaction();\n    }\n\n} catch (Exception $e) {\n    // Something went wrong, roll back changes\n    $database->rollBack();\n    echo "An error occurred: " . $e->getMessage();\n}\n\n$database = null;