<?php\n\n$ftp_server = "your_ftp_server";\n$ftp_username = "your_ftp_username";\n$ftp_password = "your_ftp_password";\n$remote_file = "/path/to/database_update.tar.gz"; // Remote path of the file\n$local_file = "./database_update.tar.gz"; // Local path where we save the file\n$sql_temp_file = "./database_update.sql";\n\n// Connect to FTP server\n$conn_id = ftp_connect($ftp_server);\nif (!$conn_id) {\n    die("FTP connection has failed!");\n}\n\n// Login with username and password\n$login_result = ftp_login($conn_id, $ftp_username, $ftp_password);\nif (!$login_result) {\n    die("FTP login has failed!");\n} else {\n    echo "Login successful...\n";\n}\n\n// Download the file\nif (ftp_get($conn_id, $local_file, $remote_file, FTP_BINARY)) {\n    echo "Successfully written to $local_file\n";\n} else {\n    echo "There was an error while downloading the file.\n";\n    ftp_close($conn_id);\n    exit;\n}\n\n// Extract the SQL file using shell command\nexec("tar -xzf {$local_file} -C ./", $output, $return_var);\n\nif ($return_var !== 0) {\n    echo "Error extracting tar.gz\n";\n    ftp_close($conn_id);\n    unlink($local_file); // Clean up downloaded file\n    exit;\n}\n\n// Locate the SQL file (adjust according to your archive structure)\n$sql_files = glob('./database_update/*.sql');\nif (!empty($sql_files)) {\n    $sql_temp_file = $sql_files[0]; // Assuming there is only one sql file\n} else {\n    echo "No SQL files found in the archive\n";\n    ftp_close($conn_id);\n    unlink($local_file); // Clean up downloaded file\n    exit;\n}\n\n// Database connection details\n$db_host = 'localhost';\n$db_username = 'your_db_username';\n$db_password = 'your_db_password';\n$db_database = 'your_database_name';\n\ntry {\n    $pdo = new PDO("mysql:host=$db_host;dbname=$db_database", $db_username, $db_password);\n    // Set the PDO error mode to exception\n    $pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n    echo "Connected successfully\n";\n    \n    // Execute SQL file through PDO\n    if (($handle = fopen($sql_temp_file, "r")) !== FALSE) {\n        while (($query = fgets($handle)) !== FALSE) {\n            $pdo->exec($query);\n        }\n        fclose($handle);\n        echo "SQL Executed successfully\n";\n        \n        // Clean up\n        ftp_close($conn_id);\n        unlink($local_file); // Remove downloaded tar.gz file\n        unlink($sql_temp_file); // Remove extracted SQL file\n    } else {\n        echo "Failed to open and read the SQL file\n";\n        ftp_close($conn_id);\n        unlink($local_file); // Clean up downloaded file\n        exit;\n    }\n} catch(PDOException $e) {\n    echo "Connection failed: " . $e->getMessage();\n}\n?>