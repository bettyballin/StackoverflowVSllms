function openExternalLinksInNewTab($html) {\n    // Use DOMDocument to parse the HTML content\n    $dom = new DOMDocument();\n    libxml_use_internal_errors(true); // Ignore HTML errors for malformed tags\n    $dom->loadHTML(mb_convert_encoding($html, 'HTML-ENTITIES', 'UTF-8'));\n    libxml_clear_errors();\n\n    // Get all anchor tags in the document\n    $tags = $dom->getElementsByTagName('a');\n\n    foreach ($tags as $tag) {\n        $href = $tag->getAttribute('href');\n        if (!empty($href) && !filter_var($href, FILTER_VALIDATE_URL)) {\n            continue; // Skip if not a URL or empty href\n        }\n\n        // Check if the link is external\n        if (parse_url($href, PHP_URL_HOST) !== $_SERVER['HTTP_HOST']) {\n            $tag->setAttribute('target', '_blank');\n            $tag->setAttribute('rel', 'noopener noreferrer'); // Security measure for opening links in new tab\n        }\n    }\n\n    return trim(str_replace(\n        ['<html>', '</html>', '<body>', '</body>'],\n        '',\n        $dom->saveHTML()\n    ));\n}\n\n// Example usage:\n$htmlContent = '<p>Check out our site <a href="https://example.com">Example</a></p>';\necho openExternalLinksInNewTab($htmlContent);