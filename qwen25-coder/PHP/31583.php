<?php\n\nrequire_once('connection.php');\n\n// Start session\nsession_start();\n\n// Prepare input data\n$username = $_POST['username'];\n$password = password_hash($_POST['password'], PASSWORD_BCRYPT); // Use password_hash instead of md5\n$email = $_POST['email'];\n$ip = $_SERVER['REMOTE_ADDR'];\n\ntry {\n    // Create a prepared statement for checking existing username or email\n    $stmt = $pdo->prepare("SELECT 1 FROM users WHERE username = :username OR email = :email");\n    $stmt->bindParam(':username', $username);\n    $stmt->bindParam(':email', $email);\n    $stmt->execute();\n\n    // Check if duplicate exists\n    if ($stmt->fetch()) {\n        echo "Username or Email already exists<br><a href=\"sign_up.php\">Try Again</a></br>";\n    } else {\n        // Insert new user into the database\n        $insertStmt = $pdo->prepare("INSERT INTO users (username, password, email, rank, ip, active) VALUES (:username, :password, :email, 1, :ip, 0)");\n        $insertStmt->bindParam(':username', $username);\n        $insertStmt->bindParam(':password', $password);\n        $insertStmt->bindParam(':email', $email);\n        $insertStmt->bindParam(':ip', $ip);\n\n        if ($insertStmt->execute()) {\n            echo "You are signed up, please follow the link on your email to activate your account.";\n        } else {\n            die('Error: ' . implode(", ", $insertStmt->errorInfo()));\n        }\n    }\n\n} catch (PDOException $e) {\n    die("Database error: " . $e->getMessage());\n}\n?>