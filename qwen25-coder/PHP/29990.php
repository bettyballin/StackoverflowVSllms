function getOccupancyData($locId) {\n    return [\n        'visitorsOnsite' => $_DBH->getOne('SELECT count(*) FROM '.lu_GetTableName('Visitor')\n            .' WHERE '.lu_GetFieldName('Location for Visit', 'Visitor').' = ?'\n            .' AND '.lu_GetFieldName('Checked In', 'Visitor').' = "checked"'\n            .' AND '.lu_GetFieldName('Checked Out', 'Visitor').' != "checked"', [$locId]),\n    ];\n}\n\nfunction getStaffQuery($orgId, $locId) {\n    return '('.lu_GetFieldName('Staff Status', 'Staff').' = "" OR  '.lu_GetFieldName('Staff Status', 'Staff').' = "On-Site")'\n        .' OR '.lu_GetFieldName('Current Location', 'Staff').' = ?'\n        .' AND record_Inactive != "checked"'\n        .' AND '.lu_GetFieldName('Ignore Counts', 'Staff').' != "checked"';\n}\n\n// Main logic\nif ($_SESSION['dash']['VC'] && isset($_SESSION['dash']['VC']['loc_ID'])) {\n    $occupancyData = getOccupancyData($_SESSION['dash']['VC']['loc_ID']);\n    $_TPL->assign('occupancy', $occupancyData);\n\n    if (lu_GetTableRow('Enote', $_SESSION['dash']['VC']['org_id'], 'record_ID', \n        lu_GetFieldName('Note Emailed', 'Enote').' = "0000-00-00" AND '.lu_GetFieldName('Note Passed On', 'Enote').' != "Yes"')) {\n        $_TPL->assign('EnoteNotice', true);\n    }\n\n    if (lu_GetTableRow('MedicalRoom', $_SESSION['dash']['VC']['loc_ID'], 'record_ID', 'record_Inactive != "Yes"')) {\n        $_TPL->assign('MedicalNotice', true);\n    }\n\n    if (lu_GetFieldValue('Printing', 'Location', $_SESSION['dash']['VC']['loc_ID']) !== "No") {\n        $_TPL->assign('UnmannedPrinting', true);\n    }\n\n    if (lu_GetFieldValue('Enable Contractor Check In', 'Location', $_SESSION['dash']['VC']['loc_ID']) === "checked") {\n        $_TPL->assign('ContractorCheckin', true);\n    }\n} else {\n    // Handle cases where VC session data is not present\n}\n\n// Fixup contractors logic\nif ($_SESSION['dash']['entity_id'] && isset($_GET['fixupCon']) && $_GET['fixupCon'] === 'true') {\n    $conStaffs = lu_GetTableRow('ContractorStaff', $_SESSION['dash']['ModifyConStaffs']['org_ID'], 'record_ID', '',\n        [lu_GetFieldName('First Name', 'ContractorStaff'), lu_GetFieldName('Surname', 'ContractorStaff')]\n    );\n\n    foreach ($conStaffs['rows'] as $cstaff) {\n        if ($cstaff[lu_GetFieldName('Site Access Card Number', 'ContractorStaff')] && $cstaff[lu_GetFieldName('Site Access Card Type', 'ContractorStaff')]) {\n            $_DBH->query(\n                'UPDATE '.lu_GetTableName('Visitor').' SET '\n                .lu_GetFieldName('Site Access Card Number', 'Visitor').' = ?, '\n                .lu_GetFieldName('Site Access Card Type', 'Visitor').' = ?'\n                .' WHERE id IN (SELECT '.lu_GetFieldName('ID', 'Visitor')\n                .' FROM '.lu_GetTableName('Visitor').' WHERE contractor_staff_id = ?)',\n                [\n                    $cstaff[lu_GetFieldName('Site Access Card Number', 'ContractorStaff')],\n                    $cstaff[lu_GetFieldName('Site Access Card Type', 'ContractorStaff')],\n                    $cstaff['id'],\n                ]\n            );\n        }\n    }\n}\n\n// Assign template and render\n// $_TPL->render();