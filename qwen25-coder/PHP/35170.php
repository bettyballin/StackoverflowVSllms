$apubs_final = [];\n$seenSpubids = [];\n\nforeach ($apubs as $arec) {\n    if (!isset($seenSpubids[$arec['spubid']])) {\n        // Add the record to the final array and mark the spubid as seen.\n        $apubs_final[] = $arec;\n        $lastIndex = count($apubs_final) - 1; // Get the index of the last inserted item.\n        $seenSpubids[$arec['spubid']] = $lastIndex;\n        unset($apubs_final[$lastIndex]['sfirst'], $apubs_final[$lastIndex]['smi'], $apubs_final[$lastIndex]['slast']);\n    } else {\n        // Append author data to the existing record.\n        $index = $seenSpubids[$arec['spubid']];\n        $nextAuthorNumber = count($apubs_final[$index]) - 3 + 1; // Calculate next author number based on current entries.\n\n        $apubs_final[$index]['sfirst' . $nextAuthorNumber] = $arec['sfirst'];\n        $apubs_final[$index]['smi'    . $nextAuthorNumber] = $arec['smi'];\n        $apubs_final[$index]['slast'  . $nextAuthorNumber] = $arec['slast'];\n    }\n}