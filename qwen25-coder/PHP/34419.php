function writeToFileWithLock($filename, $data) {\n    $lockDir = "/var/tmp/{$filename}.lock";\n    \n    // Try to create lock directory\n    while (!mkdir($lockDir)) {\n        usleep(1000); // Sleep for 1 ms before trying again\n    }\n    \n    try {\n        // Open the file that needs to be written to\n        $fileHandle = fopen($filename, 'a');\n        \n        if ($fileHandle === false) {\n            throw new Exception("Failed to open file: $filename");\n        }\n        \n        fwrite($fileHandle, $data);\n        fclose($fileHandle);\n    } catch (Exception $e) {\n        error_log($e->getMessage());\n    } finally {\n        // Remove the lock directory\n        rmdir($lockDir);\n    }\n}\n\n// Example usage:\n$logfile = "/path/to/your/logfile.log";\n$logData = "Log entry: " . date("Y-m-d H:i:s") . "\n";\nwriteToFileWithLock($logfile, $logData);