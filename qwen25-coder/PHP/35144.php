use Cake\Utility\Set;\n\nfunction getLeafNodesWithCakePHPSet($nodes) {\n    $flatten = Set::extract('/Category[Child.=[]]/', $nodes);\n    foreach ($flatten as $key => $value) {\n        $flatten[$value['id']] = $value['name'];\n    }\n    unset($flatten[array_keys($flatten)[0]]);\n    return $flatten;\n}\n\n// Assuming $nodes is defined as in the above example:\n$leafNodesWithSet = getLeafNodesWithCakePHPSet($nodes);\nprint_r($leafNodesWithSet);