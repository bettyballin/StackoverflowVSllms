function safeOutput($data, $encoding = 'UTF-8', $quotes = ENT_QUOTES) {\n    // Convert special characters to HTML entities\n    $safeData = htmlspecialchars($data, $quotes, $encoding);\n    \n    // Further encoding if needed based on context (e.g., JSON)\n    if (headers_sent() && stripos(end(headers_list()), 'Content-Type: application/json') !== false) {\n        return json_encode($safeData);\n    }\n    \n    return $safeData;\n}