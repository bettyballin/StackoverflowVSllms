function treemenu($generat=0) {\n    global $pagenum, $menu, $selected, $extension, $set;\n    $count = 0;\n    $out = "\n";\n    $intend = 0;\n\n    while ($menu[$count][0] != "") {\n        if (strpos($menu[$count][3], "#") === false) {\n            // Close previous level 2 ul if necessary\n            if ($menu[$count][1] == "0" && $intend == 2) {\n                $out .= "</ul>\n";\n                $intend--;\n            }\n\n            // Open level 1 ul if necessary\n            if ($menu[$count][1] != "0" && $intend < 1) {\n                $intend = 1;\n                $out .= "<ul>\n";\n            }\n\n            $out .= "<li class=\"LNE_menu\">";\n\n            $out .= "<a ";\n            if ($menu[$count][4] == $selected['name']) {\n                $out .= 'class="selected" ';\n            }\n            if (strpos($menu[$count][3], "*")) {\n                $out .= 'href="' . str_replace("*", "", $menu[$count][3]) . '">';\n            } elseif ($generat) {\n                $out .= 'href="' . $menu[$count][3] . "." . $set['extension'] . '">';\n            } else {\n                $out .= 'href="' . $set['indexfile'] . '?page=' . $menu[$count][3] . '">';\n            }\n            $out .= $menu[$count][4] . "</a>";\n\n            // Check if current item has submenus\n            if ($menu[$count+1][1] != "0") {\n                $intend = 2;\n                $out .= "<ul>\n";\n            }\n\n        } else {\n            if ($intend > 0) {\n                for ($i = $intend; $i > 0; $i--) {\n                    $out .= "</ul>\n</li>\n";\n                }\n                $intend = 0;\n            }\n        }\n\n        // Close level 1 li if there are no submenus\n        if ($menu[$count][2] == "0" && $intend == 1) {\n            $out .= "</li>\n";\n            $intend--;\n        }\n\n        $count++;\n    }\n\n    // Ensure all unclosed tags are closed\n    for ($i = $intend; $i > 0; $i--) {\n        $out .= "</ul>\n</li>\n";\n    }\n\n    return $out;\n}