<?php\n\nfunction authenticateAndFetchData($server, $username, $password) {\n    // Step 1: Initialize cURL session\n    $ch = curl_init();\n\n    // Set initial options for login request\n    curl_setopt($ch, CURLOPT_URL, "https://$server/exchweb/bin/auth/owaauth.dll");\n    curl_setopt($ch, CURLOPT_POST, true);\n    curl_setopt($ch, CURLOPT_POSTFIELDS, http_build_query([\n        'destination' => '/exchange',\n        'flags' => 4,\n        'forcedownlevel' => 0,\n        'trusted' => 0,\n        'frmlogintype' => 1,\n        'username' => $username,\n        'password' => $password\n    ]));\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    curl_setopt($ch, CURLOPT_COOKIEJAR, 'cookie.txt'); // Save cookies to a file\n    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, true);  // Allow redirects\n\n    // Execute login request\n    $result = curl_exec($ch);\n    if (curl_errno($ch)) {\n        echo 'Error:' . curl_error($ch);\n        return;\n    }\n\n    // Step 2: Check if login was successful by verifying the URL\n    if (strpos(curl_getinfo($ch, CURLINFO_EFFECTIVE_URL), '/exchange') === false) {\n        die('Authentication failed. Please check your credentials.');\n    }\n\n    // Step 3: Now we can send WebDAV request using the same session\n    curl_setopt_array($ch, array(\n        CURLOPT_HTTPHEADER => array("Depth: 1"),\n        CURLOPT_POSTREDIR => 3,\n        CURLOPT_URL => "https://$server/exchange/$username"\n    ));\n\n    $response = curl_exec($ch);\n    if (curl_errno($ch)) {\n        echo 'Error:' . curl_error($ch);\n        return;\n    }\n    // Output response\n    echo htmlspecialchars_decode($response);\n\n    // Close the cURL session\n    curl_close($ch);\n}\n\n// Usage example\nauthenticateAndFetchData('your_exchange_server.com', 'your_email@example.com', 'your_password');\n\n?>