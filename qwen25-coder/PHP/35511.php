<?php\n$textval = "This is some text to be an image\nThis is another line\nAnd yet another one";\n$colors = array('666666', 'FF0000', '00FF00'); // Array of colors for each line\n$font = "arial.ttf";\n$size = 9;\n$padding = 1;\n$bgcolor = "ffffff";\n\n$fontfile = $fontpath . $font; // Ensure this path is correct\n\n// Split text into lines and prepare dimensions for image\n$lines = explode("\n", $textval);\n$totalHeight = 0;\n$maxWidth = 0;\n\nforeach ($lines as $line) {\n    $box = imageftbbox($size, 0, $fontfile, $line, array());\n    $totalHeight += abs($box[3]) + abs($box[5]);\n    $maxWidth = max($maxWidth, $box[4] - $box[6] + ($padding * 2) + 1);\n}\n\n$totalHeight += ($padding * (count($lines) + 1)) + 0; // Extra padding for lines\n\n// Create the image\n$png = imagecreate($maxWidth, $totalHeight);\n\n// Allocate background color\n$color = str_replace("#", "", $bgcolor);\n$red = hexdec(substr($bgcolor, 0, 2));\n$green = hexdec(substr($bgcolor, 2, 2));\n$blue = hexdec(substr($bgcolor, 4, 2));\n$bg = imagecolorallocate($png, $red, $green, $blue);\n\n// Image initialization\n$textx = $padding;\n$texty = $padding;\n\nforeach ($lines as $index => $line) {\n    // Allocate text color for current line\n    $currentColorIndex = min($index, count($colors) - 1); // Cycle through colors if more lines than colors\n    $colorStr = $colors[$currentColorIndex];\n    $red = hexdec(substr($colorStr, 0, 2));\n    $green = hexdec(substr($colorStr, 2, 2));\n    $blue = hexdec(substr($colorStr, 4, 2));\n    $tx = imagecolorallocate($png, $red, $green, $blue);\n\n    // Draw text\n    imagettftext($png, $size, 0, $textx, $texty, $tx, $fontfile, trim($line));\n\n    // Update y position for next line\n    $box = imageftbbox($size, 0, $fontfile, $line, array());\n    $texty += abs($box[3]) + abs($box[5]) + $padding;\n}\n\nheader("content-type: image/png");\nimagepng($png);\nimagedestroy($png);\nexit;\n?>