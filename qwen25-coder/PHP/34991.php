<?php\n\n// Set headers to prevent compression or buffering issues\nheader('Content-Encoding: None');\nheader('Content-Length: ' . strlen("We'll email you as soon as this is done."));\nheader('Connection: Close');\n\necho "We'll email you as soon as this is done.";\nflush();\nob_flush();\n\n// Unset the output buffer, close connection, and continue processing\nif (function_exists("fastcgi_finish_request")) {\n    fastcgi_finish_request();\n} else {\n    if (PHP_SAPI == 'cli-server') {\n        ignore_user_abort(true);\n        ob_end_clean();\n        header('Content-Encoding: none');\n        header('Connection: close');\n        flush();\n    } else {\n        fclose(fopen('/dev/null', 'w')); // For other servers, you can try closing the output stream\n    }\n}\n\n// Do some stuff that will take a while\nmail('dude@thatplace.com', "okay I'm done", 'Yup, all done.');\n\n?>