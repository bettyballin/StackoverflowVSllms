<?php\nfunction checkEmail($email) {\n    $list = explode("@", $email);\n    $domain = array_pop($list);\n\n    $mxHosts = [];\n    if (checkdnsrr($domain, 'MX', $mxRecord)) {\n        $mxHosts = array_map('trim', explode(',', $mxRecord));\n        shuffle($mxHosts); // Randomize the MX records\n    } else {\n        // Fallback to A record if no MX is found\n        if (!checkdnsrr($domain, 'A', $aRecord)) {\n            return false;\n        }\n        $mxHosts = [$domain];\n    }\n\n    foreach ($mxHosts as $host) {\n        $sock = fsockopen($host, 25, $errno, $errstr, 10);\n        if (!$sock) continue; // Try next host\n\n        stream_set_timeout($sock, 10);\n\n        if (preg_match("/^220/", fgets($sock))) {\n            fputs($sock, "HELO example.com\r\n");\n            if (!preg_match("/^250/", fgets($sock))) break;\n\n            fputs($sock, "MAIL FROM: <nobody@$domain>\r\n");\n            if (!preg_match("/^250/", fgets($sock))) break;\n\n            fputs($sock, "RCPT TO: <$email>\r\n");\n            $result = fgets($sock);\n\n            fputs($sock, "QUIT\r\n");\n            fclose($sock);\n\n            // If code contains 250, address is valid\n            return strpos($result, '250') !== false;\n        }\n    }\n\n    return false; // No server found or no response\n}\n\n$email = "test@example.com";\nif (checkEmail($email)) {\n    echo "$email exists.";\n} else {\n    echo "$email does not exist.";\n}\n?>