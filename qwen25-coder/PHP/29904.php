ini_set("memory_limit", "30M");\n\nif(isset($_POST['submit'])) {\n    if (isset ($_FILES['new_image']) && $_FILES['new_image']['error'] === UPLOAD_ERR_OK) {\n        $imagename = $_FILES['new_image']['name'];\n        $source = $_FILES['new_image']['tmp_name'];\n        $target = "images/" . basename($imagename);\n\n        // Move the uploaded file to its new location\n        if (move_uploaded_file($source, $target)) {\n            $imagepath = $imagename;\n            $save = "thumbs/uploads/" . $imagepath; // New thumbnail saved here\n            $file = $target; // Original file path\n\n            $imagesize = getimagesize($file);\n            list($width, $height) = $imagesize;\n\n            if ($width > $height) {\n                $modwidth = 150;\n                $diff = $width / $modwidth;\n                $modheight = $height / $diff;\n            } else {\n                $modheight = 150;\n                $diff = $height / $modheight;\n                $modwidth = $width / $diff;\n            }\n\n            // Create a true color image\n            $tn = imagecreatetruecolor($modwidth, $modheight);\n            $image = imagecreatefromjpeg($file);\n\n            if ($tn && $image) {\n                imagecopyresampled($tn, $image, 0, 0, 0, 0, $modwidth, $modheight, $width, $height);\n\n                // Save the thumbnail\n                imagejpeg($tn, $save, 100);\n\n                // Free up memory\n                imagedestroy($image);\n                imagedestroy($tn);\n            } else {\n                echo "Failed to create an image resource";\n            }\n        } else {\n            echo "File upload failed: " . $_FILES['new_image']['error'];\n        }\n    } else {\n        echo "No file uploaded or error in uploading.";\n    }\n}