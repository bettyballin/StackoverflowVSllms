<?php\n// Start output buffering to prevent any accidental output\nob_start();\n\n$email = $_POST['email'];\n$username = $_POST['username'];\n$password = $_POST['password']; // Use 'password' instead of 'passhash_md5'\n\n// COOKIE setting\n$login_cookie = md5(\n    $username .\n    $password .\n    $email .\n    $_SERVER['REMOTE_ADDR']\n);\n\nsetcookie("login", $login_cookie, time() + (86400 * 30)); // 86400 = 1 day\n\n// Connect to your database\n$dbconn = pg_connect("host=localhost dbname=yourdb user=youruser password=yourpassword");\n\nif (!$dbconn) {\n    die('Connection failed: ' . pg_last_error($dbconn));\n}\n\n$sql2 = "SELECT * FROM users WHERE username = $1 AND email = $2";\n$result = pg_prepare($dbconn, "query", $sql2);\n$result = pg_execute($dbconn, "query", array($username, $email));\n\nif ($result) {\n    $userRow = pg_fetch_assoc($result);\n    if ($userRow && md5($password) == $userRow['passhash_md5']) { // Ensure you compare against the hashed password stored\n        setcookie("login", $login_cookie, time() + (86400 * 30)); \n        header("Location: index.php");\n        ob_end_flush();\n        exit();\n    } else {\n        echo "wrong username/password";\n    }\n} else {\n    echo 'An error occurred: ' . pg_last_error($dbconn);\n}\n\npg_close($dbconn);\n\n// If reached here, redirect to login again or show an error\nheader("Location: index.php");\nob_end_flush();\nexit();\n?>