<?php\nsession_start();\n\n// Start by regenerating the session ID when someone logs in\nif (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true) {\n    if ($_SERVER['REQUEST_METHOD'] === 'POST') { // Assume this is your login form submission\n        $username = $_POST['username'];\n        $password = $_POST['password'];\n\n        // Check username and password against your database securely\n        if (authenticateUser($username, $password)) {\n            session_regenerate_id(true); // Regenerate Session ID\n            $_SESSION['user'] = $username;\n            $_SESSION['logged_in'] = true;\n            $_SESSION['last_activity'] = time(); // Record the last activity time\n        } else {\n            die("Invalid Credentials");\n        }\n    }\n} else {\n    // Check if session is too old, logout if so.\n    if (isset($_SESSION['last_activity']) && (time() - $_SESSION['last_activity'] > 1800)) { // 30 minutes\n        session_unset();\n        session_destroy();\n        header("Location: login.php");\n        exit;\n    }\n}\n\n// Check that the user is properly logged in before displaying protected content\nif (!isset($_SESSION['logged_in']) || $_SESSION['logged_in'] !== true) {\n    header("Location: login.php");\n    exit;\n}\n\necho "Welcome, " . htmlspecialchars($_SESSION['user']) . "! This is a protected page.";\n?>