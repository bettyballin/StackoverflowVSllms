<?php\n// Assuming $conn is your mysqli connection object\n\ntry {\n    // Start a transaction\n    $conn->autocommit(FALSE);\n\n    // Insert into profiles table and get the last insert id\n    $profileQuery = "INSERT INTO profiles (column1, column2) VALUES ('value1', 'value2')";\n    if ($conn->query($profileQuery)) {\n        $profileId = $conn->insert_id; // Get the last inserted ID from profiles\n\n        // Insert into users table using the obtained profile id\n        $userQuery = "INSERT INTO users (username, email, profile_id) VALUES ('newuser', 'email@example.com', '$profileId')";\n        if ($conn->query($userQuery)) {\n            // Commit the transaction\n            $conn->commit();\n            echo "User and Profile created successfully!";\n        } else {\n            // Rollback in case of error during user insertion\n            throw new Exception("Error inserting user: " . $conn->error);\n        }\n    } else {\n        // Rollback in case of error during profile insertion\n        throw new Exception("Error inserting profile: " . $conn->error);\n    }\n\n} catch (Exception $e) {\n    // Handle any errors and rollback transaction\n    echo 'ERROR: ' . $e->getMessage();\n    $conn->rollback();\n}\n\n// Autocommit back to default state\n$conn->autocommit(TRUE);\n\n?>