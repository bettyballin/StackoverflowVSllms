function capitalizeName($name) {\n    // Convert the name to lowercase first\n    $name = mb_strtolower($name);\n    \n    // List of words not to be capitalized after the first word\n    $smallWords = ['and', 'the', 'of', 'in'];\n\n    // Split the name into words\n    $words = explode(' ', $name);\n\n    // Capitalize each word except small words (unless they are the first or last)\n    foreach ($words as $key => &$word) {\n        // Check if it is a compound surname with Mc, Mac, O', etc.\n        if (preg_match('/^(mac|mc|o[\'-]|ap|van de|de la|von)/i', $word)) {\n            // Capitalize only the first letter after 'Mc', 'Mac', 'O'', etc.\n            $parts = preg_split('/(m(c?)|[\'-])/', $word, 2, PREG_SPLIT_DELIM_CAPTURE);\n            foreach ($parts as &$part) {\n                if (mb_strlen($part) > 1) {\n                    $part = mb_convert_case($part, MB_CASE_TITLE, 'UTF-8');\n                }\n            }\n            $word = implode('', $parts);\n        } else {\n            // Capitalize the word normally unless it's a small word not in first/last position\n            if (!in_array($word, $smallWords) || $key === 0 || ($key + 1) === count($words)) {\n                $word = mb_convert_case($word, MB_CASE_TITLE, 'UTF-8');\n            }\n        }\n    }\n\n    return implode(' ', $words);\n}\n\n// Example usage\necho capitalizeName("MCDONALD"), "\n"; // McDonald\necho capitalizeName("FITZGERALD"), "\n"; // Fitzgerald\necho capitalizeName("O'LUNNEY'S"), "\n"; // O'Lunney's\necho capitalizeName("THEO DE RAADT"), "\n"; // Theo de Raadt\necho capitalizeName("MACARTHUR"), "\n"; // MacArthur