<?php\nif (isset($_GET["cmd"]))\n    $cmd = $_GET["cmd"];\nelse\n    die("You should have a 'cmd' parameter in your URL");\n\n$query = '';\nif (isset($_GET["query"])) {\n    $query = trim($_GET["query"]);\n}\n$pg = isset($_GET["pg"]) ? intval($_GET["pg"]) : 1;\n\necho "test connection<p>";\n\ntry {\n    $pdo = new PDO("mysql:host=localhost;dbname=database;charset=utf8", "user", "password");\n} catch (PDOException $e) {\n    die('Connection failed: ' . $e->getMessage());\n}\n\nif ($cmd == "GetRecordSet") {\n    echo "test in loop<p>";\n    $table = 'SaleS';\n    $page_rows = 10;\n    $offset = ($pg - 1) * $page_rows;\n\n    $rows = getRowsByProductSearch($pdo, $query, $table, $offset, $page_rows);\n\n    echo "test after query<p>";\n    $numRows = count($rows);\n    if ($numRows == 0) {\n        echo 'No results found.<p>';\n    } else {\n        $totalRecordsQuery = $pdo->prepare("SELECT COUNT(*) FROM {$table} WHERE upper(Product_NAME) LIKE ?");\n        $searchTerm = '%' . strtoupper($query) . '%';\n        $totalRecordsQuery->execute([$searchTerm]);\n        $totalRows = $totalRecordsQuery->fetchColumn();\n        $lastPage = ceil($totalRows / $page_rows);\n\n        if ($pg < 1) {\n            $pg = 1;\n        } elseif ($pg > $lastPage) {\n            $pg = $lastPage;\n        }\n\n        echo 'html stuff <p>';\n\n        foreach ($rows as $row) {\n            echo "test foreach <p>";\n            $pk = htmlspecialchars($row['Product_NO']);\n            echo '<tr>' . "\n";\n            echo '<td><a href="#" onclick="updateByPk(\'Layer2\', \'' . $pk . '\')">' . htmlspecialchars($row['USERNAME']) . '</a></td>' . "\n";\n            echo '<td><a href="#" onclick="updateByPk(\'Layer2\', \'' . $pk . '\')">' . htmlspecialchars($row['shortDate']) . '</a></td>' . "\n";\n            echo '<td><a href="#" onclick="updateByPk(\'Layer2\', \'' . $pk . '\')">' . htmlspecialchars($row['Product_NAME']) . '</a></td>' . "\n";\n            echo '</tr>' . "\n";\n        }\n\n        if ($pg == 1) {\n        } else {\n            echo " <a href='{$_SERVER['PHP_SELF']}?cmd=GetRecordSet&query=" . urlencode($query) . "&pg=1'> <<-First</a> ";\n            $previous = $pg - 1;\n            echo " <a href='{$_SERVER['PHP_SELF']}?cmd=GetRecordSet&query=" . urlencode($query) . "&pg=" . $previous . "'> < Previous</a> ";\n        }\n\n        if ($pg != $lastPage && $numRows > 0) {\n            $next = $pg + 1;\n            echo " <a href='{$_SERVER['PHP_SELF']}?cmd=GetRecordSet&query=" . urlencode($query) . "&pg=" . $next . "'>Next ></a> ";\n            echo " <a href='{$_SERVER['PHP_SELF']}?cmd=GetRecordSet&query=" . urlencode($query) . "&pg=$lastPage'>Last >></a> ";\n        }\n    }\n}\n\nfunction getRowsByProductSearch(PDO $pdo, $searchTerm, $table, $offset, $limit): array {\n    $searchTerm = '%' . strtoupper($searchTerm) . '%';\n    $stmt = $pdo->prepare("SELECT * FROM {$table} WHERE upper(Product_NAME) LIKE ? LIMIT :limit OFFSET :offset");\n    $stmt->bindValue(':limit', (int)$limit, PDO::PARAM_INT);\n    $stmt->bindValue(':offset', (int)$offset, PDO::PARAM_INT);\n    $stmt->execute([$searchTerm]);\n\n    return $stmt->fetchAll(PDO::FETCH_ASSOC);\n}\n?>