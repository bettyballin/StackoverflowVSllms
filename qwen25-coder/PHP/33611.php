$mh = curl_multi_init();\n\n$handles = [];\nwhile ($dbo = pg_fetch_object($dbres)) {\n    $ch = curl_init();\n    curls_setopt($ch, CURLOPT_URL, $dbo->url);\n    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\n    \n    // Store the cURL handle along with any useful data\n    $handles[(string)$ch] = [\n        'handle' => $ch,\n        'record' => $dbo,\n    ];\n    \n    curl_multi_add_handle($mh, $ch);\n}\n\n$active = null;\ndo {\n    $mrc = curl_multi_exec($mh, $active);\n} while ($mrc == CURLM_CALL_MULTI_PERFORM);\n\nwhile ($active && $mrc == CURLM_OK) {\n    if (curl_multi_select($mh) != -1) {\n        do {\n            $mrc = curl_multi_exec($mh, $active);\n        } while ($mrc == CURLM_CALL_MULTI_PERFORM);\n    }\n}\n\nforeach ($handles as $info) {\n    $ch = $info['handle'];\n    $dbo = $info['record'];\n    \n    $response = curl_multi_getcontent($ch);\n    $http_code = intval(curl_getinfo($ch, CURLINFO_HTTP_CODE));\n    \n    // Do checks on $http_code and update db\n    // ...\n\n    curl_multi_remove_handle($mh, $ch);\n}\n\ncurl_multi_close($mh);\n\nforeach ($handles as $info) {\n    curl_close($info['handle']);\n}