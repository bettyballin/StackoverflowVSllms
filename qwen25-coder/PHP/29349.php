<?php\n\nfunction getFinalUrlWithHeaders($url) {\n    $headers = get_headers($url, 1);\n    \n    // Check if URL has been redirected\n    if (strpos($headers[0], '301') !== false || strpos($headers[0], '302') !== false) {\n        while (preg_match('#Location: (.*)#i', array_pop($headers), $match)) {\n            $url = trim(array_pop($match));\n            $headers = get_headers($url, 1);\n        }\n    }\n\n    return $url;\n}\n\n$url = 'http://foo.com';\necho getFinalUrlWithHeaders($url);\n\n?>