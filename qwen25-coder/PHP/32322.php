<?php\n$productName = 'DELL';\n$targetQuantity = 35;\n\n// Prepare the query part that fetches data\n$stmt = $conn->prepare("\n    SELECT `price`, `quantity` \n    FROM (\n        SELECT `price`, `quantity` \n        FROM `quantity` \n        WHERE `product_name` = ? \n        ORDER BY `date` DESC, `position`\n    ) AS `Actions` \n    GROUP BY `price`\n");\n$stmt->bind_param("s", $productName);\n$stmt->execute();\n$result = $stmt->get_result();\n\n// Rest of the PHP code remains mostly as before\n// ...\n\n// For updating records safe way using prepared statement\n$updateStmt = $conn->prepare("\n    UPDATE `quantity` \n    SET `quantity` = ? \n    WHERE `product_name` = ? AND `price` = ?\n    LIMIT 1\n");\n\nforeach ($updates as $update) {\n    $newQuantity = $update['new_quantity'];\n    $price = $update['price'];\n    $updateStmt->bind_param("isi", $newQuantity, $productName, $price);\n    $updateStmt->execute();\n}\n\n// Close the statements and connection\n$updateStmt->close();\n$stmt->close();\nmysqli_close($conn);\n?>