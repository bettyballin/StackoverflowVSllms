<?php\n\nfunction addFileToTar($tar, $filePath, $localName = null)\n{\n    if (is_null($localName)) {\n        $localName = basename($filePath);\n    }\n    \n    $fileStat = stat($filePath);\n    $header = pack('a100a8a8a8a12A12', \n                    $localName,\n                    sprintf("%6s", decoct($fileStat['size'])), // file size\n                    sprintf("%6s ", decoct($fileStat['mode'])),  // mode\n                    sprintf("%6s ", decoct($fileStat['uid'])),   // owner id\n                    sprintf("%6s ", decoct($fileStat['gid'])),   // group id\n                    str_pad('', 12, "\0", STR_PAD_RIGHT));     // checksum\n\n    $header = substr_replace($header, pack('a8', sprintf("%6s ", decoct(crc32(substr($header, 0, 148)) & 0xffff))), 148, 8);\n    \n    fputs($tar, $header);\n    if ($fileStat['size'] > 0) {\n        $fstream = fopen($filePath, 'r');\n        while (!feof($fstream)) {\n            $buffer = fread($fstream, 512);\n            fwrite($tar, $buffer);\n            if (strlen($buffer) < 512) {\n                // Pad the remainder of the block to write\n                fwrite($tar, str_pad('', (512 - strlen($buffer)), "\0", STR_PAD_RIGHT));\n            }\n        }\n        fclose($fstream);\n    } else {\n        fwrite($tar, str_repeat("\0", 512)); // Write zero-content size file's empty data block \n    }\n}\n\nfunction createTarArchive($directoryToBackup, $outputFile)\n{\n    if (!is_dir($directoryToBackup)) {\n        throw new Exception("Directory does not exist.");\n    }\n\n    // Open the output for writing\n    $tar = fopen($outputFile, 'wb');\n\n    // Add all files in directory to tar\n    $files = scandir($directoryToBackup);\n    foreach ($files as $file) {\n        if (($file !== '.') && ($file !== '..')) {  // Skip . and ..\n            $filePath = $directoryToBackup.'/'.$file;\n            addFileToTar($tar, $filePath, './'.$file); // Local file name (relative path)\n        }\n    }\n\n    // End of the TAR archive is marked with two null blocks\n    fwrite($tar, str_repeat("\0", 1024));\n    \n    fclose($tar);\n}\n\n// Usage example:\ntry {\n    createTarArchive('/path/to/directory', '/path/to/output.tar');\n} catch (Exception $e) {\n    echo 'Error: ',  $e->getMessage();\n}