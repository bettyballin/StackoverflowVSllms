require_once __DIR__ . '/vendor/autoload.php';\n\nuse PhpAmqpLib\Connection\AMQPStreamConnection;\nuse Swift_Mailer;\nuse Swift_Message;\nuse Swift_SmtpTransport;\n\n$connection = new AMQPStreamConnection('localhost', 5672, 'guest', 'guest');\n$channel = $connection->channel();\n\n$channel->queue_declare('email_queue', false, true, false, false);\n\necho " [*] Waiting for messages. To exit press CTRL+C\n";\n\n$callback = function ($msg) {\n    $data = json_decode($msg->body);\n    \n    // Setup SwiftMailer\n    $transport = (new Swift_SmtpTransport('smtp.example.com', 25))\n        ->setUsername('your_username')\n        ->setPassword('your_password');\n\n    $mailer = new Swift_Mailer($transport);\n\n    $message = (new Swift_Message($data->subject))\n        ->setFrom(['from@example.com' => 'Sender Name'])\n        ->setTo($data->recipient)\n        ->setBody($data->body, 'text/plain');\n\n    // Send the message\n    $result = $mailer->send($message);\n    \n    echo " [x] Sent ", $msg->body, "\n";\n\n    // Acknowledge message\n    $msg->delivery_info['channel']->basic_ack($msg->delivery_info['delivery_tag']);\n};\n\n$channel->basic_qos(null, 1, null);\n$channel->basic_consume('email_queue', '', false, false, false, false, $callback);\n\nwhile ($channel->is_consuming()) {\n    $channel->wait();\n}\n\n$channel->close();\n$connection->close();