// Enable error reporting for debugging\nerror_reporting(E_ALL);\nini_set('display_errors', 1);\n\nset_time_limit(120); // Set time limit to 120 seconds\nini_set('max_input_time', 120); // Set max input processing time\nini_set('memory_limit', '512M'); // Increase memory limit if necessary\n\n$numberImages = count($_FILES['galFile']['name']) - 1;\n\nfor ($i = 1; $i <= $numberImages; $i++) {\n    $imageName = $_FILES['galFile']['name'][$i];\n    $imageType = $_FILES['galFile']['type'][$i];\n    $imageSize = $_FILES['galFile']['size'][$i];\n    $imageTemp = $_FILES['galFile']['tmp_name'][$i];\n    $imageError = $_FILES['galFile']['error'][$i];\n\n    // Ensure it is an image\n    if (in_array(end(explode(".", $imageName)), $allowed)) {\n        // Where to upload image to\n        $uploadFile = $uploadDir . $imageName;\n        if (file_exists($uploadFile)) {\n            // Append random number to the end if file already exists\n            $front = explode(".", $imageName);\n            $randomNum = rand(1, 100);\n            $front[0] = $front[0] . $randomNum;\n            $imageName = implode(".", $front);\n            $uploadFile = $uploadDir . $imageName;\n        }\n        if (move_uploaded_file($imageTemp, $uploadFile)) {\n            // Insert image name into the database\n            $query = "INSERT INTO galleryImages VALUES(\"0\",\"$lastInsert\",\"" . mysqli_real_escape_string($db, $imageName) . "\",\"$i\")";\n            mysqli_query($db, $query) or die(mysqli_error($db)); // Use mysqli and check for errors\n            reSizePic($uploadFile);\n        }\n    }\n}\n\n// Flush the output buffer\nob_end_flush();\necho "Image processing complete.";\nexit;