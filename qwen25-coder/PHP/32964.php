function insert_new_comment() {\n    check_ajax_referer('add_comment', 'security');\n\n    if (!is_user_logged_in()) {\n        wp_send_json_error(array('message' => 'You must be logged in to comment.'));\n    }\n\n    $comment = sanitize_text_field($_POST['comment']);\n    $post_id = intval($_POST['post_id']);\n    $user = get_current_user_id();\n\n    $new_comment = array(\n        'comment_post_ID'      => $post_id,\n        'comment_author'       => wp_get_current_user()->display_name,\n        'comment_author_email' => wp_get_current_user()->user_email,\n        'comment_author_url'   => '',\n        'comment_content'      => $comment,\n        'comment_approved'     => 1, // or use a moderation system\n    );\n\n    $result = wp_insert_comment($new_comment);\n\n    if ($result) {\n        $data = array('message' => 'Comment added successfully', 'id' => $result);\n        wp_send_json_success($data);\n    } else {\n        wp_send_json_error(array('message' => 'Failed to add comment.'));\n    }\n}\n\nadd_action('wp_ajax_insert_new_comment', 'insert_new_comment');\nadd_action('wp_ajax_nopriv_insert_new_comment', 'insert_new_comment');  // Allow for guests