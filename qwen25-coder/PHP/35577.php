// app/Controller/ReferralsController.php\n\npublic function add() {\n    if ($this->request->is('post')) {\n        $data = $this->request->data;\n        \n        // Reformat the friend data for correct association\n        foreach ($data['Friend'] as &$friend) {\n            if (empty($friend['friendName']) || empty($friend['friendEmail'])) {\n                unset($friend);\n                continue;\n            }\n            $friend['friendName'] = $friend['friendName'];\n            $friend['friendEmail'] = $friend['friendEmail'];\n        }\n\n        if ($this->Referral->saveAssociated($data)) {\n            $this->Session->setFlash('Success!', 'default', array(), 'success');\n            $this->redirect(array('action' => 'index'));\n        } else {\n            $this->Session->setFlash('Failed to save data. Please correct the errors.', 'default', array(), 'error'); // Display error messages\n        }\n    }\n}