<?php\nsession_start();\n\nif(!isset($_POST['username']) && !isset($_POST['password'])) {\n    // Visitor needs to enter a name and password\n?>\n<h1>Please Log In</h1>\nThis page is secret.\n<form method="post" action="<?php echo htmlspecialchars($_SERVER['PHP_SELF']); ?>">\n<table border="1">\n<tr>\n  <th> Username </th>\n  <td> <input type="text" name="username"> </td>\n</tr>\n<tr>\n  <th> Password </th>\n  <td> <input type="password" name="password"> </td>\n</tr>\n<tr>\n  <td colspan="2" align="center">\n    <input type="submit" value="Log In">\n  </td>\n</tr>\n</table>\n</form>\n<?php\n} else {\n    // connect to mysql\n    include('../cgi-bin/db.php');\n\n    $username = $_POST['username'];\n    $password = md5($_POST['password']); // Still using MD5 for compatibility, but consider changing\n\n    if(!$db) {\n        echo 'Cannot connect to database.';\n        exit;\n    }\n\n    // select the appropriate database\n    $mysql = mysql_select_db('quickwebcms', $db);\n    if(!$mysql) {\n        echo 'Cannot select database.';\n        exit;\n    }\n\n    // query the database to see if there is a record which matches\n    $query = "SELECT count(*) FROM auth WHERE username = '" . mysql_real_escape_string($username) . "' AND password = '$password'";\n    $result = mysql_query($query, $db);\n    if(!$result) {\n        echo 'Cannot run query.';\n        exit;\n    }\n\n    $count = mysql_result($result, 0, 0);\n\n    if ($count > 0 ) {\n        // visitor's name and password combination are correct\n        $_SESSION['logged_in'] = true;\n        echo '<h1>Here it is!</h1>';\n        echo 'I bet you are glad you can see this secret page.';\n    } else {\n        // visitor's name and password combination are not correct\n        echo '<h1>Go Away!</h1>';\n        echo 'You are not authorized to view this resource.';\n    }\n}\n?>