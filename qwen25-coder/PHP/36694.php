<?php\nsession_start();\nrequire_once 'path/to/facebook-sdk-v5/autoload.php'; // Include the Facebook SDK\n\n$fb = new Facebook\Facebook([\n  'app_id' => '{your-app-id}',\n  'app_secret' => '{your-app-secret}',\n  'default_graph_version' => 'v12.0',\n]);\n\n$helper = $fb->getRedirectLoginHelper();\n\ntry {\n  $accessToken = $helper->getAccessToken();\n} catch(Facebook\Exceptions\FacebookResponseException $e) {\n  echo 'Graph returned an error: ' . $e->getMessage();\n  exit;\n} catch(Facebook\Exceptions\FacebookSDKException $e) {\n  echo 'Facebook SDK returned an error: ' . $e->getMessage();\n  exit;\n}\n\nif (! isset($accessToken)) {\n  if ($helper->getError()) {\n    header('HTTP/1.0 401 Unauthorized');\n    echo "Error: " . $helper->getErrorDescription();\n    echo "\nType: " . $helper->getErrorType();\n    echo "\nCode: " . $helper->getErrorCode();\n    exit;\n  } else {\n    // Generate a URL for app redirection\n    header('Location: ' . $helper->getLoginUrl('{callback-url}', ['email']));\n    exit;\n  }\n}\n\n// Logged in\ntry {\n  // Returns a `Facebook\FacebookResponse` object\n  $response = $fb->get('/me?fields=id,name,email', $accessToken);\n} catch(Facebook\Exceptions\FacebookResponseException $e) {\n  echo 'Graph returned an error: ' . $e->getMessage();\n  exit;\n} catch(Facebook\Exceptions\FacebookSDKException $e) {\n  echo 'Facebook SDK returned an error: ' . $e->getMessage();\n  exit;\n}\n\n$user = $response->getGraphUser();\n\n// Store the Facebook User ID in database\n$fbId = $user['id'];\n$db = new mysqli('your_host', 'your_username', 'your_password', 'your_dbname');\n\nif ($db->connect_error) {\n    die("Connection failed: " . $db->connect_error);\n}\n\n$sql = "INSERT INTO users (facebook_id, name, email) VALUES ('$fbId', '" . $user['name'] . "', '" . $user['email'] . "') ON DUPLICATE KEY UPDATE facebook_id = values(facebook_id)";\n$db->query($sql);\n\n// Set session variables and log user in\n$_SESSION['user_id'] = $fbId;\nheader('Location: {dashboard-or-homepage-url}');\nexit();\n?>