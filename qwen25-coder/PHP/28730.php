function IsPrime($num) {\n    global $primesto, $primes;\n\n    if ($primesto >= $num)\n        return isset($primes[$num]);\n\n    $root = (int) sqrt($num);\n    if ($primesto < $root)\n        CalcPrimesTo($root);\n\n    // Use foreach to avoid altering the array pointer\n    foreach ($primes as $p) {\n        if ($num % $p == 0)\n            return false;\n\n        if ($p >= $root)\n            break;\n    }\n\n    return true;\n}