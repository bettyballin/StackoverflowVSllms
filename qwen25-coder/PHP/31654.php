<?php\n// Define the chunk size\n$chunkSize = 1000;\n$allCategories = [];\n\nfor ($offset = 0; $offset < 500000; $offset += $chunkSize) {\n    // Load categories from the database in chunks and store them in an associative array\n    $query = "SELECT category, id FROM categories WHERE procId='$procId' LIMIT $chunkSize OFFSET $offset";\n    $result = mysqli_query($conn, $query);\n    \n    while ($row = mysqli_fetch_assoc($result)) {\n        $allCategories[$row['category']] = $row['id'];\n    }\n\n    // Process the records in the current chunk\n    for ($i = 0; $i < $chunkSize && ($line = fgets($fileHandle)); $i++) {\n        list($category, $data) = explode(',', trim($line));\n\n        if (array_key_exists($category, $allCategories)) {\n            $id = $allCategories[$category];\n        } else {\n            // Insert the new category into the database\n            mysqli_query($conn, "INSERT INTO categories (procId, category) VALUES ('$procId', '$category')");\n            $id = mysqli_insert_id($conn);\n            $allCategories[$category] = $id;  // Update your in-memory cache\n        }\n\n        // Process the record using $id and $data...\n    }\n}\n\nfclose($fileHandle);\n?>