$MimeType = new MimeType();\n$mimetype = $MimeType->getType($filename);\n$basename = basename($filename);\n\n// Fix headers for IE compatibility\nheader("Content-Type: {$mimetype}; charset=utf-8");\nheader("Content-Disposition: attachment; filename=\"".utf8_encode($basename)."\"");\nheader('Content-Length: '. filesize($filename));\nheader("Cache-Control: no-store, no-cache, must-revalidate");\nheader("Cache-Control: post-check=0, pre-check=0", false);\nheader("Pragma: no-cache");\n\nif (@readfile($filename) === false) {\n    header("HTTP/1.0 500 Internal Server Error");\n    loadErrorPage('500');\n}