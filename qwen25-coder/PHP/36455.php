function stripSlashesDeeply($values) {\n    $result = array();\n    foreach ($values as $key => $value) {\n        // Recursively process arrays\n        if (is_array($value)) {\n            $result[$key] = stripSlashesDeeply($value);\n        } else {\n            // Strip slashes from strings\n            $result[$key] = stripslashes((string) $value);\n        }\n    }\n\n    return $result;\n}\n\nif (get_magic_quotes_gpc()) {\n    $_POST = stripSlashesDeeply($_POST);\n    $_GET = stripSlashesDeeply($_GET);\n    $_COOKIE = stripSlashesDeeply($_COOKIE);\n}\n\n// Now you can safely use mysql_real_escape_string\n$newstitle = mysql_real_escape_string($_POST['newstitle']);\n$newstext = mysql_real_escape_string($_POST['newstext']);\n\nmysql_query("INSERT INTO news (title, poster, text, time) VALUES ('$newstitle', '1', '$newstext', '$time')") or die(mysql_error());