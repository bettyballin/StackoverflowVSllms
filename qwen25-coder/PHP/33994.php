$safe_path = escapeshellarg($dir . $file);\n$command = '/usr/bin/clamscan -o --no-summary ' . $safe_path;\n\nif ($handle = popen($command, 'r')) {\n    echo "<div id='status'>Please be patient, your files are being scanned...</div>";\n    while (!feof($handle)) {\n        $output = fread($handle, 2096);\n        if (strpos($output, "FOUND") !== false) {\n            echo "<script>document.getElementById('status').innerText += '\\nVirus detected!';</script>";\n        } else {\n            echo "<script>document.getElementById('status').innerText += '.\\n';</script>";\n        }\n        ob_flush();\n        flush();\n    }\n    pclose($handle);\n} else {\n    echo "Failed to start scan.";\n}