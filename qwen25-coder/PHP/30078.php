<?php\n/*\n * Random Products Module for osCommerce\n */\n\n// Check if we are in checkout procedure to avoid conflicts\nif (!defined('IS_ADMIN_FLAG')) {\n    die('Illegal Access');\n}\n\nrequire(DIR_WS_LANGUAGES . $language . '/modules/' . FILENAME_RANDOM_PRODUCTS);\n\n$random_products_query_raw = "\n    SELECT p.products_id, pd.products_name \n    FROM " . TABLE_PRODUCTS . " p\n    JOIN " . TABLE_PRODUCTS_DESCRIPTION . " pd ON p.products_id = pd.products_id \n    WHERE p.products_status = '1' \n    AND pd.language_id = '" . (int)$languages_id. "' \n    ORDER BY rand() LIMIT " . MAX_RANDOM_SELECT_NEW;\n\n$random_products_query = tep_db_query($random_products_query_raw);\n\n$num_random_articles = tep_db_num_rows($random_products_query);\n$row = 0;\n$col = 0;\n$list_box_contents = array(\n    array('params' => 'class="productListing-heading"',\n          'text' => sprintf(TABLE_HEADING_RANDOM_PRODUCTS, $num_random_articles))\n);\n\nwhile ($random_products = tep_db_fetch_array($random_products_query)) {\n    $row++;\n    $new_price = tep_get_products_special_price($random_products['products_id']);\n    if (tep_not_null($new_price)) {\n        $random_products_price = '<s>' . tep_get_products_display_price($random_products['products_id']) . '</s> <span class="productSpecialPrice">' . $new_price . '</span>';\n    } else {\n        $random_products_price = tep_get_products_display_price($random_products['products_id']);\n    }\n\n    if ( ($col / MAX_DISPLAY_NEW_PRODUCTS_LISTING_COLUMNS) == floor($col / MAX_DISPLAY_NEW_PRODUCTS_LISTING_COLUMNS)) {\n        $list_box_contents[$row] = array('params' => 'class="productListing-even"');\n    } else {\n        $list_box_contents[$row] = array('params' => 'class="productListing-odd"');\n    }\n\n    $list_box_contents[$row][] = array(\n        'align' => 'center',\n        'params' => 'class="productListing-data" valign="top"',\n        'text' => '<a href="' . tep_href_link(FILENAME_PRODUCT_INFO, 'products_id=' . $random_products['products_id']) . '">' . tep_image(DIR_WS_IMAGES . $random_products['products_image'], $random_products['products_name'], SMALL_IMAGE_WIDTH, SMALL_IMAGE_HEIGHT) . '</a>' .\n                  '<br><a href="' . tep_href_link(FILENAME_PRODUCT_INFO, 'products_id=' . $random_products['products_id']) . '">' . $random_products['products_name'] . '</a>'\n    );\n    $col++;\n}\n\nif ($num_random_articles > 0) {\n    new productListingBox($list_box_contents);\n}\n?>