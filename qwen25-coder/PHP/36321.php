<?php\n// Assume $pdo is your PDO database connection\n\ntry {\n    // Start a transaction\n    $pdo->beginTransaction();\n\n    // Truncate table to remove old rankings\n    $pdo->exec("TRUNCATE TABLE userRanks");\n\n    // Insert new rankings into the userRanks table\n    $stmt = $pdo->prepare("\n        INSERT INTO userRanks (userid, rank) \n        SELECT id, @rownum:=@rownum + 1 as rank \n        FROM users, (SELECT @rownum:=0) r \n        WHERE status = '1' \n        ORDER BY month_score DESC\n    ");\n    $stmt->execute();\n\n    // Update the main users table with new ranks using a JOIN\n    $pdo->exec("\n        UPDATE users u\n        JOIN userRanks ur ON u.id = ur.userid\n        SET u.month_rank = ur.rank\n    ");\n\n    // Commit transaction\n    $pdo->commit();\n} catch (PDOException $e) {\n    // Rollback in case of error\n    $pdo->rollBack();\n    echo "Error: " . $e->getMessage();\n}\n?>