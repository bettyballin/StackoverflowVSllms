<?php\n// Assuming $conn is your MySQL connection\n\n$productName = 'DELL';\n$targetQuantity = 35;\n\n// Fetching the data using your query\n$query = "\n    SELECT `price`, `quantity` \n    FROM (\n        SELECT `price`, `quantity` \n        FROM `quantity` \n        WHERE `product_name` = '$productName' \n        ORDER BY `date` DESC, `position`\n    ) AS `Actions` \n    GROUP BY `price`\n";\n$result = mysqli_query($conn, $query);\n\n$remainingQuantity = $targetQuantity;\n$updates = [];\n\nwhile ($row = mysqli_fetch_assoc($result)) {\n    if ($remainingQuantity <= 0) break;\n\n    if ($row['quantity'] >= $remainingQuantity) {\n        $newQuantity = $row['quantity'] - $remainingQuantity;\n        $remainingQuantity = 0;\n    } else {\n        $newQuantity = 0;\n        $remainingQuantity -= $row['quantity'];\n    }\n\n    $updates[] = [\n        'price' => $row['price'],\n        'new_quantity' => $newQuantity\n    ];\n}\n\n// Performing the updates\nforeach ($updates as $update) {\n    $sql = "UPDATE `quantity` \n            SET `quantity` = {$update['new_quantity']} \n            WHERE `product_name` = '$productName' AND `price` = {$update['price']}\n            LIMIT 1"; // Assuming you want to update the latest record only\n    mysqli_query($conn, $sql);\n}\n\n// Close the connection\nmysqli_close($conn);\n?>