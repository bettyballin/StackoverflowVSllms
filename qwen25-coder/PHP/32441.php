// Start the session at the beginning of each page\nsession_start();\n\n// Database connection setup\n$pdo = new PDO('mysql:host=localhost;dbname=testdb', 'username', 'password');\n$pdo->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n// Login handling\nif ($_SERVER['REQUEST_METHOD'] == 'POST') {\n    $email = $_POST['email'];\n    $password = $_POST['password'];\n\n    // Prepare and execute statement\n    $stmt = $pdo->prepare('SELECT * FROM users WHERE email = ?');\n    $stmt->execute([$email]);\n    $user = $stmt->fetch(PDO::FETCH_ASSOC);\n\n    if ($user && password_verify($password, $user['password'])) {\n        // Regenerate session ID to prevent fixation attacks\n        session_regenerate_id(true);\n        \n        // Store minimal user data in session\n        $_SESSION['uid'] = $user['id'];\n        $_SESSION['first_name'] = $user['first_name'];\n\n        header('Location: dashboard.php');\n        exit();\n    } else {\n        echo 'Invalid email or password';\n    }\n}\n\n// Check for session on protected pages\nfunction isUserLoggedIn() {\n    return isset($_SESSION['uid']);\n}\n\nif (!isUserLoggedIn()) {\n    header('Location: index.php');\n    exit();\n}