<?php\nheader("Content-Type: text/html; charset=utf-8");\n\nif (isset($_GET["cmd"]))\n    $cmd = $_GET["cmd"];\nelse\n    die("You should have a 'cmd' parameter in your URL");\n\n$pk = $_GET["pk"];\n$con = mysql_connect("localhost", "someuser", "notreal");\n\nif(!$con)\n{\n    die('Connection failed because of: ' . mysql_error());\n}\n\nmysql_query('SET NAMES utf8'); \nmysql_select_db("somedb", $con);\n\nif($cmd == "GetAuctionData")\n{\n    $sql = "SELECT * FROM AUCTIONS WHERE ARTICLE_NO = '$pk'";\n    $result = mysql_query($sql);\n    \n    if (!$result) {\n        die(mysql_error());\n    }\n\n    while ($row = mysql_fetch_array($result))\n    {\n        $columns = array('FINISHED', 'WATCH', 'PRIVATE_AUCTION', 'REVISED', 'PAYPAL_ACCEPT', 'PRE_TERMINATED', 'PIC_XXL', 'PIC_DIASHOW');\n        foreach($columns as $column)\n        {\n            $$column = $row[$column] ? 'YES' : 'NO';\n        }\n\n        $lastImg = $row['PIC_URL']; \n        $maxWidth  = 250;\n        $maxHeight = 300;\n\n        $size = getimagesize($_SERVER['DOCUMENT_ROOT'] . '/' . $lastImg);\n        if ($size) {\n            $imageWidth  = $size[0];\n            $imageHeight = $size[1];\n            $wRatio = $imageWidth / $maxWidth;\n            $hRatio = $imageHeight / $maxHeight;\n            $maxRatio = max($wRatio, $hRatio);\n\n            if ($maxRatio > 1) {\n                $outputWidth = $imageWidth / $maxRatio;\n                $outputHeight = $imageHeight / $maxRatio;\n            } else {\n                $outputWidth = $imageWidth;\n                $outputHeight = $imageHeight;\n            }\n            \n            echo "<h1>" . htmlspecialchars($row['ARTICLE_NAME']) . "</h1>";\n            echo "<div id='rightlayer'>";\n            echo "<img src='" . htmlspecialchars($lastImg) . "' width='" . (int)$outputWidth . "' height='" . (int)$outputHeight . "'>";\n            echo "</div>";\n        } else {\n            echo "Error: Unable to get image size for $lastImg";\n        }\n    }\n}\n\nmysql_free_result($result);\n?>