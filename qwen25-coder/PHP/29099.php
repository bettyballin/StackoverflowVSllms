<?php\n\nfunction findPermutations($resources, $amountNeeded, $currentCombination = [], $startTime = null) {\n    static $results = [];\n\n    if (count($currentCombination) === $amountNeeded) {\n        // Check if all selected blocks have the same start time\n        $commonStartTime = reset($currentCombination)['startTime'];\n        $validBlocks = array_filter($currentCombination, function($block) use ($commonStartTime) {\n            return $block['startTime'] == $commonStartTime;\n        });\n\n        if (count($validBlocks) === $amountNeeded) {\n            $availDate = reset($currentCombination)['availDate'];\n            $endTime = current(array_slice($validBlocks, -1))['endTime'];\n\n            $resourceIDs = array_map(function ($block) {\n                return $block['resourceID'];\n            }, $currentCombination);\n\n            $results[] = [\n                'availDate' => $availDate,\n                'startTime' => $commonStartTime,\n                'endTime' => $endTime,\n                'resources' => implode(" and ", $resourceIDs),\n            ];\n        }\n        return;\n    }\n\n    foreach ($resources as $index => $resource) {\n        foreach ($resource['blocks'] as $block) {\n            if (is_null($startTime) || $block['startTime'] >= $startTime) {\n                findPermutations(\n                    array_slice($resources, $index + 1),\n                    $amountNeeded,\n                    array_merge($currentCombination, [$block]),\n                    $block['endTime']\n                );\n            }\n        }\n    }\n\n    return $results;\n}\n\n$data = [\n    'amountNeeded' => 2,\n    'resources' => [\n        [\n            'resourceID' => 10,\n            'blocks' => [\n                ['availDate' => '2008-05-14', 'startTime' => '08:00', 'endTime' => '08:10'],\n                ['availDate' => '2008-05-14', 'startTime' => '08:10', 'endTime' => '08:20'],\n                ['availDate' => '2008-05-14', 'startTime' => '08:20', 'endTime' => '08:30'],\n            ]\n        ],\n        [\n            'resourceID' => 13,\n            'blocks' => [\n                ['availDate' => '2008-05-14', 'startTime' => '08:00', 'endTime' => '08:10'],\n                ['availDate' => '2008-05-14', 'startTime' => '08:10', 'endTime' => '08:20'],\n                ['availDate' => '2008-05-14', 'startTime' => '08:30', 'endTime' => '08:40'],\n            ]\n        ],\n    ]\n];\n\n$results = findPermutations($data['resources'], $data['amountNeeded']);\n\nforeach ($results as $result) {\n    echo "Available on {$result['availDate']} from  {$result['startTime']} to {$result['endTime']} using resource {$result['resources']}\n";\n}\n?>