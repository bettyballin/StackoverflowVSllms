<?php\nfunction book($memberid, $classid) {\n    // Create a new PDO connection\n    $pdo = new PDO('mysql:host=localhost;dbname=your_database', 'username', 'password');\n    \n    // Start a transaction\n    $pdo->beginTransaction();\n\n    try {\n        // Select with FOR UPDATE to lock the row for this session\n        $stmt = $pdo->prepare("SELECT book FROM bookings WHERE memberid = :memberid AND classid = :classid FOR UPDATE");\n        $stmt->execute([':memberid' => $memberid, ':classid' => $classid]);\n        \n        // Fetch the result\n        $result = $stmt->fetch(PDO::FETCH_ASSOC);\n        \n        // If booking is not already made\n        if (!$result['book']) {\n            // Update the record to book it\n            $updateStmt = $pdo->prepare("UPDATE bookings SET book = TRUE WHERE memberid = :memberid AND classid = :classid");\n            $updateStmt->execute([':memberid' => $memberid, ':classid' => $classid]);\n        }\n        \n        // Commit the transaction\n        $pdo->commit();\n    } catch (Exception $e) {\n        // Rollback in case of error\n        $pdo->rollBack();\n        throw $e;\n    }\n}\n?>