<?php\n\n$servername = "localhost";\n$username = "username";\n$password = "password";\n$dbname = "database_name";\n\ntry {\n    $conn = new PDO("mysql:host=$servername;dbname=$dbname", $username, $password);\n    // set the PDO error mode to exception\n    $conn->setAttribute(PDO::ATTR_ERRMODE, PDO::ERRMODE_EXCEPTION);\n\n    $sql = "SELECT DISTINCT s.id, s.date, s.ip, s.browser, s.os, s.page, s.host, s.referer, s.query, s.agent \n            FROM spy_hits s \n            INNER JOIN (\n                SELECT ip, MAX(date) as max_date \n                FROM spy_hits \n                GROUP BY ip \n            ) latest_ips ON s.ip = latest_ips.ip AND s.date = latest_ips.max_date\n            ORDER BY s.date DESC \n            LIMIT 10";\n\n    $stmt = $conn->prepare($sql);\n    $stmt->execute();\n\n    // set the resulting array to associative\n    $result = $stmt->setFetchMode(PDO::FETCH_ASSOC); \n    foreach(new RecursiveArrayIterator($stmt->fetchAll()) as $k=>$v) { \n        echo $k." - ".$v."\n";\n    }\n}\ncatch(PDOException $e)\n{\n    echo "Error: " . $e->getMessage();\n}\n$conn = null;\n?>