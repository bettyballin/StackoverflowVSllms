<?php\nrequire_once __DIR__ . '/vendor/autoload.php';\n\nsession_start();\n\n$fb = new \Facebook\Facebook([\n  'app_id' => '{your-app-id}',\n  'app_secret' => '{your-app-secret}',\n  'default_graph_version' => 'v15.0',\n]);\n\n$helper = $fb->getRedirectLoginHelper();\ntry {\n    if (isset($_SESSION['facebook_access_token'])) {\n        $accessToken = $_SESSION['facebook_access_token'];\n        // The OAuth 2.0 client handler helps us manage access tokens\n        $oAuth2Client = $fb->getOAuth2Client();\n\n        // Validate the token to make sure it's still valid\n        if (!$accessToken->isLongLived()) {\n            try {\n                // Exchanges a short-lived access token for a long-lived one\n                $accessToken = $oAuth2Client->getLongLivedAccessToken($accessToken);\n                $_SESSION['facebook_access_token'] = (string) $accessToken;\n            } catch (\Facebook\Exceptions\FacebookSDKException $e) {\n                echo '<p>Error getting long-lived access token: ' . $e->getMessage() . '</p>';\n                exit;\n            }\n        }\n    } else {\n        // No token is available so we need to ask the user to log in\n        $permissions = ['email', 'user_friends']; // Optional permissions\n        $loginUrl = $helper->getLoginUrl('https://your-callback-url.com/callback.php', $permissions);\n        echo '<a href="' . htmlspecialchars($loginUrl) . '">Log in with Facebook!</a>';\n        exit;\n    }\n} catch (\Facebook\Exceptions\FacebookResponseException $e) {\n    // When Graph returns an error\n    echo 'Graph returned an error: ' . $e->getMessage();\n    exit;\n} catch (\Facebook\Exceptions\FacebookSDKException $e) {\n    // When validation fails or other local issues\n    echo 'Facebook SDK returned an error: ' . $e->getMessage();\n    exit;\n}\n\ntry {\n    // Get basic user information\n    $response = $fb->get('/me?fields=id,name,picture.height(200)', $accessToken);\n    $userNode = $response->getGraphUser();\n\n    // Get user's friends who have the app installed\n    $friendsResponse = $fb->get('/me/friends', $accessToken);\n    $friendsEdge = $friendsResponse->getGraphEdge('GraphUser');\n\n    echo 'Logged in as: ' . htmlspecialchars($userNode['name']) . '<br>';\n    echo 'Your profile picture: <img src="' . $userNode['picture']['url'] . '" /><br>';\n\n    echo 'Friends who have the app installed:<ul>';\n    foreach ($friendsEdge as $friend) {\n        echo '<li>' . htmlspecialchars($friend['name']) . '</li>';\n    }\n    echo '</ul>';\n} catch (\Facebook\Exceptions\FacebookResponseException $e) {\n    // Handle errors\n    echo 'Graph returned an error: ' . $e->getMessage();\n    exit;\n}\n?>