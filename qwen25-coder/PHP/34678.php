function forum_extract($text) {\n    // Remove everything between square brackets\n    $cleanedText = preg_replace('/\[[^\]]+\]/', '', $text);\n    \n    // Trim whitespace from the beginning and end of the string\n    $trimmedText = trim($cleanedText);\n\n    // Replace newlines with HTML line breaks\n    return str_replace("\n", '<br />', limit_text($trimmedText, 30));\n}\n\nfunction limit_text($text, $limit) {\n    // Trim the text to remove any extra whitespace\n    $text = trim($text);\n    \n    // Check if the text length is less than or equal to the limit\n    if (strlen($text) <= $limit) {\n        return $text;\n    }\n\n    // Use str_word_count with format 2 to get positions of words\n    $words = str_word_count($text, 2);\n    $positions = array_keys($words);\n\n    // If we have more words than the limit\n    if (isset($positions[$limit])) {\n        return substr($text, 0, $positions[$limit]) . '...';\n    }\n    \n    // Return the text up to the limit if no clear word boundary is found\n    return substr($text, 0, $limit) . '...';\n}