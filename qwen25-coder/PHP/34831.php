<?php\n\nfunction stripCommentsAndWhitespace($content) {\n    // Strip multiline comments, including those with nested /**/\n    $pattern = '/\/\*[^!](?:(?!?\*\/).)*\*\//s';\n    $result = preg_replace($pattern, '', $content);\n\n    // Strip single-line comments and PHP-style short tags (if any)\n    $result = preg_replace('/\/\/.*|[#].*|\?>.*|<\?.*\?>/m', '', $result);\n\n    // Remove extra whitespace lines\n    $result = preg_replace("/(^[\r\n]*|[\r\n]+)[\s\t]*[\r\n]+/", "\n", $result);\n    \n    return trim($result);\n}\n\n// Example usage:\n$code = <<<EOT\n/* This is a comment\n   that spans multiple lines */\n\necho "Hello World"; // This is an inline comment\n\n# This is also a comment\n\n/*\nAnother multi line comment\n*/\n\necho "Hi again";\n\n?>\nEOT;\n\necho stripCommentsAndWhitespace($code);