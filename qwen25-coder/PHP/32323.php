<?php\n\nrequire_once('/usr/local/lib/php/Doctrine/lib/Doctrine.php');\n\nspl_autoload_register(array('Doctrine', 'autoload'));\n\n$manager = Doctrine_Manager::getInstance();\n$manager->setAttribute('model_loading','conservative');\nDoctrine::loadModels('lib/model/master');\n\nwhile(1){\n    print "You are using " . intval(memory_get_usage() / 1024) . "\n";\n    $manager->connection('********************************************','master');\n    $query = Doctrine_Query::create()\n                ->from('SubmissionQueue s')\n                ->where('s.time_acted_on IS NULL')\n                ->orderby('s.time_queued')\n                ->limit(1)\n                ->execute();\n\n    if (count($query) > 0) {\n        print "[" . $query[0]->time_queued . "]\n";\n        // Process the entry here\n\n        // Free up memory\n        unset($query[0]);\n    }\n\n    $query->free();\n    unset($query);\n    $query = null;\n\n    // Clear Doctrine's entity manager\n    Doctrine_Manager::getInstance()->clear();\n\n    // Close the connection to free up resources\n    $manager->closeConnection(Doctrine_Manager::getInstance()->getConnection('master'));\n\n    // Force garbage collection\n    gc_collect_cycles();\n\n    sleep(5);\n}