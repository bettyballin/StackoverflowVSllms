$redirect = '';\nforeach ($curl_response as $line) {\n    // Trim any trailing \r characters from each line\n    $trimmedLine = rtrim($line, "\r");\n\n    if ($trimmedLine !== '') {  # line is not a linebreak, so we're still processing a header block\n\n        if (preg_match("(HTTP/[0-9]\.[0-9] [0-9]{3} .*)", $trimmedLine)) {\n            // line is the status code\n            // highlight the outputted line\n            $output .= "<b style='background: yellow;'>$trimmedLine</b>";\n        }\n\n        elseif (preg_match("/^Location: (.*)$/m", $trimmedLine, $regs)) {\n            // the line is a location header, so grab the location being redirected to\n            // highlight the outputted line\n            $output .= "<b style='background: purple; color: white;'>$trimmedLine</b>";\n            $redirect = $regs[1];\n        }\n\n        else {\n            // some other header, record to output\n            $output .= $trimmedLine;\n        }\n\n    } else {  # we've reached a line break, so we're getting to a new block of redirects\n        $output .= "\nreached line break\n";\n        if ($redirect != '') {\n            // if we recorded a redirect above, append it to output\n            $output .= "\n\nRedirecting to $redirect\n\n";\n            $redirect = '';\n        }\n    }\n}\necho $output;