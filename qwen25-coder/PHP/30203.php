$handle = popen('curl -o '.VIDEOPATH.$fileName.'.flv '.$url.' 2>&1', 'rb');\n\nwhile(!feof($handle)) {\n    $line = fgets($handle, 4096); // Get a line from the input handle\n\n    // Remove extra spaces and trim\n    $line = preg_replace("/\s+/", " ", $line);\n    $fields = explode(" ", trim($line)); // split the input on spaces into fields array\n\n    if (count($fields) > 0 && strpos($fields[0], '%') !== false) {\n        $percentage = floatval(str_replace('%', '', $fields[0]));\n        echo "Download Progress: $percentage%\n";\n        fwrite($fh, "$percentage%\n"); // Write the percentage to a file or output it\n    }\n}\n\nfclose($handle);