<?php\nrequire 'database.php'; // Assume database connection setup\n\nfunction getUserFromSession() {\n    // Implement your session handling here to get user credentials.\n    return $_SESSION['user'] ?? null;\n}\n\nfunction getImagePath($imageId) {\n    global $pdo; // Assuming you are using PDO for database access\n\n    // Validate imageId\n    if (!filter_var($imageId, FILTER_VALIDATE_INT)) {\n        die("Invalid image ID");\n    }\n\n    // Fetch the file path from the database securely\n    $stmt = $pdo->prepare('SELECT file_path FROM images WHERE id = ?');\n    $stmt->execute([$imageId]);\n    $row = $stmt->fetch();\n\n    if (!$row) {\n        http_response_code(404);\n        die("Image not found");\n    }\n    return $row['file_path'];\n}\n\nfunction outputImage($filePath) {\n    // Check if the file exists\n    if (!file_exists($filePath)) {\n        http_response_code(404);\n        die("File not found");\n    }\n\n    // Set the appropriate content type header\n    list($width, $height, $type, $attr) = getimagesize($filePath);\n    if (!$type || !$width || !$height) {\n        http_response_code(415);\n        die("Unsupported image type");\n    }\n    header('Content-Type: ' . image_type_to_mime_type($type));\n\n    // Output the image\n    readfile($filePath);\n}\n\n$user = getUserFromSession();\nif (!$user) {\n    http_response_code(403);\n    die("Access denied");\n}\n\n$imageId = $_GET['id'];\n$relativePath = getImagePath($imageId);\n\n// Construct full path considering your filesystem structure\n$fullPath = __DIR__ . '/../images/' . basename($relativePath); // Adjust the path as needed\n\noutputImage($fullPath);\n?>