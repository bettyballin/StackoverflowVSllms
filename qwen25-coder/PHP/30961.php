<?php\n//display results\n// now we retrieve the routes from the db\n$query = "SELECT * FROM routes ORDER BY `id`;";\n\n// run the query. if it fails, display error\n$result = @mysql_query("$query") or die('<p class="error">There was an unexpected error grabbing routes from the database.</p>');\n\n// Array to hold all rows with calculated profit\n$routesWithProfit = [];\n\nwhile ($row = mysql_fetch_array($result)) {\n    $dname = stripslashes($row['name']);\n    $dbase = stripslashes($row['base']);\n    $dlocation = stripslashes($row['location']);\n    $dx = stripslashes($row['x']);\n    $dy = stripslashes($row['y']);\n    $dgalaxy = stripslashes($row['galaxy']);\n    $dplanet = stripslashes($row['planet']);\n    $dcomment = stripslashes($row['comment']);\n    $did = stripslashes($row['id']);\n    $decon = stripslashes($row['econ']);\n\n    $distance = -1; //default\n\n    // distance calc logic...\n    \n    // Calculate the profit based on your formula\n    $profit = round(sqrt(min($decon, $econ))*(1 + sqrt($distance)/75 + sqrt($players)/10));\n\n    // Store each row along with its calculated profit in an associative array\n    $routesWithProfit[] = [\n        'name' => $dname,\n        'base' => $dbase,\n        'location' => $dlocation,\n        'x' => $dx,\n        'y' => $dy,\n        'galaxy' => $dgalaxy,\n        'planet' => $dplanet,\n        'comment' => $dcomment,\n        'id' => $did,\n        'econ' => $decon,\n        'distance' => $distance,\n        'profit' => $profit\n    ];\n}\n\n// Function to compare profits for sorting\nfunction compareProfit($a, $b) {\n    if ($a['profit'] == $b['profit']) {\n        return 0;\n    }\n    return ($a['profit'] < $b['profit']) ? 1 : -1; // Descending order\n}\n\n// Sort the array by profit in descending order\nusort($routesWithProfit, 'compareProfit');\n\n// Now you can loop through this sorted array to print the rows ordered by profit\n?>\n\n<table>\n    <!-- Your table headers here -->\n    <tr>\n        <td><b>Player</b></td>\n        <td><b>Base</b></td>\n        <td><b>Location</b></td>\n        <td><b>Econ</b></td>\n        <td><b>Distance</b></td>\n        <td><b>Profit cred./h</b></td>\n        <td><b>Comment</b></td>\n        <td><b>Delete</b></td>\n    </tr>\n    \n    <?php\n    foreach ($routesWithProfit as $route) {\n        echo '<tr>\n            <td><center>(' . $route['name'] . ')</center></td>\n            <td><center>' . $route['base'] . '</center></td>\n            <td><a href="http://delta.astroempires.com/map.aspx?loc=' . $route['location'] . '">' . $route['location'] . '</a></td>\n            <td>' . $route['econ'] . '</td>\n            <td>' . $route['distance'] . ' </td>\n            <td>' . $route['profit'] . '</td>\n            <td>[' . $route['comment'] . ']</td>\n            <td><a href=deleterouteconfirm.php?id=' . $route['id'] . '>Delete</a></td>\n        </tr>';\n    }\n    ?>\n    \n</table>