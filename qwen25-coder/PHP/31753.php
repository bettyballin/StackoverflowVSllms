$this->db->query("\n    SELECT g.id, g.name, u.username, p.url\n    FROM galleries g\n    LEFT JOIN users u ON u.id = g.user_id\n    LEFT JOIN (\n        SELECT gallery_id, url,\n               @row_num := IF(@current_gallery = gallery_id, @row_num + 1, 1) AS row_number,\n               @current_gallery := gallery_id\n        FROM pictures p, (SELECT @row_num := 0, @current_gallery := NULL) r\n        ORDER BY gallery_id, RAND()\n    ) p ON g.id = p.gallery_id AND p.row_number = 1\n    WHERE g.active = 1\n    ORDER BY RAND()\n    LIMIT 15;\n");