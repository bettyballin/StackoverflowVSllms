<?php\n// Always start the session at the very beginning of the script\nif (!session_start()) {\n    $url = "Location: error.php?id=13";\n    header($url);\n    exit;\n}\n\n$DEBUG = true; // Ensure this is defined and set properly\n\nif ($DEBUG) {\n    error_reporting(E_ALL);\n}\n\nrequire "header.php";\n\nrequire_once "dbinterface.php";\nrequire_once "user.class.php";\nrequire_once "config.inc.php";\n\n$db = new db($DB['host'], $DB['user'], $DB['pass'], $DB['database']);\n\n// Use prepared statements to prevent SQL injection\n$u_result = $db->run("SELECT user_id FROM users WHERE user_name = ?", [$_POST['user_name']]);\n\nif ($u_result === false) {\n    $url = 'Location: error.php?id=8';\n    header($url);\n} elseif (count($u_result) < 1) {\n    $url = 'Location: error.php?id=3';\n    header($url);\n} else {\n    $user = new user($u_result[0]['user_id']);\n\n    if ($user->match_password($_POST['pass'])) {\n        $_SESSION['authenticated'] = true;\n        $_SESSION['user_id'] = $u_result[0]['user_id'];\n        // Avoid storing objects directly in session. Store only necessary data.\n        $_SESSION['user_name'] = $_POST['user_name'];\n    } else {\n        $url = 'Location: error.php?id=4';\n        header($url);\n    }\n}\n\nheader('Location: index.php');\nexit;\n?>