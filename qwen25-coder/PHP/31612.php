$chart = array();\n$roll = array();\n\n// Select used terms\n$rosh = mysql_query("SELECT DISTINCT term FROM search_terms") or die(mysql_error());\n\nwhile ($roshrow = mysql_fetch_assoc($rosh)) {\n    extract($roshrow);\n    $roll[] = $term;\n}\n\n// Select term_number for each term\nforeach ($roll as $sterm) {\n    $termarray = array();\n\n    // Ensure proper quoting and error handling\n    $sterm_safe = mysql_real_escape_string($sterm); // Protect against SQL injection\n    $bashq = "SELECT term_number FROM search_terms WHERE term='$sterm_safe'";\n    \n    $bash = mysql_query($bashq) or die(mysql_error()); // Check for errors in query execution\n\n    while ($brow = mysql_fetch_assoc($bash)) {\n        extract($brow);\n        $termarray[] = $term_number;\n    }\n    $termsum = array_sum($termarray);\n\n    // Put term => number array for chart script\n    $chart[$sterm] = $termsum;\n}\n\n// Sort array so high numbers at beginning\narsort($chart);\n\n// Slice top 10 terms\n$chart = array_slice($chart, 0, 10);