// Buffer data before parsing\n$buffer = '';\n\nwhile ($data = fread($fp, 4096)) {\n    $buffer .= htmlspecialchars($data, ENT_QUOTES | ENT_XML1, 'UTF-8');\n}\n\n// Parse the buffered XML data once it is fully read\nif (!xml_parse($xml_parser, $buffer, true)) {\n    die(sprintf("XML error: %s at line %d",\n                xml_error_string(xml_get_error_code($xml_parser)),\n                xml_get_current_line_number($xml_parser)));\n}