<?php\nfunction watermark($source_file, $source_width, $source_height, $image_type) {\n    // Map image types to creation and output functions\n    $image_functions = [\n        'gif' => ['create' => 'imagecreatefromgif', 'output' => 'imagegif'],\n        'jpg' => ['create' => 'imagecreatefromjpeg', 'output' => 'imagejpeg'],\n        'png' => ['create' => 'imagecreatefrompng', 'output' => 'imagepng'],\n    ];\n\n    // Ensure the image type is supported\n    if (!isset($image_functions[$image_type])) {\n        return false; // or handle error appropriately\n    }\n\n    $watermark_size = ($source_width > 300) ? '../images/fpwatermark.gif' : '../images/fpwatermark.gif';\n    $watermark = imagecreatefromgif($watermark_size);\n\n    // Get the dimensions of the watermark\n    list($water_width, $water_height) = getimagesize($watermark_size);\n\n    // Create the source image using the appropriate function\n    $image_create_function = $image_functions[$image_type]['create'];\n    $image = $image_create_function($source_file);\n\n    // Water mark process\n    $x = $source_width - $water_width - 8; // horizontal position\n    $y = $source_height - $water_height - 8; // vertical posiion\n\n    imagecopymerge($image, $watermark, $x, $y, 0, 0, $water_width, $water_height, 65);\n\n    // Output the watermark image using the appropriate function\n    $image_output_function = $image_functions[$image_type]['output'];\n    $image_output_function($image, $source_file, 90);\n\n    imagedestroy($image);\n    return $source_file;\n}\n?>