function make_url($path, $secure = false) {\n    // Resolve the path to an absolute real path for security and consistency\n    $realPath = realpath($path);\n    \n    // Check if the real path is within the document root\n    $documentRoot = realpath($_SERVER['DOCUMENT_ROOT']);\n    if (strpos($realPath, $documentRoot) !== 0) {\n        throw new Exception("Provided path is not within the document root");\n    }\n    \n    // Remove the document root from the path to get a relative path\n    $relativePath = substr($realPath, strlen($documentRoot));\n\n    // Construct the URL based on whether it should be secure\n    $protocol = $secure ? 'https://' : 'http://';\n    $host = isset($_SERVER['HTTP_HOST']) ? $_SERVER['HTTP_HOST'] : (isset($_SERVER['SERVER_NAME']) ? $_SERVER['SERVER_NAME'] : '');\n\n    return $protocol . $host . str_replace('\\', '/', $relativePath);\n}