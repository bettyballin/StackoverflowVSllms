<?php\n$sqlResult = [\n    ['user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'],\n    ['user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'],\n    ['user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'],\n    ['user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar']\n];\n\n$formattedResult = [];\nforeach ($sqlResult as $row) {\n    $userName = $row['user_name'];\n    if (!isset($formattedResult[$userName])) {\n        $formattedResult[$userName] = [\n            'name' => $userName,\n            'tags' => []\n        ];\n    }\n    $formattedResult[$userName]['tags'][] = [\n        'id' => $row['tag_id'],\n        'name' => $row['tag_name']\n    ];\n}\n\n$formattedResult = array_values($formattedResult);\nprint_r($formattedResult);\n?>