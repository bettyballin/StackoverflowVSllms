using System;\nusing System.Collections.Generic;\nusing System.Net.Mail;\nusing System.Net;\nusing System.DirectoryServices;\n\npublic void SendEmailToGroup(string groupName, string subject, string body)\n{\n    List<string> memberEmails = GetMemberEmailAddresses(groupName);\n\n    if (memberEmails.Count > 0)\n    {\n        using (MailMessage mail = new MailMessage())\n        {\n            mail.From = new MailAddress("steveb@microsoft.com");\n            foreach (string email in memberEmails)\n            {\n                mail.To.Add(email);\n            }\n\n            // set the content\n            mail.Subject = subject;\n            mail.Body = body;\n            mail.IsBodyHtml = true;\n\n            // send the message\n            using (SmtpClient smtp = new SmtpClient("127.0.0.1"))\n            {\n                smtp.DeliveryMethod = SmtpDeliveryMethod.PickupDirectoryFromIis;\n                smtp.Send(mail);\n            }\n        }\n    }\n}\n\nprivate List<string> GetMemberEmailAddresses(string groupName)\n{\n    using (DirectoryEntry group = new DirectoryEntry("LDAP://CN=" + groupName + ",OU=Distribution Groups,DC=microsoft,DC=com"))\n    {\n        var memberEmails = new List<string>();\n        foreach (object member in group.Properties["member"])\n        {\n            using (DirectoryEntry user = new DirectoryEntry(member))\n            {\n                if (user.Properties.Contains("mail") && user.Properties["mail"].Count > 0)\n                {\n                    string mailAddress = user.Properties["mail"][0].ToString();\n                    memberEmails.Add(mailAddress);\n                }\n            }\n        }\n        return memberEmails;\n    }\n}