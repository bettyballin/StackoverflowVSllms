using System.Security.Principal;\n\n  // Enable SeAssignPrimaryTokenPrivilege\n  WindowsIdentity.GetCurrent().Impersonate();\n  try\n  {\n      var identity = new WindowsIdentity(WindowsIdentity.GetCurrent().User);\n      if (!identity.Owner.IsWellKnown(WellKnownSidType.BuiltinAdministratorsSid))\n      {\n          throw new InvalidOperationException("The application must run as an administrator.");\n      }\n\n      identity.Impersonate();\n\n      // Adjust token privileges here\n  }\n  finally\n  {\n      WindowsIdentity.Impersonate(IntPtr.Zero);\n  }