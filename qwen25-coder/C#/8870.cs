using System.ServiceModel.Security;\n\npublic void ConfigureService(ServiceHost host)\n{\n    var messageSecurityBindingElement = new MessageSecurityOverHttpBindingElement()\n    {\n        ClientCredentialType = MessageCredentialType.Certificate\n    };\n\n    CustomBinding binding = new CustomBinding(\n        messageSecurityBindingElement,\n        new TextMessageEncodingBindingElement(),\n        new HttpTransportBindingElement());\n\n    // Set the custom authenticator\n    var serviceCredentials = host.Credentials;\n    serviceCredentials.ServiceCertificate.SetCertificate(StoreLocation.LocalMachine, StoreName.My, X509FindType.FindBySubjectName, "your_service_cert_name");\n\n    var clientAuthentication = serviceCredentials.ClientCertificate.Authentication;\n    clientAuthentication.CertificateValidationMode = X509CertificateValidationMode.Custom;\n    clientAuthentication.CustomCertificateValidator = new CustomCertificateValidator();\n\n    // Set custom security token authenticator\n    ((HttpTransportBindingElement)binding.Elements[2]).ManualAddressing = true;\n\n    foreach (var endpoint in host.Description.Endpoints)\n        endpoint.Binding = binding;\n}