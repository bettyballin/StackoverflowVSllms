using System;\nusing System.ServiceProcess;\n\npublic class MyService : ServiceBase\n{\n    protected override void OnStart(string[] args)\n    {\n        const string dependencyServiceName = "MSMQ";\n        TimeSpan timeout = TimeSpan.FromSeconds(30);\n        bool serviceRunning = false;\n        DateTime startTime = DateTime.Now;\n\n        Console.WriteLine("Starting to check if the dependent MSMQ service is running...");\n\n        while (!serviceRunning && (DateTime.Now - startTime) < timeout)\n        {\n            ServiceController sc = new ServiceController(dependencyServiceName);\n\n            if (sc.Status == ServiceControllerStatus.Running)\n            {\n                serviceRunning = true;\n                Console.WriteLine("MSMQ service is now running.");\n            }\n            else\n            {\n                Console.WriteLine($"MSMQ service status is: {sc.Status}. Retrying...");\n\n                // Wait for a short period before retrying.\n                System.Threading.Thread.Sleep(2000);\n            }\n\n            sc.Dispose();\n        }\n\n        if (serviceRunning)\n        {\n            // Proceed with the rest of your service initialization and work.\n            Console.WriteLine("Proceding with the MyService operations...");\n        }\n        else\n        {\n            Console.WriteLine("Failed to start MyService as MSMQ is not running.");\n            throw new InvalidOperationException($"{dependencyServiceName} is not running. Unable to proceed.");\n        }\n    }\n\n    protected override void OnStop()\n    {\n        Console.WriteLine("Stopping MyService...");\n        // Clean up here.\n    }\n}