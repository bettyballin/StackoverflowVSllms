using System;\nusing System.Data.SqlClient;\n\npublic class EmailProcessor\n{\n    private string connectionString = "your_connection_string";\n    private string emailAddress; // Unique identifier for the email\n\n    public bool AcquireLock()\n    {\n        using (SqlConnection connection = new SqlConnection(connectionString))\n        {\n            connection.Open();\n            SqlCommand command = new SqlCommand(\n                "IF NOT EXISTS(SELECT 1 FROM EmailProcessingLocks WHERE EmailAddress=@email AND Processed=0) " +\n                "BEGIN INSERT INTO EmailProcessingLocks (EmailAddress, AcquiredAt, Processed) VALUES (@email, GETDATE(), 0); SELECT 1 END ELSE SELECT 0", connection);\n            command.Parameters.AddWithValue("@email", emailAddress);\n\n            return Convert.ToBoolean(command.ExecuteScalar());\n        }\n    }\n\n    public void MarkEmailAsProcessed()\n    {\n        using (SqlConnection connection = new SqlConnection(connectionString))\n        {\n            connection.Open();\n            SqlCommand command = new SqlCommand("UPDATE EmailProcessingLocks SET Processed=1 WHERE EmailAddress=@email AND Processed=0", connection);\n            command.Parameters.AddWithValue("@email", emailAddress);\n\n            command.ExecuteNonQuery();\n        }\n    }\n\n    public void ReleaseLock()\n    {\n        using (SqlConnection connection = new SqlConnection(connectionString))\n        {\n            connection.Open();\n            SqlCommand command = new SqlCommand("DELETE FROM EmailProcessingLocks WHERE EmailAddress=@email AND Processed=1", connection);\n            command.Parameters.AddWithValue("@email", emailAddress);\n\n            command.ExecuteNonQuery();\n        }\n    }\n\n    public void ProcessEmail()\n    {\n        if (!AcquireLock())\n        {\n            Console.WriteLine($"Could not acquire lock for {emailAddress}. Skipping.");\n            return;\n        }\n\n        try\n        {\n            // Process your email here\n\n            MarkEmailAsProcessed(); // Mark the email as processed in the database\n        }\n        finally\n        {\n            ReleaseLock();\n        }\n    }\n}