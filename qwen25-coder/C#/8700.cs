public int GetUserIdByUsername(string username)\n{\n    using (var connection = (EntityConnection)Connection)\n    {\n        using (DbCommand com = connection.StoreConnection.CreateCommand())\n        {\n            com.CommandText = "SELECT dbo.fn_GetUserId_Username(@Username)";\n            com.CommandType = CommandType.Text;\n            var param = com.CreateParameter();\n            param.ParameterName = "@Username";\n            param.Value = username;\n            com.Parameters.Add(param);\n\n            if (com.Connection.State == ConnectionState.Closed) \n                com.Connection.Open();\n\n            try\n            {\n                var result = com.ExecuteScalar(); // This should now return the correct int value or DBNull\n                if (result != null && !(result is DBNull))\n                    return Convert.ToInt32(result);\n                else\n                    return 0; // Or some other way to handle no user found\n            }\n            catch (Exception e)\n            {\n                // Handle exception appropriately, logging or rethrowing as necessary.\n                throw;\n            }\n        }\n    }\n}