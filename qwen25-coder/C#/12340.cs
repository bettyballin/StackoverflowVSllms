using System.Diagnostics;\nusing System.Reflection;\n\npublic bool IsCalledViaCom()\n{\n    StackTrace stack = new StackTrace();\n    foreach (StackFrame frame in stack.GetFrames())\n    {\n        MethodBase method = frame.GetMethod();\n        if (method != null)\n        {\n            // Look for patterns typical of COM calls\n            if (method.DeclaringType?.FullName.Contains("DispatchProxy") == true ||\n                method.DeclaringType?.FullName.Contains("DynamicComObject") == true ||\n                method.Name.Contains("Invoke"))\n            {\n                return true;\n            }\n        }\n    }\n    return false;\n}