using System;\nusing System.Collections.Generic;\nusing System.Runtime.InteropServices;\n\n[ComVisible(true)]\npublic interface ICustomEvent {\n    [PreserveSig]\n    void OnEvent();\n}\n\n[ComVisible(true), InterfaceType(ComInterfaceType.InterfaceIsIUnknown)]\npublic interface IConnectionPointContainer {\n    [PreserveSig]\n    int EnumConnectionPoints(out IntPtr ppEnum);\n\n    [PreserveSig]\n    int FindConnectionPoint(ref Guid riid, out IntPtr ppCP);\n}\n\npublic class ManagedClass : ICustomEvent, IConnectionPointContainer\n{\n    private ConnectionPoint _connectionPoint;\n\n    public ManagedClass()\n    {\n        var eventGuid = typeof(ICustomEvent).GUID;\n        _connectionPoint = new ConnectionPoint(this, ref eventGuid);\n    }\n\n    public void OnEvent()\n    {\n        // Notifies all sinks that an event has occurred.\n        _connectionPoint.OnEvent();\n    }\n\n    // IConnectionPointContainer implementations:\n\n    [PreserveSig]\n    int IConnectionPointContainer.EnumConnectionPoints(out IntPtr ppEnum)\n    {\n        throw new NotImplementedException();\n    }\n\n    [PreserveSig]\n    public int FindConnectionPoint(ref Guid riid, out IntPtr ppCP)\n    {\n        if (riid == typeof(ICustomEvent).GUID)\n        {\n            Marshal.AddRef(Marshal.GetComInterfaceForObject(_connectionPoint));\n            ppCP = Marshal.GetComInterfaceForObject(_connectionPoint, typeof(IConnectionPoint));\n            return 0; // S_OK\n        }\n\n        ppCP = IntPtr.Zero;\n        return -2147220985; // TYPE_E_ELEMENTNOTFOUND (0x8002802B)\n    }\n}\n\npublic class ConnectionPoint : IConnectionPoint /* Implement this interface */ {\n    private ManagedClass _parent;\n    private List<object> _sinks = new List<object>();\n\n    public ConnectionPoint(ManagedClass parent, ref Guid eventGuid) { }\n\n    // Implement the methods of IConnectionPoint\n\n    public int Advise(object pUnkSink, out int pdwCookie) \n    {\n        throw new NotImplementedException();\n    }\n\n    public int Unadvise(int dwCookie)\n    {\n        throw new NotImplementedException();\n    }\n\n    internal void OnEvent()\n    {\n        foreach (var sink in _sinks)\n        {\n            var eventSink = (ICustomEvent)sink;\n            eventSink.OnEvent(); // Call the events on sinks\n        }\n    }\n\n    public int EnumConnections(out IntPtr ppEnum) \n    {\n        throw new NotImplementedException();\n    }\n\n    [PreserveSig]\n    public int GetConnectionInterface(ref Guid pIID)\n    {\n        pIID = typeof(ICustomEvent).GUID;\n        return 0; // S_OK\n    }\n\n    [PreserveSig]\n    public void GetConnectionPointContainer(out IntPtr ppCPC)\n    {\n        Marshal.AddRef(Marshal.GetComInterfaceForObject(_parent, typeof(IConnectionPointContainer)));\n        ppCPC = Marshal.GetComInterfaceForObject(_parent, typeof(IConnectionPointContainer));\n    }\n}