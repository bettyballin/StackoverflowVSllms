using System;\nusing System.Data.SqlTypes;\nusing Microsoft.SqlServer.Server;\nusing System.IO;\n\npublic class DirectoryScanner\n{\n    [SqlProcedure]\n    public static void ScanDirectory(SqlString path)\n    {\n        if (path.IsNull) return;\n\n        string dirPath = path.Value;\n        if (!Directory.Exists(dirPath))\n        {\n            SqlContext.Pipe.Send("Directory does not exist: " + dirPath);\n            return;\n        }\n\n        try\n        {\n            // Get the files in the directory and its subdirectories.\n            var files = Directory.GetFiles(dirPath, "*.*", SearchOption.AllDirectories);\n\n            foreach (string file in files)\n            {\n                SqlContext.Pipe.Send(file);\n            }\n        }\n        catch (Exception ex)\n        {\n            SqlContext.Pipe.Send("Exception: " + ex.Message);\n        }\n    }\n}