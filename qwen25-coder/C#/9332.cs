using System;\nusing System.ComponentModel;\nusing System.Threading;\nusing System.Windows.Forms;\n\npublic class MyForm : Form\n{\n    private BackgroundWorker backgroundWorker;\n    \n    public MyForm()\n    {\n        // Initialize BackgroundWorker\n        backgroundWorker = new BackgroundWorker();\n        backgroundWorker.WorkerReportsProgress = true;\n        backgroundWorker.WorkerSupportsCancellation = true;\n        backgroundWorker.DoWork += BackgroundWorker_DoWork;\n        backgroundWorker.RunWorkerCompleted += BackgroundWorker_RunWorkerCompleted;\n\n        // Handle Form Closing to cancel worker\n        this.FormClosing += MyForm_FormClosing;\n\n        // Start the Worker\n        backgroundWorker.RunWorkerAsync();\n\n        // Enable treating Ctrl+C as input so that we can handle it in MainForm_KeyPress\n        Console.TreatControlCAsInput = true;\n    }\n\n    private void BackgroundWorker_DoWork(object sender, DoWorkEventArgs e)\n    {\n        while (!backgroundWorker.CancellationPending)\n        {\n            // Simulate work\n            Thread.Sleep(100);\n            backgroundWorker.ReportProgress(0);\n        }\n        if (backgroundWorker.CancellationPending)\n        {\n            e.Cancel = true;\n        }\n    }\n\n    private void BackgroundWorker_RunWorkerCompleted(object sender, RunWorkerCompletedEventArgs e)\n    {\n        if (e.Cancelled)\n        {\n            MessageBox.Show("Background worker was cancelled.");\n        }\n    }\n\n    private void MyForm_FormClosing(object sender, FormClosingEventArgs e)\n    {\n        // Cancel the background worker\n        if (backgroundWorker.IsBusy)\n        {\n            backgroundWorker.CancelAsync();\n            e.Cancel = true; // Prevent the form from closing immediately\n\n            // Optionally, wait for the worker to finish or set a timeout\n            while (backgroundWorker.IsBusy)\n            {\n                Application.DoEvents(); // Keep UI responsive\n            }\n        }\n    }\n\n    [STAThread]\n    static void Main()\n    {\n        using (MyForm form = new MyForm())\n        {\n            Application.Run(form);\n        }\n    }\n}