public void Persist(Message message)\n{\n    string siteRootPath = @"C:\YourSitesDirectory\YourSite"; // Specify correct path here\n    foreach (var recipient in message.Recipients) // recipient is a string\n    {\n        XElement xml_messages;\n        try\n        {\n            string path = Path.Combine(siteRootPath, $"{recipient}{FileExtension}"); // FileExtension=".xml"\n            if (!File.Exists(path))\n                xml_messages = XElement.Parse("<nothing/>");\n            else\n                xml_messages = XElement.Load(path);\n            \n            var element = (XElement)message;\n            if (xml_messages.IsEmpty)\n            {\n                xml_messages =\n                    new XElement("messages",\n                                 new XAttribute("recipient", recipient),\n                                 element\n                        );\n            }\n            else\n            {\n                xml_messages.Add(element);\n            }\n            xml_messages.Save(path);\n        }\n        catch (Exception e)\n        {\n            throw new Exception($"Error persisting message for {recipient}: {e.Message}");\n        }\n    }\n}