using System;\nusing System.IO;\nusing System.Runtime.InteropServices;\nusing System.Security.Principal;\n\npublic class UserImpersonation : IDisposable\n{\n    private IntPtr _userHandle;\n\n    [DllImport("advapi32.dll", SetLastError = true)]\n    public static extern bool LogonUser(\n        string lpszUsername,\n        string lpszDomain,\n        string lpszPassword,\n        int dwLogonType,\n        int dwLogonProvider,\n        ref IntPtr phToken);\n\n    [DllImport("kernel32.dll", CharSet = CharSet.Auto, SetLastError = true)]\n    public static extern bool CloseHandle(IntPtr handle);\n\n    private WindowsImpersonationContext _impersonatedUser;\n\n    public UserImpersonation(string domain, string username, string password)\n    {\n        _userHandle = IntPtr.Zero;\n        if (!LogonUser(username, domain, password,\n            2, // LOGON32_LOGON_INTERACTIVE\n            0, // LOGON32_PROVIDER_DEFAULT\n            ref _userHandle))\n        {\n            throw new Exception("Logon failed. Please check your username and password.");\n        }\n\n        WindowsIdentity identity = new WindowsIdentity(_userHandle);\n        _impersonatedUser = identity.Impersonate();\n    }\n\n    public void Dispose()\n    {\n        if (_impersonatedUser != null)\n        {\n            _impersonatedUser.Undo();\n        }\n        if (_userHandle != IntPtr.Zero)\n        {\n            CloseHandle(_userHandle);\n        }\n    }\n}\n\nclass Program\n{\n    static void Main()\n    {\n        string domain = "your_domain";\n        string username = "your_username";\n        string password = "your_password";\n\n        using (var impersonation = new UserImpersonation(domain, username, password))\n        {\n            string[] directories = Directory.GetDirectories(@"C:\YourPath");\n            string[] files = Directory.GetFiles(@"C:\YourPath");\n\n            foreach (string dir in directories)\n            {\n                Console.WriteLine(dir);\n            }\n\n            foreach (string file in files)\n            {\n                Console.WriteLine(file);\n            }\n        }\n    }\n}