using System;\nusing System.Net;\nusing System.Net.Sockets;\n\nclass SimpleImapServer {\n    static void Main(string[] args) {\n        TcpListener server = null;\n        try {\n            // Set the TcpListener on port 143, which is the default for IMAP.\n            int port = 143;\n            IPAddress localAddr = IPAddress.Parse("127.0.0.1");\n\n            // TcpListener server = new TcpListener(port);\n            server = new TcpListener(localAddr, port);\n\n            // Start listening for client requests.\n            server.Start();\n\n            // Buffer for reading data\n            Byte[] bytes = new Byte[256];\n            String data = null;\n\n            // Enter the listening loop.\n            while (true) {\n                Console.Write("Waiting for a connection... ");\n\n                // Perform a blocking call to accept requests.\n                TcpClient client = server.AcceptTcpClient();\n                Console.WriteLine("Connected!");\n\n                data = null;\n\n                // Get a stream object for reading and writing\n                NetworkStream stream = client.GetStream();\n\n                int i;\n\n                // Loop to receive all the data sent by the client.\n                while ((i = stream.Read(bytes, 0, bytes.Length)) != 0) {\n                    // Translate data bytes to a ASCII string.\n                    data = System.Text.Encoding.ASCII.GetString(bytes, 0, i);\n                    Console.WriteLine("Received: {0}", data);\n\n                    // Process the data sent by the client.\n                    data = data.ToUpper();\n\n                    byte[] msg = System.Text.Encoding.ASCII.GetBytes(data);\n\n                    // Send back a response.\n                    stream.Write(msg, 0, msg.Length);\n                }\n\n                // Shutdown and end connection\n                client.Close();\n            }\n        } catch (SocketException e) {\n            Console.WriteLine("SocketException: {0}", e);\n        } finally {\n            // Stop listening for new clients.\n            server.Stop();\n        }\n\n\n        Console.WriteLine("\nHit enter to continue...");\n        Console.Read();\n    }\n}