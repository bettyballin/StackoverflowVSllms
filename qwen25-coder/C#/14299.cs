using (SqlConnection connection = new SqlConnection(connectionString))\n{\n    SqlCommand command = new SqlCommand(query, connection);\n    connection.Open();\n    \n    using (SqlDataReader reader = command.ExecuteReader())\n    {\n        while (reader.Read())\n        {\n            // Process data here\n        }\n    } // reader is closed and disposed here\n}\n// connection is closed here as well