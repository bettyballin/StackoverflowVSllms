using System;\nusing System.Data;\nusing System.Data.SqlClient;\nusing Microsoft.Practices.EnterpriseLibrary.Data;\n\npublic void InstallDatabaseFeatures()\n{\n    var db = new DatabaseProviderFactory().CreateDefault();\n    using (var connection = db.CreateConnection())\n    {\n        connection.Open();\n        using (SqlTransaction transaction = connection.BeginTransaction(IsolationLevel.Serializable))\n        {\n            try\n            {\n                string script = SqlServices.GenerateApplicationServicesScripts(true, SqlFeatures.All, _connection.Database);\n                // Split the script into batches based on 'GO'\n                string[] batches = script.Split(new[] { "GO\r\n", "GO \r\n" }, StringSplitOptions.RemoveEmptyEntries);\n\n                foreach (string batch in batches)\n                {\n                    if (!string.IsNullOrEmpty(batch.Trim()))\n                    {\n                        db.ExecuteNonQuery(transaction, CommandType.Text, batch);\n                    }\n                }\n\n                transaction.Commit();\n            }\n            catch\n            {\n                transaction.Rollback();\n                throw;\n            }\n        }\n    }\n}