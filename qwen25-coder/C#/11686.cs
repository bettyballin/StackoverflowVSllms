using System;\nusing System.Windows;\nusing System.Windows.Media;\n\npublic class HitTestManager\n{\n    private FormattedText formattedText;\n    private double offsetX, offsetY;\n\n    public HitTestManager(FormattedText formattedText, Point textOrigin)\n    {\n        this.formattedText = formattedText;\n        offsetX = textOrigin.X;\n        offsetY = textOrigin.Y;\n    }\n\n    public int? GetHitCharacter(Point point)\n    {\n        for (int i = 0; i < formattedText.Length; i++)\n        {\n            Rect charRect = formattedText.GetCharacterRectangles(i).FirstOrDefault();\n            if (charRect.Height == 0 && charRect.Width == 0) // Non-printable characters\n                continue;\n\n            charRect.Offset(offsetX, offsetY); // Adjust for text origin\n\n            if (charRect.Contains(point))\n                return i;\n        }\n        return null; // No character found at the point\n    }\n}