using System;\nusing System.Text.RegularExpressions;\n\npublic class LdapQueryEscaper\n{\n    public static string EscapeLdapFilterElement(string value)\n    {\n        if (string.IsNullOrEmpty(value))\n            return string.Empty;\n\n        var escaped = new Regex(@"([\\*()])").MatchEvaluator(m => $"\\{((byte)m.Value[0]).ToString("X2")}");\n        return "*" + Regex.Replace(value, @"[\\*()\x00-\x1F]", escaped) + "*";\n    }\n\n    public static void Main()\n    {\n        string username = "user*(name)";\n        string domain = "domain@";\n\n        // Escape the username and domain for LDAP query\n        string escapedUsername = EscapeLdapFilterElement(username);\n        string escapedDomain = EscapeLdapFilterElement(domain);\n\n        string searchQuery = $"(&(&(objectCategory=person)(userprincipalname={escapedUsername}@{escapedDomain}))(samaccountname={escapedUsername}))";\n\n        Console.WriteLine(searchQuery);\n    }\n}