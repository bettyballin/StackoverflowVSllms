using Microsoft.SqlServer.Dts.Runtime;\n\n// Assuming aSequence is already defined and an instance of ControlFlow\nforeach (Executable executable in aSequence)\n{\n    // Adding ForEachLoop to the sequence\n    foreach (Executable loop in ((TaskHost)executable).InnerObject.InnerExecutables)\n    {\n        if (loop is ForEachLoop loopObj)\n        {\n            loopObj.Name = "a for each loop";\n\n            // Setting up the enumerator for files\n            ForEachEnumeratorInfos infos = Application.ForEachEnumerators;\n            foreach (ForEachEnumeratorInfo info in infos)\n            {\n                if (info.Name == "FEL_FORFILES")\n                {\n                    ForEachLoopEnumerator fileEnumerator = \n                        loopObj.Executables.Add(info.CreationName) as ForEachLoopEnumerator;\n\n                    // Setting properties\n                    fileEnumerator.ForEachEnumeratorConfigString = string.Empty;\n                    fileEnumerator.Properties["Directory"].SetValue(fileEnumerator, @"C:\Your\Directory");\n                    fileEnumerator.Properties["FileSpec"].SetValue(fileEnumerator, "*.txt");\n                    fileEnumerator.Properties["RecurseSubfolders"].SetValue(fileEnumerator, true);\n\n                    // Setting the collection to use this enumerator\n                    loopObj.ForEachEnumerator = fileEnumerator;\n                }\n            }\n        }\n    }\n}