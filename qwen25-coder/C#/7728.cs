using System;\nusing Google.Apis.Auth.OAuth2;\nusing Google.Apis.Gmail.v1;\nusing Google.Apis.Gmail.v1.Data;\nusing Google.Apis.Services;\nusing Google.Apis.Util.Store;\nusing System.IO;\nusing System.Threading;\n\nclass Program {\n    static void Main(string[] args) {\n        UserCredential credential;\n        using (var stream = new FileStream("credentials.json", FileMode.Open, FileAccess.Read)) {\n            string credPath = "token.json";\n            credential = GoogleWebAuthorizationBroker.AuthorizeAsync(\n                GoogleClientSecrets.Load(stream).Secrets,\n                Scopes.GmailSend,\n                "user",\n                CancellationToken.None,\n                new FileDataStore(credPath, true)).Result;\n        }\n\n        var service = new GmailService(new BaseClientService.Initializer() {\n            HttpClientInitializer = credential,\n            ApplicationName = "MyApp"\n        });\n\n        var mimeMessage = MimeKit.MimeMessage.CreateFromText("someone@somewhere.example", "emailAddress@mydomain.example", "Test", "<html><body>This is a test</body></html>");\n        var message = new Message { Raw = Base64UrlEncode(mimeMessage.ToString()) };\n        \n        service.Users.Messages.Send(message, "me").Execute();\n    }\n\n    static string Base64UrlEncode(string input) {\n        var data = System.Text.Encoding.UTF8.GetBytes(input);\n        return Convert.ToBase64String(data)\n            .Replace('+', '-')\n            .Replace('/', '_')\n            .TrimEnd('=');\n    }\n}