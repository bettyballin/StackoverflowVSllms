public void ReadWholeArray(string fileName, byte[] data)\n{\n    int offset = 0;\n    int remaining = data.Length;\n\n    log.Debug("ReadWholeArray");\n\n    using (FileStream stream = new FileStream(fileName, FileMode.Open, FileAccess.Read))\n    {\n        byte[] buffer = new byte[8192]; // Use a buffer size of 8KB\n        int bytesRead;\n\n        while (remaining > 0)\n        {\n            bytesRead = stream.Read(buffer, 0, Math.Min(buffer.Length, remaining));\n            if (bytesRead <= 0)\n                throw new EndOfStreamException(string.Format("End of stream reached with {0} bytes left to read", remaining));\n\n            Buffer.BlockCopy(buffer, 0, data, offset, bytesRead);\n\n            offset += bytesRead;\n            remaining -= bytesRead;\n        }\n    }\n}