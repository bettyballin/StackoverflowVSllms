using System;\nusing System.Linq;\nusing System.Text;\nusing System.Xml.Linq;\n\npublic static class XElementExtensions\n{\n    public static string GetXPath(this XElement element)\n    {\n        if (element == null) throw new ArgumentNullException(nameof(element));\n\n        var builder = new StringBuilder();\n        for (var node = element; node != null && !(node is XDocument); node = node.Parent)\n        {\n            var index = node.Elements(node.Name).Count(e => e != node && e.PreviousNode == null);\n            if (index > 0) // Has previous sibling with the same name\n                builder.Insert(0, $"/{node.Name}[{index + 1}]");\n            else\n                builder.Insert(0, $"/{node.Name}");\n        }\n        return builder.ToString();\n    }\n}