protected string RenderPartialViewToString(string viewName, object model)\n{\n    if (string.IsNullOrEmpty(viewName))\n        viewName = ControllerContext.RouteData.GetRequiredString("action");\n\n    ViewData.Model = model;\n\n    using (var sw = new StringWriter())\n    {\n        var viewResult = ViewEngines.Engines.FindPartialView(ControllerContext, viewName);\n        var viewContext = new ViewContext(ControllerContext, viewResult.View, ViewData, TempData, sw);\n\n        viewResult.View.Render(viewContext, sw);\n\n        return sw.GetStringBuilder().ToString();\n    }\n}