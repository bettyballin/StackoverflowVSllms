using Excel = Microsoft.Office.Interop.Excel;\nusing System.Runtime.InteropServices;\n\npublic static void AddTest()\n{\n    string filename = @"C:\addtest.xls";\n    object m = Type.Missing;\n    Excel.Application excelapp = new Excel.Application();\n    if (excelapp == null) throw new Exception("Can't start Excel");\n    Excel.Workbooks wbs = excelapp.Workbooks;\n\n    // Open an existing file and add a worksheet\n    Excel.Workbook wb = wbs.Open(filename,\n                               m, false, m, m, m, m,\n                               Excel.XlPlatform.xlWindows,\n                               m, m, m, m, m, m, m);\n\n    Excel.Sheets sheets = wb.Worksheets;\n\n    // This is the offending line:\n    Excel.Worksheet wsnew = sheets.Add(m, m, m, m) as Excel.Worksheet;\n\n    wb.SaveAs(filename, Excel.XlFileFormat.xlWorkbookNormal, m, m,\n              false, false, Excel.XlSaveAsAccessMode.xlNoChange, m, m, m, m, m);\n\n    // Cleanup\n    wsnew.Close(false);\n    MARSHAL.ReleaseComObject(wsnew); wsnew = null;\n\n    wb.Close(false, filename, m);\n    MARSHAL.ReleaseComObject(wb); wb = null;\n\n    wbs.Close();\n    MARSHAL.ReleaseComObject(wbs); wbs = null;\n\n    excelapp.Quit();\n    MARSHAL.ReleaseComObject(excelapp); excelapp = null;\n\n    // Perform garbage collection.\n    GC.Collect();\n    GC.WaitForPendingFinalizers();\n\n    GC.Collect();\n    GC.WaitForPendingFinalizers();\n}\n\nprivate static void MARSHAL_ReleaseComObject(object obj)\n{\n    try\n    {\n        if (obj != null && Marshal.IsComObject(obj))\n            Marshal.ReleaseComObject(obj);\n    }\n    catch { /* ignored */ }\n}