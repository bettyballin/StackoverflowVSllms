using (SqlConnection conn = new SqlConnection(connectionString))\n{\n    conn.Open();\n    SqlTransaction transaction = conn.BeginTransaction();\n\n    try\n    {\n        // Create your table adapter and data set here\n        SqlDataAdapter adapter = new SqlDataAdapter(command, conn);\n        adapter.UpdateCommand.Transaction = transaction;\n\n        adapter.Update(contractDS);\n\n        StringBuilder sqlCommandText = new StringBuilder();\n        foreach (DataRow row in contractDS.Tables[0].Rows)\n        {\n            if ((bool)row["isreturned"])\n            {\n                sqlCommandText.Append($"UPDATE product SET instock=1 WHERE prodid={row["productid"]}; ");\n            }\n        }\n\n        using (SqlCommand command = conn.CreateCommand())\n        {\n            command.Transaction = transaction;\n            command.CommandText = sqlCommandText.ToString();\n            command.ExecuteNonQuery();\n        }\n\n        transaction.Commit();\n    }\n    catch\n    {\n        transaction.Rollback();\n        throw; // or handle the exception as needed\n    }\n}