using System;\nusing System.Runtime.InteropServices;\n\npublic class BatteryLevel\n{\n    [StructLayout(LayoutKind.Sequential)]\n    public struct SYSTEM_POWER_STATUS_EX2\n    {\n        public byte ACLineStatus;\n        public byte BatteryFlag;\n        public byte BatteryLifePercent;\n        public byte Reserved1;\n        public int BatteryLifeTime;\n        public int BatteryFullLifeTime;\n        public byte Reserved2;\n        public byte BackupBatteryFlag;\n        public byte BackupBatteryLifePercent;\n        public byte Reserved3;\n    }\n\n    [DllImport("coredll.dll", SetLastError = true)]\n    static extern bool GetSystemPowerStatusEx2(ref SYSTEM_POWER_STATUS_EX2 lpSystemPowerStatus, bool fUpdate);\n\n    public static int GetCurrentBatteryLevel()\n    {\n        SYSTEM_POWER_STATUS_EX2 status = new SYSTEM_POWER_STATUS_EX2();\n        if (GetSystemPowerStatusEx2(ref status, true))\n        {\n            return status.BatteryLifePercent;\n        }\n        else\n        {\n            throw new SystemException("Failed to get power status");\n        }\n    }\n}\n\n// Usage\ntry\n{\n    int batteryLevel = BatteryLevel.GetCurrentBatteryLevel();\n    Console.WriteLine("Current Battery Level: " + batteryLevel + "%");\n}\ncatch (SystemException ex)\n{\n    Console.WriteLine(ex.Message);\n}