using System;\nusing System.Configuration;\nusing System.Web.Configuration;\nusing Microsoft.Web.Administration;\n\npublic bool IsHttpModuleLoaded(string moduleName)\n{\n    // Check in httpModules for older versions of IIS\n    var httpModulesSection = (HttpModulesSection)WebConfigurationManager.GetSection("system.web/httpModules");\n    if (httpModulesSection != null && httpModulesSection.Modules[moduleName] != null)\n    {\n        return true;\n    }\n\n    // Check in system.webServer/modules for newer versions of IIS\n    using (var serverManager = new ServerManager())\n    {\n        var siteName = System.Web.Hosting.HostingEnvironment.SiteName;\n        var appPoolName = System.Web.Hosting.HostingEnvironment.ApplicationVirtualPath;\n\n        Configuration webConfigConfiguration = serverManager.GetWebConfiguration(siteName, appPoolName);\n        ModuleCollection modules = webConfigConfiguration.GetSection("system.webServer/modules").GetCollection();\n\n        foreach (var module in modules)\n        {\n            if ((string)module["type"] == typeof(MyModule).FullName)\n            {\n                return true;\n            }\n        }\n    }\n\n    return false;\n}