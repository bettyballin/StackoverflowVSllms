using System;\nusing System.Linq;\n\nvar targetDate = new DateTime(2009, 4, 1, 0, 0, 0);\n\nvar query = from a in List.All()\n            join b in List.All() \n                on new {a.Value, a.Category, a.Description, a.Item} equals new {b.Value, b.Category, b.Description, b.Item}\n                into temp\n            from t in temp.Where(x => x.EffectiveDate > a.EffectiveDate).DefaultIfEmpty()\n            where a.Category == "General" &&\n                  a.Description == "Cover" &&\n                  a.EffectiveDate <= targetDate &&\n                  (t == null || t.EffectiveDate >= targetDate) &&\n                  a.Item == "Type"\n            group new { a } by new \n            { \n                a.Category, \n                a.Description, \n                a.Item, \n                a.Value, \n                a.Loading, \n                a.MaxDiscount,\n                a.SortOrder, \n                a.EffectiveDate, \n                a.ID \n            } into g\n            select new \n            {\n                Category = g.Key.Category,\n                Description = g.Key.Description,\n                Item = g.Key.Item,\n                Value = g.Key.Value,\n                Loading = g.Key.Loading,\n                MaxDiscount = g.Key.MaxDiscount,\n                FromDate = g.Min(x => x.a.EffectiveDate),\n                EndDate = g.First().a.EffectiveDate,\n                SortOrder = g.Key.SortOrder,\n                ID = g.Key.ID\n            }\n            orderby g.Key.SortOrder;