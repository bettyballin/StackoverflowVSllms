bool isSecure = false;\n\n   // Check for X-Forwarded-Protocol header which could be "https"\n   var forwardedProtocol = Request.ServerVariables["HTTP_X_FORWARDED_PROTO"];\n   if (!string.IsNullOrEmpty(forwardedProtocol))\n   {\n       isSecure = forwardedProtocol.Equals("https", StringComparison.OrdinalIgnoreCase);\n   }\n\n   // Alternatively, check for Front-End-Https header which could be "on"\n   var frontEndHttps = Request.ServerVariables["HTTP_FRONT_END_HTTPS"];\n   if (!isSecure && !string.IsNullOrEmpty(frontEndHttps))\n   {\n       isSecure = frontEndHttps.Equals("on", StringComparison.OrdinalIgnoreCase);\n   }\n\n   // Fallback to original IsSecureConnection check\n   if (!isSecure)\n   {\n       isSecure = Request.IsSecureConnection;\n   }