using System;\nusing System.Text;\nusing System.Threading;\n\nnamespace POSSystem\n{\n    public class CardReaderHandler\n    {\n        private StringBuilder _inputBuffer = new StringBuilder();\n        private Timer _inputTimer;\n\n        public void KeyPress(char key)\n        {\n            // Reset the timer on each keystroke to detect end of input\n            if (_inputTimer != null)\n                _inputTimer.Dispose();\n\n            _inputBuffer.Append(key);\n            \n            // Setup a simple 50ms timeout to check for end of input\n            _inputTimer = new Timer(OnInputTimeout, null, TimeSpan.FromMilliseconds(50), Timeout.InfiniteTimeSpan);\n        }\n\n        private void OnInputTimeout(object state)\n        {\n            // Check if buffer contains sentinel characters (e.g., %B as a starting character and ?; as ending sequence for Tracks 1 or 2)\n            string input = _inputBuffer.ToString();\n            if ((input.StartsWith("%B") && input.Contains("?;")) || \n                (input.StartsWith(";") && input.EndsWith("=")))\n            {\n                // Validate further as needed\n                ProcessCardData(input);\n                _inputBuffer.Clear(); // Clear buffer for next swipe\n            }\n        }\n\n        private void ProcessCardData(string data)\n        {\n            Console.WriteLine("Processing card data: " + data);\n            // Further processing logic here (e.g., parsing tracks, validation, etc.)\n        }\n    }\n}