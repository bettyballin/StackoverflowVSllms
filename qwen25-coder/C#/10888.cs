public static string RenderPartialToString(this ControllerBase controller, string partialViewName, object model)\n{\n    if (string.IsNullOrEmpty(partialViewName))\n        partialViewName = ((RazorView)controller.View).ViewPath;\n\n    controller.ControllerContext.Controller.ViewData.Model = model;\n    \n    using (var sw = new StringWriter())\n    {\n        var viewResult = ViewEngines.Engines.FindPartialView(controller.ControllerContext, partialViewName);\n        var viewContext = new ViewContext(controller.ControllerContext, \n                                          ((RazorView)viewResult.View), \n                                          controller.ViewData, \n                                          controller.TempData, \n                                          sw);\n        viewResult.View.Render(viewContext, sw);\n\n        return sw.GetStringBuilder().ToString();\n    }\n}