using System;\nusing System.IO;\nusing System.Text;\nusing System.Web;\nusing System.Web.Mvc;\nusing System.Web.UI;\n\npublic static class ViewHelper\n{\n    public static string RenderViewToString(ControllerContext context, \n                                           string viewName, \n                                           string masterPagePath, \n                                           object model)\n    {\n        if (string.IsNullOrEmpty(viewName))\n            viewName = context.RouteData.GetRequiredString("action");\n\n        var viewData = new ViewDataDictionary(model);\n        using (var sw = new StringWriter())\n        {\n            var viewResultViewEngine = FindView(context, viewName, masterPagePath);\n            var viewContext = new ViewContext(context, \n                                              viewResultViewEngine.View, \n                                              viewData, \n                                              new TempDataDictionary(), \n                                              sw);\n\n            Render(viewResultViewEngine.View, viewContext);\n\n            return sw.GetStringBuilder().ToString();\n        }\n    }\n\n    private static void Render(IView view, ViewContext viewContext)\n    {\n        view.Render(viewContext, viewContext.Writer);\n    }\n\n\n    private static ViewEngineResult FindView(ControllerContext context,\n                                             string viewName,\n                                             string masterPagePath)\n    {\n        var viewEngineResult = ViewEngines.Engines.FindView(context, \n                                                           viewName, \n                                                           masterPagePath);\n\n        if (viewEngineResult.View == null)\n            throw new InvalidOperationException(\n                string.Format("The view '{0}' or its master page '{1}' could not be found", \n                              viewName, \n                              masterPagePath));\n\n        return viewEngineResult;\n    }\n}