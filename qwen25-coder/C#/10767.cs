protected void AddPhotoToDatabase()\n{\n    byte[] OriginalPhoto = GetImage();\n    byte[] Thumbnail = GenerateThumbnail();\n    string Title = FileUpload1.FileName.ToString();\n    \n    // Use parameterized query to avoid SQL injection and handle binary data correctly.\n    string sql = "INSERT INTO [ProfileGallery] ([UserId], [Title], [OriginalImage], [ThumbImage]) VALUES (@UserId, @Title, @OriginalImage, @ThumbImage)";\n    \n    string strCon = System.Web.Configuration.WebConfigurationManager.ConnectionStrings["SocialSiteConnectionString"].ConnectionString;\n    using (SqlConnection conn = new SqlConnection(strCon))\n    using (SqlCommand comm = new SqlCommand(sql, conn))\n    {\n        // Add parameters with data types.\n        comm.Parameters.AddWithValue("@UserId", User.Identity.Name);\n        comm.Parameters.AddWithValue("@Title", Title);\n        comm.Parameters.Add("@OriginalImage", SqlDbType.VarBinary).Value = OriginalPhoto;\n        comm.Parameters.Add("@ThumbImage", SqlDbType.VarBinary).Value = Thumbnail;\n\n        conn.Open();\n        comm.ExecuteNonQuery();\n    }\n}\n\nprotected byte[] GetImage()\n{\n    using (var binaryReader = new BinaryReader(FileUpload1.PostedFile.InputStream))\n    {\n        return binaryReader.ReadBytes(FileUpload1.PostedFile.ContentLength);\n    }\n}\n\nprotected byte[] GenerateThumbnail()\n{\n    using (System.Drawing.Image image = System.Drawing.Image.FromStream(FileUpload1.PostedFile.InputStream))\n    {\n        double thumbwidth = 0;\n        double thumbheight = 0;\n        double imgsz = 150.0;\n        if (imgsz / image.Width < imgsz / image.Height)\n        {\n            thumbwidth = imgsz;\n            thumbheight = image.Height * (imgsz / image.Width);\n        }\n        else\n        {\n            thumbwidth = image.Width * (imgsz / image.Height);\n            thumbheight = imgsz;\n        }\n\n        using (System.Drawing.Image thumb = image.GetThumbnailImage((int)thumbwidth, (int)thumbheight, delegate() { return false; }, IntPtr.Zero))\n        using (MemoryStream ms = new MemoryStream())\n        {\n            thumb.Save(ms, System.Drawing.Imaging.ImageFormat.Jpeg);\n            return ms.ToArray();\n        }\n    }\n}