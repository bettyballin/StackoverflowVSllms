using System;\nusing System.IO;\n\npublic static class FileUtility\n{\n    public static bool WaitForFile(string filePath, int timeoutMilliseconds = 30000)\n    {\n        var startTime = DateTime.Now;\n        while (true)\n        {\n            try\n            {\n                using (FileStream inputStream = new FileStream(filePath, FileMode.Open, FileAccess.Read, FileShare.None, 128))\n                {\n                    return true; // The file is ready for access.\n                }\n            }\n            catch (FileNotFoundException) when ((DateTime.Now - startTime).TotalMilliseconds < timeoutMilliseconds)\n            {\n                // Wait and try again if the file does not exist yet\n            }\n            catch (IOException) when (((DateTime.Now - startTime).TotalMilliseconds < timeoutMilliseconds) && \n                                      (Marshal.GetHRForException(Exception.InnerException) == unchecked((int)0x80070020)))\n            {\n                // Catch sharing violation exception and try again\n            }\n\n            if ((DateTime.Now - startTime).TotalMilliseconds >= timeoutMilliseconds)\n            {\n                return false; // Timeout occurred, file is not ready.\n            }\n\n            System.Threading.Thread.Sleep(100); // Sleep for a short period before trying again\n        }\n    }\n}