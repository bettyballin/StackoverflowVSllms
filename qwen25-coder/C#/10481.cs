void CalcNewDimensions(ref int w, ref int h, int MaxWidth, int MaxHeight)\n{\n    // Calculate the aspect ratio of the original image\n    double originalAspect = (double)w / h;\n    \n    // Calculate the aspect ratio of the bounding box\n    double maxAspect = (double)MaxWidth / MaxHeight;\n    \n    if (originalAspect > maxAspect)\n    {\n        // The original is wider than the bounding box, so resize by width first\n        w = MaxWidth;\n        h = (int)(w / originalAspect);\n        \n        // Check and make sure that the new height does not exceed MaxHeight\n        if (h > MaxHeight)\n        {\n            h = MaxHeight;\n            w = (int)(h * originalAspect);\n        }\n    }\n    else\n    {\n        // The original is taller than or equal to the bounding box, so resize by height first\n        h = MaxHeight;\n        w = (int)(h * originalAspect);\n        \n        // Check and make sure that the new width does not exceed MaxWidth\n        if (w > MaxWidth)\n        {\n            w = MaxWidth;\n            h = (int)(w / originalAspect);\n        }\n    }\n}