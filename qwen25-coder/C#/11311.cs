using (var conn = new System.Data.SqlClient.SqlConnection("Data Source=.;Initial Catalog=DBNAME;Integrated Security=True"))\n{\n    conn.Open();\n    var cmd = conn.CreateCommand();\n    cmd.CommandText = "UPDATE ...";\n    cmd.ExecuteNonQuery();\n\n    // Clear the pool after closing the previous connection before dropping the database.\n    SqlConnection.ClearPool(conn);\n}\n\n// Drop and recreate the database\nstring sql = "Alter Database DBNAME set single_user with rollback immediate drop database DBNAME";\nvar server = new Microsoft.SqlServer.Management.Smo.Server(".");\nserver.ConnectionContext.ExecuteNonQuery(sql);\nserver.ConnectionContext.Disconnect();\n\nsql = File.ReadAllText("PathToDotSqlFile...");\nserver = new Microsoft.SqlServer.Management.Smo.Server(".");\nserver.ConnectionContext.ExecuteNonQuery(sql);\nserver.ConnectionContext.Disconnect();\n\n// Now, the pool is clear for the new database\nusing (var conn = new System.Data.SqlClient.SqlConnection("Data Source=.;Initial Catalog=DBNAME;Integrated Security=True"))\n{\n    conn.Open();\n    var cmd = conn.CreateCommand();\n    cmd.CommandText = "UPDATE ...";\n    cmd.ExecuteNonQuery();\n}