protected void Application_PostAuthenticateRequest(object sender, EventArgs e)\n{\n    var context = HttpContext.Current;\n    var identity = context.User.Identity;\n\n    if (identity.IsAuthenticated && !context.Session["UserRoleSet"] as bool? ?? false)\n    {\n        if (!Roles.IsUserInRole(identity.Name, "Users"))\n        {\n            Roles.AddUserToRole(identity.Name, "Users");\n            // Set a session key to avoid checking on subsequent requests.\n            context.Session["UserRoleSet"] = true;\n        }\n    }\n}