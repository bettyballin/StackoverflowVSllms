using Microsoft.Win32;\nusing System;\n\nclass Program\n{\n    static void Main()\n    {\n        try\n        {\n            using (RegistryKey reg = Registry.LocalMachine.OpenSubKey(@"SYSTEM\CurrentControlSet\Control\Session Manager\Environment", true))\n            {\n                if (reg == null)\n                {\n                    throw new Exception("Could not open the registry key.");\n                }\n                \n                reg.SetValue("MYVAR", "SomeVal", RegistryValueKind.ExpandString);\n                Console.WriteLine("Environment variable set successfully.");\n            }\n        }\n        catch (Exception ex)\n        {\n            Console.WriteLine("Failed to set environment variable: " + ex.Message);\n        }\n    }\n}