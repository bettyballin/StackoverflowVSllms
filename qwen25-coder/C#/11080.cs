public class HeaderInspector : IDispatchMessageInspector\n{\n    public object AfterReceiveRequest(ref Message request, IClientChannel channel, InstanceContext instanceContext)\n    {\n        var header = request.Headers.GetHeader<string>("FactoryId", "http://yournamespace.com");\n        OperationContext.Current.Extensions.Add(new FactoryIdExtension { FactoryId = header });\n        return null;\n    }\n\n    public void BeforeSendReply(ref Message reply, object correlationState) { }\n}\n\npublic class FactoryIdExtension : IExtension<OperationContext>\n{\n    public string FactoryId { get; set; }\n\n    public void Attach(OperationContext owner) {}\n    public void Detach(OperationContext owner) {}\n}