using System;\nusing System.Data;\nusing System.Data.SqlClient;\n\npublic class DatabaseCopy\n{\n    private readonly string _sourceConnectionString;\n    private readonly string _destinationConnectionString;\n\n    public DatabaseCopy(string sourceConnectionString, string destinationConnectionString)\n    {\n        _sourceConnectionString = sourceConnectionString;\n        _destinationConnectionString = destinationConnectionString;\n    }\n\n    public void CopyData()\n    {\n        using (SqlConnection srcConnection = new SqlConnection(_sourceConnectionString))\n        using (SqlConnection destConnection = new SqlConnection(_destinationConnectionString))\n        {\n            srcConnection.Open();\n            destConnection.Open();\n\n            // Assuming a parent table named 'ParentTable' and a child table 'ChildTable'\n            string selectCommandText = "SELECT Id, Column1, Column2 FROM ParentTable WHERE SomeCondition = @SomeCondition";\n            using (SqlCommand selectCmd = new SqlCommand(selectCommandText, srcConnection))\n            {\n                // Set your condition parameter if needed\n                selectCmd.Parameters.AddWithValue("@SomeCondition", 1);\n\n                using (SqlDataReader reader = selectCmd.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        int newParentId;\n                        using (SqlCommand insertParentCommand = new SqlCommand("INSERT INTO ParentTable (Column1, Column2) VALUES (@Column1, @Column2); SELECT SCOPE_IDENTITY();", destConnection))\n                        {\n                            insertParentCommand.Parameters.AddWithValue("@Column1", reader["Column1"]);\n                            insertParentCommand.Parameters.AddWithValue("@Column2", reader["Column2"]);\n\n                            newParentId = Convert.ToInt32(insertParentCommand.ExecuteScalar());\n                        }\n\n                        // Now, copy child records associated with this parent\n                        string selectChildCommandText = "SELECT Id, ChildColumn FROM ChildTable WHERE ParentId = @ParentId";\n                        using (SqlCommand selectChildCmd = new SqlCommand(selectChildCommandText, srcConnection))\n                        {\n                            selectChildCmd.Parameters.AddWithValue("@ParentId", reader["Id"]);\n                            using (SqlDataReader childReader = selectChildCmd.ExecuteReader())\n                            {\n                                while (childReader.Read())\n                                {\n                                    using (SqlCommand insertChildCommand = new SqlCommand("INSERT INTO ChildTable (ParentId, ChildColumn) VALUES (@NewParentId, @ChildColumn);", destConnection))\n                                    {\n                                        insertChildCommand.Parameters.AddWithValue("@NewParentId", newParentId);\n                                        insertChildCommand.Parameters.AddWithValue("@ChildColumn", childReader["ChildColumn"]);\n\n                                        insertChildCommand.ExecuteNonQuery();\n                                    }\n                                }\n                            }\n                        }\n                    }\n                }\n            }\n        }\n    }\n}