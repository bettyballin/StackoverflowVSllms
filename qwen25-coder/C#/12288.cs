try {\n    using (NetworkStream ns = client.GetStream()) {\n        if ((ns.CanRead == true) && (ns.CanWrite == true)) {\n            try {\n                int len;\n                byte[] AOK = Encoding.ASCII.GetBytes("AOK");\n                using (FileStream fs = new FileStream(location, FileMode.Create, FileAccess.Write)) {\n                    do {\n                        len = ns.Read(buf, 0, client.ReceiveBufferSize);\n                        if (len > 0) {\n                            fs.Write(buf, 0, len);\n                            ns.Write(AOK, 0, AOK.Length);\n                        }\n                    } while (len > 0);\n                }\n                byte[] okBuf = Encoding.ASCII.GetBytes("Message Received on Server");\n                ns.Write(okBuf, 0, okBuf.Length);\n            } catch (Exception err) {\n                Global.LogError("ServerForm.cs - Worker_Engine(DoWorkEvent)", err);\n                byte[] errBuf = Encoding.ASCII.GetBytes(err.Message);\n                ns.Write(errBuf, 0, errBuf.Length);\n            }\n        }\n    }\n} finally {\n    worker.ReportProgress(1, location);\n}