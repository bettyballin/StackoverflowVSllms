using System;\nusing System.Data.SQLite;\nusing Dapper;\n\npublic class BookingService\n{\n    private readonly string _connectionString = "Data Source=yourdatabase.db;";\n\n    public bool CreateBooking(int timeSlotId, int customerId)\n    {\n        using (var connection = new SQLiteConnection(_connectionString))\n        {\n            connection.Open();\n\n            // Start a transaction\n            using (var transaction = connection.BeginTransaction())\n            {\n                try\n                {\n                    // Check if the timeslot is already booked\n                    var existingBookingVersion = connection.QueryFirstOrDefault<int>(\n                        "SELECT Version FROM Bookings WHERE TimeSlotId = @TimeSlotId AND Date = @Date FOR UPDATE",\n                        new { TimeSlotId = timeSlotId, Date = DateTime.Today.Date },\n                        transaction);\n\n                    if (existingBookingVersion != null)\n                    {\n                        // If a booking exists, return false or handle accordingly\n                        throw new ApplicationException("Time slot already booked.");\n                    }\n\n                    // Insert the new booking with an initial version\n                    var rowsAffected = connection.Execute(\n                        "INSERT INTO Bookings (CustomerId, TimeSlotId, Date, Version) VALUES (@CustomerId, @TimeSlotId, @Date, 0)",\n                        new { CustomerId = customerId, TimeSlotId = timeSlotId, Date = DateTime.Today.Date },\n                        transaction);\n\n                    if (rowsAffected == 1)\n                    {\n                        // Commit the transaction\n                        transaction.Commit();\n                        return true;\n                    }\n                }\n                catch (Exception ex)\n                {\n                    // Rollback in case of error\n                    transaction.Rollback();\n                    Console.WriteLine("Error: " + ex.Message);\n                }\n            }\n        }\n\n        return false;\n    }\n}