using System;\nusing System.IO;\nusing System.Web;\n\npublic class ResponseModifier : IHttpModule\n{\n    public void Init(HttpApplication context)\n    {\n        context.BeginRequest += new EventHandler(OnBeginRequest);\n        context.EndRequest += new EventHandler(OnEndRequest);\n    }\n\n    private void OnBeginRequest(object sender, EventArgs e)\n    {\n        // Hook into the event that occurs before the request is processed\n    }\n\n    private void OnEndRequest(object sender, EventArgs e)\n    {\n        HttpApplication app = (HttpApplication)sender;\n        HttpResponse response = app.Response;\n\n        // Check if we are dealing with an HTML content type\n        if (response.ContentType == "text/html")\n        {\n            using (var memoryStream = new MemoryStream())\n            {\n                var filterStream = new ResponseFilterStream(memoryStream, response.Filter);\n                response.Filter = filterStream;\n            }\n        }\n    }\n\n    public void Dispose()\n    { }\n\n    private class ResponseFilterStream : Stream\n    {\n        private readonly Stream _baseStream;\n        private readonly Stream _outputStream;\n\n        public ResponseFilterStream(Stream baseStream, Stream outputStream)\n        {\n            _baseStream = baseStream;\n            _outputStream = outputStream;\n        }\n\n        public override void Write(byte[] buffer, int offset, int count)\n        {\n            var writer = new StreamWriter(_baseStream);\n            var responseText = System.Text.Encoding.UTF8.GetString(buffer, 0, count);\n\n            // Use your Regex here to modify the text as needed\n            responseText = ModifyResponseContent(responseText);\n\n            var data = System.Text.Encoding.UTF8.GetBytes(responseText);\n            _outputStream.Write(data, 0, data.Length);\n        }\n\n        private string ModifyResponseContent(string content)\n        {\n            // Example modification using Regular Expressions\n            // Replace img.mysite.com with img1.mysite.com\n            return System.Text.RegularExpressions.Regex.Replace(\n                content,\n                "https?://img\\.mysite\\.com/",\n                "http://img1.mysite.com/"\n            );\n        }\n\n        public override bool CanRead { get; } = false;\n        public override bool CanSeek { get; } = true;\n        public override bool CanWrite { get; } = true;\n        public override long Length => _baseStream.Length;\n        public override long Position { get; set; }\n\n        public override void Flush() => _baseStream.Flush();\n        public override int Read(byte[] buffer, int offset, int count) => throw new NotImplementedException();\n        public override long Seek(long offset, SeekOrigin origin) => _baseStream.Seek(offset, origin);\n        public override void SetLength(long value) => _baseStream.SetLength(value);\n    }\n}