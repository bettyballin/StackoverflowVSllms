protected void Application_AuthenticateRequest(object sender, EventArgs e)\n{\n    if (HttpContext.Current.User == null || !HttpContext.Current.User.Identity.IsAuthenticated)\n        return;\n\n    var identity = HttpContext.Current.User.Identity;\n    if (identity is WindowsIdentity && identity.IsAuthenticated)\n    {\n        // Validate AD user and set roles accordingly\n    }\n    else if (FormsAuthentication.FormsCookieName.Equals(identity.Name, StringComparison.OrdinalIgnoreCase))\n    {\n        // Validate forms authentication ticket\n    }\n\n    // Create a new generic principal with your custom roles\n    var principal = new GenericPrincipal(identity, new string[] { /*Roles*/ });\n    HttpContext.Current.User = principal;\n}