using System;\nusing System.Runtime.InteropServices;\n\npublic class QTPLauncher {\n    [DllImport("ole32.dll")]\n    private static extern int CoInitializeEx(IntPtr pvReserved, uint dwCoInit);\n\n    const uint COINIT_APARTMENTTHREADED = 0x2;\n\n    virtual public QuickTest.Application LaunchQuickTestPro()\n    {\n        // Initialize COM library on current thread\n        CoInitializeEx(IntPtr.Zero, COINIT_APARTMENTTHREADED);\n        \n        QuickTest.Application qtpApp = new QuickTest.Application();\n        qtpApp.Launch();\n        qtpApp.Visible = false;\n        return qtpApp;\n    }\n\n    virtual public void ExitQTP(ref QuickTest.Application qtpApp)\n    {\n        if (qtpApp != null)\n        {\n            try\n            {\n                qtpApp.Quit();\n            }\n            catch (Exception ex)\n            {\n                Console.Error.WriteLine("Failed to quit QTP: " + ex.Message);\n            }\n\n            Marshal.ReleaseComObject(qtpApp);\n            GC.Collect(); // Force garbage collection to clean up resources.\n            GC.WaitForPendingFinalizers();\n            qtpApp = null;\n        }\n    }\n}