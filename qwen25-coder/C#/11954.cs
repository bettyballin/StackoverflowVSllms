using System;\nusing System.Configuration;\nusing System.Data.SqlClient;\nusing System.Net.Mail;\n\nclass Program\n{\n    static void Main(string[] args)\n    {\n        string connectionString = ConfigurationManager.ConnectionStrings["EmailDb"].ConnectionString;\n        string query = "SELECT EmailID, RecipientEmail, Subject, Body FROM Emails WHERE ScheduledDateTime <= @CurrentTime AND IsSent = 0";\n\n        using (SqlConnection connection = new SqlConnection(connectionString))\n        {\n            SqlCommand command = new SqlCommand(query, connection);\n            command.Parameters.AddWithValue("@CurrentTime", DateTime.Now);\n\n            try\n            {\n                connection.Open();\n                using (SqlDataReader reader = command.ExecuteReader())\n                {\n                    while (reader.Read())\n                    {\n                        int emailId = (int)reader["EmailID"];\n                        string recipientEmail = (string)reader["RecipientEmail"];\n                        string subject = (string)reader["Subject"];\n                        string body = (string)reader["Body"];\n\n                        SendEmail(recipientEmail, subject, body);\n                        MarkEmailAsSent(emailId, connection);\n                    }\n                }\n            }\n            catch (Exception ex)\n            {\n                // Log exception\n                Console.WriteLine("Error sending emails: " + ex.Message);\n            }\n        }\n    }\n\n    private static void SendEmail(string recipientEmail, string subject, string body)\n    {\n        MailMessage mail = new System.Net.Mail.MailMessage("from@example.com", recipientEmail, subject, body);\n        using (SmtpClient client = new SmtpClient())\n        {\n            client.Send(mail);\n        }\n    }\n\n    private static void MarkEmailAsSent(int emailId, SqlConnection connection)\n    {\n        string updateQuery = "UPDATE Emails SET IsSent = 1 WHERE EmailID = @EmailID";\n        using (SqlCommand command = new SqlCommand(updateQuery, connection))\n        {\n            command.Parameters.AddWithValue("@EmailID", emailId);\n            command.ExecuteNonQuery();\n        }\n    }\n}