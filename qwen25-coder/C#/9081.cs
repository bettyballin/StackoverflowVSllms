using System;\nusing System.Web.UI;\nusing System.DirectoryServices.AccountManagement;\n\npublic partial class ChangePassword : Page\n{\n    protected void btnChangePassword_Click(object sender, EventArgs e)\n    {\n        string userName = txtUsername.Text;\n        string oldPassword = txtOldPassword.Text;\n        string newPassword = txtNewPassword.Text;\n\n        try\n        {\n            using (PrincipalContext context = new PrincipalContext(ContextType.Domain))\n            {\n                UserPrincipal user = UserPrincipal.FindByIdentity(context, userName);\n\n                if (user != null)\n                {\n                    // Attempt to validate old password and change it\n                    bool isAuthenticUser = ValidateCredentials(context, userName, oldPassword);\n                    if (isAuthenticUser)\n                    {\n                        user.ChangePassword(oldPassword, newPassword);\n                        user.Save();\n                        lblMessage.Text = "Password changed successfully";\n                    }\n                    else\n                    {\n                        lblMessage.Text = "Invalid username or password.";\n                    }\n                }\n                else\n                {\n                    lblMessage.Text = "Username not found.";\n                }\n            }\n        }\n        catch (Exception ex)\n        {\n            // Log the exception\n            lblMessage.Text = "An error occurred: " + ex.Message;\n        }\n    }\n\n    private bool ValidateCredentials(PrincipalContext context, string username, string password)\n    {\n        try\n        {\n            var result = new System.DirectoryServices.AccountManagement.UserPrincipal(context) { Name = username };\n            return result.Context.ValidateCredentials(username, password);\n        }\n        catch (Exception ex)\n        {\n            // Log the exception\n            return false;\n        }\n    }\n}