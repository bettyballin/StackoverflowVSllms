using System.Security.Principal;\nusing System.IO;\n\npublic class Impersonator\n{\n    private WindowsImpersonationContext _impersonationContext;\n\n    public void ImpersonateUser(string domain, string username, string password)\n    {\n        // Create a WindowsIdentity object using the provided credentials\n        var identity = new WindowsPrincipal(new WindowsIdentity(username, domain));\n        \n        // Logon user and create an impersonation context\n        bool success = LogonUser(\n            username,\n            domain,\n            password,\n            LOGON32_LOGON_INTERACTIVE,\n            LOGON32_PROVIDER_DEFAULT,\n            out var token);\n\n        if (!success)\n        {\n            var errorCode = Marshal.GetLastWin32Error();\n            throw new Exception($"Failed to impersonate user. Error code: {errorCode}");\n        }\n\n        _impersonationContext = WindowsIdentity.Impersonate(token);\n    }\n\n    public void UndoImpersonation()\n    {\n        // Revert to the original user\n        if (_impersonationContext != null)\n        {\n            _impersonationContext.Undo();\n            CloseHandle(token);\n        }\n    }\n\n    [DllImport("advapi32.dll", SetLastError = true)]\n    private static extern bool LogonUser(\n        string userName,\n        string domainName,\n        string password,\n        int logonType,\n        int logonProvider,\n        out IntPtr token);\n\n    private const int LOGON32_LOGON_INTERACTIVE = 2;\n    private const int LOGON32_PROVIDER_DEFAULT = 0;\n\n    [DllImport("kernel32.dll", CharSet = CharSet.Auto)]\n    private extern static bool CloseHandle(IntPtr handle);\n\n    // Usage example\n    // Impersonate the user and read a file\n    public void ReadFileAsUser(string filePath)\n    {\n        try\n        {\n            ImpersonateUser("DOMAIN", "username", "password");\n            string content = File.ReadAllText(filePath);\n            Console.WriteLine(content);\n        }\n        finally\n        {\n            UndoImpersonation();\n        }\n    }\n}