using System;\nusing System.ServiceProcess;\n\npublic partial class MyService : ServiceBase\n{\n    public MyService()\n    {\n        InitializeComponent();\n        \n        // Register the unhandled exception handler\n        AppDomain.CurrentDomain.UnhandledException += CurrentDomain_UnhandledException;\n    }\n\n    protected override void OnStart(string[] args)\n    {\n        try\n        {\n            MyServiceComponent.Start();\n        }\n        catch (Exception ex)\n        {\n            HandleException(ex);\n        }\n    }\n\n    private void HandleException(Exception ex)\n    {\n        // Call into your custom exception handler\n        MyExceptionHandlingComponent.ManuallyHandleException(ex);\n        \n        // Set the exit code to indicate failure\n        ExitCode = -1;\n\n        // Terminate the service with an error code\n        Environment.FailFast("Stopped due to unhandled exception", ex);\n    }\n\n    private void CurrentDomain_UnhandledException(object sender, UnhandledExceptionEventArgs e)\n    {\n        var ex = (Exception)e.ExceptionObject;\n        \n        // Handle the unhandled exception\n        HandleException(ex);\n    }\n}