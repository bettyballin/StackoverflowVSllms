# Step 1: Find duplicates\nduplicates = Location.group(:lat, :lng).having('count(*) > 1').pluck(:lat, :lng)\n\nduplicates.each do |(lat, lng)|\n  # Get all locations with the same lat and lng\n  group = Location.where(lat: lat, lng: lng)\n\n  # Find the one to keep\n  to_keep = group.find { |loc| !loc.url.blank? } || group.order(created_at: :asc).first\n\n  # Destroy all others\n  group.where.not(id: to_keep.id).destroy_all\nend