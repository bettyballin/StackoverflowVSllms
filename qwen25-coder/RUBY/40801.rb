require 'redcarpet'\nrequire 'rouge'\nrequire 'rouge/plugins/redcarpet'\n\nclass HTMLWithCodeHighlight < Redcarpet::Render::HTML\n  include Rouge::Plugins::Redcarpet\n\n  def block_code(code, language)\n    Rouge.highlight(code, language || 'plaintext', 'html')\n  end\nend\n\nmarkdown = Redcarpet::Markdown.new(HTMLWithCodeHighlight)\n\n# Usage in your view or controller when rendering user content\nsafe_html_content = markdown.render(user_submitted_markdown_string)