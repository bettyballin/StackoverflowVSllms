# app/models/product.rb\nclass Product < ApplicationRecord\n  validates :permalink, uniqueness: true\n\n  validate :permalinks_must_be_unique_across_routes\n\n  private\n\n  def permalinks_must_be_unique_across_routes\n    # Get all routes except resources\n    special_routes = Rails.application.routes.routes.select do |route|\n      route.path.is_a?(ActionDispatch::Journey::Path::Pattern) && !resource_route?(route)\n    end\n\n    # Check if the generated permalink matches any of the paths in special_routes\n    special_routes.each do |route|\n      if route.path.spec.to_s.match?(/^\A\/products\/#{Regexp.escape(permalink)}\z/)\n        errors.add(:permalink, "is reserved and cannot be used.")\n        break\n      end\n    end\n  end\n\n  def resource_route?(route)\n    # Check if the path is a generic RESTful route for products\n    route.path.spec.to_s.match?(/^\A\/products(?:\/[a-zA-Z0-9\-_\%]+)?\z/)\n  end\nend