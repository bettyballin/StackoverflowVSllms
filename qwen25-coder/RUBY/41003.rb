<%= drop_receiving_element "move_drop_zone_#{node.id.to_s}", \n  :onDrop => "customMoveUser(this, draggable)", \n  :accept => "move_user" %>\n\n<span id="move_user_<%=user.id%>_<%= node.id.to_s %>" class="move_user">\n  <%=image_tag('move_user.png') %>\n</span> \n\n<%= draggable_element "move_user_#{user.id}_#{node.id}", \n  :revert => true, \n  :draggable => { :ghosting => true },\n  :beforeDrag => "startDrag(this)"\n%>\n\n<script type="text/javascript">\nfunction startDrag(element) {\n  element.dataset.lastNodeId = element.parentNode.id.split('_')[3];\n}\n\nfunction customMoveUser(dropZone, draggable) {\n  var userId = draggable.id.split('_')[2];\n  var fromNodeId = draggable.dataset.lastNodeId;\n  var toNodeId = dropZone.id.split('_')[3];\n\n  new Ajax.Request('<%= move_user_path %>', {\n    method: 'put',\n    parameters: { id: toNodeId, user_id: userId, from_node_id: fromNodeId },\n    onSuccess: function(transport) {\n      // Refresh or update the UI as needed\n      $('users').update(transport.responseText);\n    }\n  });\n}\n</script>