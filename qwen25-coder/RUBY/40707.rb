require 'find'\nrequire 'fileutils'\n\ndef find_in_files(searchtext, file_filter: ['txt', 'htm'], start_from: 'c:/docs/2009',\n                  report_filenames: false, report_filecount_only: false,\n                  use_regex: true)\n  results = []\n  file_count = 0\n\n  Find.find(start_from) do |path|\n    next unless FileTest.file?(path)\n    ext = File.extname(path).downcase.tr(".", "")\n    if file_filter.include?(ext)\n      content = File.read(path, encoding: 'UTF-8', fallback_encoding: Encoding::BINARY)\n      found = use_regex ? !!(content =~ /#{Regexp.escape(searchtext)}/) : content.include?(searchtext)\n      if found\n        if report_filecount_only\n          file_count += 1\n        elsif report_filenames\n          results << path\n        else\n          results << "#{path}: #{content}"\n        end\n      end\n    end\n  end\n\n  return report_filecount_only ? file_count : results.join("\n")\nend\n\n# Example usage\nputs find_in_files('example', file_filter: ['txt', 'htm'], start_from: 'c:/docs/2009', report_filenames: true)