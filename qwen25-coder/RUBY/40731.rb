# app/channels/chat_channel.rb\nclass ChatChannel < ApplicationCable::Channel\n  def subscribed\n    stream_from "chat_room_#{params[:room_id]}"\n  end\n\n  def unsubscribed\n    # Any cleanup needed when channel is unsubscribed\n  end\n\n  def speak(data)\n    Message.create! content: data['message'], user: current_user, chat_room_id: params[:room_id]\n    ActionCable.server.broadcast "chat_room_#{params[:room_id]}", message: render_message(moderate_spam(data))\n  end\n\n  private\n\n  def render_message(message)\n    ApplicationController.renderer.render partial: 'messages/message', locals: {message: message}\n  end\nend