import re\n\ndef stripMatchedQuotes(item):\n    """Remove matched quotes from the input string"""\n    MatchedSingleQuotes = re.compile(r"'(.*)'", re.LOCALE)\n    MatchedDoubleQuotes = re.compile(r'"(.*)"', re.LOCALE)\n    item = MatchedSingleQuotes.sub(r'\1', item, 1)\n    item = MatchedDoubleQuotes.sub(r'\1', item, 1)\n    return item\n\ndef processVariables(item):\n    """Process variable definitions and uses in a single pass"""\n    Variables = {}\n    pattern = re.compile(r'<%(.*?)%>', re.LOCALE)\n\n    def replace(match):\n        """Callback function to handle variable definitions and uses"""\n        content = match.group(1)\n        if '=' in content:\n            var_name, var_def = content.split('=', 1)\n            var_name = stripMatchedQuotes(var_name).upper().strip()\n            var_def = stripMatchedQuotes(var_def.strip())\n            Variables[var_name] = var_def\n            return ''\n        else:\n            var_name = stripMatchedQuotes(content).upper().strip()\n            return Variables.get(var_name, '')\n\n    item = pattern.sub(replace, item)\n    return item