# models.py\nfrom django.db import models\nfrom django.contrib.auth.models import User\n\nclass Favorite(models.Model):\n    user = models.ForeignKey(User, on_delete=models.CASCADE)\n    product = models.ForeignKey(Product, on_delete=models.CASCADE)\n\n# views.py\nfrom django.shortcuts import render, redirect\nfrom django.contrib.auth.decorators import login_required\nfrom .models import Favorite\n\ndef add_to_favorites(request, product_id):\n    if request.user.is_authenticated:\n        # Registered user\n        favorite, created = Favorite.objects.get_or_create(user=request.user, product_id=product_id)\n    else:\n        # Anonymous user\n        favorite_products = request.session.get('favorite_products', [])\n        favorite_products.append(product_id)\n        request.session['favorite_products'] = favorite_products\n    return redirect('product_detail', pk=product_id)\n\n@login_required\ndef register_user(request):\n    # Handle user registration...\n    # ...\n    # Move favorite products from session to database\n    favorite_products = request.session.get('favorite_products', [])\n    for product_id in favorite_products:\n        Favorite.objects.create(user=request.user, product_id=product_id)\n    request.session['favorite_products'] = []\n    return redirect('dashboard')