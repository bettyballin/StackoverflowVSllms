def stable_triplet_matching(preferences):\n    # preferences is a dictionary where each key is a person and each value is a list of preferred partners\n\n    matchedA, matchedB, matchedC = set(), set(), set()\n    unmatchedA, unmatchedB, unmatchedC = set(preferences.keys()), set(), set()\n\n    while unmatchedA or unmatchedB or unmatchedC:\n        a = unmatchedA.pop()\n        preferred_B = [b for b in preferences[a] if b not in matchedB]\n        if not preferred_B:\n            continue\n        b = preferred_B[0]\n        preferred_C = [c for c in preferences[b] if c in preferences[a] and c not in matchedC]\n        if not preferred_C:\n            continue\n        c = preferred_C[0]\n        matchedA.add(a)\n        matchedB.add(b)\n        matchedC.add(c)\n        unmatchedB.discard(b)\n        unmatchedC.discard(c)\n\n    return list(zip(matchedA, matchedB, matchedC))