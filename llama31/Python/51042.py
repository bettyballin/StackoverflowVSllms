def is_close(A, B, X, d):\n    # Precompute vectors\n    AB = B - A\n    AX = X - A\n    BX = X - B\n    \n    # Check if X is within the rectangle defined by A, B, and d\n    if abs(AX.dot(AB)) > AB.dot(AB) or abs(BX.dot(AB)) > AB.dot(AB):\n        return False\n    \n    # Check if X is within the circle centered at A with radius d\n    if AX.dot(AX) <= d * d:\n        return True\n    \n    # Check if X is within the circle centered at B with radius d\n    if BX.dot(BX) <= d * d:\n        return True\n    \n    # Check if X is within the ellipse defined by A, B, and d\n    ellipse_axis = AB.normalized()\n    ellipse_radius = d / ellipse_axis.dot(AB)\n    if (AX - ellipse_axis * AX.dot(ellipse_axis)).dot(AX - ellipse_axis * AX.dot(ellipse_axis)) <= ellipse_radius * ellipse_radius:\n        return True\n    \n    return False