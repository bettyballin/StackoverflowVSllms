def stable_marriage(people, disallowed_pairs):\n    # Initialize preference lists\n    for person in people:\n        person.preferences = [p for p in people if p != person and (person, p) not in disallowed_pairs]\n\n    # Main loop\n    while any(not person.giftee for person in people):\n        proposer = next(person for person in people if not person.giftee)\n        proposed = proposer.preferences[0]\n        if not proposed.giftee:\n            proposed.giftee = proposer\n        elif proposed.preferences.index(proposed.giftee) < proposed.preferences.index(proposer):\n            proposer.preferences.remove(proposed)\n        else:\n            proposed.giftee = proposer\n\n    return {person: person.giftee for person in people}