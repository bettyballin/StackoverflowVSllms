def max_rectangle(grid):\n    def max_area_histogram(heights):\n        stack = []\n        max_area = 0\n        for i, height in enumerate(heights):\n            while stack and heights[stack[-1]] > height:\n                h = heights[stack.pop()]\n                w = i if not stack else i - stack[-1] - 1\n                max_area = max(max_area, h * w)\n            stack.append(i)\n        while stack:\n            h = heights[stack.pop()]\n            w = len(heights) if not stack else len(heights) - stack[-1] - 1\n            max_area = max(max_area, h * w)\n        return max_area\n\n    max_area = 0\n    for row in grid:\n        max_area = max(max_area, max_area_histogram(row))\n    return max_area