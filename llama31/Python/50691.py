def gale_shapley(giver_prefs, receiver_prefs):\n    free_givers = set(giver_prefs.keys())\n    free_receivers = set(receiver_prefs.keys())\n    assignments = {}\n\n    while free_givers:\n        giver = free_givers.pop()\n        receiver_prefs_list = giver_prefs[giver]\n        for receiver in receiver_prefs_list:\n            if receiver in free_receivers:\n                assignments[giver] = receiver\n                free_receivers.remove(receiver)\n                break\n            else:\n                current_giver = assignments.get(receiver)\n                if receiver_prefs[receiver].index(giver) < receiver_prefs[receiver].index(current_giver):\n                    assignments[giver] = receiver\n                    del assignments[current_giver]\n                    free_givers.add(current_giver)\n                    break\n\n    return assignments