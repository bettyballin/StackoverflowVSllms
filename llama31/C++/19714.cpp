#include <Windows.h>\n#include <Wtsapi32.h>\n#include <Userenv.h>\n\n#pragma comment(lib, "Wtsapi32.lib")\n#pragma comment(lib, "Userenv.lib")\n\nint main() {\n    // Get active console session ID\n    DWORD dwSessionId = WTSGetActiveConsoleSessionId();\n\n    if (dwSessionId == 0xFFFFFFFF) {\n        // Handle error\n    }\n\n    // Get token of the active session\n    HANDLE hToken;\n    if (!WTSQuerySessionToken(dwSessionId, &hToken)) {\n        // Handle error\n    }\n\n    // Get active desktop name\n    WCHAR wszDesktopName[256];\n    DWORD dwLen = 256;\n    if (!WTSQuerySessionInformationW(NULL, dwSessionId, WTSDesktopName, wszDesktopName, &dwLen)) {\n        // Handle error\n    }\n\n    STARTUPINFO si = {0};\n    si.cb = sizeof(STARTUPINFO);\n    si.lpDesktop = wszDesktopName;\n\n    PROCESS_INFORMATION pi = {0};\n\n    // Create process as user\n    if (!CreateProcessAsUserW(hToken, NULL, L"C:\\Windows\\notepad.exe", NULL, NULL, FALSE, 0, NULL, NULL, &si, &pi)) {\n        // Handle error\n    }\n\n    // Clean up\n    if (hToken) {\n        CloseHandle(hToken);\n    }\n    CloseHandle(pi.hThread);\n    CloseHandle(pi.hProcess);\n\n    return 0;\n}