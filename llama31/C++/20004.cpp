STDMETHODIMP CAnalisis::Save(IStream *pStm, BOOL fClearDirty)\n{\n    ULONG cb;\n    HRESULT hr;\n\n    // Write the string length\n    hr = pStm->Write(&img.imgNameLength, sizeof(ULONG), &cb);\n    if (FAILED(hr) || sizeof(ULONG) != cb)\n        return ResultFromScode(STG_E_WRITEFAULT);\n\n    // Write the string data\n    hr = pStm->Write(img.imgName, img.imgNameLength * sizeof(WCHAR), &cb);\n    if (FAILED(hr) || img.imgNameLength * sizeof(WCHAR) != cb)\n        return ResultFromScode(STG_E_WRITEFAULT);\n\n    return NOERROR;\n}\n\nSTDMETHODIMP CAnalisis::Load(IStream *pStm)\n{\n    ULONG cb;\n    HRESULT hr;\n\n    // Read the string length\n    hr = pStm->Read(&img.imgNameLength, sizeof(ULONG), &cb);\n    if (FAILED(hr) || sizeof(ULONG) != cb)\n        return E_FAIL;\n\n    // Allocate memory for the string\n    img.imgName = (BSTR)CoTaskMemAlloc(img.imgNameLength * sizeof(WCHAR));\n\n    // Read the string data\n    hr = pStm->Read(img.imgName, img.imgNameLength * sizeof(WCHAR), &cb);\n    if (FAILED(hr) || img.imgNameLength * sizeof(WCHAR) != cb)\n        return E_FAIL;\n\n    return NOERROR;\n}