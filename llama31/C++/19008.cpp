void LoadRecordsetIntoStream(_RecordsetPtr& pRs, ostringstream& ostrm)\n{\n    ADODB::FieldsPtr pFields = pRs->Fields;\n    ostrm.reserve(10 * 1024 * 1024); // Reserve 10MB buffer space\n\n    while (!pRs->EndOfFile) // loop through rows\n    {\n        for (long i = 0L; i < nColumns; i++)  // loop through columns\n        {\n            _variant_t var = pFields->GetItem(i)->GetValue();\n\n            if (V_VT(&var) == VT_BSTR)\n            {\n                ostrm << (const char*) (_bstr_t) var;\n            }\n            else if (V_VT(&var) == VT_I4\n                || V_VT(&var) == VT_UI1\n                || V_VT(&var) == VT_I2\n                || V_VT(&var) == VT_BOOL)\n            {\n                ostrm << std::to_string((int)var);\n            }\n            else if (V_VT(&var) == VT_DATE)\n            {\n                ::SYSTEMTIME sysTime;\n                ::VariantTimeToSystemTime(var, &sysTime);\n                ostrm << std::to_string(sysTime.wYear) << "-"\n                      << std::to_string(sysTime.wMonth) << "-"\n                      << std::to_string(sysTime.wDay) << " "\n                      << std::to_string(sysTime.wHour) << ":"\n                      << std::to_string(sysTime.wMinute) << ":"\n                      << std::to_string(sysTime.wSecond);\n            }\n        }\n\n        pRs->MoveNext();\n    }\n}