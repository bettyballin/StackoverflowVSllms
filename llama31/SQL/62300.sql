CREATE OR REPLACE FUNCTION check_resource_conflicts()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF EXISTS (\n        SELECT 1\n        FROM timespans t2\n        JOIN events e2 ON t2.event_id = e2.id\n        JOIN resources r2 ON e2.id = r2.event_id\n        WHERE r2.id = (SELECT resource_id FROM events WHERE id = NEW.event_id)\n        AND t2.day = NEW.day\n        AND (t2.start_time, t2.end_time) OVERLAPS (NEW.start_time, NEW.end_time)\n        AND (t2.start_time, t2.end_time) != (NEW.start_time, NEW.end_time)\n    ) THEN\n        RAISE EXCEPTION 'Resource conflict detected';\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER check_resource_conflicts_trigger\nAFTER INSERT OR UPDATE ON timespans\nFOR EACH ROW EXECUTE PROCEDURE check_resource_conflicts();