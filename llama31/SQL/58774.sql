DELIMITER //\nCREATE FUNCTION ip_match(ip binary(128), cidr int, target_ip binary(128)) RETURNS boolean\nBEGIN\n  DECLARE ip_int bigint;\n  DECLARE target_ip_int bigint;\n  DECLARE mask bigint;\n\n  SET ip_int = INET6_ATON(ip);\n  SET target_ip_int = INET6_ATON(target_ip);\n  SET mask = (1 << (128 - cidr)) - 1;\n\n  RETURN (ip_int & mask) = (target_ip_int & mask);\nEND//\nDELIMITER ;