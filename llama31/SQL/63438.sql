ALTER TRIGGER [dbo].[tr_CustomerSatisfactionAlertRepair]\n    ON [dbo].[tbl_repair_visit]\nAFTER UPDATE\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    INSERT alertmessagedata (TypeID, Contract, Address, ORDERID, \n                ENGINEERS, Sent, DateAdded)\n    SELECT '5', tbl_property.contract, tbl_property.fulladdress, \n            tbl_repair_visit.orderid, tbl_repair_visit.engineer, \n            0, GETDATE()\n    FROM TBL_REPAIR_VISIT\n    INNER JOIN\n        INSERTED X ON TBL_REPAIR_VISIT.VISITID = X.VISITID\n    INNER JOIN \n        TBL_PROPERTY ON TBL_REPAIR_VISIT.PROPREF = TBL_PROPERTY.PROPREF\n    INNER JOIN \n        DELETED D ON X.VISITID = D.VISITID\n    WHERE X.TENANTSATISFACTION = 'Poor' AND D.TENANTSATISFACTION <> 'Poor'\nEND