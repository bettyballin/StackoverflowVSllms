WITH RankedPatientStatus AS (\n  SELECT \n    ps.*,\n    ROW_NUMBER() OVER (PARTITION BY ps.fkPatientId ORDER BY ps.StartDate) AS row_num\n  FROM \n    PatientStatus ps\n)\nSELECT \n  p.*,\n  rps.StatusCode,\n  rps.StartDate,\n  rps.EndDate\nFROM \n  Patient p\n  INNER JOIN RankedPatientStatus rps ON p.pkPatientId = rps.fkPatientId\nWHERE \n  rps.row_num <= 2\n  AND rps.row_num > 1  -- exclude patients with only one status record\nORDER BY \n  p.pkPatientId, rps.StartDate;