USE [master]\nGO\n\nSET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[spGrantExec] \n    @User sysname,\n    @DB sysname,\n    @Target sysname\nAS \nBEGIN\n    SET NOCOUNT ON\n\n    DECLARE @SQL nvarchar(max)\n\n    SET @SQL = N'\n        USE ' + QUOTENAME(@DB) + N'\n        DECLARE @MAXOID int\n        DECLARE @OwnerName sysname\n        DECLARE @ObjectName sysname\n\n        CREATE TABLE #StoredProcedures\n        (OID int IDENTITY (1,1),\n        StoredProcOwner sysname NOT NULL,\n        StoredProcName sysname NOT NULL)\n\n        INSERT INTO #StoredProcedures (StoredProcOwner, StoredProcName)\n        SELECT ROUTINE_SCHEMA, ROUTINE_NAME\n        FROM INFORMATION_SCHEMA.ROUTINES \n        WHERE ROUTINE_NAME LIKE @Target + ''%'' \n          AND ROUTINE_TYPE = ''PROCEDURE''\n\n        SELECT @MAXOID = MAX(OID) FROM #StoredProcedures\n\n        WHILE @MAXOID > 0\n        BEGIN \n            SELECT @OwnerName = StoredProcOwner,\n                   @ObjectName = StoredProcName\n            FROM #StoredProcedures\n            WHERE OID = @MAXOID\n\n            DECLARE @CMD1 nvarchar(max) = N''GRANT EXEC ON '' + QUOTENAME(@OwnerName) + N''.'' + QUOTENAME(@ObjectName) + N'' TO '' + QUOTENAME(@User) + N''''\n            EXEC sp_executesql @CMD1\n\n            SET @MAXOID = @MAXOID - 1\n        END\n\n        DROP TABLE #StoredProcedures\n    '\n\n    EXEC sp_executesql @SQL, N'@User sysname, @DB sysname, @Target sysname', @User = @User, @DB = @DB, @Target = @Target\n\n    SET NOCOUNT OFF\nEND