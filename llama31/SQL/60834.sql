CREATE OR REPLACE TYPE OrderRecord AS OBJECT (\n  OrderID NUMBER,\n  OrderDate DATE,\n  Total NUMBER\n);\n\nCREATE OR REPLACE TYPE OrderRecordTable AS TABLE OF OrderRecord;\n\nCREATE OR REPLACE FUNCTION GetCompanyList\nRETURN SYS_REFCURSOR\nPIPELINED\nAS\n  v_ref_cursor SYS_REFCURSOR;\nBEGIN\n  OPEN v_ref_cursor FOR\n    SELECT COMPANYID, COMPANYNAME,\n           CAST(MULTISET(\n             SELECT ORDERID, ORDERDATE, TOTAL\n             FROM ORDERS\n             WHERE CompanyID = c.CompanyID\n           ) AS OrderRecordTable) OrderRecords\n    FROM COMPANIES c\n    WHERE IsActive = 'T';\n  LOOP\n    FETCH v_ref_cursor INTO v_company_rec;\n    EXIT WHEN v_ref_cursor%NOTFOUND;\n    PIPE ROW (v_company_rec);\n  END LOOP;\n  CLOSE v_ref_cursor;\n  RETURN;\nEND;