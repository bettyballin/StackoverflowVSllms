DECLARE @xml xml\nSELECT @xml = XmlCol FROM Data\n\nSELECT \n    [PersonId] = Persons.PersonCollection.value('(personid)[1]', 'NVARCHAR(50)')\n    ,[First Name] = Persons.PersonCollection.value('(firstname)[1]', 'NVARCHAR(50)')\n    ,[Last Name] = Persons.PersonCollection.value('(lastname)[1]', 'NVARCHAR(50)')\n    ,[Enter Time] = Times.TimeCollection.value('(.)[1]', 'DATETIME')\n    ,[Leave Time] = Times.TimeCollection.value('(following-sibling::leavetime)[1]', 'DATETIME')\nFROM @xml.nodes('root/person') Persons(PersonCollection)\nLEFT JOIN (\n    SELECT \n        PersonId = Persons.PersonCollection.value('(personid)[1]', 'NVARCHAR(50)')\n        ,TimeCollection = Times.TimeCollection\n    FROM @xml.nodes('root/person') Persons(PersonCollection)\n    CROSS APPLY Persons.PersonCollection.nodes('entertime') Times(TimeCollection)\n) Times ON Persons.PersonCollection.value('(personid)[1]', 'NVARCHAR(50)') = Times.PersonId