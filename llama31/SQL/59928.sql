CREATE PROCEDURE ValidateData\nAS\nBEGIN\n    -- Validate simple rules\n    SELECT *\n    INTO #ValidData\n    FROM StagingTable\n    WHERE Field1 IS NOT NULL AND Field2 LIKE '[a-zA-Z]%'\n\n    -- Validate hierarchical data\n    WITH Hierarchy AS (\n        SELECT ParentID, ChildID, 0 AS Level\n        FROM StagingTable\n        WHERE ParentID IS NULL\n        UNION ALL\n        SELECT s.ParentID, s.ChildID, Level + 1\n        FROM StagingTable s\n        INNER JOIN Hierarchy h ON s.ParentID = h.ChildID\n    )\n    SELECT *\n    INTO #ValidHierarchy\n    FROM Hierarchy\n    WHERE Level = 0 OR EXISTS (\n        SELECT 1\n        FROM ProductionTable\n        WHERE ID = Hierarchy.ChildID\n    )\n\n    -- Log validation failures\n    INSERT INTO ValidationLog (ID, ErrorMessage)\n    SELECT ID, 'Validation failed'\n    FROM StagingTable\n    WHERE ID NOT IN (SELECT ID FROM #ValidData) OR ID NOT IN (SELECT ID FROM #ValidHierarchy)\n\n    RETURN\nEND