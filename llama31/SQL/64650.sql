WITH RecursiveGroups AS (\n    SELECT k.KundeID, g.GruppeID, g.ParentGruppeID, 0 AS Level\n    FROM Kunde k\n    INNER JOIN Gruppe g ON k.GruppeID = g.GruppeID\n\n    UNION ALL\n\n    SELECT k.KundeID, g.GruppeID, g.ParentGruppeID, Level + 1\n    FROM Kunde k\n    INNER JOIN Gruppe g ON k.GruppeID = g.GruppeID\n    INNER JOIN RecursiveGroups rg ON g.ParentGruppeID = rg.GruppeID\n)\nSELECT k.KundeID, rg.GruppeID\nFROM Kunde k\nINNER JOIN RecursiveGroups rg ON k.KundeID = rg.KundeID;