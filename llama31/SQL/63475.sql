SELECT TOP (1) \n    allDates.intPK, \n    MAX(allDates.datLastAction) AS datLastScan, \n    dbo.viwAssets.strFriendlyName, \n    tblAssetsInUse_join.intAssetID,\n    CASE \n        WHEN allDates.datLastAction = tblAssetsInUse_join.datCheckedOut THEN 0 -- Checked Out\n        ELSE 1 -- Checked In\n    END AS isCheckedIn\nFROM \n    (SELECT intPK, MAX(datCheckedOut) AS datLastAction\n     FROM dbo.tblAssetsInUse AS tblAssetsInUse_out\n     GROUP BY intPK\n\n     UNION ALL\n\n     SELECT intPK, MAX(datCheckedIn) AS datLastAction\n     FROM dbo.tblAssetsInUse AS tblAssetsInUse_in\n     GROUP BY intPK) AS allDates \nINNER JOIN\n    dbo.tblAssetsInUse AS tblAssetsInUse_join ON allDates.intPK = tblAssetsInUse_join.intPK \nINNER JOIN\n    dbo.viwAssets ON tblAssetsInUse_join.intAssetID = dbo.viwAssets.intPK\nGROUP BY \n    allDates.intPK, \n    dbo.viwAssets.strFriendlyName, \n    tblAssetsInUse_join.intAssetID,\n    allDates.datLastAction,\n    tblAssetsInUse_join.datCheckedOut,\n    tblAssetsInUse_join.datCheckedIn\nORDER BY \n    datLastScan DESC