SELECT DISTINCT t.id, t.name\nFROM tags t\nJOIN tags_topics tt ON t.id = tt.tag_id\nJOIN topics tp ON tt.topic_id = tp.id\nWHERE tp.id IN (\n  SELECT tp.id\n  FROM topics tp\n  JOIN tags_topics tt ON tp.id = tt.topic_id\n  JOIN tags t ON tt.tag_id = t.id\n  WHERE t.id IN (:filter_tags)\n  GROUP BY tp.id\n  HAVING COUNT(DISTINCT t.id) = :filter_tags_count\n)\nAND t.id NOT IN (:filter_tags)