SET @sql = NULL;\n\nSELECT\n  GROUP_CONCAT(DISTINCT\n    CONCAT(\n      'MAX(CASE WHEN type = ''',\n      type,\n      ''' THEN value END) AS ',\n      type\n    )\n  ) INTO @sql\nFROM (\n  SELECT DISTINCT type\n  FROM contact_attributes\n) AS types;\n\nSET @sql = CONCAT('SELECT #profile, ', @sql, ' FROM contact_attributes GROUP BY #profile');\n\nPREPARE stmt FROM @sql;\nEXECUTE stmt;\nDEALLOCATE PREPARE stmt;