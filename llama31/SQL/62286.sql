DELIMITER $$\n\nCREATE TRIGGER trg_item_insert AFTER INSERT ON item\nFOR EACH ROW\nBEGIN\n  INSERT INTO item_rank (id, rank) VALUES (NEW.rank_id, (SELECT COUNT(*) + 1 FROM item_rank));\n  UPDATE item_rank SET rank = rank + 1 WHERE rank >= NEW.rank_id;\nEND$$\n\nCREATE TRIGGER trg_item_update AFTER UPDATE ON item\nFOR EACH ROW\nBEGIN\n  IF OLD.rank_id != NEW.rank_id THEN\n    UPDATE item_rank SET rank = rank - 1 WHERE rank > OLD.rank_id;\n    UPDATE item_rank SET rank = rank + 1 WHERE rank >= NEW.rank_id;\n  END IF;\nEND$$\n\nCREATE TRIGGER trg_item_delete AFTER DELETE ON item\nFOR EACH ROW\nBEGIN\n  DELETE FROM item_rank WHERE id = OLD.rank_id;\n  UPDATE item_rank SET rank = rank - 1 WHERE rank > OLD.rank_id;\nEND$$\n\nDELIMITER ;