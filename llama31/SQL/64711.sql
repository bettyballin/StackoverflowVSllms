ALTER PROCEDURE [dbo].[usp_NewSearch]\n    @Keyword VARCHAR(50),\n    @SessionID UNIQUEIDENTIFIER,\n    @time SMALLDATETIME = NULL,\n    @CityID INT = NULL\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    IF @time IS NULL SET @time = GETDATE();\n\n    DECLARE @KeywordID INT;\n    EXEC @KeywordID = usp_SaveKeyword @Keyword;\n\n    PRINT 'KeywordID : ';\n    PRINT @KeywordID;\n\n    DECLARE @SearchID BIGINT;     \n    SELECT TOP 1 @SearchID = SearchID\n        FROM tblSearches \n        WHERE SessionID = @SessionID\n          AND KeywordID = @KeywordID;\n\n    IF @SearchID IS NULL BEGIN\n        INSERT INTO tblSearches\n              (KeywordID, [time], SessionID, CityID)\n         VALUES\n              (@KeywordID, @time, @SessionID, @CityID);\n        SELECT Scope_Identity();\n    END\n    ELSE BEGIN\n        SELECT @SearchID;\n    END\nEND