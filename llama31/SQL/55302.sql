WITH RecursiveReportingUnits AS (\n  SELECT Key, ParentReportingUnitKey, 0 AS Level\n  FROM ReportingUnit\n  WHERE Key = ?  -- Parameter: ReportingUnit=R1\n  UNION ALL\n  SELECT r.Key, r.ParentReportingUnitKey, Level + 1\n  FROM ReportingUnit r\n  INNER JOIN RecursiveReportingUnits p ON r.ParentReportingUnitKey = p.Key\n)\nSELECT f.*\nFROM Facility f\nINNER JOIN RecursiveReportingUnits r ON f.ParentReportingUnitKey = r.Key;