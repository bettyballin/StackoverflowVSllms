SELECT i.*\nFROM items i\nJOIN item_tags it ON i.id = it.item_id\nJOIN tags t ON it.tag_id = t.id\nWHERE t.name IN ('p1', 'p2', ..., 'pn')  -- Include tags\nGROUP BY i.id\nHAVING COUNT(DISTINCT t.name) = n  -- 'n' is the number of tags in the IN clause\nAND i.id NOT IN (\n  SELECT it.item_id\n  FROM item_tags it\n  JOIN tags t ON it.tag_id = t.id\n  WHERE t.name IN ('n1', 'n2', ..., 'nk')  -- Exclude tags\n);