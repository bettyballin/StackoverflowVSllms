WITH calculated_fields AS (\n    SELECT \n        Status as status,\n        Address as ip,\n        PCName as pc_name,\n        CASE WHEN EXISTS (SELECT 1 FROM Numbers WHERE Phone = 'CPU/' + PCName) THEN 1 ELSE 0 END as cpu_contact,\n        CASE WHEN EXISTS (SELECT 1 FROM Numbers WHERE Phone = 'PC/' + PCName) THEN 1 ELSE 0 END as pc_contact,\n        CASE WHEN EXISTS (SELECT 1 FROM Numbers WHERE Phone = 'LOGIN/' + PCName) THEN 1 ELSE 0 END as login_contact\n    FROM \n        IPAddress\n    WHERE \n        $where  --Generated In code\n)\nSELECT \n    status,\n    ip,\n    cpu_contact,\n    pc_contact,\n    login_contact\nFROM \n    calculated_fields