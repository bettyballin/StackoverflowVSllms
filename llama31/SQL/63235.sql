-- Create a temporary mapping table\nCREATE TABLE #Mapping (\n    OldParentId INT,\n    NewParentId INT\n);\n\n-- Insert data from Old Table1 into New Table1 and populate the mapping table\nINSERT INTO New Table1 (Name)\nSELECT Name FROM Old Table1;\n\nINSERT INTO #Mapping (OldParentId, NewParentId)\nSELECT Old Table1.ParentId, New Table1.ParentId\nFROM Old Table1\nINNER JOIN New Table1 ON Old Table1.Name = New Table1.Name;\n\n-- Insert data from Old Table2 into New Table2 using the mapping table\nINSERT INTO New Table2 (ParentId, Foo)\nSELECT m.NewParentId, Old Table2.Foo\nFROM Old Table2\nINNER JOIN #Mapping m ON Old Table2.ParentId = m.OldParentId;\n\n-- Drop the temporary mapping table\nDROP TABLE #Mapping;