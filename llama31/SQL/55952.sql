CREATE TRIGGER trg_DariaftPardakhtDarkhastFaktor_MablaghConstraint\nON Treasury.DariaftPardakhtDarkhastFaktor\nAFTER INSERT, UPDATE\nAS\nBEGIN\n    IF NOT EXISTS (\n        SELECT 1\n        FROM Treasury.DariaftPardakhtDarkhastFaktor\n        WHERE DarkhastFaktor = INSERTED.DarkhastFaktor\n        AND Mablagh <= (SELECT ISNULL(MablaghKhalesFaktor, 0) FROM Sales.DarkhastFaktor WHERE DarkhastFaktor = INSERTED.DarkhastFaktor)\n    )\n    BEGIN\n        RAISERROR ('Constraint violation: Mablagh exceeds allowed value', 16, 1)\n        ROLLBACK TRANSACTION\n    END\nEND