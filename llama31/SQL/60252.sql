CREATE PROCEDURE assign_document_number\nAS\nBEGIN\n  DECLARE @document_number INT;\n\n  BEGIN TRANSACTION;\n\n  SELECT @document_number = MIN(t1.document_number) + 1\n  FROM (\n    SELECT document_number\n    FROM your_table\n    UNION ALL\n    SELECT document_number + 1\n    FROM your_table\n  ) t1\n  LEFT JOIN your_table t2\n    ON t1.document_number = t2.document_number\n  WHERE t2.document_number IS NULL\n    AND t1.document_number > 0;\n\n  IF @document_number IS NULL\n    SET @document_number = 1;\n\n  INSERT INTO your_table (document_number, ...)\n  VALUES (@document_number, ...);\n\n  COMMIT TRANSACTION;\nEND;