WITH sample_data AS (\n  SELECT \n    sample_id,\n    created_on\n  FROM \n    sample\n  WHERE \n    sam_tmpl_id = 18\n),\ntest_data AS (\n  SELECT \n    sample_id,\n    MAX(CASE WHEN tst_tmpl_id = 36 THEN status END) AS s_acid,\n    MAX(CASE WHEN tst_tmpl_id = 43 THEN status END) AS s_ph,\n    MAX(CASE WHEN tst_tmpl_id = 66 THEN status END) AS s_titr\n  FROM \n    test\n  WHERE \n    sample_id IN (SELECT sample_id FROM sample_data)\n  GROUP BY \n    sample_id\n)\nSELECT \n  s.sample_id,\n  s.created_on,\n  t.s_acid,\n  t.s_ph,\n  t.s_titr\nFROM \n  sample_data s\n  JOIN test_data t USING (sample_id);