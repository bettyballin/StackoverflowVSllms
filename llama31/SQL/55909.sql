SELECT \n  name,\n  SUM(days_jerky) AS days_jerky\nFROM \n  (\n    SELECT \n      name,\n      processing_date,\n      is_jerk,\n      CASE \n        WHEN LAG(is_jerk) OVER (PARTITION BY name ORDER BY processing_date) = is_jerk \n          THEN 0 \n        ELSE 1 \n      END AS island_start\n    FROM \n      history_of_jerkiness\n  ) AS subquery\nWHERE \n  processing_date <= '20090103'  -- replace with desired date\nGROUP BY \n  name, \n  SUM(island_start) OVER (PARTITION BY name ORDER BY processing_date) \nHAVING \n  is_jerk = 1\nORDER BY \n  name;