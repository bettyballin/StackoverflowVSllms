WITH RecursiveGroups AS (\n    SELECT k.KundeID, g.GruppeID, g.ParentGruppeID, 0 AS Level, CONVERT(VARCHAR(MAX), g.GruppeNavn) AS GroupName\n    FROM Kunde k\n    INNER JOIN Gruppe g ON k.GruppeID = g.GruppeID\n    WHERE g.ParentGruppeID IS NULL  -- anchor query: top-level groups\n\n    UNION ALL\n\n    SELECT k.KundeID, g.GruppeID, g.ParentGruppeID, Level + 1, CONVERT(VARCHAR(MAX), REPLICATE('  ', Level) + g.GruppeNavn)\n    FROM Kunde k\n    INNER JOIN Gruppe g ON k.GruppeID = g.GruppeID\n    INNER JOIN RecursiveGroups rg ON g.ParentGruppeID = rg.GruppeID\n)\nSELECT k.KundeNavn, rg.GroupName\nFROM Kunde k\nINNER JOIN RecursiveGroups rg ON k.KundeID = rg.KundeID\nORDER BY k.KundeID, rg.Level;