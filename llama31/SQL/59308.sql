DELIMITER //\nCREATE PROCEDURE process_update_queue()\nBEGIN\n  DECLARE done INT DEFAULT FALSE;\n  DECLARE num INT;\n  DECLARE cur CURSOR FOR SELECT num FROM update_queue;\n  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;\n\n  OPEN cur;\n\n  read_loop: LOOP\n    FETCH cur INTO num;\n    IF done THEN\n      LEAVE read_loop;\n    END IF;\n\n    UPDATE items\n    SET tot = (SELECT SUM(b.tot) FROM tree JOIN items AS b ON tree.term = b.num WHERE tree.orig = num)\n    WHERE num = items.num;\n\n    DELETE FROM update_queue WHERE num = num;\n  END LOOP;\n\n  CLOSE cur;\nEND//\nDELIMITER ;