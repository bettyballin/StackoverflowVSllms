WITH LogData AS (\n  SELECT \n    Count(Page) as VisitingCount,\n    dbo.fn_GetActivityLogsArranger(CONVERT(VARCHAR(5),Date, 108)) AS [TIME]\n  FROM \n    scr_SecuristLog     \n  WHERE \n    Date between '2009-04-30' and '2009-05-02' AND\n    [user] in\n    (\n      SELECT USERNAME               \n      FROM scr_CustomerAuthorities \n      WHERE customerID = Convert(varchar,4) and ID = Convert(varchar,43) \n    )    \n)\nSELECT \n  VisitingCount,\n  [TIME]\nFROM \n  LogData\nGROUP BY \n  [TIME]\nORDER BY \n  [TIME] ASC