WITH RecursiveCTE AS (\n    SELECT Id, ParentId, 0 AS Level, CAST('/' + CONVERT(VARCHAR, Id) AS VARCHAR(MAX)) AS Hierarchy\n    FROM Employees\n    WHERE Id IN (@Ids)  -- anchor query\n\n    UNION ALL\n\n    SELECT e.Id, e.ParentId, Level + 1, r.Hierarchy + '/' + CONVERT(VARCHAR, e.Id)\n    FROM Employees e\n    INNER JOIN RecursiveCTE r ON e.Id = r.ParentId\n)\nSELECT TOP 1 Id AS LowestCommonParent\nFROM RecursiveCTE\nORDER BY Level DESC, Hierarchy;