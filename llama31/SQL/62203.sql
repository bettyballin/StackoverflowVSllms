DECLARE @Date DATE = '2022-01-01';  -- replace with the desired date\n\nWITH Started AS (\n  SELECT TOP 1 Timestamp\n  FROM YourTable\n  WHERE Message = 'Started' AND CONVERT(DATE, Timestamp) = @Date\n),\nFinished AS (\n  SELECT TOP 1 Timestamp\n  FROM YourTable\n  WHERE Message = 'Finished' AND CONVERT(DATE, Timestamp) = @Date\n)\nSELECT \n  CASE\n    WHEN Started.Timestamp IS NULL THEN 0\n    WHEN Finished.Timestamp IS NULL THEN 1\n    WHEN Finished.Timestamp > Started.Timestamp THEN 2\n    ELSE RAISERROR('Invalid data', 16, 1)\n  END AS Status\nFROM Started\nLEFT JOIN Finished ON 1 = 1;