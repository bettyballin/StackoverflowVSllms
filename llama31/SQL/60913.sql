CREATE TABLE #TempSegments (segmentid INT);\n\n-- Insert segment IDs into temp table\nINSERT INTO #TempSegments (segmentid)\nVALUES (1), (2), (3), ...;  -- Replace with your actual values\n\n-- Group segments by ticket number and calculate duration\nWITH Segments AS (\n  SELECT ticketid, SUM(duration) AS total_duration\n  FROM ActivitySegments\n  WHERE segmentid IN (SELECT segmentid FROM #TempSegments)\n  GROUP BY ticketid\n)\n-- Insert into Activities table and capture new activityid values\nINSERT INTO Activities (actdate, actduration, ticketnumber)\nOUTPUT inserted.activityid, inserted.ticketnumber INTO #NewActivities\nSELECT GETDATE(), total_duration, ticketid\nFROM Segments;\n\n-- Update ActivitySegments table with new activityid values\nUPDATE asg\nSET asg.activityid = na.activityid\nFROM ActivitySegments asg\nJOIN #NewActivities na ON asg.ticketid = na.ticketnumber AND asg.segmentid IN (SELECT segmentid FROM #TempSegments);\n\nDROP TABLE #TempSegments;\nDROP TABLE #NewActivities;