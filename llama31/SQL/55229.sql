CREATE PROCEDURE CalculateBounds\n    @RunID INT\nAS\nBEGIN\n    SELECT \n        tm.MeasurementTypeID,\n        tm.TemplateID,\n        COALESCE(MIN(sb.UpperBound), MIN(cb.UpperBound), MIN(pb.UpperBound)) AS CalculatedUpperBound,\n        COALESCE(MAX(sb.LowerBound), MAX(cb.LowerBound), MAX(pb.LowerBound)) AS CalculatedLowerBound\n    FROM \n        TemplateMeasurements tm\n        INNER JOIN ProductionRuns pr ON tm.TemplateID = pr.TemplateID\n        LEFT JOIN SimpleBounds sb ON tm.MeasurementTypeID = sb.MeasurementTypeID AND tm.TemplateID = sb.TemplateID\n        LEFT JOIN ContainerBounds cb ON tm.MeasurementTypeID = cb.MeasurementTypeID AND tm.TemplateID = cb.TemplateID AND pr.ContainerName = cb.ContainerName\n        LEFT JOIN ProductBounds pb ON tm.MeasurementTypeID = pb.MeasurementTypeID AND tm.TemplateID = pb.TemplateID AND pr.ProductName = pb.ProductName\n    WHERE \n        pr.RunID = @RunID\n    GROUP BY \n        tm.MeasurementTypeID, tm.TemplateID\nEND