-- Create a semaphore table\nCREATE TABLE semaphore (id INT PRIMARY KEY, locked INT);\n\n-- Acquire the semaphore\nUPDATE semaphore SET locked = 1 WHERE id = 1 AND locked = 0;\n\n-- If the update succeeds, proceed with booking\nIF ROW_COUNT() = 1 THEN\n    UPDATE your_table SET book = TRUE WHERE memberid = $memberid AND classid = $classid;\n    -- Release the semaphore\n    UPDATE semaphore SET locked = 0 WHERE id = 1;\nEND IF;