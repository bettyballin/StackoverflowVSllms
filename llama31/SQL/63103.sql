SELECT \n  username,\n  concat(firstname || ' ', lastname) AS name,\n  email,\n  phone,\n  (\n    SELECT \n      ltrim(sys_connect_by_path(res, ', '), ', ')\n    FROM (\n      SELECT \n        count(*) OVER () AS cnt, \n        row_number() OVER (ORDER BY ofield) AS rnum, \n        (SELECT name FROM rooms WHERE code = ar.roomcode) AS res\n      FROM adminrooms ar\n      WHERE ar.roomcode = a.code  -- <--- use the alias 'a' to refer to the outer query\n    )\n    WHERE cnt = rnum START WITH rnum = 1 CONNECT BY PRIOR rnum = (rnum - 1)\n  ) AS groups\nFROM admins a  -- <--- add an alias 'a' to the outer query\nWHERE frozen = 0 AND (type <> 'root' OR type IS NULL)