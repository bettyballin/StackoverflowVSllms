SELECT p.*\nFROM products p\nJOIN (\n  SELECT p1.product_id\n  FROM properties p1\n  JOIN properties p2 ON p1.product_id = p2.product_id\n  WHERE p1.value = 'male' AND p2.value = 'nike'\n) AS properties_filter ON p.id = properties_filter.product_id\nJOIN (\n  SELECT o1.product_id\n  FROM options o1\n  JOIN options o2 ON o1.product_id = o2.product_id\n  WHERE o1.value = 'small'\n) AS options_filter ON p.id = options_filter.product_id;