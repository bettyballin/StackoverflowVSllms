CREATE FUNCTION GetLog\n(\n    @TableName varchar(32),\n    @RowId int\n)\nRETURNS \n@Log TABLE\n(\n    LogId int not null,\n    UserId int not null,\n    Description varchar(1024) not null\n)\nAS\nBEGIN\n    WITH LogCTE AS (\n        SELECT l.LogId, l.UserId, l.Description\n        FROM Log l\n        INNER JOIN LogReference lr ON l.LogId = lr.LogId\n        WHERE lr.TableName = @TableName AND lr.RowId = @RowId\n    )\n    INSERT INTO @Log\n    SELECT * FROM LogCTE;\n    RETURN;\nEND;\nGO