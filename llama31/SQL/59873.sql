CREATE TABLE #tempCustTable (\n    CustomerID INT,\n    FirstName VARCHAR(50),\n    LastName VARCHAR(50),\n    City VARCHAR(50),\n    StateProvince VARCHAR(50),\n    Zip VARCHAR(50),\n    PhoneNumber VARCHAR(50)\n);\n\nWITH CustomerSearch AS (\n    SELECT \n        cu.CustomerID,\n        cu.FirstName,\n        cu.LastName,\n        a.City,\n        a.StateProvince,\n        a.Zip,\n        p.PhoneNumber\n    FROM \n        Customer cu WITH(NOLOCK)\n    LEFT OUTER JOIN \n        Address a WITH(NOLOCK) ON cu.CustomerID = a.CustomerID\n    LEFT OUTER JOIN \n        Phone p WITH(NOLOCK) ON cu.CustomerID = p.CustomerID\n    WHERE \n        (cu.LastName = @LastName OR cu.LastName LIKE @LastName + '%')\n        AND (@FirstName IS NULL OR cu.FirstName = @FirstName OR cu.FirstName LIKE @FirstName + '%')\n        AND (@StateProvince = '' OR a.StateProvince LIKE @StateProvince)\n        AND (@City = '' OR a.City LIKE @City + '%')\n        AND (@Zip = '' OR a.Zip = @Zip OR a.Zip LIKE @Zip + '%')\n)\nINSERT INTO #tempCustTable\nSELECT DISTINCT \n    CustomerID,\n    FirstName,\n    LastName,\n    City,\n    StateProvince,\n    Zip,\n    PhoneNumber\nFROM \n    CustomerSearch\nORDER BY \n    LastName, \n    FirstName;\n\nSELECT * FROM #tempCustTable;\nDROP TABLE #tempCustTable;