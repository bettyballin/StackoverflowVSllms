DECLARE @sql AS NVARCHAR(MAX)\nDECLARE @pivotList AS NVARCHAR(MAX)\n\nSELECT @pivotList = STUFF((SELECT DISTINCT ',' + QUOTENAME(p.PositionName)\n                            FROM Position p\n                            FOR XML PATH(''), TYPE).value('.', 'NVARCHAR(MAX)'), 1, 1, '')\n\nSET @sql = N'SELECT c.CategoryID, c.CategoryName, ' + @pivotList + '\n            FROM (SELECT c.CategoryID, c.CategoryName, p.PositionName, cp.COrder\n                  FROM Category c\n                  LEFT JOIN CategoryPosition cp ON c.CategoryID = cp.CID\n                  LEFT JOIN Position p ON cp.PID = p.PositionID) AS SourceTable\n            PIVOT (MAX(COrder) FOR PositionName IN (' + @pivotList + ')) AS PivotTable'\n\nEXEC sp_executesql @sql