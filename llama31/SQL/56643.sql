select p.* from policies p \nwhere exists (select 0 from status_changes sc join statuses s on sc.status_id = s.id\n              where sc.policy_id = p.id\n              and s.status_category_id = '1'\n              and sc.created_at between '2009-03-10' and '2009-03-12')\nor exists\n(select 0 from status_changes sc join statuses s on sc.status_id = s.id\n where sc.created_at in\n (select max(sc2.created_at)\n  from status_changes sc2\n  where sc2.policy_id = p.id\n  and sc2.created_at < '2009-03-10')\n and s.status_category_id = '1'\n and sc.policy_id = p.id)\nAND exists\n(select 0 from status_changes sc\n where sc.policy_id = p.id\n and sc.status_id = 7\n and sc.created_at between '2008-12-31' and '2009-03-12')\nor exists\n(select 0 from status_changes sc\n where sc.created_at in\n (select max(sc2.created_at)\n  from status_changes sc2\n  where sc2.policy_id = p.id\n  and sc2.created_at < '2008-12-31')\n and sc.status_id = 7\n and sc.policy_id = p.id)