CREATE PROCEDURE pUpdateStudentStatusBatch\n    @StudentIDs TABLE (StudentID INT),\n    @StatusID INT,\n    @Comments VARCHAR(MAX),\n    @UserID INT\nAS\nBEGIN\n    -- Update student status and log changes\n    UPDATE s\n    SET s.StatusID = @StatusID\n    FROM Students s\n    INNER JOIN @StudentIDs u ON s.StudentID = u.StudentID;\n\n    INSERT INTO StudentStatusHistory (StudentID, StatusID, Comments, UserID)\n    SELECT u.StudentID, @StatusID, @Comments, @UserID\n    FROM @StudentIDs u;\nEND;