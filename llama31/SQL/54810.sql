ALTER TRIGGER [dbo].[UpdateUniqueSubjectAfterInsertUpdate]\n   ON  [dbo].[Contents]\n   AFTER INSERT,UPDATE\nAS\nBEGIN\n    SET NOCOUNT ON\n\n    UPDATE c\n    SET UniqueSubject = ISNULL(us.UniqueSubject, c.Subject)\n    FROM [dbo].[Contents] c\n    INNER JOIN (\n        SELECT i.ContentId, \n               i.Subject, \n               [dbo].[ToUriCleanText](i.Subject) AS UniqueSubject,\n               ROW_NUMBER() OVER (PARTITION BY i.ContentId, [dbo].[ToUriCleanText](i.Subject) ORDER BY i.ContentId) AS RowNum\n        FROM INSERTED i\n    ) us ON c.ContentId = us.ContentId\n    WHERE c.ContentId = us.ContentId\nEND