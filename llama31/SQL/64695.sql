CREATE TRIGGER trg_UniqueActiveSurveyAnswer\nON SurveyAnswer\nAFTER INSERT, UPDATE\nAS\nBEGIN\n    IF EXISTS (\n        SELECT 1\n        FROM inserted i\n        JOIN Survey s ON i.SurveyId = s.SurveyId\n        WHERE s.Active = 1\n        AND EXISTS (\n            SELECT 1\n            FROM SurveyAnswer sa\n            JOIN Survey s2 ON sa.SurveyId = s2.SurveyId\n            WHERE s2.Active = 1\n            AND sa.SurveyDomainId = i.SurveyDomainId\n            AND sa.Answer = i.Answer\n        )\n    )\n    BEGIN\n        RAISERROR ('Duplicate answer for active survey', 16, 1)\n        ROLLBACK TRANSACTION\n    END\nEND