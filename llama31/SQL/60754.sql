WITH \n  -- Filter the time periods that overlap with the date range\n  filtered_periods AS (\n    SELECT \n      sensor_id, start_date, end_date, description\n    FROM \n      periods\n    WHERE \n      start_date < :range_end AND end_date > :range_start\n  ),\n  \n  -- Get the corresponding values for the start and end dates\n  start_values AS (\n    SELECT \n      fp.sensor_id, fp.start_date, \n      (SELECT value FROM values WHERE sensor_id = fp.sensor_id AND acquired >= fp.start_date ORDER BY acquired ASC FETCH FIRST 1 ROW ONLY) AS v1\n    FROM \n      filtered_periods fp\n  ),\n  \n  end_values AS (\n    SELECT \n      fp.sensor_id, fp.end_date, \n      (SELECT value FROM values WHERE sensor_id = fp.sensor_id AND acquired <= fp.end_date ORDER BY acquired DESC FETCH FIRST 1 ROW ONLY) AS v2\n    FROM \n      filtered_periods fp\n  )\n  \nSELECT \n  sv.sensor_id, sv.start_date, sv.v1, ev.end_date, ev.v2, fp.description\nFROM \n  start_values sv\n  JOIN end_values ev ON sv.sensor_id = ev.sensor_id AND sv.start_date = ev.start_date\n  JOIN filtered_periods fp ON sv.sensor_id = fp.sensor_id AND sv.start_date = fp.start_date;