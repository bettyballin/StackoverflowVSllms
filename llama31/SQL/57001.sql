WITH islands AS (\n  SELECT \n    UserID, \n    Value, \n    COUNT(*) AS Count\n  FROM (\n    SELECT \n      UserID, \n      Value, \n      (ROW_NUMBER() OVER (PARTITION BY UserID ORDER BY ID) - \n       ROW_NUMBER() OVER (PARTITION BY UserID, Value ORDER BY ID)) AS Island\n    FROM YourTable\n  ) AS subquery\n  GROUP BY UserID, Value, Island\n)\nSELECT \n  UserID, \n  Value, \n  MAX(Count) AS MaxCount\nFROM islands\nGROUP BY UserID, Value\nORDER BY MaxCount DESC;