CREATE PROCEDURE CopyFolder\n    @SourceFolderId INT,\n    @DestinationFolderId INT\nAS\nBEGIN\n    BEGIN TRANSACTION;\n\n    BEGIN TRY\n        -- Retrieve the source folder's subtree\n        WITH SourceSubtree AS (\n            SELECT Id, Left, Right, ParentId\n            FROM Tree\n            WHERE Id = @SourceFolderId\n            UNION ALL\n            SELECT t.Id, t.Left, t.Right, t.ParentId\n            FROM Tree t\n            INNER JOIN SourceSubtree p ON t.ParentId = p.Id\n        )\n        -- Insert the source subtree into the destination folder\n        INSERT INTO Tree (Left, Right, ParentId)\n        SELECT \n            Left + (SELECT Right FROM Tree WHERE Id = @DestinationFolderId),\n            Right + (SELECT Right FROM Tree WHERE Id = @DestinationFolderId),\n            @DestinationFolderId\n        FROM SourceSubtree;\n\n        -- Update the Left and Right values of the destination folder's children\n        UPDATE t\n        SET Left = Left + (SELECT COUNT(*) FROM SourceSubtree),\n            Right = Right + (SELECT COUNT(*) FROM SourceSubtree)\n        FROM Tree t\n        WHERE ParentId = @DestinationFolderId;\n\n        COMMIT TRANSACTION;\n    END TRY\n    BEGIN CATCH\n        ROLLBACK TRANSACTION;\n        THROW;\n    END CATCH;\nEND;