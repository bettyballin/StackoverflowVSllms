SELECT xml_serialize(\n         document\n         (\n           xml_element(\n             name 'SalesOrders',\n             xml_agg(\n               xml_element(\n                 name 'SalesOrder',\n                 xml_attribute('Id', so.id),\n                 xml_attribute('Code', so.Code),\n                 xml_element(\n                   name 'Customer',\n                   xml_attribute('Code', cu.Code),\n                   xml_attribute('Name', cu.Name)\n                 ),\n                 (\n                   SELECT xml_agg(\n                     xml_element(\n                       name 'SalesItem',\n                       xml_attribute('Item', Item_Num),\n                       xml_attribute('PartCode', pa.Code)\n                     )\n                   )\n                   FROM tblSalesItem si\n                   LEFT JOIN tblPart pa ON pa.Id = si.Part_Id\n                   WHERE si.SalesOrder_ID = so.Id\n                 )\n               )\n             )\n           )\n         ) AS xml\nFROM tblSalesOrder so\nJOIN tblCustomer cu ON so.customer_id = cu.ID;