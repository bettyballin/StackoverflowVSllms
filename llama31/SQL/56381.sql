SELECT \n  s.username, \n  t.taskID, \n  COALESCE(g.grade, 'u') AS grade\nFROM \n  students s\n  CROSS JOIN assignment_tasks at\n  JOIN tasks t ON at.taskID = t.taskID\n  LEFT JOIN (\n    SELECT \n      username, \n      taskID, \n      MAX(date) AS max_date\n    FROM \n      grades\n    GROUP BY \n      username, taskID\n  ) mg ON s.username = mg.username AND t.taskID = mg.taskID\n  LEFT JOIN grades g ON mg.username = g.username AND mg.taskID = g.taskID AND mg.max_date = g.date\nWHERE \n  at.assignmentID = [assignmentID]\nORDER BY \n  s.username, t.taskID;