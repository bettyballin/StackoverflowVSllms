SELECT XMLELEMENT("SalesOrders",\n         XMLAGG(\n           XMLELEMENT("SalesOrder",\n             XMLATTRIBUTES(so.id AS "Id", so.Code AS "Code"),\n             XMLELEMENT("Customer",\n               XMLATTRIBUTES(cu.Code AS "Code", cu.Name AS "Name")\n             ),\n             (SELECT XMLAGG(\n               XMLELEMENT("SalesItem",\n                 XMLATTRIBUTES(Item_Num AS "Item", pa.Code AS "PartCode")\n               )\n             )\n             FROM tblSalesItem si\n             LEFT JOIN tblPart pa ON pa.Id = si.Part_Id\n             WHERE si.SalesOrder_ID = so.Id\n           )\n         )\n       )\nFROM tblSalesOrder so\nJOIN tblCustomer cu ON so.customer_id = cu.ID;