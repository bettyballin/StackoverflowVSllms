-- Create a numbers table\nCREATE TABLE Numbers (Number INT PRIMARY KEY);\nINSERT INTO Numbers (Number) VALUES (0), (1), (2), (3), (4), (5), (6), (7), (8), (9);\n\n-- Create a sample events table\nCREATE TABLE Events (EventId INT, StartDate DATETIME, EndDate DATETIME);\nINSERT INTO Events (EventId, StartDate, EndDate) VALUES\n    (1, '2009-05-02', '2009-05-10'),\n    (2, '2009-05-08', '2009-05-12'),\n    (3, '2009-05-10', '2009-05-12'),\n    (4, '2009-05-21', '2009-05-21'),\n    (5, '2009-05-25', NULL),\n    (6, '2009-06-01', '2009-06-03');\n\n-- Define the input date range\nDECLARE @StartDate DATETIME = '2009-04-01';\nDECLARE @EndDate DATETIME = '2009-06-30';\n\n-- Generate the date ranges\nWITH DateRanges AS (\n    SELECT \n        DateRange = DATEADD(DAY, Number * 10, @StartDate),\n        NextDateRange = DATEADD(DAY, (Number + 1) * 10, @StartDate)\n    FROM \n        Numbers\n    WHERE \n        DATEADD(DAY, Number * 10, @StartDate) <= @EndDate\n),\nEventsInRange AS (\n    SELECT \n        DateRange,\n        EventId,\n        StartDate,\n        EndDate\n    FROM \n        DateRanges\n    INNER JOIN \n        Events ON \n            Events.StartDate < DateRanges.NextDateRange \n            AND (Events.EndDate IS NULL OR Events.EndDate >= DateRanges.DateRange)\n),\nOverlappingEvents AS (\n    SELECT \n        DateRange,\n        COUNT(DISTINCT EventId) AS OverlappingEvents\n    FROM \n        EventsInRange\n    GROUP BY \n        DateRange\n),\nNonOverlappingRanges AS (\n    SELECT \n        DateRange,\n        NextDateRange\n    FROM \n        DateRanges\n    LEFT JOIN \n        OverlappingEvents ON \n            DateRanges.DateRange = OverlappingEvents.DateRange\n    WHERE \n        OverlappingEvents.OverlappingEvents IS NULL\n)\nSELECT \n    'No event' AS EventType,\n    DateRange AS StartDate,\n    NextDateRange AS EndDate\nFROM \n    NonOverlappingRanges\nUNION ALL\nSELECT \n    'Overlap' AS EventType,\n    MIN(StartDate) AS StartDate,\n    MAX(EndDate) AS EndDate\nFROM \n    EventsInRange\nGROUP BY \n    DateRange\nORDER BY \n    StartDate;