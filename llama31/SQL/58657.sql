ALTER TABLE Article\nADD RowVersion ROWVERSION;\n\nCREATE PROCEDURE IncrementView\n(\n    @ArticleID int\n)\nAS\nBEGIN TRANSACTION\n\nDECLARE @CurrentRowVersion ROWVERSION;\n\nSELECT @CurrentRowVersion = RowVersion\nFROM Article\nWHERE ID = @ArticleID;\n\nUPDATE Article\nSET ViewCount = ViewCount + 1\nWHERE ID = @ArticleID AND RowVersion = @CurrentRowVersion;\n\nIF @@ROWCOUNT = 0\nBEGIN\n    -- Row was updated by another transaction, retry\n    ROLLBACK;\n    WAITFOR DELAY '00:00:00.100'; -- wait for 100ms\n    EXEC IncrementView @ArticleID;\n    RETURN;\nEND\n\nIF @@ERROR <> 0\nBEGIN\n    -- Rollback the transaction\n    ROLLBACK;\n\n    -- Raise an error and return\n    RAISERROR ('Error Incrementing', 16, 1);\n    RETURN;\nEND\n\nCOMMIT;