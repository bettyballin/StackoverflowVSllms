SELECT \n    sp.name AS LoginName,\n    dp.name AS DatabaseUserName,\n    db.name AS DatabaseName,\n    p.permission_name AS PermissionName,\n    p.state_desc AS PermissionState\nFROM \n    sys.server_principals sp\nINNER JOIN \n    sys.database_principals dp ON sp.sid = dp.sid\nINNER JOIN \n    sys.databases db ON dp.database_id = db.database_id\nINNER JOIN \n    sys.database_permissions p ON dp.principal_id = p.grantee_principal_id\nWHERE \n    sp.type IN ('S', 'U')  -- 'S' for SQL login, 'U' for Windows login\nORDER BY \n    sp.name, db.name, p.permission_name;