CREATE PROCEDURE CopyNewVersion(IN oldID)\nBEGIN\n  DECLARE newID INT;\n  \n  -- Start a transaction\n  BEGIN TRANSACTION;\n  \n  -- Copy main record details for passed in oldID\n  INSERT INTO MAIN (column1, column2, ...)\n  SELECT column1, column2, ...\n  FROM MAIN\n  WHERE ID = oldID;\n  \n  -- Get the new ID\n  SET newID = LAST_INSERT_ID();\n  \n  -- Copy all SUB1 records for oldID to newID\n  INSERT INTO SUB1 (ID, column1, column2, ...)\n  SELECT newID, column1, column2, ...\n  FROM SUB1\n  WHERE ID = oldID;\n  \n  -- Commit the transaction\n  COMMIT;\n  \n  -- Return the new ID\n  SELECT newID AS newID;\nEND