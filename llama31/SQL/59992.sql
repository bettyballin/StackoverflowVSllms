DECLARE \n  @count INT,\n  @loopcount INT,\n  @running_total INT = 0,\n  @prev_trtype VARCHAR(10) = '';\n\nDECLARE @tblTransactions TABLE\n(\n  ID INT IDENTITY(1,1),\n  trtype VARCHAR(10),\n  trdate DATETIME,\n  trvalue INT\n);\n\nINSERT INTO @tblTransactions\nSELECT * FROM Transactions;\n\nSELECT @count = @@ROWCOUNT;\nSET @loopcount = 1;\n\nWHILE @loopcount <= @count\nBEGIN\n  SELECT \n    @running_total = CASE \n      WHEN trtype = @prev_trtype THEN @running_total + trvalue \n      ELSE trvalue END,\n    @prev_trtype = trtype\n  FROM \n    @tblTransactions \n  WHERE \n    ID = @loopcount;\n\n  PRINT @running_total;  -- or do something else with the running total\n\n  SET @loopcount = @loopcount + 1;\nEND;