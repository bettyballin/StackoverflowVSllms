WITH denormalized_data AS (\n  SELECT emp_id, job_id, \n         MIN(eff_date) AS start_date, \n         MAX(eff_date) AS end_date\n  FROM employee_jobs\n  WHERE status = 'A'\n  GROUP BY emp_id, job_id\n  UNION ALL\n  SELECT emp_id, job_id, \n         MIN(eff_date) AS start_date, \n         NULL AS end_date\n  FROM employee_jobs\n  WHERE status = 'T'\n  GROUP BY emp_id, job_id\n)\nSELECT * FROM denormalized_data;