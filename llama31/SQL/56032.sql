WITH RECURSIVE product_offers AS (\n  SELECT po, array_agg(pi) AS pi_array\n  FROM product_instances\n  GROUP BY po\n),\nmatching_offers AS (\n  SELECT po, pi_array\n  FROM product_offers\n  WHERE pi_array @> ARRAY[10, 11, 13]  -- input product instances\n  AND NOT EXISTS (\n    SELECT 1\n    FROM product_offers o2\n    WHERE o2.po <> product_offers.po\n    AND o2.pi_array @> ARRAY[10, 11, 13]\n    AND o2.pi_array <@ product_offers.pi_array\n  )\n)\nSELECT po\nFROM matching_offers;