WITH RankedPrices AS (\n    SELECT \n        Product, \n        Region, \n        Store, \n        Price, \n        ROW_NUMBER() OVER (\n            PARTITION BY Product, COALESCE(Region, 0), COALESCE(Store, 0) \n            ORDER BY CASE \n                WHEN Region IS NOT NULL AND Store IS NOT NULL THEN 3 \n                WHEN Region IS NOT NULL THEN 2 \n                ELSE 1 \n            END DESC\n        ) AS Rank\n    FROM \n        Prices\n)\nSELECT \n    Product, \n    Region, \n    Store, \n    Price\nFROM \n    RankedPrices\nWHERE \n    Rank = 1