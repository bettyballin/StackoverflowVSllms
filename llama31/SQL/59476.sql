WITH Recursive_Hierarchy AS (\n  SELECT Node_ID, Parent_Node_ID, Effective_Date, End_Date, 0 AS Level\n  FROM Hierarchy_Relationships\n  WHERE Effective_Date <= '2022-01-01' AND End_Date >= '2022-01-01'\n  UNION ALL\n  SELECT r.Node_ID, r.Parent_Node_ID, r.Effective_Date, r.End_Date, Level + 1\n  FROM Recursive_Hierarchy p\n  JOIN Hierarchy_Relationships r ON p.Node_ID = r.Parent_Node_ID\n  WHERE r.Effective_Date <= '2022-01-01' AND r.End_Date >= '2022-01-01'\n)\nSELECT * FROM Recursive_Hierarchy;