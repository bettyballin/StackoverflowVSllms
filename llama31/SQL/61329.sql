-- Get the list of flag names\nDECLARE @flags TABLE (Id INT, Name VARCHAR(50));\nINSERT INTO @flags\nSELECT Id, Name FROM Flag;\n\n-- Build the dynamic SQL query\nDECLARE @sql VARCHAR(MAX) = '';\nSELECT @sql += '[' + Name + '],' FROM @flags;\nSET @sql = LEFT(@sql, LEN(@sql) - 1); -- Remove trailing comma\n\n-- Build the pivot query\nSET @sql = '\n    SELECT \n        F.Id AS FileId,\n        F.Name AS FileName,\n        ' + @sql + '\n    FROM \n        File F\n        LEFT JOIN (\n            SELECT \n                FF.FileId,\n                F.Name AS FlagName,\n                1 AS FlagValue\n            FROM \n                FileFlags FF\n                JOIN Flag F ON FF.FlagId = F.Id\n        ) P ON F.Id = P.FileId\n    PIVOT (\n        MAX(FlagValue)\n        FOR FlagName IN (' + @sql + ')\n    ) AS PivotTable\n';\n\n-- Execute the dynamic query\nEXEC(@sql);