DELIMITER //\nCREATE FUNCTION count_words(text TEXT) RETURNS INT\nBEGIN\n  DECLARE word_count INT DEFAULT 0;\n  DECLARE word TEXT;\n  DECLARE done INT DEFAULT 0;\n  DECLARE cur CURSOR FOR SELECT REGEXP_SPLIT(text, '[^\\s]+');\n  DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = 1;\n\n  OPEN cur;\n  read_loop: LOOP\n    FETCH cur INTO word;\n    IF done THEN\n      LEAVE read_loop;\n    END IF;\n    SET word_count = word_count + 1;\n  END LOOP;\n  CLOSE cur;\n\n  RETURN word_count;\nEND//\nDELIMITER ;