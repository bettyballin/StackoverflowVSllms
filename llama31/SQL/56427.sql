SELECT \n  a.locId,\n  a.temp - b.temp AS change\nFROM \n  (SELECT \n     locId,\n     dtg,\n     temp,\n     ROW_NUMBER() OVER (PARTITION BY locId ORDER BY dtg DESC) AS rn\n   FROM \n     your_table) a\nJOIN \n  (SELECT \n     locId,\n     dtg,\n     temp,\n     ROW_NUMBER() OVER (PARTITION BY locId ORDER BY dtg DESC) AS rn\n   FROM \n     your_table) b\nON \n  a.locId = b.locId AND a.rn = 1 AND b.rn = 2\nWHERE \n  a.dtg > (SELECT MAX(dtg) - INTERVAL '15 minute' FROM your_table);