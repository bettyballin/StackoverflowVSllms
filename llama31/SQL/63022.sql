CREATE PROCEDURE SendReminderEmails\nAS\nBEGIN\n    DECLARE @appointmentDate DATE = GETDATE();\n    DECLARE @customerId INT;\n    DECLARE @emailAddress VARCHAR(255);\n\n    DECLARE cur CURSOR FOR\n        SELECT CustomerId, EmailAddress\n        FROM Appointments\n        WHERE AppointmentDate = @appointmentDate;\n\n    OPEN cur;\n\n    FETCH NEXT FROM cur INTO @customerId, @emailAddress;\n\n    WHILE @@FETCH_STATUS = 0\n    BEGIN\n        EXEC msdb.dbo.sp_send_dbmail\n            @recipients = @emailAddress,\n            @subject = 'Reminder: Your appointment is today!',\n            @body = 'Please arrive on time for your appointment.';\n\n        FETCH NEXT FROM cur INTO @customerId, @emailAddress;\n    END\n\n    CLOSE cur;\n    DEALLOCATE cur;\nEND