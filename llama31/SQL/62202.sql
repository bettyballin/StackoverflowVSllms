CREATE TYPE UpdateStudentStatusTableType AS TABLE (\n    StudentID INT,\n    StatusID INT,\n    Comments VARCHAR(MAX),\n    UserID INT\n);\n\nALTER PROCEDURE pUpdateStudentStatus\n    @UpdateTable UpdateStudentStatusTableType READONLY\nAS\nBEGIN\n    -- Update student status and log changes\n    UPDATE s\n    SET s.StatusID = u.StatusID\n    FROM Students s\n    INNER JOIN @UpdateTable u ON s.StudentID = u.StudentID;\n\n    INSERT INTO StudentStatusHistory (StudentID, StatusID, Comments, UserID)\n    SELECT u.StudentID, u.StatusID, u.Comments, u.UserID\n    FROM @UpdateTable u;\nEND;