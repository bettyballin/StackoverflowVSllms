WITH payments AS (\n    SELECT \n        SchedID, \n        1 AS PaymentNum, \n        StartDate AS DueDate, \n        PaymentAmt AS ExpectedTotal\n    FROM \n        payment_schedule\n    UNION ALL\n    SELECT \n        p.SchedID, \n        p.PaymentNum + 1, \n        DATEADD(month, p.PaymentNum * s.Frequency, s.StartDate), \n        p.ExpectedTotal + s.PaymentAmt\n    FROM \n        payments p\n    INNER JOIN \n        payment_schedule s ON p.SchedID = s.SchedID\n    WHERE \n        p.PaymentNum < s.Term / s.Frequency\n)\nSELECT \n    SchedID, \n    PaymentNum, \n    DueDate, \n    ExpectedTotal\nFROM \n    payments\nORDER BY \n    SchedID, \n    PaymentNum