CREATE PROCEDURE proc1\nAS\nBEGIN\n    EXEC proc3;\nEND\nGO\n\nCREATE PROCEDURE proc2\nAS\nBEGIN\n    EXEC proc3;\nEND\nGO\n\nCREATE PROCEDURE proc3\nAS\nBEGIN\n    DECLARE @CurrentProcID INT = @@PROCID;\n    DECLARE @CurrentProcName VARCHAR(128) = OBJECT_NAME(@CurrentProcID);\n    \n    DECLARE @CallingProcID INT = NULL;\n    DECLARE @CallingProcName VARCHAR(128) = NULL;\n    \n    IF @@NESTLEVEL > 1\n    BEGIN\n        DBCC INPUTBUFFER(@@SPID);\n        SET @CallingProcID = (SELECT TOP 1 EventInfo FROM sys.sysprocesses WHERE SPID = @@SPID ORDER BY StartTime DESC);\n        SET @CallingProcName = OBJECT_NAME(@CallingProcID);\n    END\n    \n    RAISERROR ('Error in proc3. Called by %s.', 16, 1, @CallingProcName);\nEND\nGO