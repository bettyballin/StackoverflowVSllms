WITH messageentries AS (\n  SELECT \n    ROW_NUMBER() OVER (ORDER BY score DESC) AS row,\n    COUNT(DISTINCT town.townid) AS towns,\n    user_details.username,\n    user_score.score,\n    allience.alliencename,\n    allience.allienceid,\n    allience.alliencetagname,\n    COUNT(*) OVER () AS total_rows,\n    CASE WHEN user_details.username = 'myUsername' THEN ROW_NUMBER() OVER (ORDER BY score DESC) END AS my_row\n  FROM \n    user_details\n    INNER JOIN user_score ON user_details.username = user_score.username\n    INNER JOIN town ON user_details.username = town.townownername\n    LEFT OUTER JOIN allience_roles ON user_details.useralliencerole = allience_roles.roleid\n    LEFT OUTER JOIN allience ON allience_roles.allienceid = allience.allienceid\n  GROUP BY \n    user_details.username,\n    user_score.score,\n    allience.alliencename,\n    allience.allienceid,\n    allience.alliencetagname\n)\nSELECT \n  *,\n  MAX(my_row) OVER () AS my_row_number\nFROM \n  messageentries\nWHERE \n  row BETWEEN @startRowIndex AND @StartRowIndex + @RowsPerPage - 1