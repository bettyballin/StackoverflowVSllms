CREATE OR REPLACE FUNCTION get_offer(p_projnum NUMBER) RETURN NUMBER IS\n  v_offer NUMBER;\nBEGIN\n  SELECT offer INTO v_offer FROM projects WHERE projnum = p_projnum;\n  RETURN v_offer;\nEND;\n\nCREATE OR REPLACE TRIGGER trigger_w_subquery\nAFTER UPDATE OR INSERT ON project_archiving\nFOR EACH ROW WHEN (old.archiving_status <> new.archiving_status\n  AND new.archiving_status = 1\n  AND get_offer(:new.projnum) IS NULL\n)\nBEGIN\n  INSERT INTO offer_log (offer, status, date)\n  VALUES (null, 9, sysdate);\nEND;