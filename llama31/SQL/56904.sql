DECLARE @results TABLE (\n    spid int,\n    ecid int,\n    status nvarchar(30),\n    loginname nvarchar(128),\n    hostname nvarchar(128),\n    blk char(5),\n    dbname nvarchar(128),\n    cmd nvarchar(16),\n    request_id int\n);\n\nINSERT INTO @results\nEXEC sp_who;\n\nDECLARE @row INT = 1;\nDECLARE @maxRow INT = (SELECT COUNT(*) FROM @results);\nDECLARE @loginname nvarchar(128);\n\nWHILE @row <= @maxRow\nBEGIN\n    SELECT @loginname = loginname FROM @results WHERE spid = (SELECT spid FROM @results ORDER BY spid OFFSET @row - 1 ROWS FETCH NEXT 1 ROW ONLY);\n    IF @loginname LIKE '%gatesb%'\n    BEGIN\n        DECLARE @sql nvarchar(100) = 'KILL ' + CONVERT(nvarchar(10), (SELECT spid FROM @results ORDER BY spid OFFSET @row - 1 ROWS FETCH NEXT 1 ROW ONLY));\n        EXEC sp_executesql @sql;\n    END\n    SET @row = @row + 1;\nEND