-- Identify duplicate accounts\nWITH duplicate_accounts AS (\n  SELECT user_id, username, lastname, firstname,\n         ROW_NUMBER() OVER (PARTITION BY lastname, firstname ORDER BY user_id) AS row_num\n  FROM user_rtab\n)\n-- Choose primary account (e.g., earliest user_id)\nSELECT @primary_user_id := user_id\nFROM duplicate_accounts\nWHERE row_num = 1;\n\n-- Update lessonstatus_rtab to replace user_id of duplicate accounts\nUPDATE lessonstatus_rtab\nSET user_id = @primary_user_id\nWHERE user_id IN (\n  SELECT user_id\n  FROM duplicate_accounts\n  WHERE row_num > 1\n);\n\n-- Delete duplicate accounts from user_rtab\nDELETE FROM user_rtab\nWHERE user_id IN (\n  SELECT user_id\n  FROM duplicate_accounts\n  WHERE row_num > 1\n);