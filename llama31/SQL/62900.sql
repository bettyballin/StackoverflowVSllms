WITH RECURSIVE family_tree AS (\n  SELECT \n    id, \n    name, \n    age, \n    parent, \n    0 AS level\n  FROM \n    persons\n  WHERE \n    parent IS NULL  -- anchor query: select top-level parents\n  UNION ALL\n  SELECT \n    p.id, \n    p.name, \n    p.age, \n    p.parent, \n    level + 1\n  FROM \n    persons p\n  INNER JOIN family_tree ft ON p.parent = ft.id\n)\nSELECT \n  name, \n  age\nFROM \n  family_tree\nORDER BY \n  level, \n  age