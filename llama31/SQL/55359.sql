SELECT \n  SV.Netbios_Name0 AS [NetBIOS Name],\n  SCU.SystemConsoleUser0 AS [User Name],\n  CAST(SCU.LastConsoleUse0 AS datetime) AS [Last Console Use],\n  IP.IP_Addresses0 AS [IP Address]\n\nFROM \n  v_R_System_Valid SV\n  LEFT JOIN (\n    SELECT \n      ResourceID, \n      SystemConsoleUser0, \n      LastConsoleUse0,\n      ROW_NUMBER() OVER (PARTITION BY ResourceID ORDER BY LastConsoleUse0 DESC) AS rn\n    FROM \n      v_GS_SYSTEM_CONSOLE_USER\n  ) SCU ON SCU.ResourceID = SV.ResourceID AND SCU.rn = 1\n  LEFT JOIN v_RA_System_IPAddresses IP ON IP.ResourceID = SV.ResourceID\n\nWHERE \n  (SV.Netbios_Name0 NOT LIKE 'ENC-%')\n  AND (SV.Netbios_Name0 NOT LIKE 'NL%')\n\nORDER BY \n  SV.Netbios_Name0