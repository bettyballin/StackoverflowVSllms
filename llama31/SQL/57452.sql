WITH RecursiveDependencies AS (\n    SELECT \n        obj_name = CONVERT(VARCHAR(MAX), b.name),\n        level = 0,\n        hierarchy = CONVERT(VARCHAR(MAX), b.name)\n    FROM \n        sys.objects b\n    WHERE \n        b.name = @obj_name\n\n    UNION ALL\n\n    SELECT \n        obj_name = CONVERT(VARCHAR(MAX), c.name),\n        level = r.level + 1,\n        hierarchy = CONVERT(VARCHAR(MAX), r.hierarchy + ' -- ' + c.name)\n    FROM \n        sys.sql_expression_dependencies a\n    INNER JOIN \n        sys.objects b ON a.referencing_entity_id = b.object_id\n    INNER JOIN \n        sys.objects c ON a.referenced_entity_id = c.object_id\n    INNER JOIN \n        RecursiveDependencies r ON b.name = r.obj_name\n    WHERE \n        r.level < 10  -- limit to 10 levels deep\n)\nSELECT \n    hierarchy\nFROM \n    RecursiveDependencies\nORDER BY \n    hierarchy;