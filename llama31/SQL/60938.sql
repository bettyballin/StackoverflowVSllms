DECLARE @LicenseLimit INT = 10;\n\nSELECT LH1.LoginDateTime AS StartTime, LH2.LogoutDateTime AS EndTime\nFROM LoginHistory LH1\nJOIN LoginHistory LH2 ON LH1.UserId = LH2.UserId AND LH1.LoginDateTime < LH2.LogoutDateTime\nWHERE (SELECT COUNT(*) FROM LoginHistory LH3 WHERE LH3.LoginDateTime <= LH1.LoginDateTime AND (LH3.LogoutDateTime IS NULL OR LH3.LogoutDateTime > LH1.LoginDateTime)) > @LicenseLimit;