CREATE OR REPLACE FUNCTION check_open_bar_record()\nRETURNS TRIGGER AS $$\nBEGIN\n    IF EXISTS (\n        SELECT 1\n        FROM bar\n        WHERE id = NEW.id AND dropped IS NULL\n    ) THEN\n        RAISE EXCEPTION 'Cannot insert new record with open bar record';\n    END IF;\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER check_open_bar_record_trigger\nBEFORE INSERT ON bar\nFOR EACH ROW\nEXECUTE PROCEDURE check_open_bar_record();