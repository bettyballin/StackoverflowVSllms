WITH combined_orders AS (\n  SELECT id_customer, id, code, date\n  FROM p_orders\n  UNION ALL\n  SELECT id_customer, id, code, date\n  FROM h_orders\n),\ncombined_items AS (\n  SELECT id_order, description, price\n  FROM p_items\n  UNION ALL\n  SELECT id_order, description, price\n  FROM h_items\n)\nSELECT \n  c.id,\n  c.name,\n  COUNT(DISTINCT co.id) AS num_orders,\n  SUM(ci.price) AS total_money\nFROM \n  customer c\n  INNER JOIN combined_orders co ON co.id_customer = c.id\n  INNER JOIN combined_items ci ON ci.id_order = co.id\nGROUP BY \n  c.id,\n  c.name\nORDER BY \n  c.id;