DELIMITER //\nCREATE PROCEDURE mark_duplicates()\nBEGIN\n    UPDATE your_table t1\n    JOIN (\n        SELECT Code, MIN(DocID) as original_id\n        FROM your_table\n        GROUP BY Code\n        HAVING COUNT(*) > 1\n    ) t2 ON t1.Code = t2.Code\n    SET t1.IsDup = IF(t1.DocID = t2.original_id, 0, 1),\n        t1.DupOf = IF(t1.DocID = t2.original_id, 0, t2.original_id);\nEND//\nDELIMITER ;