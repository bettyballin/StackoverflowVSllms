DELIMITER //\n\nCREATE PROCEDURE search_documents(IN search_string VARCHAR(255))\nBEGIN\n  DECLARE tokens CURSOR FOR\n    SELECT idWord FROM Words WHERE Word LIKE CONCAT('%', search_string, '%');\n\n  DECLARE CONTINUE HANDLER FOR NOT FOUND SET @done = TRUE;\n\n  OPEN tokens;\n\n  read_loop: LOOP\n    FETCH tokens INTO token_id;\n\n    IF @done THEN\n      LEAVE read_loop;\n    END IF;\n\n    SELECT \n      w.Word, \n      d.Name, \n      d.Location\n    FROM \n      Words w\n    JOIN \n      Word_Docs wd ON w.idWord = wd.idWord\n    JOIN \n      Documents d ON wd.idDoc = d.idDoc\n    WHERE \n      w.idWord = token_id AND\n      d.idDoc IN (\n        SELECT \n          wd.idDoc\n        FROM \n          Word_Docs wd\n        JOIN \n          Words w ON wd.idWord = w.idWord\n        WHERE \n          w.Word LIKE CONCAT('%', search_string, '%')\n      );\n  END LOOP;\n\n  CLOSE tokens;\nEND //\n\nDELIMITER ;