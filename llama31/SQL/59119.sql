-- Create a temporary table to store the results\nSELECT \n    (SELECT \n        IIF(IsNull(sum(b.AmountCharged) - sum(b.AmountPaid)),\n                a.Balance, \n                (sum(b.AmountCharged) - sum(b.AmountPaid)))\n        FROM tblCurrentTransaction AS b\n        WHERE b.TenantTransactionID <= a.TenantTransactionID \n                AND b.Tenant = a.Tenant\n        GROUP BY b.Tenant\n    ) AS TrueBalance, \n    a.TenantTransactionID\nINTO #TempTable\nFROM tblCurrentTransaction AS a\nORDER BY a.Tenant, a.TenantTransactionID;\n\n-- Update the tblCurrentTransaction table using the temporary table\nUPDATE tblCurrentTransaction\nSET Balance = #TempTable.TrueBalance\nFROM tblCurrentTransaction\nINNER JOIN #TempTable\nON tblCurrentTransaction.TenantTransactionID = #TempTable.TenantTransactionID;\n\n-- Drop the temporary table\nDROP TABLE #TempTable;