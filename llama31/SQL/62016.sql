SELECT \n  m.id, \n  t.priceEach,\n  (t.priceEach - (t.priceEach * m.margin)) AS estCost,\n  ((t.priceEach - (t.priceEach * m.margin)) * t.quantity) AS salesSub,\n  ((t.priceEach - (t.priceEach * m.margin)) * t.quantity) / \n    (SELECT SUM((t2.priceEach - (t2.priceEach * m2.margin)) * t2.quantity)\n     FROM financeMasters AS m2\n     INNER JOIN temp AS t2\n     ON m2.id = t2.id\n     WHERE m2.groupNum = m.groupNum) AS salesPercent\nINTO output\nFROM financeMasters AS m\nINNER JOIN temp AS t\nON m.id = t.id