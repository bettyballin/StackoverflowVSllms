WITH lag_lead AS (\n  SELECT id, month, year, value,\n         LAG(value) OVER (PARTITION BY id ORDER BY month) AS prev_value,\n         LEAD(value) OVER (PARTITION BY id ORDER BY month) AS next_value\n  FROM your_table\n),\ngroups AS (\n  SELECT id, month, year, value,\n         CASE\n           WHEN prev_value IS NULL OR prev_value != value THEN 1\n           ELSE 0\n         END AS group_start,\n         CASE\n           WHEN next_value IS NULL OR next_value != value THEN 1\n           ELSE 0\n         END AS group_end\n  FROM lag_lead\n)\nSELECT id, \n       MIN(month) AS start_month, \n       MAX(month) AS end_month, \n       MIN(year) AS start_year, \n       MAX(year) AS end_year, \n       value\nFROM groups\nGROUP BY id, value, \n         SUM(group_start) OVER (PARTITION BY id, value ORDER BY month)