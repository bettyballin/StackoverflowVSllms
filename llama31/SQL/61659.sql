SELECT \n  s_id, \n  s_title, \n  s_time, \n  (s_time-now()) AS s_timediff, \n  (\n    (SELECT COUNT(*) FROM s_ups WHERE stories.q_id=s_ups.s_id) - \n    (SELECT COUNT(*) FROM s_downs WHERE stories.s_id=s_downs.s_id)\n  ) AS votes,\n  LOG10(\n    (\n      (SELECT COUNT(*) FROM s_ups WHERE stories.q_id=s_ups.s_id) - \n      (SELECT COUNT(*) FROM s_downs WHERE stories.s_id=s_downs.s_id)\n    ) + 1\n  ) * (\n    (UNIX_TIMESTAMP(s_time) - UNIX_TIMESTAMP(NOW())) / 45000\n  ) AS ranking\nFROM \n  stories\nORDER BY \n  ranking DESC;