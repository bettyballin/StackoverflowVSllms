WITH ranked_sales AS (\n  SELECT custid, prodid, issue, qty, datesold,\n         ROW_NUMBER() OVER (PARTITION BY custid, prodid ORDER BY datesold DESC) AS row_num\n  FROM sales\n  WHERE custid = @custid\n)\nSELECT *\nFROM ranked_sales\nWHERE row_num = 1