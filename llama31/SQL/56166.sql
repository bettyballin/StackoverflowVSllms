CREATE TABLE #Temp (VisitingCount int, [Time] nvarchar(5), [Date] nvarchar(50) )\n\n-- ... rest of your code ...\n\nselect Sum(VisitingCount)as VisitingCount, [Time],Date\nfrom (\n  select Sum(VisitingCount)as VisitingCount, [Time],Date\n    from #Temp group by [Time],Date\n  Union All\n    select count(page) as VisitingCount,CONVERT(VARCHAR(5),Date, 108), \n    (datepart(hour,Date)*60+datepart(minute,Date))/30 as [Time]\n    from scr_SecuristLog\n    where Date between '2009-05-12' and '2009-05-13'\n    GROUP BY (datepart(hour,Date)*60+datepart(minute,Date))/30,CONVERT(VARCHAR(5),Date, 108)\n  ) X\ngroup by [Time],Date\norder by 2 asc