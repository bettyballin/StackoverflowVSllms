CREATE FUNCTION fnGetOpManualXMLDataFromInt \n(\n    @valueXPath nvarchar(255), \n    @criteriaXPath nvarchar(255),\n    @intCriteriaVal int\n)\nRETURNS @returntable TABLE \n(\n    omId int,\n    xmlNodes xml\n)\nAS\nBEGIN\n    DECLARE @sql nvarchar(max)\n    SET @sql = '\n        INSERT INTO @returntable (omId, xmlNodes)\n        SELECT omID, omText.query(''' + @valueXPath + ''')\n        FROM dbo.htOperationsManuals\n        WHERE omText.exist(''' + @criteriaXPath + ''') = 1\n        AND omText.value(''' + @criteriaXPath + ''', ''int'') = ' + CONVERT(nvarchar(10), @intCriteriaVal)\n\n    EXEC sp_executesql @sql, N'@returntable TABLE (omId int, xmlNodes xml)', @returntable OUTPUT\n\n    RETURN\nEND