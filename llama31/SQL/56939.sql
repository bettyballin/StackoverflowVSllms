WITH numberedSchedule AS (\n  SELECT \n    EmployeeID, \n    ProjectID, \n    DayID, \n    ROW_NUMBER() OVER (PARTITION BY EmployeeID, ProjectID ORDER BY DayID) - DayID AS dateGroup\n  FROM \n    EmployeeSchedule\n)\nSELECT \n  EmployeeID, \n  ProjectID, \n  dn1.Day AS startDate, \n  dn2.Day AS endDate\nFROM \n  numberedSchedule\n  JOIN DayNumbers dn1 ON numberedSchedule.startDate = dn1.ID\n  JOIN DayNumbers dn2 ON numberedSchedule.endDate = dn2.ID\nGROUP BY \n  EmployeeID, \n  ProjectID, \n  dateGroup\nORDER BY \n  EmployeeID, \n  ProjectID, \n  startDate;