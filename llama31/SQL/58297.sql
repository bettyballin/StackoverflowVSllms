SELECT \n    D.TestDate,\n    PS1.SiteNm AS SiteNm,\n    PS1.PersonName + ', ' + PS2.PersonName AS TestPair\nFROM \n    Dates D\nJOIN \n    PersonSite PS1 ON D.TestDate = DATEADD(DAY, ((PS1.PersonOrder - 1) / @PairSize), @StartDate)\nJOIN \n    PersonSite PS2 ON PS1.SiteID = PS2.SiteID AND PS1.PairGroup = PS2.PairGroup AND PS1.PersonID < PS2.PersonID\nWHERE \n    PS1.PersonOrder % @PairSize = 1\n    AND PS2.PersonOrder % @PairSize = 2\nORDER BY \n    D.TestDate, \n    PS1.SiteNm;