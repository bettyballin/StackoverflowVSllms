CREATE PROCEDURE sp_SwapRecords\n    @tableName nvarchar(128), -- Ensure this length matches your max table name length\n    @id1 int,\n    @id2 int,\n    @excludeColumns nvarchar(max)\nAS\nBEGIN\n    SET NOCOUNT ON;\n\n    DECLARE @sql nvarchar(max) = '';\n    DECLARE @selectList nvarchar(max) = '';\n    DECLARE @schema nvarchar(128);\n\n    -- Basic validation\n    IF @tableName IS NULL OR @id1 IS NULL OR @id2 IS NULL\n    BEGIN\n        RAISERROR('Invalid parameters', 16, 1);\n        RETURN;\n    END\n\n    -- Get schema of the table\n    SELECT @schema = s.name \n    FROM sys.tables t\n    JOIN sys.schemas s ON t.schema_id = s.schema_id\n    WHERE t.name = @tableName;\n\n    -- Build select list excluding specified columns\n    SELECT @selectList += ',' + QUOTENAME(c.name)\n    FROM sys.columns c\n    JOIN sys.tables t ON c.object_id = t.object_id\n    JOIN sys.schemas s ON t.schema_id = s.schema_id\n    WHERE t.name = @tableName AND s.name = @schema\n        AND c.name NOT IN (SELECT value FROM STRING_SPLIT(@excludeColumns, ','));\n    \n    SET @selectList = STUFF(@selectList, 1, 1, '');\n\n    -- Construct the swap query\n    SET @sql = N'\n        UPDATE t1\n        SET ' + @selectList + N' = t2.' + @selectList + '\n        FROM ' + QUOTENAME(@schema) + '.' + QUOTENAME(@tableName) + N' t1\n        JOIN ' + QUOTENAME(@schema) + '.' + QUOTENAME(@tableName) + N' t2 ON t1.' + QUOTENAME('id') + N' = t2.' + QUOTENAME('id') + N'\n        WHERE t1.' + QUOTENAME('id') + N' = @id1 AND t2.' + QUOTENAME('id') + N' = @id2;\n\n        UPDATE t1\n        SET ' + @selectList + N' = t2.' + @selectList + '\n        FROM ' + QUOTENAME(@schema) + '.' + QUOTENAME(@tableName) + N' t1\n        JOIN ' + QUOTENAME(@schema) + '.' + QUOTENAME(@tableName) + N' t2 ON t1.' + QUOTENAME('id') + N' = t2.' + QUOTENAME('id') + N'\n        WHERE t1.' + QUOTENAME('id') + N' = @id2 AND t2.' + QUOTENAME('id') + N' = @id1;';\n\n    EXEC sp_executesql @sql, N'@id1 int, @id2 int', @id1 = @id1, @id2 = @id2;\nEND