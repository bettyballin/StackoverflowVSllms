CREATE OR REPLACE FUNCTION tox.begin_spool()\nRETURNS void AS $$\nBEGIN\n    PERFORM set_config('tox.spool_key', (nextval('spool_key_seq')::text), false);\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION tox.into_spool(in_txt text)\nRETURNS void AS $$\nBEGIN\n    INSERT INTO spool (key, txt, seq)\n    VALUES (current_setting('tox.spool_key')::integer, in_txt, nextval('spool_seq_seq'));\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION tox.reset_spool()\nRETURNS void AS $$\nBEGIN\n    DELETE FROM spool WHERE key = current_setting('tox.spool_key')::integer;\n    COMMIT;\n    PERFORM tox.begin_spool();\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION tox.end_spool()\nRETURNS TABLE (key integer, txt text, seq integer) AS $$\nBEGIN\n    COMMIT;\n    RETURN QUERY SELECT * FROM spool WHERE key = current_setting('tox.spool_key')::integer ORDER BY seq;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE OR REPLACE FUNCTION tox.timestamp()\nRETURNS text AS $$\nBEGIN\n    RETURN to_char(now(), 'YYYYMMDDHH24MISS');\nEND;\n$$ LANGUAGE plpgsql;