CREATE OR REPLACE PACKAGE edi_parser AS\n  FUNCTION extract_field(p_edi_message CLOB, p_segment VARCHAR2, p_field NUMBER) RETURN VARCHAR2;\nEND edi_parser;\n\nCREATE OR REPLACE PACKAGE BODY edi_parser AS\n  FUNCTION extract_field(p_edi_message CLOB, p_segment VARCHAR2, p_field NUMBER) RETURN VARCHAR2 IS\n    v_start_pos NUMBER;\n    v_end_pos NUMBER;\n    v_segment VARCHAR2(1000);\n    v_field_value VARCHAR2(1000);\n  BEGIN\n    -- Find the segment\n    v_start_pos := REGEXP_INSTR(p_edi_message, '^' || p_segment, 1, 1, 'm');\n    IF v_start_pos = 0 THEN\n      RETURN NULL;\n    END IF;\n    \n    v_end_pos := REGEXP_INSTR(p_edi_message, '^', v_start_pos + 1, 1, 'm');\n    IF v_end_pos = 0 THEN\n      v_end_pos := LENGTH(p_edi_message) + 1;\n    END IF;\n    \n    v_segment := SUBSTR(p_edi_message, v_start_pos, v_end_pos - v_start_pos);\n    \n    -- Split the segment into fields\n    v_field_value := REGEXP_SUBSTR(v_segment, '[^*]+', 1, p_field);\n    \n    RETURN v_field_value;\n  END extract_field;\nEND edi_parser;