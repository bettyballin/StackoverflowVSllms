INSERT INTO @tmpStack\n  (\n    EmployeeID, \n    ParentID,\n    LeftExtent\n  )\nSELECT TOP 1 EmployeeID, ParentID, @counter \nFROM Employee \nWHERE ISNULL(ParentID, 0) = ISNULL(@parentid,0) \n  /* If the Id and ParentId combination has already been added then record is not given [LeftExtent] or [RightExtent] values. */\n  AND (EmployeeID, ParentID) NOT IN (SELECT EmployeeID, ParentID FROM @tmpStack)