WITH OpeningBalances AS (\n  SELECT A.AccountId, A.AccountBalanceDate, SUM(BT.TokenAmount) AS OpeningBalance\n  FROM Account A\n  LEFT JOIN Balance B ON A.OpeningBalanceId = B.BalanceId\n  LEFT JOIN BalanceToken BT ON B.BalanceId = BT.BalanceId\n  GROUP BY A.AccountId, A.AccountBalanceDate\n),\nClosingBalances AS (\n  SELECT A.AccountId, A.AccountBalanceDate, SUM(BT.TokenAmount) AS ClosingBalance\n  FROM Account A\n  LEFT JOIN Balance B ON A.ClosingBalanceId = B.BalanceId\n  LEFT JOIN BalanceToken BT ON B.BalanceId = BT.BalanceId\n  GROUP BY A.AccountId, A.AccountBalanceDate\n)\nSELECT *\nFROM OpeningBalances\nFULL OUTER JOIN ClosingBalances ON OpeningBalances.AccountId = ClosingBalances.AccountId AND OpeningBalances.AccountBalanceDate = ClosingBalances.AccountBalanceDate;