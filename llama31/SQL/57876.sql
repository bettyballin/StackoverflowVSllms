WITH RankedMessages AS (\n  SELECT \n    MessageID, \n    SendingUserID, \n    ReceivingUserID,\n    ROW_NUMBER() OVER (\n      PARTITION BY \n        CASE \n          WHEN SendingUserID < ReceivingUserID \n          THEN SendingUserID \n          ELSE ReceivingUserID \n        END, \n        CASE \n          WHEN SendingUserID < ReceivingUserID \n          THEN ReceivingUserID \n          ELSE SendingUserID \n        END\n      ORDER BY MessageID DESC\n    ) AS RN\n  FROM YourTable\n)\nSELECT \n  MessageID, \n  SendingUserID, \n  ReceivingUserID\nFROM RankedMessages\nWHERE RN = 1;