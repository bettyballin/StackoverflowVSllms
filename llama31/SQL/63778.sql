-- Extract login information from production database\nCREATE TABLE #logins (\n    login_name sysname,\n    password_hash varbinary(256)\n);\n\nINSERT INTO #logins\nEXEC sp_help_revlogin;\n\n-- Create and update logins on dev and DR databases\nDECLARE @login_name sysname;\nDECLARE @password_hash varbinary(256);\nDECLARE @sql nvarchar(max);\n\nDECLARE login_cursor CURSOR FOR\nSELECT login_name, password_hash FROM #logins;\n\nOPEN login_cursor;\n\nFETCH NEXT FROM login_cursor INTO @login_name, @password_hash;\n\nWHILE @@FETCH_STATUS = 0\nBEGIN\n    SET @sql = N'IF NOT EXISTS (SELECT * FROM sys.server_principals WHERE name = ''' + @login_name + ''') CREATE LOGIN [' + @login_name + '] WITH PASSWORD = ''' + CONVERT(nvarchar(256), @password_hash) + '''';\n    EXEC sp_executesql @sql;\n\n    SET @sql = N'ALTER LOGIN [' + @login_name + '] WITH PASSWORD = ''' + CONVERT(nvarchar(256), @password_hash) + '''';\n    EXEC sp_executesql @sql;\n\n    FETCH NEXT FROM login_cursor INTO @login_name, @password_hash;\nEND\n\nCLOSE login_cursor;\nDEALLOCATE login_cursor;\n\nDROP TABLE #logins;