BEGIN TRY\n    UPDATE #table\n    SET currWorker = tblUser.UserLogonName\n    FROM tblUser\n    JOIN tblLoanInvolvement ON tblLoanInvolvement.invlUnderwriterDeptID = tblUser.userID\n    WHERE tblLoanInvolvement.LOANid = #table.loanid\n    AND #table.currstatus in('R_UW_Approved','R_Submitted to Underwriting')\n    OUTPUT INSERTED.loanid INTO @updatedRows\n\n    UPDATE #table\n    SET currWorker = tblUser.UserLogonName\n    FROM tblUser\n    JOIN tblLoanInvolvement ON tblLoanInvolvement.invlProcessorID  = tblUser.userID\n    WHERE tblLoanInvolvement.LOANid = #table.loanid\n    AND #table.currstatus in('R_UW Approved With Conditions','R_Loan Resubmitted','R_UW_Suspended','R_Submitted to Processing')\n    OUTPUT INSERTED.loanid INTO @updatedRows\n\n    UPDATE #table\n    SET currWorker = tblUser.UserLogonName\n    FROM tblUser\n    JOIN tblLoanInvolvement ON tblLoanInvolvement.invlCloserID = tblUser.userID\n    WHERE tblLoanInvolvement.LOANid = #table.loanid\n    AND #table.currstatus in('R_Docs Out','R_Ready to Close','R_Scheduled to Close and Fund','Scheduled To Close')\n    OUTPUT INSERTED.loanid INTO @updatedRows\nEND TRY\nBEGIN CATCH\n    DECLARE @errorLoanid INT\n    SELECT @errorLoanid = loanid FROM @updatedRows\n    PRINT 'Error occurred while updating loanid: ' + CONVERT(VARCHAR, @errorLoanid)\n    PRINT ERROR_MESSAGE()\nEND CATCH