MERGE [dbo].[Dim_MyTable] AS target\nUSING [dbo].[Staging_MyTable] AS source\nON target.[BusinessKey] = source.[BusinessKey]\n\nWHEN MATCHED AND target.[HashValue] <> source.[HashValue]\nTHEN\n    UPDATE SET target.[EndDate] = GETDATE()\n\nWHEN NOT MATCHED BY TARGET\nTHEN\n    INSERT ([BusinessKey], [StartDate], [EndDate], [HashValue], [OtherColumns...])\n    VALUES (source.[BusinessKey], GETDATE(), NULL, source.[HashValue], source.[OtherColumns...])\n\nWHEN MATCHED AND target.[HashValue] = source.[HashValue]\nTHEN\n    INSERT ([BusinessKey], [StartDate], [EndDate], [HashValue], [OtherColumns...])\n    VALUES (source.[BusinessKey], GETDATE(), NULL, source.[HashValue], source.[OtherColumns...]);