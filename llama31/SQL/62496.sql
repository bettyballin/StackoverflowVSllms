WITH ranked_balances AS (\n  SELECT \n    aid,\n    balance,\n    date,\n    ROW_NUMBER() OVER (PARTITION BY aid ORDER BY date DESC) AS row_num\n  FROM \n    your_table\n),\nlatest_balances AS (\n  SELECT \n    aid,\n    balance,\n    date,\n    LAG(date, 1, date) OVER (PARTITION BY aid ORDER BY date) AS prev_date\n  FROM \n    ranked_balances\n  WHERE \n    row_num = 1 OR MOD(DATEDIFF(date, LAG(date, 1, date) OVER (PARTITION BY aid ORDER BY date)), 5) = 0\n)\nSELECT \n  aid,\n  balance,\n  date\nFROM \n  latest_balances\nWHERE \n  date = (SELECT MAX(date) FROM latest_balances lb2 WHERE lb2.aid = latest_balances.aid AND lb2.prev_date <= latest_balances.date - INTERVAL 5 DAY)