WITH availability AS (\n  SELECT date_trunc('day', series) AS date, \n         bool_and(CASE WHEN booking_id IS NULL THEN TRUE ELSE FALSE END) AS available\n  FROM generate_series('2023-05-01', '2023-05-31', '1 day') series\n  LEFT JOIN bookings ON series BETWEEN start_date AND end_date\n  GROUP BY series\n)\nSELECT date, date + INTERVAL '3 days' AS end_date\nFROM availability\nWHERE available AND date + INTERVAL '3 days' <= '2023-05-31'\nAND NOT EXISTS (\n  SELECT 1\n  FROM availability a2\n  WHERE a2.date BETWEEN date AND date + INTERVAL '3 days'\n  AND NOT a2.available\n)