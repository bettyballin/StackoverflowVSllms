SELECT m.material_id, \n       m.content_id,\n       s.special_mat_file_location,\n       s.special_mat_file_size\nFROM mat m,\n     LATERAL (\n       SELECT MAX(file_location) KEEP (DENSE_RANK FIRST ORDER BY resolution DESC) AS special_mat_file_location,\n              MAX(file_size) KEEP (DENSE_RANK FIRST ORDER BY resolution DESC) AS special_mat_file_size\n       FROM mat\n       WHERE mat.content_id = m.content_id\n         /* AND ...\n           AND ...\n           AND ... */\n     ) s\nWHERE m.material_id IN (SELECT material_id\n                        FROM mat\n                        INNER JOIN con ON con.content_id = mat.content_id\n                        INNER JOIN con_groups ON con_groups.content_id = con.content_id\n                        WHERE con_groups.content_group_id = 10);