CREATE FUNCTION dbo.IsWatchmanPresent (@StartTime datetime, @EndTime datetime)\nRETURNS bit\nAS\nBEGIN\n    WITH MergedShifts AS (\n        SELECT Start, End, 1 AS Level\n        FROM Shifts\n        WHERE Start <= @EndTime AND End >= @StartTime\n        UNION ALL\n        SELECT s.Start, ms.End, Level + 1\n        FROM Shifts s\n        INNER JOIN MergedShifts ms ON s.Start <= ms.End AND s.End > ms.End\n    )\n    SELECT @StartTime, @EndTime, MAX(Level) AS MaxLevel\n    INTO #Results\n    FROM MergedShifts\n\n    DECLARE @MaxLevel int\n    SELECT @MaxLevel = MaxLevel FROM #Results\n\n    IF @MaxLevel IS NULL OR EXISTS (\n        SELECT 1\n        FROM #Results\n        WHERE Start < @EndTime AND End > @StartTime\n        GROUP BY Start, End\n        HAVING MAX(Level) < @MaxLevel\n    )\n        RETURN 0\n    ELSE\n        RETURN 1\nEND\nGO