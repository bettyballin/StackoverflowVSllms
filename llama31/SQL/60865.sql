CREATE OR REPLACE FUNCTION get_index(p_id NUMBER, p_threshold NUMBER)\n  RETURN NUMBER\nIS\n  l_blob BLOB;\n  l_value BINARY_FLOAT;\nBEGIN\n  SELECT data INTO l_blob FROM waveforms WHERE id = p_id;\n  FOR i IN 0..(DBMS_LOB.GETLENGTH(l_blob) / 4) - 1 LOOP\n    l_value := UTL_RAW.CAST_TO_BINARY_FLOAT(DBMS_LOB.SUBSTR(l_blob, 4, i * 4 + 1));\n    IF l_value > p_threshold THEN\n      RETURN i;\n    END IF;\n  END LOOP;\n  RETURN -1; -- not found\nEND;