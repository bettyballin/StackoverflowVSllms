CREATE TABLE parent (\n    id SERIAL PRIMARY KEY,\n    deleted_at TIMESTAMP\n);\n\nCREATE TABLE child (\n    id SERIAL PRIMARY KEY,\n    parent_id INTEGER NOT NULL REFERENCES parent(id),\n    deleted_at TIMESTAMP\n);\n\nCREATE OR REPLACE FUNCTION cascade_soft_delete()\nRETURNS TRIGGER AS $$\nBEGIN\n    UPDATE child\n    SET deleted_at = NOW()\n    WHERE parent_id = OLD.id;\n    RETURN OLD;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER cascade_soft_delete_trigger\nBEFORE UPDATE OF deleted_at ON parent\nFOR EACH ROW\nWHEN (NEW.deleted_at IS NOT NULL AND OLD.deleted_at IS NULL)\nEXECUTE PROCEDURE cascade_soft_delete();