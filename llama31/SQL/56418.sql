SELECT COUNT(DISTINCT his.historyID) AS theCount\nFROM RS_History his\nWHERE his.historyID IN \n    (SELECT track.historyID\n     FROM RS_HistoryTracker track\n     INNER JOIN (\n         SELECT historyID, MAX(trackDateTime) AS maxDateTime\n         FROM RS_HistoryTracker\n         WHERE trackDateTime <= @endOfWeek\n         GROUP BY historyID\n     ) maxTrack ON track.historyID = maxTrack.historyID AND track.trackDateTime = maxTrack.maxDateTime\n     WHERE (track.action = 'STATUS:INITIAL:DRAFT'\n            OR track.action = 'STATUS:DELETED:DRAFT'\n            OR track.action = 'STATUS:DRAFT:DRAFT')\n)