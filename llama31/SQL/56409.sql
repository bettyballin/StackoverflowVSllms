WITH LatestAddresses AS (\n    SELECT \n        SpouseID,\n        PreviousAddressID,\n        ROW_NUMBER() OVER (PARTITION BY SpouseID ORDER BY FromDate DESC) AS rowNumber\n    FROM \n        SpousePreviousAddresses\n    WHERE \n        CountryID = 181\n)\nUPDATE \n    spa\nSET \n    AddressTypeID = 1\nFROM \n    SpousePreviousAddresses spa\nINNER JOIN \n    LatestAddresses la ON spa.PreviousAddressID = la.PreviousAddressID\nWHERE \n    la.rowNumber = 1;