SELECT \n  shipment_id,\n  MIN(CASE WHEN stop_seq = min_stop_seq THEN TIME END) AS start,\n  MAX(CASE WHEN stop_seq = max_stop_seq THEN TIME END) AS end\nFROM \n  (\n    SELECT \n      shipment_id,\n      stop_seq,\n      TIME,\n      MIN(stop_seq) OVER (PARTITION BY shipment_id) AS min_stop_seq,\n      MAX(stop_seq) OVER (PARTITION BY shipment_id) AS max_stop_seq\n    FROM \n      test\n  ) AS subquery\nGROUP BY \n  shipment_id