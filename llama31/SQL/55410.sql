WITH contiguous_dates AS (\n  SELECT site_id, start_date, end_date,\n         CASE\n           WHEN LAG(end_date) OVER (PARTITION BY site_id ORDER BY start_date) = start_date - INTERVAL 1 DAY\n           THEN 0\n           ELSE 1\n         END AS is_start_of_contiguous_range\n  FROM your_table\n),\ncontiguous_ranges AS (\n  SELECT site_id, start_date, end_date,\n         SUM(is_start_of_contiguous_range) OVER (PARTITION BY site_id ORDER BY start_date) AS range_id\n  FROM contiguous_dates\n),\nlong_contiguous_ranges AS (\n  SELECT site_id, MIN(start_date) AS contiguous_start_date, MAX(end_date) AS contiguous_end_date\n  FROM contiguous_ranges\n  GROUP BY site_id, range_id\n  HAVING COUNT(*) >= 15\n)\nSELECT * FROM long_contiguous_ranges;