CREATE OR REPLACE FUNCTION convert_unit(\n    p_measurement_unit_id INTEGER,\n    p_value NUMERIC,\n    p_target_unit_id INTEGER\n)\nRETURNS NUMERIC AS $$\nDECLARE\n    conversion_factor NUMERIC;\nBEGIN\n    SELECT mu.conversion_factor\n    INTO conversion_factor\n    FROM measurement_unit mu\n    WHERE mu.id = p_measurement_unit_id;\n\n    RETURN p_value * conversion_factor / (\n        SELECT mu.conversion_factor\n        FROM measurement_unit mu\n        WHERE mu.id = p_target_unit_id\n    );\nEND;\n$$ LANGUAGE plpgsql;