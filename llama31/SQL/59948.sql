SELECT 'CREATE LOGIN [' + name + '] WITH PASSWORD = ''' + CONVERT(varchar(128), password_hash, 1) + ''';' \nFROM sys.server_principals \nWHERE type = 'S';\n\nSELECT 'CREATE USER [' + name + '] FOR LOGIN [' + name + '];' \nFROM sys.database_principals \nWHERE type = 'S';\n\nSELECT 'GRANT ' + permission_name + ' ON ' + OBJECT_NAME(major_id) + ' TO [' + grantee.name + '];' \nFROM sys.database_permissions \nJOIN sys.database_principals grantee ON grantee.principal_id = grantee_principal_id \nWHERE state = 'G';