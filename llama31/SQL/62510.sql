SELECT \n  s1.Id,\n  s1.Name,\n  s1.Parent,\n  s2.Id AS Child,\n  s2.Mark,\n  m.Ranking\nFROM \n  Students s1\n  JOIN (\n    SELECT \n      Parent, \n      MAX(Mark) AS MaxMark\n    FROM \n      Students\n    WHERE \n      Mark >= 20\n    GROUP BY \n      Parent\n  ) AS sub ON s1.Id = sub.Parent\n  JOIN Students s2 ON s2.Parent = s1.Id AND s2.Mark = sub.MaxMark\n  JOIN Marks m ON m.Name = s1.Name\nWHERE \n  s1.Parent = 0;