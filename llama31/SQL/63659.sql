SELECT \n  p.name,\n  [1] AS Category_1,\n  [2] AS Category_2,\n  [3] AS Category_3\nFROM \n  (\n    SELECT \n      p.name,\n      pc.cat_id,\n      c.name\n    FROM \n      product p\n      LEFT JOIN product_to_category pc ON p.id = pc.prod_id\n      LEFT JOIN category c ON pc.cat_id = c.id\n  ) AS SourceTable\nPIVOT \n  (\n    MAX(name)\n    FOR cat_id IN ([1], [2], [3])\n  ) AS PivotTable