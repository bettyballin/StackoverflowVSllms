function createXmlNode($doc, $node, $row) {\n    foreach ($row as $fieldname => $fieldvalue) {\n        if (is_array($fieldvalue)) {\n            $subNode = $doc->createElement($fieldname);\n            $subNode = $node->appendChild($subNode);\n            createXmlNode($doc, $subNode, $fieldvalue);\n        } else {\n            $node->appendChild($doc->createElement($fieldname, $fieldvalue));\n        }\n    }\n}\n\n// ... (rest of your code remains the same)\n\nwhile ($row = pg_fetch_assoc($result)) {\n    $node = $doc->createElement('collection');\n    $node = $root->appendChild($node);\n    createXmlNode($doc, $node, $row);\n}