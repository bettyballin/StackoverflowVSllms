$user_id = 1138;\n$time_span = '7 days'; // adjust to desired time span\n\n// Get the reputation total for the current user within the desired time span\n$user_reputation_total = $this->db->query("\n  SELECT SUM(value) as reputation_total\n  FROM reputation\n  WHERE user_id = $user_id AND created_at >= DATE_SUB(CURRENT_DATE, INTERVAL $time_span)\n")->row()->reputation_total;\n\n// Get the total number of users with reputation totals within the desired time span\n$total_users = $this->db->query("\n  SELECT COUNT(*) as total_users\n  FROM (\n    SELECT user_id, SUM(value) as reputation_total\n    FROM reputation\n    WHERE created_at >= DATE_SUB(CURRENT_DATE, INTERVAL $time_span)\n    GROUP BY user_id\n  ) as subquery\n")->row()->total_users;\n\n// Calculate the percentile rank\n$percentile_rank = ($this->db->query("\n  SELECT COUNT(*) as num_users_below\n  FROM (\n    SELECT user_id, SUM(value) as reputation_total\n    FROM reputation\n    WHERE created_at >= DATE_SUB(CURRENT_DATE, INTERVAL $time_span)\n    GROUP BY user_id\n  ) as subquery\n  WHERE reputation_total < $user_reputation_total\n")->row()->num_users_below / $total_users) * 100;