// Fetch all data from the database in a single query\n$data = fetchAllDataFromDatabase();\n\n// Generate sheets in batches\n$batchSize = 100;\nforeach (array_chunk($data, $batchSize) as $batch) {\n    $objPHPExcel = new PHPExcel();\n    // Generate a sheet with data\n    generateSheetWithData($objPHPExcel, $batch);\n    // Apply styles and formulas in a separate pass\n    applyStylesAndFormulas($objPHPExcel);\n    // Save the sheet to the Excel file\n    saveSheetToExcelFile($objPHPExcel);\n}\n\nfunction fetchAllDataFromDatabase() {\n    // Fetch all data from the database in a single query\n    $db = new mysqli('host', 'user', 'password', 'database');\n    $query = 'SELECT * FROM table_name';\n    $result = $db->query($query);\n    $data = array();\n    while ($row = $result->fetch_assoc()) {\n        $data[] = $row;\n    }\n    return $data;\n}\n\nfunction generateSheetWithData(PHPExcel $objPHPExcel, array $data) {\n    // Generate a sheet with data\n    $objPHPExcel->getActiveSheet()->setTitle('Sheet 1');\n    $objPHPExcel->getActiveSheet()->fromArray($data);\n}\n\nfunction applyStylesAndFormulas(PHPExcel $objPHPExcel) {\n    // Apply styles and formulas in a separate pass\n    $objPHPExcel->getActiveSheet()->getStyle('A1')->getFont()->setBold(true);\n    $objPHPExcel->getActiveSheet()->setCellValue('B1', '=SUM(A1:A10)');\n}\n\nfunction saveSheetToExcelFile(PHPExcel $objPHPExcel) {\n    // Save the sheet to the Excel file\n    $objPHPExcel->save('file.xlsx');\n}