function buildTree($data) {\n    $tree = array();\n    foreach ($data as $node) {\n        $id = $node['id'];\n        $ancestors = explode(',', $node['ancestors']);\n        $parent = end($ancestors);\n        if (!isset($tree[$parent])) {\n            $tree[$parent] = array();\n        }\n        $tree[$parent][] = $id;\n    }\n    return buildTreeRecursive($tree, 1); // assuming 1 is the root node\n}\n\nfunction buildTreeRecursive($tree, $node) {\n    $children = array();\n    if (isset($tree[$node])) {\n        foreach ($tree[$node] as $child) {\n            $children[] = array(\n                'id' => $child,\n                'children' => buildTreeRecursive($tree, $child)\n            );\n        }\n    }\n    return $children;\n}\n\n$data = array(\n    array('id' => 1, 'ancestors' => '1'),\n    array('id' => 2, 'ancestors' => '2,1'),\n    array('id' => 3, 'ancestors' => '3,1,2'),\n    array('id' => 4, 'ancestors' => '4,1')\n);\n\n$tree = buildTree($data);\nprint_r($tree);