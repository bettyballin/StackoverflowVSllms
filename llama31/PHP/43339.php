function decodeValue($encodedValue) {\n    $re = '/^(a|n|d|b|s|o):(.*)$/';\n    $matches = preg_match($re, urldecode($encodedValue), $matches);\n    if (!$matches || !$matches[1]) return; // non state cookie\n    $type = $matches[1];\n    $v = $matches[2];\n    switch ($type) {\n        case 'n':\n            return floatval($v);\n        case 'd':\n            return new DateTime($v);\n        case 'b':\n            return ($v == '1');\n        case 'a':\n            $all = array();\n            $values = explode('^', $v);\n            foreach ($values as $value) {\n                $all[] = decodeValue($value);\n            }\n            return $all;\n        case 'o':\n            $all = array();\n            $values = explode('^', $v);\n            foreach ($values as $value) {\n                list($key, $val) = explode('=', $value);\n                $all[$key] = decodeValue($val);\n            }\n            return $all;\n        default:\n            return $v;\n    }\n}