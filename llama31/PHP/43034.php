$imageId = $_GET['id'];\n\n// Authenticate user\n$user = authenticateUser($_SESSION['username'], $_SESSION['password']);\nif (!$user) {\n    header('HTTP/1.1 401 Unauthorized');\n    exit;\n}\n\n// Get image path and mime type from database\n$imagePath = getImagePathFromDatabase($imageId);\n$mime = getImageMimeTypeFromDatabase($imageId);\n\n// Check if image exists and is readable\nif (!file_exists($imagePath) || !is_readable($imagePath)) {\n    header('HTTP/1.1 404 Not Found');\n    exit;\n}\n\n// Output image\nheader('Content-Type: ' . $mime);\nheader('Content-Length: ' . filesize($imagePath));\nreadfile($imagePath);