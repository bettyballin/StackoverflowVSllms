$textval = 'This is some text to be an image.\nIt has multiple lines.\nEach line can have a different color.';\n\n$textcolors = array(\n    '666666', // color for line 1\n    'FF0000', // color for line 2\n    '00FF00'  // color for line 3\n);\n\n$font="arial.ttf";\n$size = 9;\n$padding= 1;\n$bgcolor= "ffffff";\n\n$transparent = 0;\n$antialias = 0;\n\n$fontfile = $fontpath.$font;\n\n$lines = explode("\n", $textval);\n$line_height = 0;\n$width = 0;\nforeach ($lines as $line) {\n    $box = imageftbbox($size, 0, $fontfile, $line, array());\n    $boxwidth = $box[4];\n    $boxheight = abs($box[3]) + abs($box[5]);\n    $line_height += $boxheight + $padding;\n    $width = max($width, $boxwidth + ($padding*2) + 1);\n}\n\n$height = $line_height + $padding;\n\n// create the image\n$png = imagecreate($width, $height);\n\n$color = str_replace("#","",$bgcolor);\n$red = hexdec(substr($bgcolor,0,2));\n$green = hexdec(substr($bgcolor,2,2));\n$blue = hexdec(substr($bgcolor,4,2));\n$bg = imagecolorallocate($png, $red, $green, $blue);\n\nimagefill($png, 0, 0, $bg);\n\n$y = $padding;\nforeach ($lines as $i => $line) {\n    $color = str_replace("#","",$textcolors[$i]);\n    $red = hexdec(substr($textcolors[$i],0,2));\n    $green = hexdec(substr($textcolors[$i],2,2));\n    $blue = hexdec(substr($textcolors[$i],4,2));\n    $tx = imagecolorallocate($png, $red, $green, $blue);\n    \n    $box = imageftbbox($size, 0, $fontfile, $line, array());\n    $textx = $padding;\n    $texty = $y + abs($box[3]);\n    imagettftext($png, $size, 0, $textx, $texty, $tx, $fontfile, $line);\n    $y += abs($box[3]) + abs($box[5]) + $padding;\n}\n\nheader("content-type: image/jpeg");\nimagejpeg($png);\nimagedestroy($png);\nexit;