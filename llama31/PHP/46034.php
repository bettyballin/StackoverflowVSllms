// Category.php\npublic function getItems($categoryId)\n{\n    $items = array();\n    $category = $this->find($categoryId);\n    if ($category) {\n        $items = $this->getItemCategories($category->id);\n        $children = $this->getChildren($category->id);\n        foreach ($children as $child) {\n            $items = array_merge($items, $this->getItems($child->id));\n        }\n    }\n    return $items;\n}\n\npublic function getItemCategories($categoryId)\n{\n    $itemCategories = $this->getItemCategoryModel()->fetchAll(\n        $this->getItemCategoryModel()->select()\n            ->where('category_id = ?', $categoryId)\n    );\n    $items = array();\n    foreach ($itemCategories as $itemCategory) {\n        $items[] = $this->getItemModel()->find($itemCategory->item_id);\n    }\n    return $items;\n}\n\npublic function getChildren($categoryId)\n{\n    $children = $this->fetchAll(\n        $this->select()\n            ->where('parent_id = ?', $categoryId)\n    );\n    return $children;\n}