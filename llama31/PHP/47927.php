$ch = curl_init($url);\ncurl_setopt($ch, CURLOPT_TCP_KEEPALIVE, 1);\ncurl_setopt($ch, CURLOPT_TCP_KEEPIDLE, 30);\ncurl_setopt($ch, CURLOPT_TCP_KEEPINTVL, 10);\ncurl_setopt($ch, CURLOPT_FORBID_REUSE, 0);\ncurl_setopt($ch, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);\n\n$reconnectInterval = 300; // reconnect every 5 minutes\n$lastReconnect = time();\n\nforeach ($documents as $document) {\n    if (time() - $lastReconnect >= $reconnectInterval) {\n        curl_close($ch);\n        $ch = curl_init($url);\n        curl_setopt($ch, CURLOPT_TCP_KEEPALIVE, 1);\n        curl_setopt($ch, CURLOPT_TCP_KEEPIDLE, 30);\n        curl_setopt($ch, CURLOPT_TCP_KEEPINTVL, 10);\n        curl_setopt($ch, CURLOPT_FORBID_REUSE, 0);\n        curl_setopt($ch, CURLOPT_HTTP_VERSION, CURL_HTTP_VERSION_1_1);\n        $lastReconnect = time();\n    }\n\n    curl_setopt($ch, CURLOPT_POSTFIELDS, $document);\n    curl_exec($ch);\n}\n\ncurl_close($ch);