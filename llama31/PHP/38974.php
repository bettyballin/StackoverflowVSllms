function crypt_apr1_md5($plainpasswd) {\n    $salt = substr(str_shuffle("abcdefghijklmnopqrstuvwxyz0123456789"), 0, 8);\n    $len = strlen($plainpasswd);\n    $text = $plainpasswd . '$apr1$' . $salt;\n    $bin = pack("H32", md5($plainpasswd . $salt . $plainpasswd));\n    for ($i = $len; $i > 0; $i -= 16) {\n        $text .= substr($bin, 0, min(16, $i));\n    }\n    for ($i = $len; $i > 0; $i >>= 1) {\n        $text .= ($i & 1) ? chr(0) : $plainpasswd{0};\n    }\n    $bin = pack("H32", md5($text));\n    for ($i = 0; $i < 1000; $i++) {\n        $new = ($i & 1) ? $plainpasswd : $bin;\n        if ($i % 3) $new .= $salt;\n        if ($i % 7) $new .= $plainpasswd;\n        $new .= ($i & 1) ? $bin : $plainpasswd;\n        $bin = pack("H32", md5($new));\n    }\n    $tmp = '';\n    for ($i = 0; $i < 5; $i++) {\n        $k = $i + 6;\n        $j = $i + 12;\n        if ($j == 16) $j = 5;\n        $tmp = $bin[$i] . $bin[$k] . $bin[$j] . $tmp;\n    }\n    $tmp = chr(0) . chr(0) . $bin[11] . $tmp;\n    $tmp = strtr(strrev(substr(base64_encode($tmp), 2)),\n                 "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",\n                 "./0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz");\n    return "$apr1$" . $salt . "$" . $tmp;\n}