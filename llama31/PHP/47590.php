$db = Zend_Db_Table::getDefaultAdapter();\n\n$select = $db->select()\n    ->from(array('e1' => new Zend_Db_Expr("(SELECT max(energy_produced) AS energy_produced, \n                                            mid(timestamp, 1, 10) AS timestamp1 \n                                            FROM tbl_energy \n                                            WHERE site_id = 1366 \n                                            AND mid(timestamp, 1, 10) >= DATE_SUB(curdate(),INTERVAL 1 day) \n                                            GROUP BY mid(timestamp, 1, 10))")))\n    ->joinInner(array('e2' => new Zend_Db_Expr("(SELECT max(energy_consumed) AS energy_consumed, \n                                               mid(timestamp, 1, 10) AS timestamp2 \n                                               FROM tbl_energy \n                                               WHERE site_id = 1366 \n                                               AND mid(timestamp, 1, 10) >= DATE_SUB(curdate(),INTERVAL 1 day) \n                                               GROUP BY mid(timestamp, 1, 10))")), \n                'e1.timestamp1 = e2.timestamp2', \n                array('energy_consumed'))\n    ->columns(array('energy_produced', 'timestamp1 AS timestamp'));\n\n$result = $db->fetchAll($select)->toArray();