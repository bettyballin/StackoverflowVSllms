function formatSqlResult($sqlResult) {\n    $formattedResult = [];\n    foreach ($sqlResult as $row) {\n        $userName = $row['user_name'];\n        if (!isset($formattedResult[$userName])) {\n            $formattedResult[$userName] = ['name' => $userName, 'tags' => []];\n        }\n        $formattedResult[$userName]['tags'][] = ['id' => $row['tag_id'], 'name' => $row['tag_name']];\n    }\n    return array_values($formattedResult);\n}\n\n$sqlResult = [\n    ['user_name' => 'john', 'tag_id' => 1, 'tag_name' => 'foo'],\n    ['user_name' => 'john', 'tag_id' => 2, 'tag_name' => 'bar'],\n    ['user_name' => 'rick', 'tag_id' => 3, 'tag_name' => 'foobar'],\n    ['user_name' => 'rick', 'tag_id' => 2, 'tag_name' => 'bar']\n];\n\n$formattedResult = formatSqlResult($sqlResult);\n\nprint_r($formattedResult);