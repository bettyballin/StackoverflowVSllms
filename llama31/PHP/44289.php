$threads = $mysqli->query("\n    SELECT DISTINCT t.id, t.title\n    FROM threads t\n    INNER JOIN (\n        SELECT parentID, MAX(date) as max_date\n        FROM comments\n        GROUP BY parentID\n    ) c ON t.id = c.parentID\n    ORDER BY c.max_date DESC\n");\n\nwhile ($thread = $threads->fetch_assoc()) {\n    echo "<li><a href=\"?threadID=$thread[id]\">".htmlspecialchars($thread['title'])."</a></li>";\n}