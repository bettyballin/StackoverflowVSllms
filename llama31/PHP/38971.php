function get_lock($lock_file) {\n    if (file_exists($lock_file)) {\n        $fp = fopen($lock_file, 'r');\n        if (flock($fp, LOCK_EX | LOCK_NB)) {\n            return $fp;\n        } else {\n            fclose($fp);\n            return false;\n        }\n    } else {\n        touch($lock_file);\n        $fp = fopen($lock_file, 'r');\n        flock($fp, LOCK_EX | LOCK_NB);\n        return $fp;\n    }\n}\n\nfunction release_lock($fp, $lock_file) {\n    flock($fp, LOCK_UN);\n    fclose($fp);\n    unlink($lock_file);\n}