$allowedFunctions = array('imagecrop', 'imagescale');\n\n$userCode = $_POST['user_code'];\n\n$isValid = true;\nforeach (token_get_all($userCode) as $token) {\n    if ($token[0] === T_STRING && !in_array($token[1], $allowedFunctions)) {\n        $isValid = false;\n        break;\n    }\n}\n\nif ($isValid) {\n    // Execute the user's code\n    eval($userCode);\n} else {\n    // Handle invalid code\n}