function createThumb($thumb, $ids) {\n    $start = getTime();\n\n    // File and new size\n    $filename = $thumb;\n\n    // Get new dimensions\n    $img1 = getimagesize($filename);\n\n    // ...\n\n    $imgPath = '/foo/bar/location/'.$ids;\n    $imgName = '';\n\n    // Create directory recursively with correct permissions\n    mkdir($imgPath, 0777, true);\n\n    // Create index.html file with a single operation\n    file_put_contents($imgPath."/index.html", '<html><body>401</body></html>');\n\n    // Resample image using GD2 (if available) or ImageMagick\n    if (extension_loaded('imagick')) {\n        $image = new Imagick($filename);\n        $image->resizeImage($new_width, $new_height, Imagick::FILTER_LANCZOS, 1);\n    } elseif (extension_loaded('gd2')) {\n        $image = imagecreatefromjpeg($filename);\n        imagecopyresampled($image, $image, 0, 0, 0, 0, $new_width, $new_height, $img1[0], $img1[1]);\n    } else {\n        // Fall back to original GD library\n        $image = imagecreatefromjpeg($filename);\n        imagecopyresampled($image, $image, 0, 0, 0, 0, $new_width, $new_height, $img1[0], $img1[1]);\n    }\n\n    // Save resized image using imagewebp() (if available)\n    if (extension_loaded('imagewebp')) {\n        $imgName = date("y_m_d_h_m_s").$name.'.webp';\n        imagewebp($image, $imgPath.'/'.$imgName);\n    } else {\n        // Fall back to original image format\n        if ($img1['mime'] == 'image/png') {\n            $imgName = date("y_m_d_h_m_s").$name.'.png';\n            imagepng($image, $imgPath.'/'.$imgName);\n        } else {\n            $imgName = date("y_m_d_h_m_s").$name.'.jpg';\n            imagejpeg($image, $imgPath.'/'.$imgName, 100);\n        }\n    }\n\n    $end = getTime();\n    echo  '<strong>createImage</strong>: '.round($end - $start,4).' seconden<br />';\n    exit;\n    return $imgName;\n}