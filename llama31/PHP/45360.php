function mysql_to_csv($db_host, $db_username, $db_password, $db_name, $query) {\n  $conn = new mysqli($db_host, $db_username, $db_password, $db_name);\n  \n  if ($conn->connect_error) {\n    die("Connection failed: " . $conn->connect_error);\n  }\n  \n  $result = $conn->query($query);\n  \n  if (!$result) {\n    die("Query failed: " . $conn->error);\n  }\n  \n  $fields = array();\n  $fields_escaped = array();\n  $fp = @fopen('php://output', 'w');\n  \n  if ($fp) {\n    $fields = $result->fetch_fields();\n    foreach ($fields as $val) {\n      $fields_escaped[] = str_replace('"', '""', $val->name);\n    }\n    fputcsv($fp, $fields_escaped);\n    \n    while ($row = $result->fetch_assoc()) {\n      $row_escaped = array();\n      foreach ($row as $val) {\n        $row_escaped[] = str_replace('"', '""', $val);\n      }\n      fputcsv($fp, $row_escaped);\n    }\n    fclose($fp);\n  }\n  \n  $conn->close();\n}\n\n// Usage\n$db_host = 'your_host';\n$db_username = 'your_username';\n$db_password = 'your_password';\n$db_name = 'your_database';\n$query = 'SELECT * FROM your_table';\n\nheader('Content-Type: text/csv');\nheader('Content-Disposition: attachment; filename="output.csv"');\n\nmysql_to_csv($db_host, $db_username, $db_password, $db_name, $query);