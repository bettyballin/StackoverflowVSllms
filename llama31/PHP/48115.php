$semaphore = sem_open("/my_semaphore", O_CREAT, 0644, 10); // create a semaphore with a count of 10\n\n$pids = array();\nforeach ($items as $item) {\n    sem_acquire($semaphore); // decrement the semaphore count\n    $pid = pcntl_fork();\n    if ($pid == -1) {\n        die("couldn't fork()");\n    } elseif ($pid > 0) {\n        // parent\n        $pids[] = $pid;\n    } else {\n        // child\n        do_stuff_with($item);\n        sem_release($semaphore); // increment the semaphore count\n        exit(0);\n    }\n}\n\nforeach ($pids as $pid) {\n    pcntl_waitpid($pid, $status);\n}\n\nsem_close($semaphore);