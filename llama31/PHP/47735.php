<?php\n// ipn_listener.php\n\n// Configuration\n$paypal_sandbox = true; // Set to false for live environment\n$paypal_url = 'https://www.paypal.com/cgi-bin/webscr';\n$paypal_sandbox_url = 'https://www.sandbox.paypal.com/cgi-bin/webscr';\n$database_host = 'your_host';\n$database_username = 'your_username';\n$database_password = 'your_password';\n$database_name = 'your_database';\n\n// Connect to database\n$conn = new mysqli($database_host, $database_username, $database_password, $database_name);\n\n// Check connection\nif ($conn->connect_error) {\n    die("Connection failed: " . $conn->connect_error);\n}\n\n// Verify IPN notification\nif ($_POST) {\n    $req = 'cmd=_notify-validate';\n    foreach ($_POST as $key => $value) {\n        $value = urlencode(stripslashes($value));\n        $req .= "&$key=$value";\n    }\n    $header .= "POST /cgi-bin/webscr HTTP/1.0\r\n";\n    $header .= "Content-Type: application/x-www-form-urlencoded\r\n";\n    $header .= "Content-Length: " . strlen($req) . "\r\n\r\n";\n    if ($paypal_sandbox) {\n        $fp = fsockopen("ssl://www.sandbox.paypal.com", 443, $errno, $errstr, 30);\n    } else {\n        $fp = fsockopen("ssl://www.paypal.com", 443, $errno, $errstr, 30);\n    }\n    if (!$fp) {\n        // Error\n    } else {\n        fputs(STDOUT, $header . $req);\n        while (!feof(STDOUT)) {\n            $res = fgets(STDOUT, 1024);\n            if (strcmp($res, "VERIFIED") == 0) {\n                // Insert data into database\n                $sql = "INSERT INTO your_table (column1, column2, ...) VALUES ('".$_POST['field1']."', '".$_POST['field2']."', ...)";\n                if ($conn->query($sql) === TRUE) {\n                    // Success\n                } else {\n                    // Error\n                }\n            } elseif (strcmp($res, "INVALID") == 0) {\n                // Error\n            }\n        }\n        fclose($STDIN);\n    }\n}\n?>