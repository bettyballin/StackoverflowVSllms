$commentsPerPage = 20;\n$currentPage = 1; // retrieve from query string or session\n$offset = ($currentPage - 1) * $commentsPerPage;\n\n$query = "SELECT * FROM comments\n          ORDER BY created_at DESC\n          LIMIT $offset, $commentsPerPage";\n\n$comments = $db->query($query)->fetchAll();\n\n// Iterate through comments and display them\nforeach ($comments as $comment) {\n    // Display comment and its replies (if any)\n    displayComment($comment);\n}\n\n// Function to display a comment and its replies\nfunction displayComment($comment) {\n    echo $comment->text;\n    $replies = getReplies($comment->id);\n    if ($replies) {\n        foreach ($replies as $reply) {\n            displayComment($reply);\n        }\n    }\n}\n\n// Function to retrieve replies for a comment\nfunction getReplies($commentId) {\n    $query = "SELECT * FROM comments\n              WHERE parent_id = $commentId\n              ORDER BY created_at ASC";\n    return $db->query($query)->fetchAll();\n}