$html = 'your ugly HTML here';\n\n// Pre-processing: remove unnecessary tags, attributes, and whitespace\n$html = preg_replace('/\s+/', ' ', $html);\n$html = strip_tags($html, '<table><tr><td>');\n\n// libtidy with options\n$tidy = new Tidy();\n$tidy->parseString($html, array('indent' => true, 'wrap' => 0, 'clean' => true, 'bare' => true));\n$tidy->cleanRepair();\n$html = $tidy->output();\n\n// DOM parsing\n$dom = new DOMDocument();\n$dom->loadHTML($html);\n$xpath = new DOMXPath($dom);\n\n// Traverse the HTML structure using XPath expressions or CSS selectors\n$tables = $xpath->query('//table');\nforeach ($tables as $table) {\n    // process each table\n}