// Define the number of images to process per batch\n$batchSize = 5;\n\n// Retrieve the last processed image ID from storage (e.g., database or file)\n$lastProcessedId = getLastProcessedId();\n\n// Retrieve the next batch of images to process\n$images = getImagesToProcess($lastProcessedId, $batchSize);\n\n// Process the batch of images\nforeach ($images as $image) {\n    // Thumbnail and watermark the image\n    processImage($image);\n}\n\n// Update the last processed image ID\nupdateLastProcessedId($images[count($images) - 1]->id);