$categories = array();\n$limit = 10000;\n\n// ...\n\nif (array_key_exists($category, $categories)) {\n    $id = $categories[$category];\n} else {\n    if (count($categories) >= $limit) {\n        // Flush the array to the database\n        $insertValues = array();\n        foreach ($categories as $cat => $id) {\n            $insertValues[] = "('$procId', '$cat')";\n        }\n        mysql_query("INSERT INTO categories (procId, category) VALUES " . implode(',', $insertValues));\n        $categories = array();\n    }\n    // Check the database\n    $result = mysql_query("SELECT id FROM categories WHERE procId='$procId' AND category='$category'");\n    if (mysql_num_rows($result) > 0) {\n        $id = mysql_fetch_assoc($result)['id'];\n    } else {\n        // Insert the new category\n        mysql_query("INSERT INTO categories (procId, category) VALUES ('$procId', '$category')");\n        $id = mysql_insert_id();\n    }\n    $categories[$category] = $id;\n}