$file = curl_file_create('path/to/file.txt');\n$postFields['file'] = $file;\n\n// Create the custom URL-encoded string as before\n$postString = '';\nforeach ($postFields as $key => $values) {\n    foreach ($values as $value) {\n        if ($value instanceof CURLFile) {\n            $postString .= $key . '=' . $value->getFilename() . '&';\n        } else {\n            $postString .= $key . '=' . urlencode($value) . '&';\n        }\n    }\n}\nrtrim($postString, '&'); // Remove trailing ampersand\n\n// Set CURLOPT_POSTFIELDS to the custom string\n$ch = curl_init();\ncurl_setopt($ch, CURLOPT_URL, 'https://example.com');\ncurl_setopt($ch, CURLOPT_RETURNTRANSFER, true);\ncurl_setopt($ch, CURLOPT_POST, true);\ncurl_setopt($ch, CURLOPT_POSTFIELDS, $postString);