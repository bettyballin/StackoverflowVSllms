function replace_urls_with_links($text) {\n    $url_pattern = '/(https?:\/\/[^\s]+)/';\n    $replacement = function($match) {\n        $url = parse_url($match[1]);\n        $scheme = $url['scheme'];\n        $host = $url['host'];\n        $path = $url['path'];\n        $query = $url['query'];\n        $fragment = $url['fragment'];\n        $link_text = $scheme . '://' . $host . $path;\n        $href = $scheme . '://' . $host . $path;\n        if (!empty($query)) {\n            $href .= '?' . $query;\n        }\n        if (!empty($fragment)) {\n            $href .= '#' . $fragment;\n        }\n        return '<a href="' . $href . '">' . $link_text . '</a>';\n    };\n    return preg_replace_callback($url_pattern, $replacement, $text);\n}