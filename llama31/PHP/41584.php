$iterator = new RecursiveIteratorIterator(\n    new Node_List(array($root)),\n    RecursiveIteratorIterator::SELF_FIRST);\n\n$i = 1; // Starting index for the left value\n$stack = array(); // Stack to keep track of nodes for right value calculation\n\nforeach ($iterator as $node) {\n    $node->left = $i++;\n    array_push($stack, $node);\n}\n\n// Reverse the stack to calculate the right values\nwhile ($node = array_pop($stack)) {\n    $node->right = $i++;\n}