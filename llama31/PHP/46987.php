$conn = new mysqli("localhost", "username", "password", "database");\n\nif ($conn->connect_error) {\n    die("Connection failed: " . $conn->connect_error);\n}\n\n$sql = "SELECT \n        case TRIM(company)\n            when 'apple'        THEN 'AAPL'\n            when 'microsoft'    THEN 'MSFT'\n            else '__xx__'\n        END as company       \n\n        ,case TRIM(division)\n            when 'hardware'         THEN Trim(division)\n            when 'software'         THEN Trim(division)\n            else '__xx__'\n        END as division\n\n        ,concat( '$' , format(sum(trydollar),0))    as  dollars\n    FROM        pivtest\n    GROUP BY    \n        company, division with rollup";\n\n$result = $conn->query($sql);\n\n$tree = array();\n\nwhile($row = $result->fetch_assoc()) {\n    if($row['company'] == '__xx__' && $row['division'] == '__xx__') {\n        $tree['Total'] = $row['dollars'];\n    } else {\n        if(!isset($tree[$row['company']])) {\n            $tree[$row['company']] = array();\n        }\n        if($row['division'] == '__xx__') {\n            $tree[$row['company']]['Total'] = $row['dollars'];\n        } else {\n            $tree[$row['company']][$row['division']] = $row['dollars'];\n        }\n    }\n}\n\nfunction printTree($tree, $indent = '') {\n    foreach($tree as $key => $value) {\n        if(is_array($value)) {\n            echo $indent . $key . "\n";\n            printTree($value, $indent . '    ');\n        } else {\n            echo $indent . $key . '; ' . $value . "\n";\n        }\n    }\n}\n\nprintTree($tree);\n\n$conn->close();