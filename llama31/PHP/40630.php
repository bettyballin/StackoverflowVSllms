635         move_uploaded_file($_FILES['image']['tmp_name'],$mainframe->getCfg( 'absolute_path' ) ."/virtualgallery/images/resize/$newname");\n\n636         /* resize images - width 600px */   \n637         $docRoot = $GLOBALS['mosConfig_absolute_path'];\n638         $pathToImages = $docRoot.'/virtualgallery/images/resize/';\n639         $pathToThumbs = $docRoot.'/virtualgallery/images/';\n640         $thumbHeight = 600;\n\n641         $dir = opendir( $pathToImages );\n642         while (false !== ($fname = readdir( $dir ))) {\n643             $info = pathinfo($pathToImages . $fname);\n644             if ( strtolower($info['extension']) == 'jpg' ) {\n645                 $img = imagecreatefromjpeg( "{$pathToImages}{$fname}" );\n646                 $width = imagesx( $img );\n647                 $height = imagesy( $img );\n648                 $new_width = floor( $width * ( $thumbHeight / $height ) );\n649                 $new_height = $thumbHeight;\n650                 $tmp_img = imagecreatetruecolor( $new_width, $new_height );\n651                 imagecopyresized( $tmp_img, $img, 0, 0, 0, 0, $new_width, $new_height, $width, $height );\n652                 imagejpeg( $tmp_img, "{$pathToThumbs}{$fname}" );\n653                 imagedestroy($img);\n654                 imagedestroy($tmp_img);\n655             };\n656         };\n657         closedir( $dir );\n\n658         /* delete file(s) from resize folder */\n659         $dir = $docRoot.'/virtualgallery/images/resize/';\n660         foreach(glob($dir.'*.*') as $v) {\n661             unlink($v);\n662         };