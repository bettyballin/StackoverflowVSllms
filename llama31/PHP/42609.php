class HTML {\n    private $tags = array();\n    private $attrs = array();\n    private $text = array();\n\n    public function tag($tag) {\n        $this->tags[] = array('tag' => $tag, 'children' => array());\n        return $this;\n    }\n\n    public function attr($key, $value) {\n        $lastTag = &$this->getLastTag();\n        $lastTag['attrs'][$key] = $value;\n        return $this;\n    }\n\n    public function text($text) {\n        $lastTag = &$this->getLastTag();\n        $lastTag['text'] = $text;\n        return $this;\n    }\n\n    public function close() {\n        $lastTag = &$this->getLastTag();\n        $children = $lastTag['children'];\n        unset($lastTag['children']);\n        $this->tags[count($this->tags) - 2]['children'][] = $lastTag;\n        array_pop($this->tags);\n        return $this;\n    }\n\n    private function &getLastTag() {\n        return $this->tags[count($this->tags) - 1];\n    }\n\n    function __toString() {\n        return $this->renderTags($this->tags);\n    }\n\n    private function renderTags($tags) {\n        $output = '';\n        foreach ($tags as $tag) {\n            $output .= '<' . $tag['tag'];\n            if (isset($tag['attrs'])) {\n                foreach ($tag['attrs'] as $key => $value) {\n                    $output .= ' ' . $key . '="' . htmlspecialchars($value) . '"';\n                }\n            }\n            $output .= '>';\n            if (isset($tag['text'])) {\n                $output .= $tag['text'];\n            }\n            if (isset($tag['children'])) {\n                $output .= $this->renderTags($tag['children']);\n            }\n            $output .= '</' . $tag['tag'] . '>';\n        }\n        return $output;\n    }\n}