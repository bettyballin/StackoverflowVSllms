function unserialize_session_data($session_data) {\n    $return_data = array();\n    $offset = 0;\n    while ($offset < strlen($session_data)) {\n        if (!strstr(substr($session_data, $offset), "|")) {\n            throw new Exception("invalid data, remaining: " . substr($session_data, $offset));\n        }\n        $pos = strpos($session_data, "|", $offset);\n        $num = $pos - $offset;\n        $varname = substr($session_data, $offset, $num);\n        $offset += $num + 1;\n        $data = unserialize(substr($session_data, $offset));\n        $return_data[$varname] = $data;\n        $offset += strlen(serialize($data));\n    }\n    return $return_data;\n}