function htmlentities_except_pre($text) {\n    // Use a regular expression to find all occurrences of <pre>...</pre>\n    preg_match_all('/<pre>.*?<\/pre>/s', $text, $pre_tags);\n\n    // Replace <pre>...</pre> with a placeholder\n    $text = preg_replace('/<pre>.*?<\/pre>/s', '__PRE_TAG__', $text);\n\n    // Apply htmlentities() to the text\n    $text = htmlentities($text);\n\n    // Replace the placeholder with the original <pre>...</pre> content\n    foreach ($pre_tags[0] as $pre_tag) {\n        $text = str_replace('__PRE_TAG__', $pre_tag, $text, 1);\n    }\n\n    return $text;\n}\n\n// Test the function\n$text = '<b>Hello world</b> <pre>This must not be converted to HTML entities</pre>';\necho htmlentities_except_pre($text);