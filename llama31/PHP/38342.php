function watermark($source_file, $source_width, $source_height, $image_type) {\n    // Define allowed image types\n    $allowed_types = ['gif', 'jpg', 'png'];\n\n    // Check if the image type is allowed\n    if (!in_array($image_type, $allowed_types)) {\n        throw new Exception("Invalid image type");\n    }\n\n    // Define the watermark image\n    $watermarksize = ($source_width > 300) ? '../images/fpwatermark.gif' : '../images/fpwatermark.gif';\n\n    // Create the watermark image\n    $watermark = imagecreatefromgif($watermarksize);\n\n    // Get the dimensions of the watermark\n    list($water_width, $water_height) = getimagesize($watermarksize);\n\n    // Create the source image\n    switch ($image_type) {\n        case 'gif':\n            $image = imagecreatefromgif($source_file);\n            break;\n        case 'jpg':\n            $image = imagecreatefromjpeg($source_file);\n            break;\n        case 'png':\n            $image = imagecreatefrompng($source_file);\n            break;\n    }\n\n    // Water mark process\n    $x = $source_width - $water_width - 8; //horizontal position\n    $y = $source_height - $water_height - 8; //vertical positon\n\n    imagecopymerge($image, $watermark, $x, $y, 0, 0, $water_width, $water_height, 65);\n\n    // Save the watermarked image\n    switch ($image_type) {\n        case 'gif':\n            imagegif($image, $source_file, 90);\n            break;\n        case 'jpg':\n            imagejpeg($image, $source_file, 90);\n            break;\n        case 'png':\n            imagepng($image, $source_file, 90);\n            break;\n    }\n\n    imagedestroy($image);\n\n    return $source_file;\n}