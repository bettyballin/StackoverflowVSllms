$posts = $this->select()->setIntegrityCheck(false)\n    ->from(array('post' => 'Posts'), array('*'))\n    ->where('post.idGroup = ' . $idGroup)\n    ->where('post.idTopic IS NULL')\n    ->order('post.date DESC')\n    ->limit($resultsPerPage, $resultsPerPage * ($page - 1))\n    ->joinLeft(array('user' => 'Users'), 'post.idUser = user.idUser', \n        array('idUser', 'fname', 'lname', 'profileUrl', 'photoUrl'))\n    ->joinLeft(array('comment' => 'Posts'), 'comment.idTopic = post.idPost')\n    ->setFetchMode(Zend_Db::FETCH_ASSOC)\n    ->query()->fetchAll();\n\n// Restructure the results\n$restructuredPosts = array();\nforeach ($posts as $post) {\n    $postId = $post['idPost'];\n    if (!isset($restructuredPosts[$postId])) {\n        $restructuredPosts[$postId] = array(\n            'post' => array($post),\n            'user' => array(),\n            'comments' => array()\n        );\n    }\n    if ($post['idTopic'] === null) {\n        $restructuredPosts[$postId]['post'][] = $post;\n    } elseif ($post['idTopic'] == $postId) {\n        $restructuredPosts[$postId]['comments'][] = $post;\n    }\n    if ($post['idUser'] != '') {\n        $restructuredPosts[$postId]['user'][] = $post;\n    }\n}