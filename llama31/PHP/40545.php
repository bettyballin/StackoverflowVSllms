// Create a temporary file\n$tempFile = tempnam(sys_get_temp_dir(), 'prefs');\nif ($tempFile === false) {\n    error_log("Failed to create temporary file");\n    // Contingency plan for failing to create a temp file\n} else {\n    $handle = fopen($tempFile, 'w');\n    if ($handle === false) {\n        error_log("Failed to open temporary file for writing");\n        // Contingency plan for failing to open temp file\n    } else {\n        fwrite($handle, $str);\n        fclose($handle);\n        // Replace the original file with the temporary file\n        if (!rename($tempFile, $file)) {\n            error_log("Failed to replace original file with temporary file");\n            // Contingency plan for failing to replace file\n        }\n    }\n}