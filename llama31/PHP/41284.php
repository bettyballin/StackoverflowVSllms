$MimeType = new MimeType();\n$mimetype = $MimeType->getType($filename);\n$basename = basename($filename);\n\nheader("Content-type: $mimetype");\nheader("Content-Disposition: attachment; filename*=UTF-8''$basename");\nheader('Content-Length: '. filesize($filename));\nheader('Cache-Control: private');\nheader('Pragma: public');\n\nif ( @readfile($filename)===false ) {\n  header("HTTP/1.0 500 Internal Server Error");\n  loadErrorPage('500');\n}