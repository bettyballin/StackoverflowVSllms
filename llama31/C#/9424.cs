using System;\nusing System.Runtime.InteropServices;\nusing Microsoft.Win32;\n\nnamespace CustomActions\n{\n    [ComVisible(true)]\n    public class DisableAnonymousAccess : MarshalByRefObject\n    {\n        [DllImport("metabase.dll")]\n        private static extern int MetabaseDelete(string pszPath, string pszPropertyName);\n\n        [CustomAction]\n        public static ActionResult DisableAnonymousAccess_MSI(Microsoft.Deployment.WindowsInstaller.Session session)\n        {\n            string virtualDirectoryPath = session.CustomActionData["VIRTUALDIRECTORYPATH"];\n\n            // Disable anonymous access\n            string anonymousAccessPropertyName = "AnonymousAccess";\n            int result = MetabaseDelete(virtualDirectoryPath, anonymousAccessPropertyName);\n\n            if (result != 0)\n            {\n                throw new Exception("Failed to disable anonymous access");\n            }\n\n            return ActionResult.Success;\n        }\n    }\n}