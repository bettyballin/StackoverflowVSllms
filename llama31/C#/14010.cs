using (var connection = new SqlConnection(connectionString))\n{\n    connection.Open();\n\n    using (var transaction = connection.BeginTransaction())\n    {\n        // Read current workload\n        var currentWorkload = ReadWorkloadFromDatabase(connection, transaction);\n\n        // Calculate new workload\n        var newWorkload = CalculateNewWorkload(currentWorkload);\n\n        // Update workload using conditional update\n        var updateCommand = new SqlCommand("UPDATE users SET workload = @new_workload WHERE user_id = @user_id AND workload = @current_workload", connection, transaction);\n        updateCommand.Parameters.AddWithValue("@new_workload", newWorkload);\n        updateCommand.Parameters.AddWithValue("@user_id", userId);\n        updateCommand.Parameters.AddWithValue("@current_workload", currentWorkload);\n\n        var rowsAffected = updateCommand.ExecuteNonQuery();\n\n        if (rowsAffected == 0)\n        {\n            // Conflict detected, retry from step 1\n            transaction.Rollback();\n            // ...\n        }\n        else\n        {\n            transaction.Commit();\n        }\n    }\n}