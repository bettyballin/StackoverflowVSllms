using System;\nusing System.Text.RegularExpressions;\nusing System.Web;\n\npublic class ResponseModifier : IHttpModule\n{\n    public void Init(HttpApplication context)\n    {\n        context.EndRequest += new EventHandler(OnEndRequest);\n    }\n\n    public void Dispose()\n    {\n        // Nothing to dispose\n    }\n\n    private void OnEndRequest(object sender, EventArgs e)\n    {\n        HttpApplication app = (HttpApplication)sender;\n        HttpResponse response = app.Response;\n\n        // Check if the response is not null and the content type is text/html\n        if (response != null && response.ContentType == "text/html")\n        {\n            // Get the response output stream\n            Stream outputStream = response.OutputStream;\n\n            // Create a new stream to hold the modified response\n            MemoryStream modifiedStream = new MemoryStream();\n\n            // Copy the original response to the modified stream\n            outputStream.CopyTo(modifiedStream);\n\n            // Get the modified stream as a string\n            modifiedStream.Position = 0;\n            string modifiedResponse = new StreamReader(modifiedStream).ReadToEnd();\n\n            // Apply your regex replacements here\n            modifiedResponse = Regex.Replace(modifiedResponse, "img.mysite.com", "img1.mysite.com");\n\n            // Set the modified response as the new response output stream\n            response.OutputStream = new MemoryStream(Encoding.UTF8.GetBytes(modifiedResponse));\n        }\n    }\n}