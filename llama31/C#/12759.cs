using System.DirectoryServices;\n\nprivate string GetAspNetVersion(string server, string directory)\n{\n    string path = string.Format("IIS://{0}/W3SVC/1/Root", server);\n\n    if (!string.IsNullOrEmpty(directory))\n    {\n        path = string.Concat(path, "/", directory);\n    }\n\n    DirectoryEntry iis = new DirectoryEntry(path);\n    string aspNetVersion = iis.Properties["ScriptMap"].Value.ToString();\n\n    // The ScriptMap property contains the ASP.NET version in the following format:\n    // "*,%windir%\Microsoft.NET\Framework\v{version}\aspnet_isapi.dll"\n    // Extract the version number from the string\n    int startIndex = aspNetVersion.IndexOf("v") + 1;\n    int endIndex = aspNetVersion.IndexOf("\\", startIndex);\n    string version = aspNetVersion.Substring(startIndex, endIndex - startIndex);\n\n    iis.Close();\n    iis = null;\n\n    return version;\n}