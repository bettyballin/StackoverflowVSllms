using System;\nusing System.Runtime.InteropServices;\n\npublic class ServiceSecurity\n{\n    [DllImport("advapi32.dll", SetLastError = true)]\n    private static extern IntPtr OpenSCManager(string lpMachineName, string lpDatabaseName, int dwDesiredAccess);\n\n    [DllImport("advapi32.dll", SetLastError = true)]\n    private static extern IntPtr OpenService(IntPtr hSCManager, string lpServiceName, int dwDesiredAccess);\n\n    private const int SC_MANAGER_CONNECT = 0x0001;\n    private const int SERVICE_QUERY_STATUS = 0x0004;\n    private const int ACCESS_SYSTEM_SECURITY = 0x01000000;\n\n    public static IntPtr GetServiceHandle(string serviceName, string machineName)\n    {\n        IntPtr hSCManager = OpenSCManager(machineName, null, SC_MANAGER_CONNECT);\n        if (hSCManager == IntPtr.Zero)\n        {\n            throw new Exception("Failed to open service control manager");\n        }\n\n        IntPtr hService = OpenService(hSCManager, serviceName, SERVICE_QUERY_STATUS | ACCESS_SYSTEM_SECURITY);\n        if (hService == IntPtr.Zero)\n        {\n            throw new Exception("Failed to open service");\n        }\n\n        return hService;\n    }\n}