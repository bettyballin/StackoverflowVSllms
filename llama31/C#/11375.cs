public void Authenticate(string username, string password)\n{\n    var user = db.Users.FirstOrDefault(u => u.Username == username && u.PasswordHash == password);\n    if (user != null)\n    {\n        var role = db.Roles.FirstOrDefault(r => r.Id == user.RoleId);\n        var permissions = db.Permissions.Where(p => p.RoleId == role.Id).ToList();\n\n        var claimsIdentity = new CustomClaimsIdentity(user.Id, username, role.Id, role.Name, permissions);\n        var claimsPrincipal = new CustomClaimsPrincipal(claimsIdentity);\n\n        // Set the ClaimsPrincipal for the current request\n        Thread.CurrentPrincipal = claimsPrincipal;\n        HttpContext.Current.User = claimsPrincipal;\n    }\n}