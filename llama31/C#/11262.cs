public static DataSet ExecuteDataset(string connectionString, CommandType commandType, string commandText, SqlParameter[] parameters, int commandTimeout = 30)\n{\n    using (SqlConnection connection = new SqlConnection(connectionString))\n    {\n        connection.Open();\n\n        using (SqlCommand command = new SqlCommand(commandText, connection))\n        {\n            command.CommandType = commandType;\n            command.CommandTimeout = commandTimeout;\n\n            if (parameters != null)\n            {\n                foreach (SqlParameter parameter in parameters)\n                {\n                    command.Parameters.Add(parameter);\n                }\n            }\n\n            using (SqlDataAdapter adapter = new SqlDataAdapter(command))\n            {\n                DataSet dataSet = new DataSet();\n                adapter.Fill(dataSet);\n                return dataSet;\n            }\n        }\n    }\n}