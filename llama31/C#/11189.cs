using System.Diagnostics;\nusing System.IO;\nusing System.Security.AccessControl;\nusing System.Security.Principal;\n\n// Create the event log\nif (!EventLog.SourceExists(APPLICATIONNAME))\n{\n    EventLog.CreateEventSource(APPLICATIONNAME, EVENTLOGNAME);\n}\n\n// Set the permissions on the event log\nstring logName = $"HKEY_LOCAL_MACHINE\\SYSTEM\\CurrentControlSet\\Services\\Eventlog\\{EVENTLOGNAME}";\nRegistryKey logKey = Registry.LocalMachine.OpenSubKey(logName, RegistryKeyPermissionCheck.ReadWriteSubTree, RegistryRights.ChangePermissions);\nif (logKey != null)\n{\n    var acl = logKey.GetAccessControl();\n    var rule = new RegistryAccessRule(new NTAccount("NT AUTHORITY\\NETWORK SERVICE"), RegistryRights.WriteKey, AccessControlType.Allow);\n    acl.AddAccessRule(rule);\n    logKey.SetAccessControl(acl);\n    logKey.Close();\n}\n\n// Write to the event log\nEventLog.WriteEntry(APPLICATIONNAME, "Service started", EventLogEntryType.Information);