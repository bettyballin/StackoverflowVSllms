foreach (MethodInfo method in type.GetMethods())\n{\n    var attribute = method.GetCustomAttributes(typeof(MessageHandlerAttribute), false).FirstOrDefault() as MessageHandlerAttribute;\n    if (attribute != null)\n    {\n        var handlerType = attribute.HandlerType;\n        var handler = Activator.CreateInstance(handlerType);\n        var handlerMethod = handlerType.GetMethod(attribute.HandlerName);\n        // add to dictionary\n    }\n}