public class COMObjectEnumerator : IEnumerable<object>\n{\n    [DllImport("ole32")]\n    static extern int CoGetObjectContext(int dwContext, out IntPtr pCtx);\n\n    public IEnumerator<object> GetEnumerator()\n    {\n        IntPtr ctx = IntPtr.Zero;\n        int hr = CoGetObjectContext(1, out ctx);\n        if (hr == 0)\n        {\n            try\n            {\n                while (true)\n                {\n                    object obj;\n                    hr = Marshal.GetObjectForIUnknown(ctx, out obj);\n                    if (hr != 0) break;\n                    yield return obj;\n                }\n            }\n            finally\n            {\n                Marshal.Release(ctx);\n            }\n        }\n    }\n\n    IEnumerator IEnumerable.GetEnumerator()\n    {\n        return GetEnumerator();\n    }\n}