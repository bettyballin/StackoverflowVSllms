public static string[] SmartSplit(string delimitedData, char delimiter, char escape)\n{\n    var result = new List<string>();\n    var current = new StringBuilder();\n    var isEscaped = false;\n\n    foreach (var c in delimitedData)\n    {\n        if (c == escape)\n        {\n            isEscaped = !isEscaped;\n            if (isEscaped)\n            {\n                current.Append(c);\n            }\n        }\n        else if (c == delimiter && !isEscaped)\n        {\n            if (current.Length > 0)\n            {\n                result.Add(current.ToString());\n                current.Clear();\n            }\n        }\n        else\n        {\n            current.Append(c);\n            isEscaped = false;\n        }\n    }\n\n    if (current.Length > 0)\n    {\n        result.Add(current.ToString());\n    }\n\n    return result.ToArray();\n}