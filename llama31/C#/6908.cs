public void CheckConnection(HttpContext context)\n{\n    try\n    {\n        context.Response.BeginWrite(new byte[] { ' ' }, 0, 1, new AsyncCallback(CheckConnectionCallback), context);\n    }\n    catch (HttpException)\n    {\n        // Connection is not active\n    }\n}\n\nprivate void CheckConnectionCallback(IAsyncResult ar)\n{\n    HttpContext context = (HttpContext)ar.AsyncState;\n    if (!context.Response.IsClientConnected)\n    {\n        // Connection is not active\n    }\n}