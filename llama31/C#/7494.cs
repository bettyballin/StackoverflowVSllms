using System.Runtime.Caching;\n\npublic class CompiledQueryCache\n{\n    private ObjectCache _cache = MemoryCache.Default;\n\n    public CompiledQuery<T> GetOrAdd<T>(string key, Func<CompiledQuery<T>> compileQuery)\n    {\n        var cachedQuery = _cache[key] as CompiledQuery<T>;\n        if (cachedQuery == null)\n        {\n            cachedQuery = compileQuery();\n            _cache.Add(key, cachedQuery, ObjectCache.InfiniteAbsoluteExpiration);\n        }\n        return cachedQuery;\n    }\n}