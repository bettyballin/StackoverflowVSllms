const string queryXP = "SELECT HotFixID FROM Win32_QuickFixEngineering";\nconst string queryVistaAndLater = "SELECT * FROM Win32_PatchFile";\n\nvar search = new ManagementObjectSearcher();\n\nif (Environment.OSVersion.Version.Major < 6) // XP\n{\n    search.Query = queryXP;\n}\nelse // Vista and later\n{\n    search.Query = queryVistaAndLater;\n}\n\nvar collection = search.Get();\n\nforeach (ManagementObject update in collection)\n{\n    if (update["HotFixID"] != null)\n    {\n        Console.WriteLine(update["HotFixID"].ToString());\n    }\n    else if (update["PatchID"] != null)\n    {\n        Console.WriteLine(update["PatchID"].ToString());\n    }\n}