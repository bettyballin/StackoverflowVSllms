using (var tx = session.BeginTransaction())\n{\n    // Acquire lock on Booking table\n    session.Lock(typeof(Booking), LockMode.Upgrade);\n\n    // Perform date range check\n    var existingBooking = session.Query<Booking>()\n        .Where(b => b.BookingStart < newBooking.BookingEnd && b.BookingEnd > newBooking.BookingStart)\n        .FirstOrDefault();\n\n    if (existingBooking != null)\n    {\n        // Conflict found, roll back transaction\n        tx.Rollback();\n        return;\n    }\n\n    // Insert new booking\n    session.Save(newBooking);\n\n    // Commit transaction\n    tx.Commit();\n}