public class DataPager\n{\n    private readonly string _connectionString;\n    private readonly string _tableName;\n\n    public DataPager(string connectionString, string tableName)\n    {\n        _connectionString = connectionString;\n        _tableName = tableName;\n    }\n\n    public IEnumerable<DataRecord> GetRecords(int batchSize)\n    {\n        using (var connection = new SqlConnection(_connectionString))\n        {\n            connection.Open();\n\n            var cursor = new SqlParameter("@cursor", SqlDbType.NVarChar, 50) { Direction = ParameterDirection.Output };\n\n            using (var command = new SqlCommand("SELECT TOP (@batchSize) * FROM " + _tableName + " WHERE cursor > @cursor", connection))\n            {\n                command.Parameters.AddWithValue("@batchSize", batchSize);\n                command.Parameters.AddWithValue("@cursor", cursor);\n\n                while (true)\n                {\n                    var reader = command.ExecuteReader();\n                    while (reader.Read())\n                    {\n                        yield return new DataRecord(reader);\n                    }\n                    reader.Close();\n\n                    if (cursor.Value == DBNull.Value)\n                    {\n                        break;\n                    }\n                }\n            }\n        }\n    }\n}