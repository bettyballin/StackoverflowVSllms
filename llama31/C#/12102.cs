using System;\nusing System.IO;\nusing System.IO.Compression;\nusing System.Web;\n\npublic class CompressionModule : IHttpModule\n{\n    public void Init(HttpApplication application)\n    {\n        application.BeginRequest += (sender, e) =>\n        {\n            var request = ((HttpApplication)sender).Request;\n            var response = ((HttpApplication)sender).Response;\n\n            if (request.Headers["Accept-Encoding"] != null &&\n                request.Headers["Accept-Encoding"].Contains("gzip"))\n            {\n                response.Filter = new GZipStream(response.Filter, CompressionMode.Compress);\n                response.AppendHeader("Content-Encoding", "gzip");\n            }\n        };\n    }\n\n    public void Dispose()\n    {\n    }\n}