public static string TrimStringToByteLength(string input, int maxLength)\n{\n    byte[] bytes = Encoding.UTF8.GetBytes(input);\n    if (bytes.Length <= maxLength)\n    {\n        return input;\n    }\n\n    int charIndex = 0;\n    int byteIndex = 0;\n    while (byteIndex < maxLength)\n    {\n        char c = input[charIndex];\n        int charByteLength = Encoding.UTF8.GetByteCount(new char[] { c });\n        if (byteIndex + charByteLength > maxLength)\n        {\n            break;\n        }\n        byteIndex += charByteLength;\n        charIndex++;\n    }\n\n    return input.Substring(0, charIndex);\n}