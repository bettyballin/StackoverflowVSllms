public class MvcApplication : System.Web.HttpApplication\n{\n    protected void Application_BeginRequest(object sender, EventArgs e)\n    {\n        // Create a new UnitOfWork instance\n        var unitOfWork = new UnitOfWork(SessionFactory);\n\n        // Store it in the HttpContext\n        HttpContext.Current.Items["UnitOfWork"] = unitOfWork;\n    }\n\n    protected void Application_EndRequest(object sender, EventArgs e)\n    {\n        // Retrieve the UnitOfWork instance\n        var unitOfWork = (UnitOfWork)HttpContext.Current.Items["UnitOfWork"];\n\n        // Commit or rollback the transaction\n        if (unitOfWork != null)\n        {\n            unitOfWork.Commit();\n            unitOfWork.Dispose();\n        }\n    }\n}