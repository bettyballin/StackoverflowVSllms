string script = SqlServices.GenerateApplicationServicesScripts(true, SqlFeatures.All, _connection.Database);\n\n// Split the script into individual batches using the GO statement as a delimiter\nstring[] batches = script.Split(new[] { "\r\nGO\r\n" }, StringSplitOptions.RemoveEmptyEntries);\n\n// Execute each batch separately within the transaction\nforeach (string batch in batches)\n{\n    SqlHelper.ExecuteNonQuery(transaction, CommandType.Text, batch);\n}