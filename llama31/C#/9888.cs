protected void PerformCircularReferenceCheck(AmICircular target)\n{\n    var queue = new Queue<AmICircular>();\n    queue.Enqueue(target);\n    var visited = new HashSet<AmICircular>();\n    while (queue.Count > 0)\n    {\n        var node = queue.Dequeue();\n        if (visited.Contains(node))\n        {\n            throw new InvalidOperationException("Circular reference detected");\n        }\n        visited.Add(node);\n        foreach (var child in node.Children)\n        {\n            queue.Enqueue(child);\n        }\n    }\n}