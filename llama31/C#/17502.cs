using System;\nusing System.Runtime.InteropServices;\nusing System.Security.Principal;\n\npublic class ImpersonationHelper\n{\n    [DllImport("advapi32.dll", SetLastError = true, CharSet = CharSet.Unicode)]\n    static extern bool LogonUser(string lpszUsername, string lpszDomain, string lpszPassword, int dwLogonType, int dwLogonProvider, out IntPtr phToken);\n\n    public static void ImpersonateUser(string username)\n    {\n        IntPtr tokenHandle;\n        try\n        {\n            if (LogonUser(username, null, null, 3, 0, out tokenHandle))\n            {\n                using (WindowsIdentity impersonatedIdentity = new WindowsIdentity(tokenHandle))\n                {\n                    impersonatedIdentity.Impersonate();\n                    // Your code here will run under the impersonated identity\n                }\n            }\n            else\n            {\n                throw new Exception("Logon failed: " + Marshal.GetLastWin32Error());\n            }\n        }\n        finally\n        {\n            if (tokenHandle != IntPtr.Zero)\n            {\n                Marshal.Release(tokenHandle);\n            }\n        }\n    }\n}