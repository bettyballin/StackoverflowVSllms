public class CustomModule : IHttpModule\n{\n    public void Init(HttpApplication context)\n    {\n        context.PreSendRequestContent += new EventHandler(OnPreSendRequestContent);\n    }\n\n    private void OnPreSendRequestContent(object sender, EventArgs e)\n    {\n        HttpResponse response = ((HttpApplication)sender).Response;\n        response.Filter = new ContentLengthFilter(response.OutputStream);\n    }\n}\n\npublic class ContentLengthFilter : Stream\n{\n    private Stream _outputStream;\n    private long _contentLength;\n\n    public ContentLengthFilter(Stream outputStream)\n    {\n        _outputStream = outputStream;\n    }\n\n    public override void Write(byte[] buffer, int offset, int count)\n    {\n        _outputStream.Write(buffer, offset, count);\n        _contentLength += count;\n    }\n\n    public override void Close()\n    {\n        _outputStream.Close();\n        // Use the calculated content length here\n        // ...\n    }\n}