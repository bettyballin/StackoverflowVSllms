private void Window_KeyDown(object sender, System.Windows.Input.KeyEventArgs e)\n{\n    if (e.Key == System.Windows.Input.Key.Escape)\n    {\n        var topmostControl = GetTopmostControl(this);\n        if (topmostControl is Grid grid && grid.Visibility == Visibility.Visible)\n        {\n            BeginStoryboard((Storyboard)this.FindResource("theVisibleOne_Hide"));\n        }\n    }\n}\n\nprivate DependencyObject GetTopmostControl(DependencyObject parent)\n{\n    if (parent == null) return null;\n\n    var childCount = VisualTreeHelper.GetChildrenCount(parent);\n    for (int i = childCount - 1; i >= 0; i--)\n    {\n        var child = VisualTreeHelper.GetChild(parent, i);\n        if (child is Grid grid && grid.Visibility == Visibility.Visible)\n        {\n            return grid;\n        }\n    }\n\n    return GetTopmostControl(VisualTreeHelper.GetParent(parent));\n}