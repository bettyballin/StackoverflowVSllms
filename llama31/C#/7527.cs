private readonly SemaphoreSlim _semaphore = new SemaphoreSlim(1);\n\nprotected override void PrintDocument(XmlDocument document, string xsltFileName, string directory, string tempImageDirectory)\n{\n    _semaphore.Wait();\n    try\n    {\n        using (var writer = new StreamWriter(string.Format("{0}{1}{2}", directory, "batch", FileExtension), true, Encoding.ASCII))\n        {\n            Transform(document, xsltFileName, writer);\n        }\n    }\n    finally\n    {\n        _semaphore.Release();\n    }\n}