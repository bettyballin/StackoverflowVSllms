using Microsoft.Build.Framework;\nusing Microsoft.Build.Utilities;\nusing System;\nusing System.IO;\nusing System.Text.RegularExpressions;\n\nnamespace CustomTask\n{\n    public class ModifyCsFiles : Task\n    {\n        [Required]\n        public ITaskItem[] CompileItems { get; set; }\n\n        public override bool Execute()\n        {\n            foreach (var item in CompileItems)\n            {\n                var filePath = item.ItemSpec;\n                var fileContent = File.ReadAllText(filePath);\n\n                // Modify the file content in memory\n                var modifiedContent = Regex.Replace(fileContent, "old code", "new code");\n\n                // Create a new TaskItem with the modified content\n                var modifiedItem = new TaskItem(filePath);\n                modifiedItem.SetMetadata("ModifiedContent", modifiedContent);\n\n                // Replace the original item with the modified one\n                CompileItems[Array.IndexOf(CompileItems, item)] = modifiedItem;\n            }\n\n            return true;\n        }\n    }\n}