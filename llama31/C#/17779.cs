private readonly object _lock = new Object();\n\npublic static object GetNextNumber(string prefix)\n{\n    int yr = DateTime.Now.Year;\n    int month = DateTime.Now.Month;\n\n    SequenceGeneratorCollection col = new SequenceGeneratorCollection()\n        .Where(SequenceGenerator.Columns.Year, Comparison.Equals, yr)\n        .Where(SequenceGenerator.Columns.Month, Comparison.Equals, month)\n        .Load();\n\n    if (col == null || col.Count == 0)\n    {\n        // Create a new SequenceGenerator instance\n        SequenceGenerator tr = new SequenceGenerator();\n        tr.Year = yr;\n        tr.Month = month;\n        tr.NextNumber = 1;\n\n        // Lock only the critical section\n        lock (_lock)\n        {\n            tr.Save();\n        }\n\n        return string.Format(FormatString, prefix, yr, month, tr.NextNumber.ToString(NumberFormat));\n    }\n\n    SequenceGenerator t = col[0];\n\n    // Lock only the critical section\n    lock (_lock)\n    {\n        t.NextNumber += 1;\n        t.Save();\n    }\n\n    return string.Format(FormatString, prefix, yr, month, t.NextNumber.ToString(NumberFormat));\n}