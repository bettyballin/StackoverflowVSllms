using (var scope = new TransactionScope(TransactionScopeOption.Required))\n{\n    using (var connection = new SqlConnection(connectionString))\n    {\n        connection.Open();\n\n        using (var command = new SqlCommand("UPDATE Terminals WITH (ROWLOCK) SET Lock = 1 WHERE TerminalId = @TerminalId AND Lock = 0", connection))\n        {\n            command.Parameters.AddWithValue("@TerminalId", terminalId);\n\n            if (command.ExecuteNonQuery() == 0)\n            {\n                throw new Exception("Terminal is already locked");\n            }\n        }\n    }\n\n    scope.Complete();\n}