public class HttpRequestValidationExceptionHandler : IHttpModule\n{\n    public void Init(HttpApplication context)\n    {\n        context.Error += new EventHandler(context_Error);\n    }\n\n    void context_Error(object sender, EventArgs e)\n    {\n        HttpApplication application = (HttpApplication)sender;\n        HttpContext context = application.Context;\n        Exception exception = application.Server.GetLastError();\n\n        if (exception is HttpRequestValidationException)\n        {\n            application.Server.ClearError();\n\n            if (context.Request.IsAjaxRequest())\n            {\n                context.Response.StatusCode = 400;\n                context.Response.StatusDescription = "Invalid request";\n                context.Response.Write("Invalid request");\n                context.Response.End();\n            }\n            else\n            {\n                context.Response.Redirect("ErrorPage.aspx");\n            }\n        }\n    }\n\n    public void Dispose() { }\n}