var privilege = new LUID();\nif (!WinApi.LookupPrivilegeValue(null, "SeAssignPrimaryTokenPrivilege", ref privilege))\n{\n    throw new Win32Exception(Marshal.GetLastWin32Error(), "Error looking up privilege value.");\n}\n\nvar tokenPrivileges = new TOKEN_PRIVILEGES();\ntokenPrivileges.PrivilegeCount = 1;\ntokenPrivileges.Privileges[0].Luid = privilege;\ntokenPrivileges.Privileges[0].Attributes = SE_PRIVILEGE_ENABLED;\n\nif (!WinApi.AdjustTokenPrivileges(hUserTokenDuplicate, false, ref tokenPrivileges, 0, IntPtr.Zero, IntPtr.Zero))\n{\n    throw new Win32Exception(Marshal.GetLastWin32Error(), "Error adjusting token privileges.");\n}