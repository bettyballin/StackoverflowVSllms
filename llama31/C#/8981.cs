using System.Windows.Threading;\n\n// Assume 'doc' is the mshtml.HTMLDocument instance\n// Assume 'callback' is the method that manipulates the DOM\n\n// Create a dispatcher for the main thread\nDispatcher dispatcher = Dispatcher.CurrentDispatcher;\n\n// Run the server communication code in a background thread\nSystem.Threading.ThreadPool.QueueUserWorkItem(delegate\n{\n    // Perform server communication...\n    // ...\n\n    // When the communication is complete, marshal the execution to the main thread\n    dispatcher.Invoke(DispatcherPriority.Normal, callback);\n});\n\n// The callback method that manipulates the DOM\nvoid callback()\n{\n    // Manipulate the DOM here\n    // For example:\n    mshtml.IHTMLElement element = doc.getElementById("myElement");\n    element.innerHTML = "New content";\n}