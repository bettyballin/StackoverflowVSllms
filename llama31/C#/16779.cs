public byte[] GetRC4SessionBlobFromKey(byte[] keyData, RSACryptoServiceProvider publicKey)\n{\n    using (MemoryStream ms = new MemoryStream())\n    using (BinaryWriter w = new BinaryWriter(ms))\n    {\n        w.Write((byte)0x01); // SIMPLEBLOB\n        w.Write((byte)0x02); // Version 2\n        w.Write((byte)0x00); // Reserved\n        w.Write(0x00006801); // ALG_ID = RC4 for the encrypted key\n        w.Write(0x0000a400); // CALG_RSA_KEYX\n        byte[] encryptedKey = publicKey.Encrypt(keyData, false);\n        w.Write((byte)0x00); // Reserved\n        w.Write((byte)0x00); // Reserved\n        w.Write((short)encryptedKey.Length); // Length of encrypted key\n        w.Write(encryptedKey); // Encrypted key\n        w.Flush();\n\n        return ms.ToArray();\n    }\n}