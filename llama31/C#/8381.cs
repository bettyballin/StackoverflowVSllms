using System.IO;\nusing System.Text;\n\npublic void WriteDataTableToCsvStream(DataTable dt, Stream outputStream)\n{\n    using (var writer = new StreamWriter(outputStream, Encoding.UTF8))\n    {\n        // Write column headers\n        foreach (DataColumn column in dt.Columns)\n        {\n            writer.Write(column.ColumnName);\n            writer.Write(",");\n        }\n        writer.WriteLine();\n\n        // Write data rows\n        foreach (DataRow row in dt.Rows)\n        {\n            foreach (object value in row.ItemArray)\n            {\n                writer.Write(value.ToString());\n                writer.Write(",");\n            }\n            writer.WriteLine();\n        }\n    }\n}