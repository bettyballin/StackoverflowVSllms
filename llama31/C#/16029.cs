public class ContextAwareSessionFactory : ISessionFactory\n{\n    private readonly ISessionFactory _webSessionFactory;\n    private readonly ISessionFactory _winFormsSessionFactory;\n\n    public ContextAwareSessionFactory(ISessionFactory webSessionFactory, ISessionFactory winFormsSessionFactory)\n    {\n        _webSessionFactory = webSessionFactory;\n        _winFormsSessionFactory = winFormsSessionFactory;\n    }\n\n    public ISession CreateSession()\n    {\n        if (HttpContext.Current != null)\n        {\n            return _webSessionFactory.CreateSession();\n        }\n        else\n        {\n            return _winFormsSessionFactory.CreateSession();\n        }\n    }\n}