public class XmlEncoder\n{\n    private static readonly Regex badAmpersand = new Regex("&(?![a-zA-Z]{2,6};|#[0-9]{2,4};)");\n\n    public string EncodeForXml(string data)\n    {\n        data = badAmpersand.Replace(data, "&amp;");\n        // more processing\n        return data;\n    }\n}