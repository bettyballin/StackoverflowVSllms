using System;\nusing System.Runtime.InteropServices;\nusing System.Windows.Forms;\n\npublic class MenuItemAdder\n{\n    [DllImport("user32.dll")]\n    private static extern IntPtr SetWindowsHookEx(int idHook, HookProc lpfn, IntPtr hInstance, int threadId);\n\n    [DllImport("user32.dll")]\n    private static extern bool UnhookWindowsHookEx(IntPtr idHook);\n\n    [DllImport("user32.dll")]\n    private static extern IntPtr CallNextHookEx(IntPtr idHook, int nCode, IntPtr wParam, IntPtr lParam);\n\n    private const int WH_CALLWNDPROC = 4;\n    private const int WM_CONTEXTMENU = 0x7B;\n\n    private delegate int HookProc(int nCode, IntPtr wParam, IntPtr lParam);\n\n    private IntPtr hookId;\n\n    public void AddMenuItem()\n    {\n        hookId = SetWindowsHookEx(WH_CALLWNDPROC, HookCallback, IntPtr.Zero, AppDomain.GetCurrentThreadId());\n    }\n\n    private int HookCallback(int nCode, IntPtr wParam, IntPtr lParam)\n    {\n        if (nCode == 0 && wParam == (IntPtr)WM_CONTEXTMENU)\n        {\n            // Get the context menu\n            IntPtr menu = wParam;\n\n            // Add a new menu item\n            string menuItemText = "My Menu Item";\n            IntPtr menuItem = CreateMenuItem(menuItemText);\n            InsertMenuItem(menu, menuItem, 0);\n\n            // Return 1 to prevent the default context menu from showing\n            return 1;\n        }\n\n        return CallNextHookEx(hookId, nCode, wParam, lParam);\n    }\n\n    private IntPtr CreateMenuItem(string text)\n    {\n        IntPtr menu = CreatePopupMenu();\n        InsertMenu(menu, 0, MF_BYPOSITION | MF_STRING, text, text);\n        return menu;\n    }\n\n    private const int MF_BYPOSITION = 0x400;\n    private const int MF_STRING = 0x0;\n\n    [DllImport("user32.dll")]\n    private static extern IntPtr CreatePopupMenu();\n\n    [DllImport("user32.dll")]\n    private static extern bool InsertMenu(IntPtr hMenu, int uPosition, int uFlags, string lpNewItem, string lpString);\n\n    [DllImport("user32.dll")]\n    private static extern bool InsertMenuItem(IntPtr hMenu, IntPtr hNewItem, int uPosition);\n}