private static Collection<string> GetDirectReportsInternal(string ldapBase, string userDN, out long elapsedTime)\n{\n    Collection<string> result = new Collection<string>();\n\n    Stopwatch sw = new Stopwatch();\n    sw.Start();\n\n    using (DirectoryEntry directoryEntry = new DirectoryEntry(ldapBase))\n    {\n        using (DirectorySearcher ds = new DirectorySearcher(directoryEntry))\n        {\n            ds.SearchScope = SearchScope.Subtree;\n            ds.PropertiesToLoad.Clear();\n            ds.PropertiesToLoad.Add("userPrincipalName");\n            ds.PropertiesToLoad.Add("distinguishedName");\n            ds.PageSize = 10;\n            ds.ServerPageTimeLimit = TimeSpan.FromSeconds(2);\n            ds.Filter = string.Format("(&(objectCategory=user)(manager={0}))", userDN);\n\n            using (SearchResultCollection src = ds.FindAll())\n            {\n                foreach (SearchResult sr in src)\n                {\n                    result.Add((string)sr.Properties["userPrincipalName"][0]);\n\n                    // Recursively get direct reports for each user\n                    Collection<string> tmp = GetDirectReportsInternal(ldapBase, (string)sr.Properties["distinguishedName"][0], out long subElapsed);\n                    foreach (string s in tmp)\n                    {\n                        result.Add(s);\n                    }\n                }\n            }\n        }\n    }\n\n    sw.Stop();\n    elapsedTime = sw.ElapsedMilliseconds;\n    return result;\n}