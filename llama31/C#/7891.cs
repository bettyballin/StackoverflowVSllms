using (SqlConnection connection = new SqlConnection(connectionString))\n{\n    connection.Open();\n\n    int maxId = GetMaxId(connection);\n    int newId = maxId + 1;\n\n    while (true)\n    {\n        using (SqlTransaction transaction = connection.BeginTransaction())\n        {\n            try\n            {\n                InsertRecord(connection, transaction, newId);\n                transaction.Commit();\n                break;\n            }\n            catch (SqlException ex)\n            {\n                if (ex.Number == 2601) // Primary key constraint violation\n                {\n                    transaction.Rollback();\n                    maxId = GetMaxId(connection);\n                    newId = maxId + 1;\n                }\n                else\n                {\n                    throw;\n                }\n            }\n        }\n    }\n}\n\nint GetMaxId(SqlConnection connection)\n{\n    using (SqlCommand command = new SqlCommand("SELECT MAX(id) FROM table", connection))\n    {\n        return (int)command.ExecuteScalar();\n    }\n}\n\nvoid InsertRecord(SqlConnection connection, SqlTransaction transaction, int id)\n{\n    using (SqlCommand command = new SqlCommand("INSERT INTO table (id, ...) VALUES (@id, ...)", connection, transaction))\n    {\n        command.Parameters.AddWithValue("@id", id);\n        // ... add other parameters ...\n        command.ExecuteNonQuery();\n    }\n}