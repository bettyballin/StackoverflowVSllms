public class MediaHandler : IHttpHandler\n{\n    public void ProcessRequest(HttpContext context)\n    {\n        // Get the media file path from the URL\n        string filePath = context.Request.Url.AbsolutePath;\n\n        // Check user permissions\n        if (!HasPermission(context.User.Identity.Name, filePath))\n        {\n            context.Response.StatusCode = 404;\n            context.Response.End();\n            return;\n        }\n\n        // Serve the media file\n        context.Response.ContentType = GetMimeType(filePath);\n        context.Response.TransmitFile(filePath);\n    }\n\n    private bool HasPermission(string username, string filePath)\n    {\n        // Implement your permission logic here\n    }\n\n    private string GetMimeType(string filePath)\n    {\n        // Return the MIME type for the media file\n    }\n}