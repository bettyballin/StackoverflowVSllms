public static List<User> FilterBySearchTerms(List<User> usersToFilter, string searchTerms, bool searchEmailText)\n{\n    string[] terms = searchTerms.ToLower().Trim().Split(' ');\n\n    return usersToFilter\n        .Select(user => new\n        {\n            User = user,\n            Matches = terms.Count(term =>\n                (searchEmailText && user.Email.ToLower().Contains(term)) ||\n                user.FirstName.ToLower().Contains(term) ||\n                user.Surname.ToLower().Contains(term) ||\n                user.Position.ToLower().Contains(term) ||\n                user.Company.ToLower().Contains(term) ||\n                user.Office.ToLower().Contains(term) ||\n                user.Title.ToLower().Contains(term) ||\n                (int.TryParse(term, out int encodedID) && GetByEncodedUserInviteID(encodedID)?.ID == user.ID)\n            )\n        })\n        .OrderByDescending(x => x.Matches)\n        .Select(x => x.User)\n        .ToList();\n}