public class SessionPerRequestModule : IHttpModule\n{\n    public void BeginRequest(object sender, EventArgs e)\n    {\n        ISession session = SessionFactory.OpenSession();\n        // Store the session in the request context\n        HttpContext.Current.Items["Session"] = session;\n    }\n\n    public void EndRequest(object sender, EventArgs e)\n    {\n        ISession session = (ISession)HttpContext.Current.Items["Session"];\n        session.Close();\n    }\n}