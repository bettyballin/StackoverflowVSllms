class RandomizeWhenEqualComparer<T> : IComparer<T>\n{\n    private readonly Func<T, T, int> _comparer;\n    private readonly Random _random = new Random();\n\n    public int Compare(T x, T y)\n    {\n        int result = _comparer(x, y);\n        if (result != 0) return result;\n        return _random.Next(2) == 0 ? -1 : 1;\n    }\n\n    public RandomizeWhenEqualComparer(Func<T, T, int> comparer)\n    {\n        _comparer = comparer;\n    }\n}