public class WhiteSpaceFilter : Stream\n{\n    private readonly Stream _stream;\n    private readonly byte[] _buffer = new byte[1024];\n    private int _position;\n    private int _length;\n\n    public WhiteSpaceFilter(Stream stream)\n    {\n        _stream = stream;\n    }\n\n    public override void Write(byte[] buffer, int offset, int count)\n    {\n        var html = Encoding.UTF8.GetString(buffer, offset, count);\n        html = Regex.Replace(html, @"\s+", " ");\n        html = html.Trim();\n        var bytes = Encoding.UTF8.GetBytes(html);\n        _stream.Write(bytes, 0, bytes.Length);\n    }\n\n    public override void Flush()\n    {\n        _stream.Flush();\n    }\n\n    public override void Close()\n    {\n        _stream.Close();\n    }\n\n    public override int Read(byte[] buffer, int offset, int count)\n    {\n        return _stream.Read(buffer, offset, count);\n    }\n\n    public override long Seek(long offset, SeekOrigin origin)\n    {\n        return _stream.Seek(offset, origin);\n    }\n\n    public override void SetLength(long value)\n    {\n        _stream.SetLength(value);\n    }\n\n    public override bool CanRead\n    {\n        get { return _stream.CanRead; }\n    }\n\n    public override bool CanWrite\n    {\n        get { return _stream.CanWrite; }\n    }\n\n    public override bool CanSeek\n    {\n        get { return _stream.CanSeek; }\n    }\n\n    public override long Length\n    {\n        get { return _stream.Length; }\n    }\n\n    public override long Position\n    {\n        get { return _stream.Position; }\n        set { _stream.Position = value; }\n    }\n}