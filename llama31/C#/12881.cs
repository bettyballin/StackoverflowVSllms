using (NetworkStream ns = client.GetStream())\n{\n    if ((ns.CanRead == true) && (ns.CanWrite == true))\n    {\n        try\n        {\n            int len;\n            byte[] AOK = Encoding.ASCII.GetBytes("AOK");\n            using (FileStream fs = new FileStream(location, FileMode.Create, FileAccess.Write))\n            {\n                byte[] buf = new byte[client.ReceiveBufferSize];\n                while ((len = ns.Read(buf, 0, buf.Length)) > 0)\n                {\n                    fs.Write(buf, 0, len);\n                    ns.Write(AOK, 0, AOK.Length);\n                }\n            }\n            byte[] okBuf = Encoding.ASCII.GetBytes("Message Received on Server");\n            ns.Write(okBuf, 0, okBuf.Length);\n        }\n        catch (Exception err)\n        {\n            Global.LogError("ServerForm.cs - Worker_Engine(DoWorkEvent)", err);\n            byte[] errBuf = Encoding.ASCII.GetBytes(err.Message);\n            ns.Write(errBuf, 0, errBuf.Length);\n        }\n    }\n}