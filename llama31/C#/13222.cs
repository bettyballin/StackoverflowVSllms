using System.Runtime.InteropServices;\n\n[DllImport("winhttp.dll", SetLastError = true)]\npublic static extern bool WinHttpGetDefaultProxyConfiguration(out WINHTTP_PROXY_INFO proxyInfo);\n\n[StructLayout(LayoutKind.Sequential, CharSet = CharSet.Unicode)]\npublic struct WINHTTP_PROXY_INFO\n{\n    public int dwAccessType;\n    public string lpszProxy;\n    public string lpszProxyBypass;\n}\n\n// Get the default proxy configuration\nWINHTTP_PROXY_INFO proxyInfo;\nif (WinHttpGetDefaultProxyConfiguration(out proxyInfo))\n{\n    // Create a new WebProxy instance\n    WebProxy proxy = new WebProxy(proxyInfo.lpszProxy, true);\n    proxy.Credentials = CredentialCache.DefaultNetworkCredentials;\n\n    // Set the proxy as the default\n    WebRequest.DefaultWebProxy = proxy;\n}