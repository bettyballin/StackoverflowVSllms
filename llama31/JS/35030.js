function getSelectedParagraph() {\n    var selection = window.getSelection();\n    if (selection.rangeCount > 0) {\n        var range = selection.getRangeAt(0);\n        var paragraph = range.commonAncestorContainer;\n        while (paragraph && paragraph.nodeName !== "P") {\n            paragraph = paragraph.parentNode;\n        }\n        return paragraph;\n    }\n    return null;\n}