form.submit(function(event) {\n  event.preventDefault(); // prevent default form submission\n  validateUsername(function(valid) {\n    if (valid && validateEmail() && validatePassword()) {\n      form.unbind('submit').submit(); // submit the form if all validations pass\n    }\n  });\n});\n\nfunction validateUsername(callback) {\n  usernameInfo.addClass("sign_up_drill");\n  usernameInfo.text("checking...");\n  var b = username.val();\n  var filter = /^[a-zA-Z0-9_]+$/;\n  $.post("../username_check.php", { su_username: username.val() }, function(data) {\n    if (data == 'yes') {\n      username.addClass("error");\n      usernameInfo.text("sorry, that one's taken");\n      usernameInfo.addClass("error");\n      callback(false);\n    } else if (!filter.test(b)) {\n      username.addClass("error");\n      usernameInfo.text("no funny characters please");\n      usernameInfo.addClass("error");\n      callback(false);\n    } else {\n      username.removeClass("error");\n      usernameInfo.text("ok");\n      usernameInfo.removeClass("error");\n      callback(true);\n    }\n  });\n}