const bcrypt = require('bcrypt');\nconst User = require('./UserModel');\n\n// When a user logs in...\nasync function login(req, res) {\n  const user = await User.findOne({ email: req.body.email });\n  if (!user) return res.status(401).send({ message: 'Invalid credentials' });\n\n  // Check if the password is still in MD5 format\n  if (user.password_new === null) {\n    // Hash the password with bcrypt\n    const bcryptHash = await bcrypt.hash(req.body.password, 12);\n    user.password_new = bcryptHash;\n    await user.save();\n  }\n\n  // Compare the input password with the bcrypt-hashed password\n  const isValid = await bcrypt.compare(req.body.password, user.password_new);\n  if (!isValid) return res.status(401).send({ message: 'Invalid credentials' });\n\n  // Login successful, return JWT token or whatever\n  res.send({ token: generateToken(user) });\n}