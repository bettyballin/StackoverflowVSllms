__kernel void levenberg_marquardt(__global float *x,\n                                 __global float *y,\n                                 __global float *beta,\n                                 __global float *residuals,\n                                 __global float *gradient,\n                                 __global float *hessian,\n                                 float lambda) {\n  // Compute residuals\n  __global float *r = residuals;\n  for (int i = 0; i < get_global_size(0); i++) {\n    float x_i = x[i];\n    float y_i = y[i];\n    float beta_i = beta[i];\n    float residual = y_i - f(x_i, beta_i);\n    r[i] = residual;\n  }\n\n  // Compute gradient and Hessian\n  __global float *g = gradient;\n  __global float *H = hessian;\n  for (int i = 0; i < get_global_size(0); i++) {\n    float x_i = x[i];\n    float y_i = y[i];\n    float beta_i = beta[i];\n    float J_i = J(x_i, beta_i);\n    g[i] = -2 * J_i * r[i];\n    H[i] = 2 * J_i * J_i;\n  }\n\n  // Update parameters\n  __global float *new_beta = beta;\n  for (int i = 0; i < get_global_size(0); i++) {\n    float beta_i = beta[i];\n    float g_i = g[i];\n    float H_i = H[i];\n    float lambda_i = lambda;\n    new_beta[i] = beta_i - (H_i + lambda_i * I) * g_i;\n  }\n}