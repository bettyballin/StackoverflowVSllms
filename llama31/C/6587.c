#include <jvmti.h>\n\nvoid JNICALL ExceptionCallback(jvmtiEnv* jvmti, JNIEnv* jni, jthread thread,\n                               jmethodID method, jlocation location, jobject exception) {\n  // Get the current frame\n  jvmtiFrameInfo frame_info;\n  jvmti->GetFrameInfo(thread, 0, &frame_info);\n\n  // Get the local variables\n  jint num_locals = frame_info.num_locals;\n  jvmtiLocalVariableEntry* locals = (jvmtiLocalVariableEntry*)malloc(num_locals * sizeof(jvmtiLocalVariableEntry));\n  jvmti->GetLocalVariables(thread, 0, num_locals, locals);\n\n  // Get the method arguments\n  jint num_args = method->GetArgumentCount();\n  jvmtiStackVariableEntry* args = (jvmtiStackVariableEntry*)malloc(num_args * sizeof(jvmtiStackVariableEntry));\n  jvmti->GetStackVariables(thread, 0, num_args, args);\n\n  // Save the data to a file or perform any other analysis\n  // ...\n\n  free(locals);\n  free(args);\n}\n\nJNIEXPORT jint JNICALL Agent_OnLoad(JavaVM* vm, char* options, void* reserved) {\n  jvmtiEnv* jvmti = NULL;\n  vm->GetEnv((void**)&jvmti, JVMTI_VERSION_1_0);\n\n  // Set the exception callback\n  jvmtiEventCallbacks callbacks;\n  callbacks.Exception = ExceptionCallback;\n  jvmti->SetEventCallbacks(&callbacks, sizeof(callbacks));\n\n  return JNI_OK;\n}