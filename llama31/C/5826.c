#include <openssl/rsa.h>\n#include <openssl/x509.h>\n\nint create_x509_certificate(char **pem_cert, char **pem_key) {\n    RSA *rsa;\n    X509 *cert;\n    X509_NAME *name;\n    ASN1_INTEGER *serial;\n    BIGNUM *bne;\n\n    // Create a new RSA key pair\n    rsa = RSA_new();\n    BIGNUM *exponent = BN_new();\n    BN_set_word(exponent, 65537);\n    RSA_generate_key_ex(rsa, 2048, exponent, NULL);\n\n    // Create a new X509 certificate\n    cert = X509_new();\n\n    // Set the certificate version\n    X509_set_version(cert, 2);\n\n    // Set the serial number\n    serial = ASN1_INTEGER_new();\n    ASN1_INTEGER_set(serial, 1);\n    X509_set_serialNumber(cert, serial);\n\n    // Set the not-before and not-after dates\n    X509_gmtime_adj(cert, 0, 365 * 24 * 60 * 60); // valid for 1 year\n\n    // Set the subject name\n    name = X509_NAME_new();\n    X509_NAME_add_entry_by_txt(name, "C", MBSTRING_ASC, (const unsigned char *)"US", -1, -1, 0);\n    X509_NAME_add_entry_by_txt(name, "O", MBSTRING_ASC, (const unsigned char *)"My Org", -1, -1, 0);\n    X509_set_subject_name(cert, name);\n\n    // Set the issuer name (same as subject for self-signed)\n    X509_set_issuer_name(cert, name);\n\n    // Set the public key\n    EVP_PKEY *pkey = EVP_PKEY_new();\n    EVP_PKEY_assign_RSA(pkey, rsa);\n    X509_set_pubkey(cert, pkey);\n\n    // Sign the certificate (self-signed)\n    X509_sign(cert, pkey, EVP_sha256());\n\n    // Convert the certificate and private key to PEM format\n    BIO *bio_cert = BIO_new(BIO_s_mem());\n    PEM_write_bio_X509(bio_cert, cert);\n    *pem_cert = malloc(BIO_get_mem_data(bio_cert, NULL));\n    BIO_get_mem_data(bio_cert, *pem_cert);\n\n    BIO *bio_key = BIO_new(BIO_s_mem());\n    PEM_write_bio_PrivateKey(bio_key, pkey, NULL, NULL, 0, NULL, NULL);\n    *pem_key = malloc(BIO_get_mem_data(bio_key, NULL));\n    BIO_get_mem_data(bio_key, *pem_key);\n\n    // Clean up\n    RSA_free(rsa);\n    X509_free(cert);\n    X509_NAME_free(name);\n    ASN1_INTEGER_free(serial);\n    BIGNUM_free(bne);\n    EVP_PKEY_free(pkey);\n    BIO_free(bio_cert);\n    BIO_free(bio_key);\n\n    return 0;\n}