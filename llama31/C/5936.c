#include <sys/socket.h>\n#include <sys/types.h>\n#include <sys/un.h>\n\n// ...\n\nint fd = socket(AF_UNIX, SOCK_STREAM, 0);\n// ...\n\nint enable_creds = 1;\nsetsockopt(fd, 0, LOCAL_CREDS, &enable_creds, sizeof(enable_creds));\n\n// ...\n\nstruct msghdr msg;\nstruct cmsghdr *cmsg;\nchar cmsgbuf[CMSG_SPACE(sizeof(struct cmsgcred))];\n\nmsg.msg_control = cmsgbuf;\nmsg.msg_controllen = sizeof(cmsgbuf);\n\ncmsg = CMSG_FIRSTHDR(&msg);\ncmsg->cmsg_level = SOL_SOCKET;\ncmsg->cmsg_type = SCM_CREDS;\ncmsg->cmsg_len = CMSG_LEN(sizeof(struct cmsgcred));\n\n// Send the message with credentials\nsendmsg(fd, &msg, 0);