while(pop(&x, &y, tex->width))\n{\n    y1 = y;\n    while(y1 >= 0 && y1 < tex->height && cmp_color(old_color, get_pixel_color(tex, x, y1))) y1--;\n    y1++;\n    spanLeft = spanRight = false;\n    while(y1 < tex->height  && cmp_color(old_color, get_pixel_color(tex, x, y1)) )\n    {\n        set_pixel_color_with_style(payload, tex, x, y1);\n\n        if(!spanLeft && x > 0 && cmp_color(old_color, get_pixel_color(tex, x - 1, y1))) \n        {\n            if(!push(x - 1, y1, tex->width)) return;\n            spanLeft = true;\n        }\n        else if(spanLeft && x > 0 && !cmp_color(old_color, get_pixel_color(tex, x - 1, y1)))\n        {\n            spanLeft = false;\n        }\n\n        if(!spanRight && x < tex->width - 1 && cmp_color(old_color, get_pixel_color(tex, x + 1, y1))) \n        {\n            if(!push(x + 1, y1, tex->width)) return;\n            spanRight = true;\n        }\n\n        else if(spanRight && x < tex->width - 1 && !cmp_color(old_color, get_pixel_color(tex, x + 1, y1)))\n        {\n            spanRight = false;\n        } \n        y1++;\n    }\n}