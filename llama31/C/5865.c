while (1) {\n    numbytes = recv(sockfd, buf, MAXDATASIZE-1, MSG_DONTWAIT);\n    if (numbytes == -1) {\n        if (errno == EAGAIN || errno == EWOULDBLOCK) {\n            // No data available, try again later\n            usleep(100000); // sleep for 100ms\n            continue;\n        } else {\n            // Handle other errors\n            perror("recv");\n            break;\n        }\n    } else if (numbytes == 0) {\n        // Connection closed by server\n        printf("Connection closed by server\n");\n        break;\n    }\n\n    buf[numbytes] = '\0';\n    printf("Received: %s\n", buf);\n    // more code to react goes here\n}