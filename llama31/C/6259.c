while (currentLen < len && result >= 0) {\n    result = recv(sock, buf + currentLen, TCP_BlockSize);\n    if (result > 0) {\n        currentLen = currentLen + result;\n    } else if (result == 0) {\n        // Connection has been closed by the peer, but there might be data left in the buffer\n        result = recv(sock, buf + currentLen, len - currentLen);\n        if (result > 0) {\n            currentLen = currentLen + result;\n        }\n        break;\n    } else {\n        // Error occurred\n        break;\n    }\n}