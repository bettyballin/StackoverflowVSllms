// Hook NtCreateThreadEx\ntypedef NTSTATUS (NTAPI *pNtCreateThreadEx)(\n    OUT PHANDLE hThread,\n    IN ACCESS_MASK DesiredAccess,\n    IN POBJECT_ATTRIBUTES ObjectAttributes,\n    IN HANDLE ProcessHandle,\n    IN PVOID StartRoutine,\n    IN PVOID Argument,\n    IN ULONG CreateFlags,\n    IN SIZE_T ZeroBits,\n    IN SIZE_T StackSize,\n    IN SIZE_T MaximumStackSize,\n    IN PPVOID AttributeList\n);\n\npNtCreateThreadEx originalNtCreateThreadEx = (pNtCreateThreadEx)GetProcAddress(GetModuleHandleA("ntdll.dll"), "NtCreateThreadEx");\n\nNTSTATUS hookedNtCreateThreadEx(\n    OUT PHANDLE hThread,\n    IN ACCESS_MASK DesiredAccess,\n    IN POBJECT_ATTRIBUTES ObjectAttributes,\n    IN HANDLE ProcessHandle,\n    IN PVOID StartRoutine,\n    IN PVOID Argument,\n    IN ULONG CreateFlags,\n    IN SIZE_T ZeroBits,\n    IN SIZE_T StackSize,\n    IN SIZE_T MaximumStackSize,\n    IN PPVOID AttributeList\n)\n{\n    // Implement your detection and prevention logic here\n    return originalNtCreateThreadEx(hThread, DesiredAccess, ObjectAttributes, ProcessHandle, StartRoutine, Argument, CreateFlags, ZeroBits, StackSize, MaximumStackSize, AttributeList);\n}\n\n// Replace the original NtCreateThreadEx with the hooked function\nReplaceFunction(originalNtCreateThreadEx, hookedNtCreateThreadEx);