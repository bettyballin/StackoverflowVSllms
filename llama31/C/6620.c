if (data.size > 0) {\n    data.data = (unsigned char*)malloc(data.size);\n    if (!data.data) {\n        // handle memory allocation error\n    }\n\n    memset(data.data, 0, data.size);\n    int remainingSize = data.size;\n    unsigned char *iter = data.data;\n    int count;\n\n    while (remainingSize > 0) {\n        count = read(connect_fd, iter, remainingSize);\n        if (count < 0) {\n            // handle error\n            if (errno == EAGAIN || errno == EWOULDBLOCK) {\n                // handle non-blocking socket\n            } else {\n                // handle other errors\n            }\n            break;\n        } else if (count == 0) {\n            // handle connection closure\n            break;\n        }\n\n        iter += count;\n        remainingSize -= count;\n    }\n} else {\n    data.data = NULL;\n}