// mymessage.proto\nsyntax = "proto2";\npackage mypackage;\n\nmessage MyMessage {\n  required int32 foo = 1;\n  optional string bar = 2;\n}\n\n// mymessage.c\n#include <stdio.h>\n#include <stdlib.h>\n#include "mypackage/mymessage.pb-c.h"\n\nint main() {\n  MyMessage msg;\n  msg.foo = 42;\n  msg.bar = "Hello, World!";\n  size_t len = mymessage__get_packed_size(&msg);\n  uint8_t* buf = malloc(len);\n  mymessage__pack(&msg, buf);\n  // Send or store the buffer...\n  free(buf);\n  return 0;\n}