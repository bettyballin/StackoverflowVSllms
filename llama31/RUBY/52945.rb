class Category < ActiveRecord::Base\n  acts_as_nested_set\n\n  validate :validate_move\n\n  def validate_move\n    if target = self.move_target\n      if target == self || descendants.include?(target)\n        errors[:base] << "Cannot move node to be its own child or descendant"\n      end\n    end\n  end\n\n  def move_target\n    # Get the target node from the move_to method\n    # This is a bit hacky, but it works\n    self.instance_variable_get(:@move_target)\n  end\nend