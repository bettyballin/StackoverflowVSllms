class Product < ApplicationRecord\n  validate :permalink_does_not_overlap_with_special_route\n\n  private\n\n  def permalink_does_not_overlap_with_special_route\n    permalink = permalink_fu\n    begin\n      Rails.application.routes.recognize_path("/products/#{permalink}")\n      errors.add(:permalink, "overlaps with a special route")\n    rescue ActionController::RoutingError\n      # no overlap\n    end\n  end\nend