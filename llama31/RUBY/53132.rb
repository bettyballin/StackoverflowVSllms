Event.includes(:patient).group(:patient_id, :event_type).maximum(:event_date)