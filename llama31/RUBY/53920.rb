context "on POST to :my_action" do\n  setup do\n    # setup the site and owner\n    @site = FactoryGirl.create(:site)\n    @owner = FactoryGirl.create(:owner, site: @site)\n  end\n\n  context "with valid params" do\n    setup do\n      post :my_action, email: 'foo@bar.com', password: 'test'\n    end\n\n    should_assign_to :owner\n    should "Change name and verify password and resend activation key" do\n      assert_equal true, assigns(:owner).authenticated?('test')\n      assert_equal 'foo@bar.com', assigns(:owner).login\n    end\n    should_respond_with :success\n    should_set_the_flash_to "Success."\n  end\n\n  context "with invalid params" do\n    setup do\n      post :my_action, email: '', password: ''\n    end\n\n    should_respond_with :success\n    should_set_the_flash_to "You must fill in both the e-mail and password fields"\n  end\n\n  context "with incorrect password" do\n    setup do\n      post :my_action, email: 'foo@bar.com', password: 'wrong'\n    end\n\n    should_respond_with :success\n    should_set_the_flash_to "Incorrect password"\n  end\n\n  context "with no site" do\n    setup do\n      @site.destroy\n      post :my_action, email: 'foo@bar.com', password: 'test'\n    end\n\n    should_redirect_to(root_url)\n  end\nend