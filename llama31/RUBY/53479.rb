class Project\n  include DataMapper::Resource\n\n  property :id,     Serial\n  property :title,  String, :nullable => false\n\n  has 2..n, :tasks\n\n  validate :validate_tasks\n\n  private\n\n  def validate_tasks\n    tasks.each do |task|\n      unless task.valid?\n        errors.add(:tasks, "Task is invalid")\n      end\n    end\n    tasks.size >= 2 || errors.add(:tasks, "At least 2 tasks are required")\n  end\nend