require 'sinatra'\n\nget '/' do\n  boundary = 'rn9012'\n  headers['Content-Type'] = "multipart/x-mixed-replace; boundary=#{boundary}"\n\n  # First part\n  body << "--#{boundary}\r\n"\n  body << "Content-Type: application/xml\r\n\r\n"\n  body << "<?xml version='1.0'?>\r\n"\n  body << "<content>First Part</content>\r\n"\n  body << "--#{boundary}\r\n"\n\n  # Force the response to be sent now\n  headers['X-Accel-Buffering'] = 'no'\n  stream_send\n\n  # Second part (after 5 seconds)\n  sleep 5\n  body << "Content-Type: application/xml\r\n\r\n"\n  body << "<?xml version='1.0'?>\r\n"\n  body << "<content>Second Part</content>\r\n"\n  body << "--#{boundary}--\r\n"\nend