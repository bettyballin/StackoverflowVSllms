class Project\n  include DataMapper::Resource\n\n  property :id,     Serial\n  property :title,  String, :nullable => false\n\n  has 2..n, :tasks\n\n  before_save :validate_tasks\n\n  private\n\n  def validate_tasks\n    tasks.each do |task|\n      unless task.valid?\n        raise DataMapper::ValidationException.new("Task is invalid")\n      end\n    end\n    if tasks.size < 2\n      raise DataMapper::ValidationException.new("At least 2 tasks are required")\n    end\n  end\nend