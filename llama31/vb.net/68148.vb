Public Sub Capture(ByVal MyImage As Canvas)\n    ' Determine the constraining scale to maintain the aspect ratio and the bounds of the image size\n    Dim scale As Double = Math.Min(Width / MyImage.Width, Height / MyImage.Height)\n\n    ' Create a scale transform to scale the canvas\n    Dim scaleTransform As New ScaleTransform(scale, scale)\n\n    ' Apply the scale transform to the canvas\n    MyImage.LayoutTransform = scaleTransform\n\n    ' Create the target bitmap\n    Dim rtb As RenderTargetBitmap = New RenderTargetBitmap(CInt(Width * scale * 300 / 96.0), CInt(Height * scale * 300 / 96.0), 300, 300, PixelFormats.Pbgra32)\n\n    ' Render the image to the target bitmap\n    Dim dv As DrawingVisual = New DrawingVisual()\n    Using ctx As DrawingContext = dv.RenderOpen()\n        Dim vb As New VisualBrush(MyImage)\n        ctx.DrawRectangle(vb, Nothing, New Rect(New System.Windows.Point(), New Size(Width * scale, Height * scale)))\n    End Using\n    rtb.Render(dv)\n\n    ' Encode the image in the format selected\n    Dim encoder As System.Windows.Media.Imaging.BitmapEncoder\n    Select Case Encoding.ToLower\n        Case "jpg"\n            encoder = New System.Windows.Media.Imaging.JpegBitmapEncoder()\n        Case "png"\n            encoder = New System.Windows.Media.Imaging.PngBitmapEncoder()\n        Case "gif"\n            encoder = New System.Windows.Media.Imaging.GifBitmapEncoder()\n        Case "bmp"\n            encoder = New System.Windows.Media.Imaging.BmpBitmapEncoder()\n        Case "tif"\n            encoder = New System.Windows.Media.Imaging.TiffBitmapEncoder()\n        Case "wmp"\n            encoder = New System.Windows.Media.Imaging.WmpBitmapEncoder()\n    End Select\n    encoder.Frames.Add(System.Windows.Media.Imaging.BitmapFrame.Create(rtb))\n\n    ' Create the memory stream to save the encoded image.\n    retImageStream = New System.IO.MemoryStream()\n    encoder.Save(retImageStream)\n    retImageStream.Flush()\n    retImageStream.Seek(0, System.IO.SeekOrigin.Begin)\n    MyImage = Nothing\nEnd Sub