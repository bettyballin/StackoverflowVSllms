Imports System.Runtime.InteropServices\n\nPublic Class TerminalServices\n    <DllImport("kernel32.dll")>\n    Private Shared Function WTSGetSessionInformation(\n        ByVal hServer As IntPtr,\n        ByVal sessionId As Integer,\n        ByVal infoClass As WTS_INFO_CLASS,\n        ByRef pBuffer As IntPtr,\n        ByRef pBytesReturned As IntPtr\n    ) As Boolean\n    End Function\n\n    <DllImport("kernel32.dll")>\n    Private Shared Function WTSCloseServerHandle(\n        ByVal hServer As IntPtr\n    ) As Boolean\n    End Function\n\n    Public Enum WTS_INFO_CLASS\n        WTSClientName\n    End Enum\n\n    Public Shared Function GetClientName() As String\n        Dim hServer As IntPtr = IntPtr.Zero\n        Dim sessionId As Integer = 0\n        Dim pBuffer As IntPtr = IntPtr.Zero\n        Dim pBytesReturned As IntPtr = IntPtr.Zero\n\n        Try\n            If WTSGetSessionInformation(hServer, sessionId, WTS_INFO_CLASS.WTSClientName, pBuffer, pBytesReturned) Then\n                Dim clientName As String = Marshal.PtrToStringAuto(pBuffer)\n                Return clientName\n            End If\n        Finally\n            If pBuffer <> IntPtr.Zero Then\n                Marshal.FreeHGlobal(pBuffer)\n            End If\n            If hServer <> IntPtr.Zero Then\n                WTSCloseServerHandle(hServer)\n            End If\n        End Try\n\n        Return Nothing\n    End Function\nEnd Class