Private Declare Function NetUserGetGroups Lib "netapi32" _\n    Alias "NetUserGetGroups" ( _\n    ByVal servername As String, _\n    ByVal username As String, _\n    ByVal level As Long, _\n    ByRef bufptr As Long, _\n    ByVal prefmaxlen As Long, _\n    ByRef entriesread As Long, _\n    ByRef totalentries As Long, _\n    ByRef resume As Long) As Long\n\nPrivate Declare Function NetApiBufferFree Lib "netapi32" _\n    Alias "NetApiBufferFree" (ByVal buffer As Long) As Long\n\nPrivate Const MAX_PREFERRED_LENGTH = -1\n\nPublic Function IsUserInGroup(username As String, groupname As String) As Boolean\n    Dim servername As String\n    Dim bufptr As Long\n    Dim prefmaxlen As Long\n    Dim entriesread As Long\n    Dim totalentries As Long\n    Dim resume As Long\n    Dim i As Long\n    Dim gr As GROUP_USERS_INFO_0\n    \n    servername = "" ' local machine\n    prefmaxlen = MAX_PREFERRED_LENGTH\n    resume = 0\n    \n    ' Get the groups for the user\n    If NetUserGetGroups(servername, username, 0, bufptr, prefmaxlen, entriesread, totalentries, resume) = 0 Then\n        ' Loop through the groups\n        For i = 0 To entriesread - 1\n            ' Get the group info\n            CopyMemory gr, ByVal bufptr + (i * Len(gr)), Len(gr)\n            \n            ' Check if the group matches\n            If gr.grui0_name = groupname Then\n                IsUserInGroup = True\n                Exit Function\n            End If\n        Next i\n    End If\n    \n    ' Free the buffer\n    NetApiBufferFree bufptr\n    \n    IsUserInGroup = False\nEnd Functio