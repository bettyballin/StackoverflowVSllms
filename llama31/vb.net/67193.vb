Imports System.Runtime.InteropServices\n\nPublic Class FileGroupDescriptor\n    <DllImport("ole32.dll", CharSet:=CharSet.Unicode, ExactSpelling:=True, PreserveSig:=False)>\n    Private Shared Function OleGetClipboardData(format As Integer) As IntPtr\n    End Function\n\n    <DllImport("kernel32.dll", CharSet:=CharSet.Unicode)>\n    Private Shared Function GlobalLock(hMem As IntPtr) As IntPtr\n    End Function\n\n    <DllImport("kernel32.dll", CharSet:=CharSet.Unicode)>\n    Private Shared Function GlobalUnlock(hMem As IntPtr) As Boolean\n    End Function\n\n    <StructLayout(LayoutKind.Sequential)>\n    Private Structure FILEGROUPDESCRIPTOR\n        Public cItems As UInt32\n        <MarshalAs(UnmanagedType.ByValArray, SizeParamIndex:=0)>\n        Public fgd() As FILEDESCRIPTOR\n    End Structure\n\n    <StructLayout(LayoutKind.Sequential)>\n    Private Structure FILEDESCRIPTOR\n        Public dwFlags As UInt32\n        Public clsid As Guid\n        Public sizel As SIZE\n        Public pointl As POINT\n        Public dwFileAttributes As UInt32\n        Public ftLastAccessTime As FILETIME\n        Public ftLastWriteTime As FILETIME\n        Public nFileSizeHigh As UInt32\n        Public nFileSizeLow As UInt32\n        <MarshalAs(UnmanagedType.ByValTStr, SizeConst:=260)>\n        Public cFileName As String\n    End Structure\n\n    <StructLayout(LayoutKind.Sequential)>\n    Private Structure SIZE\n        Public cx As Int32\n        Public cy As Int32\n    End Structure\n\n    <StructLayout(LayoutKind.Sequential)>\n    Private Structure POINT\n        Public x As Int32\n        Public y As Int32\n    End Structure\n\n    <StructLayout(LayoutKind.Sequential)>\n    Private Structure FILETIME\n        Public dwLowDateTime As UInt32\n        Public dwHighDateTime As UInt32\n    End Structure\n\n    Public Shared Function GetFileName() As String\n        Dim hData As IntPtr = OleGetClipboardData(80) ' 80 is the format ID for FileGroupDescriptorW\n        If hData = IntPtr.Zero Then Return Nothing\n\n        Dim pData As IntPtr = GlobalLock(hData)\n        If pData = IntPtr.Zero Then Return Nothing\n\n        Dim fgDesc As New FILEGROUPDESCRIPTOR()\n        Marshal.PtrToStructure(pData, fgDesc)\n\n        If fgDesc.cItems = 0 Then Return Nothing\n\n        Dim fileName As String = fgDesc.fgd(0).cFileName\n\n        GlobalUnlock(hData)\n\n        Return fileName\n    End Function\nEnd Class