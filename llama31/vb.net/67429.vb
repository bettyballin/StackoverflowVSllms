Function GuidToBase64(guid As Guid) As String\n    Return Convert.ToBase64String(guid.ToByteArray(), Base64FormattingOptions.UrlTokenEncode)\nEnd Function\n\nFunction Base64ToGuid(base64 As String) As Guid\n    If base64.Length <> 22 Then\n        Throw New ArgumentException("Invalid base64-encoded GUID length", NameOf(base64))\n    End If\n\n    If Not IsValidBase64String(base64) Then\n        Throw New ArgumentException("Invalid base64-encoded GUID", NameOf(base64))\n    End If\n\n    Try\n        Dim bytes = Convert.FromBase64String(base64 + "==")\n        Return New Guid(bytes)\n    Catch ex As Exception\n        Throw New Exception("Bad Base64 conversion to GUID", ex)\n    End Try\nEnd Function\n\nPrivate Function IsValidBase64String(s As String) As Boolean\n    Return s.All(Function(c) Char.IsLetterOrDigit(c) OrElse c = "-" OrElse c = "_")\nEnd Functio